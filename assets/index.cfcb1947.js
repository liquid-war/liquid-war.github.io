(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();function noop$1(){}function run(i){return i()}function blank_object(){return Object.create(null)}function run_all(i){i.forEach(run)}function is_function(i){return typeof i=="function"}function safe_not_equal(i,e){return i!=i?e==e:i!==e||i&&typeof i=="object"||typeof i=="function"}function is_empty(i){return Object.keys(i).length===0}function subscribe(i,...e){if(i==null)return noop$1;const t=i.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function get_store_value(i){let e;return subscribe(i,t=>e=t)(),e}function component_subscribe(i,e,t){i.$$.on_destroy.push(subscribe(e,t))}function append(i,e){i.appendChild(e)}function insert(i,e,t){i.insertBefore(e,t||null)}function detach(i){i.parentNode.removeChild(i)}function destroy_each(i,e){for(let t=0;t<i.length;t+=1)i[t]&&i[t].d(e)}function element(i){return document.createElement(i)}function svg_element(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function text(i){return document.createTextNode(i)}function space(){return text(" ")}function listen(i,e,t,r){return i.addEventListener(e,t,r),()=>i.removeEventListener(e,t,r)}function prevent_default(i){return function(e){return e.preventDefault(),i.call(this,e)}}function attr(i,e,t){t==null?i.removeAttribute(e):i.getAttribute(e)!==t&&i.setAttribute(e,t)}function children(i){return Array.from(i.childNodes)}function set_data(i,e){e=""+e,i.wholeText!==e&&(i.data=e)}function set_input_value(i,e){i.value=e==null?"":e}function set_style(i,e,t,r){t===null?i.style.removeProperty(e):i.style.setProperty(e,t,r?"important":"")}let current_component;function set_current_component(i){current_component=i}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(i){get_current_component().$$.on_mount.push(i)}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(i){render_callbacks.push(i)}const seen_callbacks=new Set;let flushidx=0;function flush(){const i=current_component;do{for(;flushidx<dirty_components.length;){const e=dirty_components[flushidx];flushidx++,set_current_component(e),update(e.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let e=0;e<render_callbacks.length;e+=1){const t=render_callbacks[e];seen_callbacks.has(t)||(seen_callbacks.add(t),t())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(i)}function update(i){if(i.fragment!==null){i.update(),run_all(i.before_update);const e=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,e),i.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(i,e){i&&i.i&&(outroing.delete(i),i.i(e))}function transition_out(i,e,t,r){if(i&&i.o){if(outroing.has(i))return;outroing.add(i),outros.c.push(()=>{outroing.delete(i),r&&(t&&i.d(1),r())}),i.o(e)}else r&&r()}function create_component(i){i&&i.c()}function mount_component(i,e,t,r){const{fragment:s,after_update:n}=i.$$;s&&s.m(e,t),r||add_render_callback(()=>{const o=i.$$.on_mount.map(run).filter(is_function);i.$$.on_destroy?i.$$.on_destroy.push(...o):run_all(o),i.$$.on_mount=[]}),n.forEach(add_render_callback)}function destroy_component(i,e){const t=i.$$;t.fragment!==null&&(run_all(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function make_dirty(i,e){i.$$.dirty[0]===-1&&(dirty_components.push(i),schedule_update(),i.$$.dirty.fill(0)),i.$$.dirty[e/31|0]|=1<<e%31}function init$1(i,e,t,r,s,n,o,a=[-1]){const l=current_component;set_current_component(i);const h=i.$$={fragment:null,ctx:[],props:n,update:noop$1,not_equal:s,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:blank_object(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(h.root);let c=!1;if(h.ctx=t?t(i,e.props||{},(u,d,...f)=>{const p=f.length?f[0]:d;return h.ctx&&s(h.ctx[u],h.ctx[u]=p)&&(!h.skip_bound&&h.bound[u]&&h.bound[u](p),c&&make_dirty(i,u)),d}):[],h.update(),c=!0,run_all(h.before_update),h.fragment=r?r(h.ctx):!1,e.target){if(e.hydrate){const u=children(e.target);h.fragment&&h.fragment.l(u),u.forEach(detach)}else h.fragment&&h.fragment.c();e.intro&&transition_in(i.$$.fragment),mount_component(i,e.target,e.anchor,e.customElement),flush()}set_current_component(l)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop$1}$on(e,t){if(!is_function(t))return noop$1;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!is_empty(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const subscriber_queue=[];function writable(i,e=noop$1){let t;const r=new Set;function s(a){if(safe_not_equal(i,a)&&(i=a,t)){const l=!subscriber_queue.length;for(const h of r)h[1](),subscriber_queue.push(h,i);if(l){for(let h=0;h<subscriber_queue.length;h+=2)subscriber_queue[h][0](subscriber_queue[h+1]);subscriber_queue.length=0}}}function n(a){s(a(i))}function o(a,l=noop$1){const h=[a,l];return r.add(h),r.size===1&&(t=e(s)||noop$1),a(i),()=>{r.delete(h),r.size===0&&(t(),t=null)}}return{set:s,update:n,subscribe:o}}var ENV=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(ENV||{}),BUFFER_BITS=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(BUFFER_BITS||{}),BLEND_MODES=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(BLEND_MODES||{}),DRAW_MODES=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(DRAW_MODES||{}),FORMATS=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(FORMATS||{}),TARGETS=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(TARGETS||{}),TYPES=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(TYPES||{}),SAMPLER_TYPES=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(SAMPLER_TYPES||{}),SCALE_MODES=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(SCALE_MODES||{}),WRAP_MODES=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(WRAP_MODES||{}),MIPMAP_MODES=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(MIPMAP_MODES||{}),ALPHA_MODES=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(ALPHA_MODES||{}),CLEAR_MODES=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(CLEAR_MODES||{}),GC_MODES=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(GC_MODES||{}),PRECISION=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(PRECISION||{}),MASK_TYPES=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(MASK_TYPES||{}),MSAA_QUALITY=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(MSAA_QUALITY||{}),BUFFER_TYPE=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(BUFFER_TYPE||{});const BrowserAdapter={createCanvas:(i,e)=>{const t=document.createElement("canvas");return t.width=i,t.height=e,t},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var i;return(i=document.baseURI)!=null?i:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(i,e)=>fetch(i,e)};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(i){return function(e){return e.test(i)}}function isMobile$1(i){var e={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?e.userAgent=i:i&&i.userAgent&&(e={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var s=createMatch(t),n={apple:{phone:s(appleIphone)&&!s(windowsPhone),ipod:s(appleIpod),tablet:!s(appleIphone)&&(s(appleTablet)||isAppleTabletOnIos13(e))&&!s(windowsPhone),universal:s(appleUniversal),device:(s(appleIphone)||s(appleIpod)||s(appleTablet)||s(appleUniversal)||isAppleTabletOnIos13(e))&&!s(windowsPhone)},amazon:{phone:s(amazonPhone),tablet:!s(amazonPhone)&&s(amazonTablet),device:s(amazonPhone)||s(amazonTablet)},android:{phone:!s(windowsPhone)&&s(amazonPhone)||!s(windowsPhone)&&s(androidPhone),tablet:!s(windowsPhone)&&!s(amazonPhone)&&!s(androidPhone)&&(s(amazonTablet)||s(androidTablet)),device:!s(windowsPhone)&&(s(amazonPhone)||s(amazonTablet)||s(androidPhone)||s(androidTablet))||s(/\bokhttp\b/i)},windows:{phone:s(windowsPhone),tablet:s(windowsTablet),device:s(windowsPhone)||s(windowsTablet)},other:{blackberry:s(otherBlackBerry),blackberry10:s(otherBlackBerry10),opera:s(otherOpera),firefox:s(otherFirefox),chrome:s(otherChrome),device:s(otherBlackBerry)||s(otherBlackBerry10)||s(otherOpera)||s(otherFirefox)||s(otherChrome)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const isMobile=isMobile$1(globalThis.navigator);function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(i){let e=!0;if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){const t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(isMobile.android.device){const t=navigator.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?i:4}const settings={ADAPTER:BrowserAdapter,MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:MSAA_QUALITY.NONE,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};settings.PREFER_ENV=ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var ExtensionType=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(ExtensionType||{});const normalizeExtension=i=>{if((typeof i=="function"||typeof i=="object"&&i.extension)&&(i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}),typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},extensions$1={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(normalizeExtension).forEach(e=>{e.type.forEach(t=>{var r,s;return(s=(r=this._removeHandlers)[t])==null?void 0:s.call(r,e)})}),this},add(...i){return i.map(normalizeExtension).forEach(e=>{e.type.forEach(t=>{const r=this._addHandlers,s=this._queue;r[t]?r[t](e):(s[t]=s[t]||[],s[t].push(e))})}),this},handle(i,e,t){const r=this._addHandlers,s=this._removeHandlers;r[i]=e,s[i]=t;const n=this._queue;return n[i]&&(n[i].forEach(o=>e(o)),delete n[i]),this},handleByMap(i,e){return this.handle(i,t=>{e[t.name]=t.ref},t=>{delete e[t.name]})},handleByList(i,e){return this.handle(i,t=>{e.includes(t.ref)||(e.push(t.ref),e.sort((r,s)=>{var n,o;return((n=s.priority)!=null?n:-1)-((o=r.priority)!=null?o:-1)}))},t=>{const r=e.indexOf(t.ref);r!==-1&&e.splice(r,1)})}},PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;var SHAPES=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(SHAPES||{});class Point{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Point(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}const tempPoints$1=[new Point,new Point,new Point,new Point];class Rectangle{constructor(e=0,t=0,r=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(s),this.type=SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Rectangle(0,0,0,0)}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const S=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=S)return!1;const D=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>D}const r=this.left,s=this.right,n=this.top,o=this.bottom;if(s<=r||o<=n)return!1;const a=tempPoints$1[0].set(e.left,e.top),l=tempPoints$1[1].set(e.left,e.bottom),h=tempPoints$1[2].set(e.right,e.top),c=tempPoints$1[3].set(e.right,e.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(t.a*t.d-t.b*t.c);if(u===0||(t.apply(a,a),t.apply(l,l),t.apply(h,h),t.apply(c,c),Math.max(a.x,l.x,h.x,c.x)<=r||Math.min(a.x,l.x,h.x,c.x)>=s||Math.max(a.y,l.y,h.y,c.y)<=n||Math.min(a.y,l.y,h.y,c.y)>=o))return!1;const d=u*(l.y-a.y),f=u*(a.x-l.x),p=d*r+f*n,m=d*s+f*n,g=d*r+f*o,y=d*s+f*o;if(Math.max(p,m,g,y)<=d*a.x+f*a.y||Math.min(p,m,g,y)>=d*c.x+f*c.y)return!1;const v=u*(a.y-h.y),_=u*(h.x-a.x),x=v*r+_*n,T=v*s+_*n,R=v*r+_*o,A=v*s+_*o;return!(Math.max(x,T,R,A)<=v*a.x+_*a.y||Math.min(x,T,R,A)>=v*c.x+_*c.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,t=.001){const r=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=s-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=s,this.height=n-s,this}}class Circle{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.radius=r,this.type=SHAPES.CIRC}clone(){return new Circle(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const r=this.radius*this.radius;let s=this.x-e,n=this.y-t;return s*=s,n*=n,s+n<=r}getBounds(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class Ellipse{constructor(e=0,t=0,r=0,s=0){this.x=e,this.y=t,this.width=r,this.height=s,this.type=SHAPES.ELIP}clone(){return new Ellipse(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let r=(e-this.x)/this.width,s=(t-this.y)/this.height;return r*=r,s*=s,r+s<=1}getBounds(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}}class Polygon{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const r=[];for(let s=0,n=t.length;s<n;s++)r.push(t[s].x,t[s].y);t=r}this.points=t,this.type=SHAPES.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Polygon(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let r=!1;const s=this.points.length/2;for(let n=0,o=s-1;n<s;o=n++){const a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],c=this.points[o*2+1];l>t!=c>t&&e<(h-a)*((t-l)/(c-l))+a&&(r=!r)}return r}}class RoundedRectangle{constructor(e=0,t=0,r=0,s=0,n=20){this.x=e,this.y=t,this.width=r,this.height=s,this.radius=n,this.type=SHAPES.RREC}clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+r&&t<=this.y+this.height-r||e>=this.x+r&&e<=this.x+this.width-r)return!0;let s=e-(this.x+r),n=t-(this.y+r);const o=r*r;if(s*s+n*n<=o||(s=e-(this.x+this.width-r),s*s+n*n<=o)||(n=t-(this.y+this.height-r),s*s+n*n<=o)||(s=e-(this.x+r),s*s+n*n<=o))return!0}return!1}}class ObservablePoint{constructor(e,t,r=0,s=0){this._x=r,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new ObservablePoint(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}class Matrix{constructor(e=1,t=0,r=0,s=1,n=0,o=0){this.array=null,this.a=e,this.b=t,this.c=r,this.d=s,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,r,s,n,o){return this.a=e,this.b=t,this.c=r,this.d=s,this.tx=n,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(e,t){t=t||new Point;const r=e.x,s=e.y;return t.x=this.a*r+this.c*s+this.tx,t.y=this.b*r+this.d*s+this.ty,t}applyInverse(e,t){t=t||new Point;const r=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return t.x=this.d*r*s+-this.c*r*n+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*n+-this.b*r*s+(-this.ty*this.a+this.tx*this.b)*r,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),s=this.a,n=this.c,o=this.tx;return this.a=s*t-this.b*r,this.b=s*r+this.b*t,this.c=n*t-this.d*r,this.d=n*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this}append(e){const t=this.a,r=this.b,s=this.c,n=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*r+e.b*n,this.c=e.c*t+e.d*s,this.d=e.c*r+e.d*n,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*r+e.ty*n+this.ty,this}setTransform(e,t,r,s,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+s*this.c),this.ty=t-(r*this.b+s*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const r=this.a,s=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,r=this.b,s=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-s,n),l=Math.atan2(r,t),h=Math.abs(a+l);return h<1e-5||Math.abs(PI_2-h)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(o.x*t+o.y*s),e.position.y=this.ty+(o.x*r+o.y*n),e}invert(){const e=this.a,t=this.b,r=this.c,s=this.d,n=this.tx,o=e*s-t*r;return this.a=s/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-s*n)/o,this.ty=-(e*this.ty-t*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Matrix;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Matrix}static get TEMP_MATRIX(){return new Matrix}}const ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(let i=0;i<16;i++){const e=[];rotationCayley.push(e);for(let t=0;t<16;t++){const r=signum(ux[i]*ux[t]+vx[i]*uy[t]),s=signum(uy[i]*ux[t]+vy[i]*uy[t]),n=signum(ux[i]*vx[t]+vx[i]*vy[t]),o=signum(uy[i]*vx[t]+vy[i]*vy[t]);for(let a=0;a<16;a++)if(ux[a]===r&&uy[a]===s&&vx[a]===n&&vy[a]===o){e.push(a);break}}}for(let i=0;i<16;i++){const e=new Matrix;e.set(ux[i],uy[i],vx[i],vy[i],0,0),rotationMatrices.push(e)}}init();const groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>ux[i],uY:i=>uy[i],vX:i=>vx[i],vY:i=>vy[i],inv:i=>i&8?i&15:-i&7,add:(i,e)=>rotationCayley[i][e],sub:(i,e)=>rotationCayley[i][groupD8.inv(e)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,e)=>Math.abs(i)*2<=Math.abs(e)?e>=0?groupD8.S:groupD8.N:Math.abs(e)*2<=Math.abs(i)?i>0?groupD8.E:groupD8.W:e>0?i>0?groupD8.SE:groupD8.SW:i>0?groupD8.NE:groupD8.NW,matrixAppendRotationInv:(i,e,t=0,r=0)=>{const s=rotationMatrices[groupD8.inv(e)];s.tx=t,s.ty=r,i.append(s)}},_Transform=class{constructor(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const t=i.worldTransform,r=this.worldTransform;r.a=e.a*t.a+e.b*t.c,r.b=e.a*t.b+e.b*t.d,r.c=e.c*t.a+e.d*t.c,r.d=e.c*t.b+e.d*t.d,r.tx=e.tx*t.a+e.ty*t.c+t.tx,r.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let Transform=_Transform;Transform.IDENTITY=new _Transform;class Runner{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,r,s,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][h](e,t,r,s,n,o,a,l);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});settings.TARGET_FPMS=.06;var UPDATE_PRIORITY=(i=>(i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(UPDATE_PRIORITY||{});class TickerListener{constructor(e,t=null,r=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=r,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}class Ticker{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,r=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(e,t,r))}addOnce(e,t,r=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(e,t,r,!0))}_addListener(e){let t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this}remove(e,t){let r=this._head.next;for(;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;const r=this._head;let s=r.next;for(;s;)s=s.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Ticker._shared){const e=Ticker._shared=new Ticker;e.autoStart=!0,e._protected=!0}return Ticker._shared}static get system(){if(!Ticker._system){const e=Ticker._system=new Ticker;e.autoStart=!0,e._protected=!0}return Ticker._system}}class TickerPlugin{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ticker.shared:new Ticker,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}TickerPlugin.extension=ExtensionType.Application;extensions$1.add(TickerPlugin);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},eventemitter3={exports:{}};(function(i){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,h,c){this.fn=l,this.context=h,this.once=c||!1}function n(l,h,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,u||l,d),p=t?t+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new r:delete l._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],c,u;if(this._eventsCount===0)return h;for(u in c=this._events)e.call(c,u)&&h.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(c)):h},a.prototype.listeners=function(h){var c=t?t+h:h,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,p=new Array(f);d<f;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(h){var c=t?t+h:h,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,c,u,d,f,p){var m=t?t+h:h;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,v,_;if(g.fn){switch(g.once&&this.removeListener(h,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,u),!0;case 4:return g.fn.call(g.context,c,u,d),!0;case 5:return g.fn.call(g.context,c,u,d,f),!0;case 6:return g.fn.call(g.context,c,u,d,f,p),!0}for(_=1,v=new Array(y-1);_<y;_++)v[_-1]=arguments[_];g.fn.apply(g.context,v)}else{var x=g.length,T;for(_=0;_<x;_++)switch(g[_].once&&this.removeListener(h,g[_].fn,void 0,!0),y){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,c);break;case 3:g[_].fn.call(g[_].context,c,u);break;case 4:g[_].fn.call(g[_].context,c,u,d);break;default:if(!v)for(T=1,v=new Array(y-1);T<y;T++)v[T-1]=arguments[T];g[_].fn.apply(g[_].context,v)}}return!0},a.prototype.on=function(h,c,u){return n(this,h,c,u,!1)},a.prototype.once=function(h,c,u){return n(this,h,c,u,!0)},a.prototype.removeListener=function(h,c,u,d){var f=t?t+h:h;if(!this._events[f])return this;if(!c)return o(this,f),this;var p=this._events[f];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&o(this,f);else{for(var m=0,g=[],y=p.length;m<y;m++)(p[m].fn!==c||d&&!p[m].once||u&&p[m].context!==u)&&g.push(p[m]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(h){var c;return h?(c=t?t+h:h,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a})(eventemitter3);const EventEmitter$1=eventemitter3.exports;var earcut$1={exports:{}};earcut$1.exports=earcut;earcut$1.exports.default=earcut;function earcut(i,e,t){t=t||2;var r=e&&e.length,s=r?e[0]*t:i.length,n=linkedList(i,0,s,t,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,c,u,d,f;if(r&&(n=eliminateHoles(i,e,n,t)),i.length>80*t){a=h=i[0],l=c=i[1];for(var p=t;p<s;p+=t)u=i[p],d=i[p+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);f=Math.max(h-a,c-l),f=f!==0?32767/f:0}return earcutLinked(n,o,t,a,l,f,0),o}function linkedList(i,e,t,r,s){var n,o;if(s===signedArea(i,e,t,r)>0)for(n=e;n<t;n+=r)o=insertNode(n,i[n],i[n+1],o);else for(n=t-r;n>=e;n-=r)o=insertNode(n,i[n],i[n+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(i,e){if(!i)return i;e||(e=i);var t=i,r;do if(r=!1,!t.steiner&&(equals(t,t.next)||area(t.prev,t,t.next)===0)){if(removeNode(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function earcutLinked(i,e,t,r,s,n,o){if(!!i){!o&&n&&indexCurve(i,r,s,n);for(var a=i,l,h;i.prev!==i.next;){if(l=i.prev,h=i.next,n?isEarHashed(i,r,s,n):isEar(i)){e.push(l.i/t|0),e.push(i.i/t|0),e.push(h.i/t|0),removeNode(i),i=h.next,a=h.next;continue}if(i=h,i===a){o?o===1?(i=cureLocalIntersections(filterPoints(i),e,t),earcutLinked(i,e,t,r,s,n,2)):o===2&&splitEarcut(i,e,t,r,s,n):earcutLinked(filterPoints(i),e,t,r,s,n,1);break}}}}function isEar(i){var e=i.prev,t=i,r=i.next;if(area(e,t,r)>=0)return!1;for(var s=e.x,n=t.x,o=r.x,a=e.y,l=t.y,h=r.y,c=s<n?s<o?s:o:n<o?n:o,u=a<l?a<h?a:h:l<h?l:h,d=s>n?s>o?s:o:n>o?n:o,f=a>l?a>h?a:h:l>h?l:h,p=r.next;p!==e;){if(p.x>=c&&p.x<=d&&p.y>=u&&p.y<=f&&pointInTriangle(s,a,n,l,o,h,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(i,e,t,r){var s=i.prev,n=i,o=i.next;if(area(s,n,o)>=0)return!1;for(var a=s.x,l=n.x,h=o.x,c=s.y,u=n.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,p=c<u?c<d?c:d:u<d?u:d,m=a>l?a>h?a:h:l>h?l:h,g=c>u?c>d?c:d:u>d?u:d,y=zOrder(f,p,e,t,r),v=zOrder(m,g,e,t,r),_=i.prevZ,x=i.nextZ;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&pointInTriangle(a,c,l,u,h,d,_.x,_.y)&&area(_.prev,_,_.next)>=0||(_=_.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&pointInTriangle(a,c,l,u,h,d,x.x,x.y)&&area(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&pointInTriangle(a,c,l,u,h,d,_.x,_.y)&&area(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==s&&x!==o&&pointInTriangle(a,c,l,u,h,d,x.x,x.y)&&area(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function cureLocalIntersections(i,e,t){var r=i;do{var s=r.prev,n=r.next.next;!equals(s,n)&&intersects(s,r,r.next,n)&&locallyInside(s,n)&&locallyInside(n,s)&&(e.push(s.i/t|0),e.push(r.i/t|0),e.push(n.i/t|0),removeNode(r),removeNode(r.next),r=i=n),r=r.next}while(r!==i);return filterPoints(r)}function splitEarcut(i,e,t,r,s,n){var o=i;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&isValidDiagonal(o,a)){var l=splitPolygon(o,a);o=filterPoints(o,o.next),l=filterPoints(l,l.next),earcutLinked(o,e,t,r,s,n,0),earcutLinked(l,e,t,r,s,n,0);return}a=a.next}o=o.next}while(o!==i)}function eliminateHoles(i,e,t,r){var s=[],n,o,a,l,h;for(n=0,o=e.length;n<o;n++)a=e[n]*r,l=n<o-1?e[n+1]*r:i.length,h=linkedList(i,a,l,r,!1),h===h.next&&(h.steiner=!0),s.push(getLeftmost(h));for(s.sort(compareX),n=0;n<s.length;n++)t=eliminateHole(s[n],t);return t}function compareX(i,e){return i.x-e.x}function eliminateHole(i,e){var t=findHoleBridge(i,e);if(!t)return e;var r=splitPolygon(t,i);return filterPoints(r,r.next),filterPoints(t,t.next)}function findHoleBridge(i,e){var t=e,r=i.x,s=i.y,n=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var a=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=r&&a>n&&(n=a,o=t.x<t.next.x?t:t.next,a===r))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,h=o.x,c=o.y,u=1/0,d;t=o;do r>=t.x&&t.x>=h&&r!==t.x&&pointInTriangle(s<c?r:n,s,h,c,s<c?n:r,s,t.x,t.y)&&(d=Math.abs(s-t.y)/(r-t.x),locallyInside(t,i)&&(d<u||d===u&&(t.x>o.x||t.x===o.x&&sectorContainsSector(o,t)))&&(o=t,u=d)),t=t.next;while(t!==l);return o}function sectorContainsSector(i,e){return area(i.prev,i,e.prev)<0&&area(e.next,i,i.next)<0}function indexCurve(i,e,t,r){var s=i;do s.z===0&&(s.z=zOrder(s.x,s.y,e,t,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,sortLinked(s)}function sortLinked(i){var e,t,r,s,n,o,a,l,h=1;do{for(t=i,i=null,n=null,o=0;t;){for(o++,r=t,a=0,e=0;e<h&&(a++,r=r.nextZ,!!r);e++);for(l=h;a>0||l>0&&r;)a!==0&&(l===0||!r||t.z<=r.z)?(s=t,t=t.nextZ,a--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:i=s,s.prevZ=n,n=s;t=r}n.nextZ=null,h*=2}while(o>1);return i}function zOrder(i,e,t,r,s){return i=(i-t)*s|0,e=(e-r)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function getLeftmost(i){var e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function pointInTriangle(i,e,t,r,s,n,o,a){return(s-o)*(e-a)>=(i-o)*(n-a)&&(i-o)*(r-a)>=(t-o)*(e-a)&&(t-o)*(n-a)>=(s-o)*(r-a)}function isValidDiagonal(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!intersectsPolygon(i,e)&&(locallyInside(i,e)&&locallyInside(e,i)&&middleInside(i,e)&&(area(i.prev,i,e.prev)||area(i,e.prev,e))||equals(i,e)&&area(i.prev,i,i.next)>0&&area(e.prev,e,e.next)>0)}function area(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function equals(i,e){return i.x===e.x&&i.y===e.y}function intersects(i,e,t,r){var s=sign$1(area(i,e,t)),n=sign$1(area(i,e,r)),o=sign$1(area(t,r,i)),a=sign$1(area(t,r,e));return!!(s!==n&&o!==a||s===0&&onSegment(i,t,e)||n===0&&onSegment(i,r,e)||o===0&&onSegment(t,i,r)||a===0&&onSegment(t,e,r))}function onSegment(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function sign$1(i){return i>0?1:i<0?-1:0}function intersectsPolygon(i,e){var t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&intersects(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function locallyInside(i,e){return area(i.prev,i,i.next)<0?area(i,e,i.next)>=0&&area(i,i.prev,e)>=0:area(i,e,i.prev)<0||area(i,i.next,e)<0}function middleInside(i,e){var t=i,r=!1,s=(i.x+e.x)/2,n=(i.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&s<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==i);return r}function splitPolygon(i,e){var t=new Node(i.i,i.x,i.y),r=new Node(e.i,e.x,e.y),s=i.next,n=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,r.next=t,t.prev=r,n.next=r,r.prev=n,r}function insertNode(i,e,t,r){var s=new Node(i,e,t);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function removeNode(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Node(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(i,e,t,r){var s=e&&e.length,n=s?e[0]*t:i.length,o=Math.abs(signedArea(i,0,n,t));if(s)for(var a=0,l=e.length;a<l;a++){var h=e[a]*t,c=a<l-1?e[a+1]*t:i.length;o-=Math.abs(signedArea(i,h,c,t))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*t,f=r[a+1]*t,p=r[a+2]*t;u+=Math.abs((i[d]-i[p])*(i[f+1]-i[d+1])-(i[d]-i[f])*(i[p+1]-i[d+1]))}return o===0&&u===0?0:Math.abs((u-o)/o)};function signedArea(i,e,t,r){for(var s=0,n=e,o=t-r;n<t;n+=r)s+=(i[o]-i[n])*(i[n+1]+i[o+1]),o=n;return s}earcut.flatten=function(i){for(var e=i[0][0].length,t={vertices:[],holes:[],dimensions:e},r=0,s=0;s<i.length;s++){for(var n=0;n<i[s].length;n++)for(var o=0;o<e;o++)t.vertices.push(i[s][n][o]);s>0&&(r+=i[s-1].length,t.holes.push(r))}return t};var punycode$1={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,e){(function(t){var r=e&&!e.nodeType&&e,s=i&&!i.nodeType&&i,n=typeof commonjsGlobal=="object"&&commonjsGlobal;(n.global===n||n.window===n||n.self===n)&&(t=n);var o,a=2147483647,l=36,h=1,c=26,u=38,d=700,f=72,p=128,m="-",g=/^xn--/,y=/[^\x20-\x7E]/,v=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},x=l-h,T=Math.floor,R=String.fromCharCode,A;function S(b){throw RangeError(_[b])}function M(b,B){for(var N=b.length,G=[];N--;)G[N]=B(b[N]);return G}function D(b,B){var N=b.split("@"),G="";N.length>1&&(G=N[0]+"@",b=N[1]),b=b.replace(v,".");var U=b.split("."),$=M(U,B).join(".");return G+$}function I(b){for(var B=[],N=0,G=b.length,U,$;N<G;)U=b.charCodeAt(N++),U>=55296&&U<=56319&&N<G?($=b.charCodeAt(N++),($&64512)==56320?B.push(((U&1023)<<10)+($&1023)+65536):(B.push(U),N--)):B.push(U);return B}function P(b){return M(b,function(B){var N="";return B>65535&&(B-=65536,N+=R(B>>>10&1023|55296),B=56320|B&1023),N+=R(B),N}).join("")}function w(b){return b-48<10?b-22:b-65<26?b-65:b-97<26?b-97:l}function E(b,B){return b+22+75*(b<26)-((B!=0)<<5)}function O(b,B,N){var G=0;for(b=N?T(b/d):b>>1,b+=T(b/B);b>x*c>>1;G+=l)b=T(b/x);return T(G+(x+1)*b/(b+u))}function L(b){var B=[],N=b.length,G,U=0,$=p,F=f,H,j,q,Y,W,z,V,K,Z;for(H=b.lastIndexOf(m),H<0&&(H=0),j=0;j<H;++j)b.charCodeAt(j)>=128&&S("not-basic"),B.push(b.charCodeAt(j));for(q=H>0?H+1:0;q<N;){for(Y=U,W=1,z=l;q>=N&&S("invalid-input"),V=w(b.charCodeAt(q++)),(V>=l||V>T((a-U)/W))&&S("overflow"),U+=V*W,K=z<=F?h:z>=F+c?c:z-F,!(V<K);z+=l)Z=l-K,W>T(a/Z)&&S("overflow"),W*=Z;G=B.length+1,F=O(U-Y,G,Y==0),T(U/G)>a-$&&S("overflow"),$+=T(U/G),U%=G,B.splice(U++,0,$)}return P(B)}function C(b){var B,N,G,U,$,F,H,j,q,Y,W,z=[],V,K,Z,J;for(b=I(b),V=b.length,B=p,N=0,$=f,F=0;F<V;++F)W=b[F],W<128&&z.push(R(W));for(G=U=z.length,U&&z.push(m);G<V;){for(H=a,F=0;F<V;++F)W=b[F],W>=B&&W<H&&(H=W);for(K=G+1,H-B>T((a-N)/K)&&S("overflow"),N+=(H-B)*K,B=H,F=0;F<V;++F)if(W=b[F],W<B&&++N>a&&S("overflow"),W==B){for(j=N,q=l;Y=q<=$?h:q>=$+c?c:q-$,!(j<Y);q+=l)J=j-Y,Z=l-Y,z.push(R(E(Y+J%Z,0))),j=T(J/Z);z.push(R(E(j,0))),$=O(N,K,G==U),N=0,++G}++N,++B}return z.join("")}function k(b){return D(b,function(B){return g.test(B)?L(B.slice(4).toLowerCase()):B})}function X(b){return D(b,function(B){return y.test(B)?"xn--"+C(B):B})}if(o={version:"1.3.2",ucs2:{decode:I,encode:P},decode:L,encode:C,toASCII:X,toUnicode:k},r&&s)if(i.exports==r)s.exports=o;else for(A in o)o.hasOwnProperty(A)&&(r[A]=o[A]);else t.punycode=o})(commonjsGlobal)})(punycode$1,punycode$1.exports);var util$6={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},querystring$1={};function hasOwnProperty(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var decode=function(i,e,t,r){e=e||"&",t=t||"=";var s={};if(typeof i!="string"||i.length===0)return s;var n=/\+/g;i=i.split(e);var o=1e3;r&&typeof r.maxKeys=="number"&&(o=r.maxKeys);var a=i.length;o>0&&a>o&&(a=o);for(var l=0;l<a;++l){var h=i[l].replace(n,"%20"),c=h.indexOf(t),u,d,f,p;c>=0?(u=h.substr(0,c),d=h.substr(c+1)):(u=h,d=""),f=decodeURIComponent(u),p=decodeURIComponent(d),hasOwnProperty(s,f)?Array.isArray(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s},stringifyPrimitive=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},encode=function(i,e,t,r){return e=e||"&",t=t||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(s){var n=encodeURIComponent(stringifyPrimitive(s))+t;return Array.isArray(i[s])?i[s].map(function(o){return n+encodeURIComponent(stringifyPrimitive(o))}).join(e):n+encodeURIComponent(stringifyPrimitive(i[s]))}).join(e):r?encodeURIComponent(stringifyPrimitive(r))+t+encodeURIComponent(stringifyPrimitive(i)):""};querystring$1.decode=querystring$1.parse=decode;querystring$1.encode=querystring$1.stringify=encode;var punycode=punycode$1.exports,util$5=util$6,parse=urlParse,resolve=urlResolve,format=urlFormat;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=querystring$1;function urlParse(i,e,t){if(i&&util$5.isObject(i)&&i instanceof Url)return i;var r=new Url;return r.parse(i,e,t),r}Url.prototype.parse=function(i,e,t){if(!util$5.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),s=r!==-1&&r<i.indexOf("#")?"?":"#",n=i.split(s),o=/\\/g;n[0]=n[0].replace(o,"/"),i=n.join(s);var a=i;if(a=a.trim(),!t&&i.split("#").length===1){var l=simplePathPattern.exec(a);if(l)return this.path=a,this.href=a,this.pathname=l[1],l[2]?(this.search=l[2],e?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var h=protocolPattern.exec(a);if(h){h=h[0];var c=h.toLowerCase();this.protocol=c,a=a.substr(h.length)}if(t||h||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=a.substr(0,2)==="//";u&&!(h&&hostlessProtocol[h])&&(a=a.substr(2),this.slashes=!0)}if(!hostlessProtocol[h]&&(u||h&&!slashedProtocol[h])){for(var d=-1,f=0;f<hostEndingChars.length;f++){var p=a.indexOf(hostEndingChars[f]);p!==-1&&(d===-1||p<d)&&(d=p)}var m,g;d===-1?g=a.lastIndexOf("@"):g=a.lastIndexOf("@",d),g!==-1&&(m=a.slice(0,g),a=a.slice(g+1),this.auth=decodeURIComponent(m)),d=-1;for(var f=0;f<nonHostChars.length;f++){var p=a.indexOf(nonHostChars[f]);p!==-1&&(d===-1||p<d)&&(d=p)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var v=this.hostname.split(/\./),f=0,_=v.length;f<_;f++){var x=v[f];if(!!x&&!x.match(hostnamePartPattern)){for(var T="",R=0,A=x.length;R<A;R++)x.charCodeAt(R)>127?T+="x":T+=x[R];if(!T.match(hostnamePartPattern)){var S=v.slice(0,f),M=v.slice(f+1),D=x.match(hostnamePartStart);D&&(S.push(D[1]),M.unshift(D[2])),M.length&&(a="/"+M.join(".")+a),this.hostname=S.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=punycode.toASCII(this.hostname));var I=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+I,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!unsafeProtocol[c])for(var f=0,_=autoEscape.length;f<_;f++){var w=autoEscape[f];if(a.indexOf(w)!==-1){var E=encodeURIComponent(w);E===w&&(E=escape(w)),a=a.split(w).join(E)}}var O=a.indexOf("#");O!==-1&&(this.hash=a.substr(O),a=a.slice(0,O));var L=a.indexOf("?");if(L!==-1?(this.search=a.substr(L),this.query=a.substr(L+1),e&&(this.query=querystring.parse(this.query)),a=a.slice(0,L)):e&&(this.search="",this.query={}),a&&(this.pathname=a),slashedProtocol[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var I=this.pathname||"",C=this.search||"";this.path=I+C}return this.href=this.format(),this};function urlFormat(i){return util$5.isString(i)&&(i=urlParse(i)),i instanceof Url?i.format():Url.prototype.format.call(i)}Url.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",s=!1,n="";this.host?s=i+this.host:this.hostname&&(s=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(s+=":"+this.port)),this.query&&util$5.isObject(this.query)&&Object.keys(this.query).length&&(n=querystring.stringify(this.query));var o=this.search||n&&"?"+n||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||slashedProtocol[e])&&s!==!1?(s="//"+(s||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):s||(s=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+s+t+o+r};function urlResolve(i,e){return urlParse(i,!1,!0).resolve(e)}Url.prototype.resolve=function(i){return this.resolveObject(urlParse(i,!1,!0)).format()};Url.prototype.resolveObject=function(i){if(util$5.isString(i)){var e=new Url;e.parse(i,!1,!0),i=e}for(var t=new Url,r=Object.keys(this),s=0;s<r.length;s++){var n=r[s];t[n]=this[n]}if(t.hash=i.hash,i.href==="")return t.href=t.format(),t;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=i[l])}return slashedProtocol[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(i.protocol&&i.protocol!==t.protocol){if(!slashedProtocol[i.protocol]){for(var h=Object.keys(i),c=0;c<h.length;c++){var u=h[c];t[u]=i[u]}return t.href=t.format(),t}if(t.protocol=i.protocol,!i.host&&!hostlessProtocol[i.protocol]){for(var _=(i.pathname||"").split("/");_.length&&!(i.host=_.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),_[0]!==""&&_.unshift(""),_.length<2&&_.unshift(""),t.pathname=_.join("/")}else t.pathname=i.pathname;if(t.search=i.search,t.query=i.query,t.host=i.host||"",t.auth=i.auth,t.hostname=i.hostname||i.host,t.port=i.port,t.pathname||t.search){var d=t.pathname||"",f=t.search||"";t.path=d+f}return t.slashes=t.slashes||i.slashes,t.href=t.format(),t}var p=t.pathname&&t.pathname.charAt(0)==="/",m=i.host||i.pathname&&i.pathname.charAt(0)==="/",g=m||p||t.host&&i.pathname,y=g,v=t.pathname&&t.pathname.split("/")||[],_=i.pathname&&i.pathname.split("/")||[],x=t.protocol&&!slashedProtocol[t.protocol];if(x&&(t.hostname="",t.port=null,t.host&&(v[0]===""?v[0]=t.host:v.unshift(t.host)),t.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(_[0]===""?_[0]=i.host:_.unshift(i.host)),i.host=null),g=g&&(_[0]===""||v[0]==="")),m)t.host=i.host||i.host===""?i.host:t.host,t.hostname=i.hostname||i.hostname===""?i.hostname:t.hostname,t.search=i.search,t.query=i.query,v=_;else if(_.length)v||(v=[]),v.pop(),v=v.concat(_),t.search=i.search,t.query=i.query;else if(!util$5.isNullOrUndefined(i.search)){if(x){t.hostname=t.host=v.shift();var T=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;T&&(t.auth=T.shift(),t.host=t.hostname=T.shift())}return t.search=i.search,t.query=i.query,(!util$5.isNull(t.pathname)||!util$5.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!v.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var R=v.slice(-1)[0],A=(t.host||i.host||v.length>1)&&(R==="."||R==="..")||R==="",S=0,M=v.length;M>=0;M--)R=v[M],R==="."?v.splice(M,1):R===".."?(v.splice(M,1),S++):S&&(v.splice(M,1),S--);if(!g&&!y)for(;S--;S)v.unshift("..");g&&v[0]!==""&&(!v[0]||v[0].charAt(0)!=="/")&&v.unshift(""),A&&v.join("/").substr(-1)!=="/"&&v.push("");var D=v[0]===""||v[0]&&v[0].charAt(0)==="/";if(x){t.hostname=t.host=D?"":v.length?v.shift():"";var T=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;T&&(t.auth=T.shift(),t.host=t.hostname=T.shift())}return g=g||t.host&&v.length,g&&!D&&v.unshift(""),v.length?t.pathname=v.join("/"):(t.pathname=null,t.path=null),(!util$5.isNull(t.pathname)||!util$5.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=i.auth||t.auth,t.slashes=t.slashes||i.slashes,t.href=t.format(),t};Url.prototype.parseHost=function(){var i=this.host,e=portPattern.exec(i);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)};const url={parse,format,resolve};function assertPath(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function removeUrlParams(i){return i.split("?")[0].split("#")[0]}function escapeRegExp(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function replaceAll(i,e,t){return i.replace(new RegExp(escapeRegExp(e),"g"),t)}function normalizeStringPosix(i,e){let t="",r=0,s=-1,n=0,o;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(s===a-1||n===1))if(s!==a-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=a,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=a,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+=`/${i.slice(s+1,a)}`:t=i.slice(s+1,a),r=a-s-1;s=a,n=0}else o===46&&n!==-1?++n:n=-1}return t}const path={toPosix(i){return replaceAll(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){assertPath(i),i=this.toPosix(i);let e="";const t=/^file:\/\/\//.exec(i),r=/^[^/:]+:\/\//.exec(i),s=/^[^/:]+:\//.exec(i);if(t||r||s){const n=(t==null?void 0:t[0])||(r==null?void 0:r[0])||(s==null?void 0:s[0]);e=n,i=i.slice(n.length)}return e},toAbsolute(i,e,t){if(this.isDataUrl(i))return i;const r=removeUrlParams(this.toPosix(e!=null?e:settings.ADAPTER.getBaseUrl())),s=removeUrlParams(this.toPosix(t!=null?t:this.rootname(r)));return assertPath(i),i=this.toPosix(i),i.startsWith("/")?path.join(s,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(i=this.toPosix(i),assertPath(i),i.length===0)return".";let e="";const t=i.startsWith("/");this.hasProtocol(i)&&(e=this.rootname(i),i=i.slice(e.length));const r=i.endsWith("/");return i=normalizeStringPosix(i,!1),i.length>0&&r&&(i+="/"),t?`/${i}`:e+i},isAbsolute(i){return assertPath(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){var t;if(i.length===0)return".";let e;for(let r=0;r<i.length;++r){const s=i[r];if(assertPath(s),s.length>0)if(e===void 0)e=s;else{const n=(t=i[r-1])!=null?t:"";this.extname(n)?e+=`/../${s}`:e+=`/${s}`}}return e===void 0?".":this.normalize(e)},dirname(i){if(assertPath(i),i.length===0)return".";i=this.toPosix(i);let e=i.charCodeAt(0);const t=e===47;let r=-1,s=!0;const n=this.getProtocol(i),o=i;i=i.slice(n.length);for(let a=i.length-1;a>=1;--a)if(e=i.charCodeAt(a),e===47){if(!s){r=a;break}}else s=!1;return r===-1?t?"/":this.isUrl(o)?n+i:n:t&&r===1?"//":n+i.slice(0,r)},rootname(i){assertPath(i),i=this.toPosix(i);let e="";if(i.startsWith("/")?e="/":e=this.getProtocol(i),this.isUrl(i)){const t=i.indexOf("/",e.length);t!==-1?e=i.slice(0,t):e=i,e.endsWith("/")||(e+="/")}return e},basename(i,e){assertPath(i),e&&assertPath(e),i=this.toPosix(i);let t=0,r=-1,s=!0,n;if(e!==void 0&&e.length>0&&e.length<=i.length){if(e.length===i.length&&e===i)return"";let o=e.length-1,a=-1;for(n=i.length-1;n>=0;--n){const l=i.charCodeAt(n);if(l===47){if(!s){t=n+1;break}}else a===-1&&(s=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(r=n):(o=-1,r=a))}return t===r?r=a:r===-1&&(r=i.length),i.slice(t,r)}for(n=i.length-1;n>=0;--n)if(i.charCodeAt(n)===47){if(!s){t=n+1;break}}else r===-1&&(s=!1,r=n+1);return r===-1?"":i.slice(t,r)},extname(i){assertPath(i),i=this.toPosix(i);let e=-1,t=0,r=-1,s=!0,n=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!s){t=o+1;break}continue}r===-1&&(s=!1,r=o+1),a===46?e===-1?e=o:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||r===-1||n===0||n===1&&e===r-1&&e===t+1?"":i.slice(e,r)},parse(i){assertPath(i);const e={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return e;i=this.toPosix(i);let t=i.charCodeAt(0);const r=this.isAbsolute(i);let s;e.root=this.rootname(i),r||this.hasProtocol(i)?s=1:s=0;let n=-1,o=0,a=-1,l=!0,h=i.length-1,c=0;for(;h>=s;--h){if(t=i.charCodeAt(h),t===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),t===46?n===-1?n=h:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||a===-1||c===0||c===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&r?e.base=e.name=i.slice(1,a):e.base=e.name=i.slice(o,a)):(o===0&&r?(e.name=i.slice(1,n),e.base=i.slice(1,a)):(e.name=i.slice(o,n),e.base=i.slice(o,a)),e.ext=i.slice(n,a)),e.dir=this.dirname(i),e},sep:"/",delimiter:":"};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=function(){const e={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;const t=settings.ADAPTER.createCanvas();let r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const s=!!(r&&r.getContextAttributes().stencil);if(r){const n=r.getExtension("WEBGL_lose_context");n&&n.loseContext()}return r=null,s}catch{return!1}}()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,goldenrod,gold,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavenderblush,lavender,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen};function hex2rgb(i,e=[]){return e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,e}function hex2string(i){let e=i.toString(16);return e="000000".substring(0,6-e.length)+e,`#${e}`}function string2hex(i){if(typeof i=="string"&&(i=cssColorNames[i.toLowerCase()]||i,i[0]==="#"&&(i=i.slice(1)),i.length===3)){const[e,t,r]=i;i=e+e+t+t+r+r}return parseInt(i,16)}function mapPremultipliedBlendModes(){const i=[],e=[];for(let r=0;r<32;r++)i[r]=r,e[r]=r;i[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,i[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,i[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,e[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,e[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,e[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;const t=[];return t.push(e),t.push(i),t}const premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(i,e){return premultiplyBlendMode[e?1:0][i]}function premultiplyRgba(i,e,t,r){return t=t||new Float32Array(4),r||r===void 0?(t[0]=i[0]*e,t[1]=i[1]*e,t[2]=i[2]*e):(t[0]=i[0],t[1]=i[1],t[2]=i[2]),t[3]=e,t}function premultiplyTint(i,e){if(e===1)return(e*255<<24)+i;if(e===0)return 0;let t=i>>16&255,r=i>>8&255,s=i&255;return t=t*e+.5|0,r=r*e+.5|0,s=s*e+.5|0,(e*255<<24)+(t<<16)+(r<<8)+s}function premultiplyTintToRgba(i,e,t,r){return t=t||new Float32Array(4),t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,(r||r===void 0)&&(t[0]*=e,t[1]*=e,t[2]*=e),t[3]=e,t}function createIndicesForQuads(i,e=null){const t=i*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let r=0,s=0;r<t;r+=6,s+=4)e[r+0]=s+0,e[r+1]=s+1,e[r+2]=s+2,e[r+3]=s+0,e[r+4]=s+2,e[r+5]=s+3;return e}function getBufferType(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function isPow2(i){return!(i&i-1)&&!!i}function log2(i){let e=(i>65535?1:0)<<4;i>>>=e;let t=(i>255?1:0)<<3;return i>>>=t,e|=t,t=(i>15?1:0)<<2,i>>>=t,e|=t,t=(i>3?1:0)<<1,i>>>=t,e|=t,e|i>>1}function removeItems(i,e,t){const r=i.length;let s;if(e>=r||t===0)return;t=e+t>r?r-e:t;const n=r-t;for(s=e;s<n;++s)i[s]=i[s+t];i.length=n}function sign(i){return i===0?0:i<0?-1:1}let nextUid=0;function uid(){return++nextUid}const ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);class CanvasRenderTarget{constructor(e,t,r){this.canvas=settings.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=r||settings.RESOLUTION,this.resize(e,t)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(e,t){this.canvas.width=Math.round(e*this.resolution),this.canvas.height=Math.round(t*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(e){this.canvas.width=Math.round(e)}get height(){return this.canvas.height}set height(e){this.canvas.height=Math.round(e)}}function trimCanvas(i){let e=i.width,t=i.height;const r=i.getContext("2d",{willReadFrequently:!0}),n=r.getImageData(0,0,e,t).data,o=n.length,a={top:null,left:null,right:null,bottom:null};let l=null,h,c,u;for(h=0;h<o;h+=4)n[h+3]!==0&&(c=h/4%e,u=~~(h/4/e),a.top===null&&(a.top=u),(a.left===null||c<a.left)&&(a.left=c),(a.right===null||a.right<c)&&(a.right=c+1),(a.bottom===null||a.bottom<u)&&(a.bottom=u));return a.top!==null&&(e=a.right-a.left,t=a.bottom-a.top+1,l=r.getImageData(a.left,a.top,e,t)),{height:t,width:e,data:l}}let tempAnchor;function determineCrossOrigin(i,e=globalThis.location){if(i.startsWith("data:"))return"";e=e||globalThis.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=i;const t=url.parse(tempAnchor.href),r=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!r||t.protocol!==e.protocol?"anonymous":""}function getResolutionOfUrl(i,e=1){const t=settings.RETINA_PREFIX.exec(i);return t?parseFloat(t[1]):e}const INSTALLED=[];function autoDetectResource(i,e){if(!i)return null;let t="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(t=r[1].toLowerCase())}for(let r=INSTALLED.length-1;r>=0;--r){const s=INSTALLED[r];if(s.test&&s.test(i,t))return new s(i,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Resource{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class BufferResource extends Resource{constructor(e,t){const{width:r,height:s}=t||{};if(!r||!s)throw new Error("BufferResource width or height invalid");super(r,s),this.data=e}upload(e,t,r){const s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ALPHA_MODES.UNPACK);const n=t.realWidth,o=t.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(t.target,0,0,0,n,o,t.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(t.target,0,r.internalFormat,n,o,0,t.format,r.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}}const defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM},_BaseTexture=class extends EventEmitter$1{constructor(i=null,e=null){super(),e=e||{};const{alphaMode:t,mipmap:r,anisotropicLevel:s,scaleMode:n,width:o,height:a,wrapMode:l,format:h,type:c,target:u,resolution:d,resourceOptions:f}=e;i&&!(i instanceof Resource)&&(i=autoDetectResource(i,f),i.internal=!0),this.resolution=d||settings.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r!=null?r:settings.MIPMAP_TEXTURES,this.anisotropicLevel=s!=null?s:settings.ANISOTROPIC_LEVEL,this._wrapMode=l||settings.WRAP_MODE,this._scaleMode=n!=null?n:settings.SCALE_MODE,this.format=h||FORMATS.RGBA,this.type=c||TYPES.UNSIGNED_BYTE,this.target=u||TARGETS.TEXTURE_2D,this.alphaMode=t!=null?t:ALPHA_MODES.UNPACK,this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,e){let t;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,t=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,t=!0),t&&this.dirtyStyleId++,this}setSize(i,e,t){return t=t||this.resolution,this.setRealSize(i*t,e*t,t)}setRealSize(i,e,t){return this.resolution=t||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)}setResolution(i){const e=this.resolution;return e===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*e)/i,this.height=Math.round(this.height*e)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),_BaseTexture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,e,t=settings.STRICT_TEXTURE_CACHE){const r=typeof i=="string";let s=null;if(r)s=i;else{if(!i._pixiId){const o=(e==null?void 0:e.pixiIdPrefix)||"pixiid";i._pixiId=`${o}_${uid()}`}s=i._pixiId}let n=BaseTextureCache[s];if(r&&t&&!n)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return n||(n=new _BaseTexture(i,e),n.cacheId=s,_BaseTexture.addToCache(n,s)),n}static fromBuffer(i,e,t,r){i=i||new Float32Array(e*t*4);const s=new BufferResource(i,{width:e,height:t}),n=i instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new _BaseTexture(s,Object.assign({},defaultBufferOptions,r||{width:e,height:t,type:n}))}static addToCache(i,e){e&&(i.textureCacheIds.includes(e)||i.textureCacheIds.push(e),BaseTextureCache[e]&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),BaseTextureCache[e]=i)}static removeFromCache(i){if(typeof i=="string"){const e=BaseTextureCache[i];if(e){const t=e.textureCacheIds.indexOf(i);return t>-1&&e.textureCacheIds.splice(t,1),delete BaseTextureCache[i],e}}else if(i!=null&&i.textureCacheIds){for(let e=0;e<i.textureCacheIds.length;++e)delete BaseTextureCache[i.textureCacheIds[e]];return i.textureCacheIds.length=0,i}return null}};let BaseTexture=_BaseTexture;BaseTexture._globalBatch=0;class AbstractMultiResource extends Resource{constructor(e,t){const{width:r,height:s}=t||{};super(r,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const o=new BaseTexture;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let r=0;r<this.length;r++)!e[r]||(e[r].castToBaseTexture?this.addBaseTextureAt(e[r].castToBaseTexture(),r):e[r]instanceof Resource?this.addResourceAt(e[r],r):this.addResourceAt(autoDetectResource(e[r],t),r))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const t=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(t).then(()=>{const{realWidth:r,realHeight:s}=this.items[0];return this.resize(r,s),Promise.resolve(this)}),this._load}}class ArrayResource extends AbstractMultiResource{constructor(e,t){const{width:r,height:s}=t||{};let n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:r,height:s}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=TARGETS.TEXTURE_2D_ARRAY}upload(e,t,r){const{length:s,itemDirtyIds:n,items:o}=this,{gl:a}=e;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,s,0,t.format,r.type,null);for(let l=0;l<s;l++){const h=o[l];n[l]<h.dirtyId&&(n[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,t.format,r.type,h.resource.source))}return!0}}class BaseImageResource extends Resource{constructor(e){const t=e,r=t.naturalWidth||t.videoWidth||t.width,s=t.naturalHeight||t.videoHeight||t.height;super(r,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,r){r===void 0&&!t.startsWith("data:")?e.crossOrigin=determineCrossOrigin(t):r!==!1&&(e.crossOrigin=typeof r=="string"?r:"anonymous")}upload(e,t,r,s){const n=e.gl,o=t.realWidth,a=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1&&s.buffered.length===0)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&r.width===o&&r.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,r.type,s):(r.width=o,r.height=a,n.texImage2D(t.target,0,r.internalFormat,t.format,r.type,s)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;this.resize(t,r),super.update()}dispose(){this.source=null}}class CanvasResource extends BaseImageResource{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const _CubeResource=class extends AbstractMultiResource{constructor(i,e){const{width:t,height:r,autoLoad:s,linkBaseTexture:n}=e||{};if(i&&i.length!==_CubeResource.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:t,height:r});for(let o=0;o<_CubeResource.SIDES;o++)this.items[o].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=n!==!1,i&&this.initFromArray(i,e),s!==!1&&this.load()}bind(i){super.bind(i),i.target=TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(i,e,t){if(t===void 0&&(t=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+e,i.parentTextureArray=this.baseTexture,this.items[e]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[e]=i,this}upload(i,e,t){const r=this.itemDirtyIds;for(let s=0;s<_CubeResource.SIDES;s++){const n=this.items[s];(r[s]<n.dirtyId||t.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(i,n,t),r[s]=n.dirtyId):r[s]<-1&&(i.gl.texImage2D(n.target,0,t.internalFormat,e.realWidth,e.realHeight,0,e.format,t.type,null),r[s]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===_CubeResource.SIDES}};let CubeResource=_CubeResource;CubeResource.SIDES=6;class ImageResource extends BaseImageResource{constructor(e,t){var r;if(t=t||{},typeof e=="string"){const s=new Image;BaseImageResource.crossOrigin(s,e,t.crossorigin),s.src=e,e=s}super(e),!e.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((r=t.createBitmap)!=null?r:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,r)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.resize(s.width,s.height),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=o=>{r(o),this.onError.emit(o)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,r=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:r?"cors":"no-cors"}).then(s=>s.blob()).then(s=>t(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,r){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,r,this.bitmap),!this.preserveBitmap){let s=!0;const n=t._glTextures;for(const o in n){const a=n[o];if(a!==r&&a.dirtyId!==t.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}const _SVGResource=class extends BaseImageResource{constructor(i,e){e=e||{},super(settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},_SVGResource.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;BaseImageResource.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=e=>{!this._resolve||(i.onerror=null,this.onError.emit(e))},i.onload=()=>{if(!this._resolve)return;const e=i.width,t=i.height;if(!e||!t)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,s=t*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/t*e,s=this._overrideHeight||this._overrideWidth/e*t),r=Math.round(r),s=Math.round(s);const n=this.source;n.width=r,n.height=s,n._pixiId=`canvas_${uid()}`,n.getContext("2d").drawImage(i,0,0,e,t,0,0,r,s),this._resolve(),this._resolve=null}}static getSize(i){const e=_SVGResource.SVG_SIZE.exec(i),t={};return e&&(t[e[1]]=Math.round(parseFloat(e[3])),t[e[5]]=Math.round(parseFloat(e[7]))),t}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,e){return e==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&_SVGResource.SVG_XML.test(i)}};let SVGResource=_SVGResource;SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const _VideoResource=class extends BaseImageResource{constructor(i,e){if(e=e||{},!(i instanceof HTMLVideoElement)){const t=document.createElement("video");t.setAttribute("preload","auto"),t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const r=i[0].src||i[0];BaseImageResource.crossOrigin(t,r,e.crossorigin);for(let s=0;s<i.length;++s){const n=document.createElement("source");let{src:o,mime:a}=i[s];o=o||i[s];const l=o.split("?").shift().toLowerCase(),h=l.slice(l.lastIndexOf(".")+1);a=a||_VideoResource.MIME_TYPES[h]||`video/${h}`,n.src=o,n.type=a,t.appendChild(n)}i=t}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const e=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(i.videoWidth,i.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,e){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||_VideoResource.TYPES.includes(e)}};let VideoResource=_VideoResource;VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ImageBitmapResource extends BaseImageResource{constructor(e,t){var s;var r=(...n)=>{super(...n)};t=t||{},typeof e=="string"?(r(ImageBitmapResource.EMPTY),this.url=e):(r(e),this.url=null),this.crossOrigin=(s=t.crossOrigin)!=null?s:!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const r=await settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await r.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=n,this.update(),e(this)}catch(r){if(this.destroyed)return;t(r),this.onError.emit(r)}}),this._load)}upload(e,t,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){var e;return ImageBitmapResource._EMPTY=(e=ImageBitmapResource._EMPTY)!=null?e:settings.ADAPTER.createCanvas(0,0),ImageBitmapResource._EMPTY}}INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);class DepthResource extends BufferResource{upload(e,t,r){const s=e.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===ALPHA_MODES.UNPACK);const n=t.realWidth,o=t.realHeight;return r.width===n&&r.height===o?s.texSubImage2D(t.target,0,0,0,n,o,t.format,r.type,this.data):(r.width=n,r.height=o,s.texImage2D(t.target,0,r.internalFormat,n,o,0,t.format,r.type,this.data)),!0}}class Framebuffer{constructor(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const s=this.colorTextures[r],n=s.resolution;s.setSize(e/n,t/n)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(e/r,t/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class BaseRenderTexture extends BaseTexture{constructor(e={}){var t;if(typeof e=="number"){const r=arguments[0],s=arguments[1],n=arguments[2],o=arguments[3];e={width:r,height:s,scaleMode:n,resolution:o}}e.width=e.width||100,e.height=e.height||100,(t=e.multisample)!=null||(e.multisample=MSAA_QUALITY.NONE),super(null,e),this.mipmap=MIPMAP_MODES.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,r){const s=t.width,n=t.height;if(r){const o=e.width/2/s,a=e.height/2/n,l=e.x/s+o,h=e.y/n+a;r=groupD8.add(r,groupD8.NW),this.x0=l+o*groupD8.uX(r),this.y0=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x1=l+o*groupD8.uX(r),this.y1=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x2=l+o*groupD8.uX(r),this.y2=h+a*groupD8.uY(r),r=groupD8.add(r,2),this.x3=l+o*groupD8.uX(r),this.y3=h+a*groupD8.uY(r)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const DEFAULT_UVS=new TextureUvs;function removeAllHandlers(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class Texture extends EventEmitter$1{constructor(e,t,r,s,n,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Rectangle(0,0,1,1)),e instanceof Texture&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this._uvs=DEFAULT_UVS,this.uvMatrix=null,this.orig=r||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Point(o.x,o.y):new Point(0,0),this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;(t==null?void 0:t.url)&&TextureCache[t.url]&&Texture.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null}clone(){var s;const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),r=new Texture(this.baseTexture,!this.noFrame&&e,t,(s=this.trim)==null?void 0:s.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},r=settings.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let n=null;if(s)n=e;else if(e instanceof BaseTexture){if(!e.cacheId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${a}-${uid()}`,BaseTexture.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${uid()}`}n=e._pixiId}let o=TextureCache[n];if(s&&r&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof BaseTexture)?(t.resolution||(t.resolution=getResolutionOfUrl(e)),o=new Texture(new BaseTexture(e,t)),o.baseTexture.cacheId=n,BaseTexture.addToCache(o.baseTexture,n),Texture.addToCache(o,n)):!o&&e instanceof BaseTexture&&(o=new Texture(e),Texture.addToCache(o,n)),o}static fromURL(e,t){const r=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),s=Texture.from(e,Object.assign({resourceOptions:r},t),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,t,r,s){return new Texture(BaseTexture.fromBuffer(e,t,r,s))}static fromLoader(e,t,r,s){const n=new BaseTexture(e,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(t)},s)),{resource:o}=n;o instanceof ImageResource&&(o.url=t);const a=new Texture(n);return r||(r=t),BaseTexture.addToCache(a.baseTexture,r),Texture.addToCache(a,r),r!==t&&(BaseTexture.addToCache(a.baseTexture,t),Texture.addToCache(a,t)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),TextureCache[t]&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),TextureCache[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=TextureCache[e];if(t){const r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete TextureCache[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)TextureCache[e.textureCacheIds[t]]===e&&delete TextureCache[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:r,width:s,height:n}=e,o=t+s>this.baseTexture.width,a=r+n>this.baseTexture.height;if(o||a){const l=o&&a?"and":"or",h=`X: ${t} + ${s} = ${t+s} > ${this.baseTexture.width}`,c=`Y: ${r} + ${n} = ${r+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${c}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Texture._EMPTY||(Texture._EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture._EMPTY),removeAllHandlers(Texture._EMPTY.baseTexture)),Texture._EMPTY}static get WHITE(){if(!Texture._WHITE){const e=settings.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),Texture._WHITE=new Texture(BaseTexture.from(e)),removeAllHandlers(Texture._WHITE),removeAllHandlers(Texture._WHITE.baseTexture)}return Texture._WHITE}}class RenderTexture extends Texture{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,r=!0){const s=this.baseTexture.resolution,n=Math.round(e*s)/s,o=Math.round(t*s)/s;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,r&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new RenderTexture(new BaseRenderTexture(e))}}class RenderTexturePool{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,r=MSAA_QUALITY.NONE){const s=new BaseRenderTexture(Object.assign({width:e,height:t,resolution:1,multisample:r},this.textureOptions));return new RenderTexture(s)}getOptimalTexture(e,t,r=1,s=MSAA_QUALITY.NONE){let n;e=Math.ceil(e*r-1e-6),t=Math.ceil(t*r-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=nextPow2(e),t=nextPow2(t),n=((e&65535)<<16|t&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,t,s)),o.filterPoolKey=n,o.setResolution(r),o}getFilterTexture(e,t,r){const s=this.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const r=this.texturePool[t];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const r=this.texturePool[t];if(r)for(let s=0;s<r.length;s++)r[s].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}RenderTexturePool.SCREEN_KEY=-1;class Attribute{constructor(e,t=0,r=!1,s=TYPES.FLOAT,n,o,a){this.buffer=e,this.size=t,this.normalized=r,this.type=s,this.stride=n,this.start=o,this.instance=a}destroy(){this.buffer=null}static from(e,t,r,s,n){return new Attribute(e,t,r,s,n)}}let UID$4=0;class Buffer{constructor(e,t=!0,r=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Buffer(e)}}const map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(i,e){let t=0,r=0;const s={};for(let l=0;l<i.length;l++)r+=e[l],t+=i[l].length;const n=new ArrayBuffer(t*4);let o=null,a=0;for(let l=0;l<i.length;l++){const h=e[l],c=i[l],u=getBufferType(c);s[u]||(s[u]=new map$1[u](n)),o=s[u];for(let d=0;d<c.length;d++){const f=(d/h|0)*r+a,p=d%h;o[f+p]=c[d]}a+=h}return new Float32Array(n)}const byteSizeMap$1={5126:4,5123:2,5121:1};let UID$3=0;const map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Geometry{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}addAttribute(e,t,r=0,s=!1,n,o,a,l=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Buffer||(t instanceof Array&&(t=new Float32Array(t)),t=new Buffer(t));const h=e.split("|");if(h.length>1){for(let u=0;u<h.length;u++)this.addAttribute(h[u],t,r,s,n);return this}let c=this.buffers.indexOf(t);return c===-1&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new Attribute(c,r,s,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Buffer||(e instanceof Array&&(e=new Uint16Array(e)),e=new Buffer(e)),e.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],r=new Buffer;let s;for(s in this.attributes){const n=this.attributes[s],o=this.buffers[n.buffer];e.push(o.data),t.push(n.size*byteSizeMap$1[n.type]/4),n.buffer=0}for(r.data=interleaveTypedArrays(e,t),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Geometry;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Buffer(this.buffers[t].data.slice(0));for(const t in this.attributes){const r=this.attributes[t];e.attributes[t]=new Attribute(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new Geometry,r=[],s=[],n=[];let o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)s[l]=s[l]||0,s[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)r[a]=new map[getBufferType(o.buffers[a].data)](s[a]),t.buffers[a]=new Buffer(r[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,c=0;for(let u=0;u<o.buffers.length;u++)if(o.buffers[u]!==o.indexBuffer){c=u;break}for(const u in o.attributes){const d=o.attributes[u];(d.buffer|0)===c&&(l+=d.size*byteSizeMap$1[d.type]/4)}for(let u=0;u<e.length;u++){const d=e[u].indexBuffer.data;for(let f=0;f<d.length;f++)t.indexBuffer.data[f+h]+=a;a+=e[u].buffers[c].data.length/l,h+=d.length}}return t}}class Quad extends Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class QuadUv extends Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Buffer(this.vertices),this.uvBuffer=new Buffer(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let r=0,s=0;return this.uvs[0]=r,this.uvs[1]=s,this.uvs[2]=r+t.width/e.width,this.uvs[3]=s,this.uvs[4]=r+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=r,this.uvs[7]=s+t.height/e.height,r=t.x,s=t.y,this.vertices[0]=r,this.vertices[1]=s,this.vertices[2]=r+t.width,this.vertices[3]=s,this.vertices[4]=r+t.width,this.vertices[5]=s+t.height,this.vertices[6]=r,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let UID$2=0;class UniformGroup{constructor(e,t,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!t,this.ubo=!!r,e instanceof Buffer?(this.buffer=e,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,r){if(!this.ubo)this.uniforms[e]=new UniformGroup(t,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,r){return new UniformGroup(e,t,r)}static uboFrom(e,t){return new UniformGroup(e,t!=null?t:!0,!0)}}class FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$1=new Matrix;class FilterSystem{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){var p,m;const r=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new FilterState,o=this.renderer.renderTexture;let a=t[0].resolution,l=t[0].multisample,h=t[0].padding,c=t[0].autoFit,u=(p=t[0].legacy)!=null?p:!0;for(let g=1;g<t.length;g++){const y=t[g];a=Math.min(a,y.resolution),l=Math.min(l,y.multisample),h=this.useMaxPadding?Math.max(h,y.padding):h+y.padding,c=c&&y.autoFit,u=u||((m=y.legacy)!=null?m:!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),s.push(n),n.resolution=a,n.multisample=l,n.legacy=u,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(h);const d=this.tempRect.copyFrom(o.sourceFrame);r.projection.transform&&this.transformAABB(tempMatrix$1.copyFrom(r.projection.transform).invert(),d),c?(n.sourceFrame.fit(d),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(d)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:r.resolution,o.sourceFrame,o.destinationFrame,r.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,a,l),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const f=this.tempRect;f.x=0,f.y=0,f.width=n.sourceFrame.width,f.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=r.projection.transform,r.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,f),r.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;const s=this.globalUniforms.uniforms;s.outputFrame=t.sourceFrame,s.resolution=t.resolution;const n=s.inputSize,o=s.inputPixel,a=s.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*t.resolution),o[1]=Math.round(n[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=t.sourceFrame.width*n[2]-.5*o[2],a[3]=t.sourceFrame.height*n[3]-.5*o[3],t.legacy){const h=s.filterArea;h[0]=t.destinationFrame.width,h[1]=t.destinationFrame.height,h[2]=t.sourceFrame.x,h[3]=t.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const l=e[e.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,t.renderTexture,l.renderTexture,CLEAR_MODES.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let h=t.renderTexture,c=this.getOptimalFilterTexture(h.width,h.height,t.resolution);c.filterFrame=h.filterFrame;let u=0;for(u=0;u<r.length-1;++u){u===1&&t.multisample>1&&(c=this.getOptimalFilterTexture(h.width,h.height,t.resolution),c.filterFrame=h.filterFrame),r[u].apply(this,h,c,CLEAR_MODES.CLEAR,t);const d=h;h=c,c=d}r[u].apply(this,h,l.renderTexture,CLEAR_MODES.BLEND,t),u>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(c)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=CLEAR_MODES.CLEAR){const{renderTexture:r,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e!=null&&e.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,r.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(t===CLEAR_MODES.CLEAR||t===CLEAR_MODES.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,r,s){const n=this.renderer;n.state.set(e.state),this.bindAndClear(r,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(DRAW_MODES.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:r,destinationFrame:s}=this.activeState,{orig:n}=t._texture,o=e.set(s.width,0,0,s.height,r.x,r.y),a=t.worldTransform.copyTo(Matrix.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(t.anchor.x,t.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,r=1,s=MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(e,t,r,s)}getFilterTexture(e,t,r){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,r||MSAA_QUALITY.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const r=tempPoints[0],s=tempPoints[1],n=tempPoints[2],o=tempPoints[3];r.set(t.left,t.top),s.set(t.left,t.bottom),n.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(r,r),e.apply(s,s),e.apply(n,n),e.apply(o,o);const a=Math.min(r.x,s.x,n.x,o.x),l=Math.min(r.y,s.y,n.y,o.y),h=Math.max(r.x,s.x,n.x,o.x),c=Math.max(r.y,s.y,n.y,o.y);t.x=a,t.y=l,t.width=h-a,t.height=c-l}roundFrame(e,t,r,s,n){if(!(e.width<=0||e.height<=0||r.width<=0||r.height<=0)){if(n){const{a:o,b:a,c:l,d:h}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}n=n?tempMatrix$1.copyFrom(n):tempMatrix$1.identity(),n.translate(-r.x,-r.y).scale(s.width/r.width,s.height/r.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}}FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"};extensions$1.add(FilterSystem);class ObjectRenderer{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}class BatchSystem{constructor(e){this.renderer=e,this.emptyRenderer=new ObjectRenderer(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:r}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=r[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,r,s){const{elements:n,ids:o,count:a}=e;let l=0;for(let h=0;h<a;h++){const c=n[h],u=c._batchLocation;if(u>=0&&u<s&&t[u]===c){o[h]=u;continue}for(;l<s;){const d=t[l];if(d&&d._batchEnabled===r&&d._batchLocation===l){l++;continue}o[h]=l,c._batchLocation=l,t[l]=c;break}}}destroy(){this.renderer=null}}BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"};extensions$1.add(BatchSystem);let CONTEXT_UID_COUNTER=0;class ContextSystem{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()}init(e){var t;if(e.context)this.initFromContext(e.context);else{const r=this.renderer.background.alpha<1,s=(t=e.premultipliedAlpha)!=null?t:!0;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:r,premultipliedAlpha:s,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let r;if(settings.PREFER_ENV>=ENV.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=r||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"};extensions$1.add(ContextSystem);class GLFramebuffer{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tempRectangle=new Rectangle;class FramebufferSystem{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}contextChange(){const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=s=>t.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,r=0){const{gl:s}=this;if(e){const n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==r&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=r),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,r)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){const a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const o=t.width>>r,a=t.height>>r,l=o/t.width;this.setViewport(t.x*l,t.y*l,o,a)}else{const o=e.width>>r,a=e.height>>r;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,r,s){const n=this.viewport;e=Math.round(e),t=Math.round(t),r=Math.round(r),s=Math.round(s),(n.width!==r||n.height!==s||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=r,n.height=s,this.gl.viewport(e,t,r,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,r,s,n=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH){const{gl:o}=this;o.clearColor(e,t,r,s),o.clear(n)}initFramebuffer(e){const{gl:t}=this,r=new GLFramebuffer(t.createFramebuffer());return r.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(e),e.disposeRunner.add(this),r}resizeFramebuffer(e){const{gl:t}=this,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),r.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));const s=e.colorTextures;let n=s.length;t.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=s[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&r.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,r.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:r}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures;let o=n.length;r.drawBuffers||(o=Math.min(o,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||r.createRenderbuffer():s.msaaBuffer&&(r.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=n[l],c=h.parentTextureArray||h;this.renderer.texture.bind(c,0),l===0&&s.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,s.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,h.target,c._glTextures[this.CONTEXT_UID].texture,t),a.push(r.COLOR_ATTACHMENT0+l))}if(a.length>1&&r.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){const h=e.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,t)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(s.stencil=s.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,s.stencil),s.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,s.multisample,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s.stencil)):s.stencil&&(r.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let r=MSAA_QUALITY.NONE;if(e<=1||t===null)return r;for(let s=0;s<t.length;s++)if(t[s]<=e){r=t[s];break}return r===1&&(r=MSAA_QUALITY.NONE),r}blit(e,t,r){const{current:s,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!s)return;const l=s.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;l.blitFramebuffer||(l.blitFramebuffer=new Framebuffer(s.width,s.height),l.blitFramebuffer.addColorTexture(0,c)),e=l.blitFramebuffer,e.colorTextures[0]!==c&&(e.colorTextures[0]=c,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=tempRectangle,t.width=s.width,t.height=s.height),r||(r=t);const h=t.width===r.width&&t.height===r.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,r.left,r.top,r.right,r.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR)}disposeFramebuffer(e,t){const r=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!r)return;delete e.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&s.deleteRenderbuffer(r.msaaBuffer),r.stencil&&s.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&r.blitFramebuffer.dispose()}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil)return;e.stencil=!0;const r=e.width,s=e.height,n=this.gl,o=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,n.DEPTH24_STENCIL8,r,s):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,r,s),t.stencil=o,n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle}destroy(){this.renderer=null}}FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"};extensions$1.add(FramebufferSystem);const byteSizeMap={5126:4,5123:2,5121:1};class GeometrySystem{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=()=>r.createVertexArrayOES(),e.bindVertexArray=s=>r.bindVertexArrayOES(s),e.deleteVertexArray=s=>r.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const r=e.getExtension("ANGLE_instanced_arrays");r?(e.vertexAttribDivisor=(s,n)=>r.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,o,a,l)=>r.drawElementsInstancedANGLE(s,n,o,a,l),e.drawArraysInstanced=(s,n,o,a)=>r.drawArraysInstancedANGLE(s,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:r}=this;let s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const o=s[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?r.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let r=0;r<e.buffers.length;r++){const s=e.buffers[r];t.update(s)}}checkCompatibility(e,t){const r=e.attributes,s=t.attributeData;for(const n in s)if(!r[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const r=e.attributes,s=t.attributeData,n=["g",e.id];for(const o in r)s[o]&&n.push(o,s[o].location);return n.join("-")}initGeometryVao(e,t,r=!0){const s=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=t.program;a.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,a);const l=this.getSignature(e,a),h=e.glVertexArrayObjects[this.CONTEXT_UID];let c=h[l];if(c)return h[a.id]=c,c;const u=e.buffers,d=e.attributes,f={},p={};for(const m in u)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*byteSizeMap[d[m].type];for(const m in d){const g=d[m],y=g.size;g.stride===void 0&&(f[g.buffer]===y*byteSizeMap[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=y*byteSizeMap[g.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let m=0;m<u.length;m++){const g=u[m];o.bind(g),r&&g._glBuffers[n].refCount++}return this.activateVao(e,a),h[a.id]=c,h[l]=c,s.bindVertexArray(null),o.unbind(BUFFER_TYPE.ARRAY_BUFFER),c}disposeGeometry(e,t){var a;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,o=(a=this.renderer)==null?void 0:a.buffer;if(e.disposeRunner.remove(this),!!r){if(o)for(let l=0;l<n.length;l++){const h=n[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&o.dispose(n[l],t))}if(!t){for(const l in r)if(l[0]==="g"){const h=r[l];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e)}activateVao(e,t){const r=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(const h in a){const c=a[h],u=o[c.buffer],d=u._glBuffers[s];if(t.attributeData[h]){l!==d&&(n.bind(u),l=d);const f=t.attributeData[h].location;if(r.enableVertexAttribArray(f),r.vertexAttribPointer(f,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)r.vertexAttribDivisor(f,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,r,s){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,t||o.indexBuffer.data.length,l,(r||0)*a,s||1):n.drawElements(e,t||o.indexBuffer.data.length,l,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,r,t||o.getSize(),s||1):n.drawArrays(e,r,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"};extensions$1.add(GeometrySystem);class MaskData{constructor(e=null){this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function compileShader(i,e,t){const r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}function logPrettyShaderError(i,e){const t=i.getShaderSource(e).split(`
`).map((h,c)=>`${c}: ${h}`),r=i.getShaderInfoLog(e),s=r.split(`
`),n={},o=s.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!n[h]?(n[h]=!0,!0):!1),a=[""];o.forEach(h=>{t[h-1]=`%c${t[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join(`
`);a[0]=l,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function logProgramError(i,e,t,r){i.getProgramParameter(e,i.LINK_STATUS)||(i.getShaderParameter(t,i.COMPILE_STATUS)||logPrettyShaderError(i,t),i.getShaderParameter(r,i.COMPILE_STATUS)||logPrettyShaderError(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(e)))}function booleanArray(i){const e=new Array(i);for(let t=0;t<e.length;t++)e[t]=!1;return e}function defaultValue(i,e){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return booleanArray(2*e);case"bvec3":return booleanArray(3*e);case"bvec4":return booleanArray(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const unknownContext={};let context=unknownContext;function getTestContext(){if(context===unknownContext||(context==null?void 0:context.isContextLost())){const i=settings.ADAPTER.createCanvas();let e;settings.PREFER_ENV>=ENV.WEBGL2&&(e=i.getContext("webgl2",{})),e||(e=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),context=e}return context}let maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;const i=getTestContext();i&&i.getShaderPrecisionFormat&&(maxFragmentPrecision=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?PRECISION.HIGH:PRECISION.MEDIUM)}return maxFragmentPrecision}function setPrecision(i,e,t){if(i.substring(0,9)!=="precision"){let r=e;return e===PRECISION.HIGH&&t!==PRECISION.HIGH&&(r=PRECISION.MEDIUM),`precision ${r} float;
${i}`}else if(t!==PRECISION.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}const GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(i){return GLSL_TO_SIZE[i]}let GL_TABLE=null;const GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(i,e){if(!GL_TABLE){const t=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(let r=0;r<t.length;++r){const s=t[r];GL_TABLE[i[s]]=GL_TO_GLSL_TYPES[s]}}return GL_TABLE[e]}const uniformParsers=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,e)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(e==null||e.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,e)=>i.type==="mat3"&&i.size===1&&!i.isArray&&e.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,e)=>i.type==="vec2"&&i.size===1&&!i.isArray&&e.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,e)=>i.type==="vec4"&&i.size===1&&!i.isArray&&e.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(i,e){var r;const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in i.uniforms){const n=e[s];if(!n){(r=i.uniforms[s])!=null&&r.group&&(i.uniforms[s].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${s}, syncData);
                    `));continue}const o=i.uniforms[s];let a=!1;for(let l=0;l<uniformParsers.length;l++)if(uniformParsers[l].test(n,o)){t.push(uniformParsers[l].code(s,o)),a=!0;break}if(!a){const h=(n.size===1&&!n.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[n.type].replace("location",`ud["${s}"].location`);t.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(i){let e="";for(let t=0;t<i;++t)t>0&&(e+=`
else `),t<i-1&&(e+=`if(test == ${t}.0){}`);return e}function checkMaxIfStatementsInShader(i,e){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(i));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))i=i/2|0;else break}return i}let unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{unsafeEval=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let UID$1=0;const nameCache={};class Program{constructor(e,t,r="pixi-shader",s={}){this.extra={},this.id=UID$1++,this.vertexSrc=e||Program.defaultVertexSrc,this.fragmentSrc=t||Program.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),nameCache[r]?(nameCache[r]++,r+=`-${nameCache[r]}`):nameCache[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return defaultVertex$2}static get defaultFragmentSrc(){return defaultFragment$2}static from(e,t,r){const s=e+t;let n=ProgramCache[s];return n||(ProgramCache[s]=n=new Program(e,t,r)),n}}class Shader{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof UniformGroup?this.uniformGroup=t:this.uniformGroup=new UniformGroup(t):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const r in t.uniforms){const s=t.uniforms[r];if(s.group&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,r){const s=Program.from(e,t);return new Shader(s,r)}}const BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5;class State$1{constructor(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<BLEND$1)}set blend(e){!!(this.data&1<<BLEND$1)!==e&&(this.data^=1<<BLEND$1)}get offsets(){return!!(this.data&1<<OFFSET$1)}set offsets(e){!!(this.data&1<<OFFSET$1)!==e&&(this.data^=1<<OFFSET$1)}get culling(){return!!(this.data&1<<CULLING$1)}set culling(e){!!(this.data&1<<CULLING$1)!==e&&(this.data^=1<<CULLING$1)}get depthTest(){return!!(this.data&1<<DEPTH_TEST$1)}set depthTest(e){!!(this.data&1<<DEPTH_TEST$1)!==e&&(this.data^=1<<DEPTH_TEST$1)}get depthMask(){return!!(this.data&1<<DEPTH_MASK$1)}set depthMask(e){!!(this.data&1<<DEPTH_MASK$1)!==e&&(this.data^=1<<DEPTH_MASK$1)}get clockwiseFrontFace(){return!!(this.data&1<<WINDING$1)}set clockwiseFrontFace(e){!!(this.data&1<<WINDING$1)!==e&&(this.data^=1<<WINDING$1)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==BLEND_MODES.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new State$1;return e.depthTest=!1,e.blend=!0,e}}var defaultFragment$1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class Filter extends Shader{constructor(e,t,r){const s=Program.from(e||Filter.defaultVertexSrc,t||Filter.defaultFragmentSrc);super(s,r),this.padding=0,this.resolution=settings.FILTER_RESOLUTION,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new State$1}apply(e,t,r,s,n){e.applyFilter(this,t,r,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return defaultVertex$1}static get defaultFragmentSrc(){return defaultFragment$1}}var vertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment$3=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const tempMat$1=new Matrix;class TextureMatrix{constructor(e,t){this._texture=e,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const r=this.mapCoord;for(let s=0;s<e.length;s+=2){const n=e[s],o=e[s+1];t[s]=n*r.a+o*r.c+r.tx,t[s+1]=n*r.b+o*r.d+r.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const s=t.orig,n=t.trim;n&&(tempMat$1.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(tempMat$1));const o=t.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(t._frame.x+l+h)/o.width,a[1]=(t._frame.y+l+h)/o.height,a[2]=(t._frame.x+t._frame.width-l+h)/o.width,a[3]=(t._frame.y+t._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0}}class SpriteMaskFilter extends Filter{constructor(e,t,r){let s=null;typeof e!="string"&&t===void 0&&r===void 0&&(s=e,e=void 0,t=void 0,r=void 0),super(e||vertex$2,t||fragment$3,r),this.maskSprite=s,this.maskMatrix=new Matrix}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,r,s){const n=this._maskSprite,o=n._texture;!o.valid||(o.uvMatrix||(o.uvMatrix=new TextureMatrix(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,r,s))}}class MaskSystem{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let r=t;if(!r.isMaskData){const n=this.maskDataPool.pop()||new MaskData;n.pooled=!0,n.maskObject=t,r=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(s),r._colorMask=s?s._colorMask:15,r.autoDetect&&this.detect(r),r._target=e,r.type!==MASK_TYPES.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(r);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(r);break;case MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case MASK_TYPES.COLOR:this.pushColorMask(r);break}r.type===MASK_TYPES.SPRITE&&this.maskStack.push(r)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(t);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(t);break;case MASK_TYPES.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===MASK_TYPES.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=MASK_TYPES.SCISSOR:e.type=MASK_TYPES.STENCIL:e.type=MASK_TYPES.COLOR}pushSpriteMask(e){var c,u;const{maskObject:t}=e,r=e._target;let s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter]));const n=this.renderer,o=n.renderTexture;let a,l;if(o.current){const d=o.current;a=e.resolution||d.resolution,l=(c=e.multisample)!=null?c:d.multisample}else a=e.resolution||n.resolution,l=(u=e.multisample)!=null?u:n.multisample;s[0].resolution=a,s[0].multisample=l,s[0].maskSprite=t;const h=r.filterArea;r.filterArea=t.getBounds(!0),n.filter.push(r,s),r.filterArea=h,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,r=e._colorMask=t&e.colorMask;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(e){const t=e._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==t&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"};extensions$1.add(MaskSystem);class AbstractMaskSystem{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,r=this.getStackLength();this.maskStack=e;const s=this.getStackLength();s!==r&&(s===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tempMatrix=new Matrix,rectPool=[],_ScissorSystem=class extends AbstractMaskSystem{constructor(i){super(i),this.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){var o;if(i._scissorRectLocal)return;const e=i._scissorRect,{maskObject:t}=i,{renderer:r}=this,s=r.renderTexture,n=t.getBounds(!0,(o=rectPool.pop())!=null?o:new Rectangle);this.roundFrameToPixels(n,s.current?s.current.resolution:r.resolution,s.sourceFrame,s.destinationFrame,r.projection.transform),e&&n.fit(e),i._scissorRectLocal=n}static isMatrixRotated(i){if(!i)return!1;const{a:e,b:t,c:r,d:s}=i;return(Math.abs(t)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(i){const{maskObject:e}=i;if(!e.isFastRect||!e.isFastRect()||_ScissorSystem.isMatrixRotated(e.worldTransform)||_ScissorSystem.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const t=i._scissorRectLocal;return t.width>0&&t.height>0}roundFrameToPixels(i,e,t,r,s){_ScissorSystem.isMatrixRotated(s)||(s=s?tempMatrix.copyFrom(s):tempMatrix.identity(),s.translate(-t.x,-t.y).scale(r.width/t.width,r.height/t.height).translate(r.x,r.y),this.renderer.filter.transformAABB(s,i),i.fit(r),i.x=Math.round(i.x*e),i.y=Math.round(i.y*e),i.width=Math.round(i.width*e),i.height=Math.round(i.height*e))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:e}=this.renderer;i._scissorRect||e.enable(e.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:e}=this.renderer;i&&rectPool.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=i.y:e=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,e,i.width,i.height)}};let ScissorSystem=_ScissorSystem;ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};extensions$1.add(ScissorSystem);class StencilSystem extends AbstractMaskSystem{constructor(e){super(e),this.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:r}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,s,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,r.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=r?r._colorMask:15;s!==0&&(r._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(r._colorMask=s,t.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"};extensions$1.add(StencilSystem);class ProjectionSystem{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}update(e,t,r,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,r,s){const n=this.projectionMatrix,o=s?-1:1;n.identity(),n.a=1/t.width*2,n.d=o*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-o-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}}ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"};extensions$1.add(ProjectionSystem);const tempRect=new Rectangle,tempRect2=new Rectangle;class RenderTextureSystem{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}bind(e=null,t,r){const s=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,t||(tempRect.width=e.frame.width,tempRect.height=e.frame.height,t=tempRect),r||(tempRect2.x=e.frame.x,tempRect2.y=e.frame.y,tempRect2.width=t.width,tempRect2.height=t.height,r=tempRect2),o=n.framebuffer):(a=s.resolution,t||(tempRect.width=s._view.screen.width,tempRect.height=s._view.screen.height,t=tempRect),r||(r=tempRect,r.width=t.width,r.height=t.height));const l=this.viewportFrame;l.x=r.x*a,l.y=r.y*a,l.width=r.width*a,l.height=r.height*a,e||(l.y=s.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(r,t,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(r)}clear(e,t){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.renderer.background.colorRgba;const r=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,n=r.width!==s.width||r.height!==s.height;if(n){let{x:o,y:a,width:l,height:h}=this.viewportFrame;o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,a,l,h)}this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t),n&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"};extensions$1.add(RenderTextureSystem);function uboUpdate(i,e,t,r,s){t.buffer.update(s)}const UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(i){const e=i.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let t=0,r=0,s=0;for(let n=0;n<e.length;n++){const o=e[n];if(t=GLSL_TO_STD40_SIZE[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,r%t!==0&&r<16){const a=r%t%16;r+=a,s+=a}r+t>16?(s=Math.ceil(s/16)*16,o.offset=s,s+=t,r=t):(o.offset=s,r+=t,s+=t)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function getUBOData(i,e){const t=[];for(const r in i)e[r]&&t.push(e[r]);return t.sort((r,s)=>r.index-s.index),t}function generateUniformBufferSync(i,e){if(!i.autoManage)return{size:0,syncFunc:uboUpdate};const t=getUBOData(i.uniforms,e),{uboElements:r,size:s}=createUBOElements(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<r.length;o++){const a=r[o],l=i.uniforms[a.data.name],h=a.data.name;let c=!1;for(let u=0;u<uniformParsers.length;u++){const d=uniformParsers[u];if(d.codeUbo&&d.test(a.data,l)){n.push(`offset = ${a.offset/4};`,uniformParsers[u].codeUbo(a.data.name,l)),c=!0;break}}if(!c)if(a.data.size>1){const u=mapSize(a.data.type),d=Math.max(GLSL_TO_STD40_SIZE[a.data.type]/16,1),f=u/d,p=(4-f%4)%4;n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const u=UBO_TO_SINGLE_SETTERS[a.data.type];n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}class GLProgram{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function getAttributeData(i,e){const t={},r=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const n=e.getActiveAttrib(i,s);if(n.name.startsWith("gl_"))continue;const o=mapType(e,n.type),a={type:o,name:n.name,size:mapSize(o),location:e.getAttribLocation(i,n.name)};t[n.name]=a}return t}function getUniformData(i,e){const t={},r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){const n=e.getActiveUniform(i,s),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=mapType(e,n.type);t[o]={name:o,index:s,type:l,size:n.size,isArray:a,value:defaultValue(l,n.size)}}return t}function generateProgram(i,e){var l;const t=compileShader(i,i.VERTEX_SHADER,e.vertexSrc),r=compileShader(i,i.FRAGMENT_SHADER,e.fragmentSrc),s=i.createProgram();i.attachShader(s,t),i.attachShader(s,r);const n=(l=e.extra)==null?void 0:l.transformFeedbackVaryings;if(n&&(typeof i.transformFeedbackVaryings!="function"||i.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||logProgramError(i,s,t,r),e.attributeData=getAttributeData(s,i),e.uniformData=getUniformData(s,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const h=Object.keys(e.attributeData);h.sort((c,u)=>c>u?1:-1);for(let c=0;c<h.length;c++)e.attributeData[h[c]].location=c,i.bindAttribLocation(s,c,h[c]);i.linkProgram(s)}i.deleteShader(t),i.deleteShader(r);const o={};for(const h in e.uniformData){const c=e.uniformData[h];o[h]={location:i.getUniformLocation(s,h),value:defaultValue(c.type,c.size)}}return new GLProgram(s,o)}let UID=0;const defaultSyncData={textureCount:0,uboCount:0};class ShaderSystem{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}systemCheck(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const r=e.program,s=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(s.program)),t||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(e.uniformGroup,defaultSyncData)),s}setUniforms(e){const t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)}syncUniformGroup(e,t){const r=this.getGlProgram();(!e.static||e.dirtyId!==r.uniformDirtyGroups[e.id])&&(r.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,r,t))}syncUniforms(e,t,r){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,r)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=generateUniformsSync(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const r=this.getGlProgram();if(!e.static||e.dirtyId!==0||!r.uniformGroups[e.id]){e.dirtyId=0;const s=r.uniformGroups[e.id]||this.createSyncBufferGroup(e,r,t);e.buffer.update(),s(r.uniformData,e.uniforms,this.renderer,defaultSyncData,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,r.uniformBufferBindings[t])}createSyncBufferGroup(e,t,r){const{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);const n=this.gl.getUniformBlockIndex(t.program,r);t.uniformBufferBindings[r]=this.shader.uniformBindCount,s.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=generateUniformBufferSync(e,this.shader.program.uniformData)),e.autoManage){const l=new Float32Array(a.size/4);e.buffer.update(l)}return t.uniformGroups[e.id]=a.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,r){const s=e.uniforms,n=[`${r}-`];for(const o in s)n.push(o),t[o]&&n.push(t[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,r=e.program,s=generateProgram(t,r);return r.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"};extensions$1.add(ShaderSystem);function mapWebGLBlendModesToPixi(i,e=[]){return e[BLEND_MODES.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD]=[i.ONE,i.ONE],e[BLEND_MODES.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.NONE]=[0,0],e[BLEND_MODES.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],e[BLEND_MODES.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SRC_IN]=[i.DST_ALPHA,i.ZERO],e[BLEND_MODES.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],e[BLEND_MODES.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],e[BLEND_MODES.DST_IN]=[i.ZERO,i.SRC_ALPHA],e[BLEND_MODES.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],e[BLEND_MODES.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[BLEND_MODES.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],e}const BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,_StateSystem=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State$1,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=mapWebGLBlendModesToPixi(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let e=this.stateId^i.data,t=0;for(;e;)e&1&&this.map[t].call(this,!!(i.data&1<<t)),e=e>>1,t++;this.stateId=i.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,i)}forceState(i){i=i||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(i.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(_StateSystem.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(_StateSystem.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const e=this.blendModes[i],t=this.gl;e.length===2?t.blendFunc(e[0],e[1]):t.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,t.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD))}setPolygonOffset(i,e){this.gl.polygonOffset(i,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,e){const t=this.checks.indexOf(i);e&&t===-1?this.checks.push(i):!e&&t!==-1&&this.checks.splice(t,1)}static checkBlendMode(i,e){i.setBlendMode(e.blendMode)}static checkPolygonOffset(i,e){i.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let StateSystem=_StateSystem;StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};extensions$1.add(StateSystem);class TextureGCSystem{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let r=!1;for(let s=0;s<t.length;s++){const n=t[s];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[s]=null,r=!0)}if(r){let s=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[s++]=t[n]);t.length=s}}unload(e){const t=this.renderer.texture,r=e._texture;r&&!r.framebuffer&&t.destroyTexture(r);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}}TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};extensions$1.add(TextureGCSystem);function mapTypeAndFormatToInternalFormat(i){let e;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?e={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:i.RGBA8,[FORMATS.RGB]:i.RGB8,[FORMATS.RG]:i.RG8,[FORMATS.RED]:i.R8,[FORMATS.RGBA_INTEGER]:i.RGBA8UI,[FORMATS.RGB_INTEGER]:i.RGB8UI,[FORMATS.RG_INTEGER]:i.RG8UI,[FORMATS.RED_INTEGER]:i.R8UI,[FORMATS.ALPHA]:i.ALPHA,[FORMATS.LUMINANCE]:i.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[TYPES.BYTE]:{[FORMATS.RGBA]:i.RGBA8_SNORM,[FORMATS.RGB]:i.RGB8_SNORM,[FORMATS.RG]:i.RG8_SNORM,[FORMATS.RED]:i.R8_SNORM,[FORMATS.RGBA_INTEGER]:i.RGBA8I,[FORMATS.RGB_INTEGER]:i.RGB8I,[FORMATS.RG_INTEGER]:i.RG8I,[FORMATS.RED_INTEGER]:i.R8I},[TYPES.UNSIGNED_SHORT]:{[FORMATS.RGBA_INTEGER]:i.RGBA16UI,[FORMATS.RGB_INTEGER]:i.RGB16UI,[FORMATS.RG_INTEGER]:i.RG16UI,[FORMATS.RED_INTEGER]:i.R16UI,[FORMATS.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[TYPES.SHORT]:{[FORMATS.RGBA_INTEGER]:i.RGBA16I,[FORMATS.RGB_INTEGER]:i.RGB16I,[FORMATS.RG_INTEGER]:i.RG16I,[FORMATS.RED_INTEGER]:i.R16I},[TYPES.UNSIGNED_INT]:{[FORMATS.RGBA_INTEGER]:i.RGBA32UI,[FORMATS.RGB_INTEGER]:i.RGB32UI,[FORMATS.RG_INTEGER]:i.RG32UI,[FORMATS.RED_INTEGER]:i.R32UI,[FORMATS.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[TYPES.INT]:{[FORMATS.RGBA_INTEGER]:i.RGBA32I,[FORMATS.RGB_INTEGER]:i.RGB32I,[FORMATS.RG_INTEGER]:i.RG32I,[FORMATS.RED_INTEGER]:i.R32I},[TYPES.FLOAT]:{[FORMATS.RGBA]:i.RGBA32F,[FORMATS.RGB]:i.RGB32F,[FORMATS.RG]:i.RG32F,[FORMATS.RED]:i.R32F,[FORMATS.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[TYPES.HALF_FLOAT]:{[FORMATS.RGBA]:i.RGBA16F,[FORMATS.RGB]:i.RGB16F,[FORMATS.RG]:i.RG16F,[FORMATS.RED]:i.R16F},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:i.RGB565},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:i.RGBA4},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:i.RGB5_A1},[TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[FORMATS.RGBA]:i.RGB10_A2,[FORMATS.RGBA_INTEGER]:i.RGB10_A2UI},[TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[FORMATS.RGB]:i.R11F_G11F_B10F},[TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[FORMATS.RGB]:i.RGB9_E5},[TYPES.UNSIGNED_INT_24_8]:{[FORMATS.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[FORMATS.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:e={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:i.RGBA,[FORMATS.RGB]:i.RGB,[FORMATS.ALPHA]:i.ALPHA,[FORMATS.LUMINANCE]:i.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:i.RGB},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:i.RGBA},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:i.RGBA}},e}class GLTexture{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}}class TextureSystem{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let s=0;s<t;s++)this.boundTextures[s]=null;this.emptyTextures={};const r=new GLTexture(e.createTexture());e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new GLTexture(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,t=0){const{gl:r}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<r.length;s++)r[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<r.length;s++)r[s]===e&&(this.currentLocation!==s&&(t.activeTexture(t.TEXTURE0+s),this.currentLocation=s),t.bindTexture(e.target,this.emptyTextures[e.target].texture),r[s]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:r,CONTEXT_UID:s}=this;if(!!r)for(let n=e-1;n>=0;--n){const o=t[n];o&&o._glTextures[s].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){const t=new GLTexture(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var r,s;t.internalFormat=(s=(r=this.internalFormats[e.type])==null?void 0:r[e.format])!=null?s:e.format,this.webGLVersion===2&&e.type===TYPES.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var s;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const r=this.renderer;if(this.initTextureType(e,t),(s=e.resource)!=null&&s.upload(r,e,t))t.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const n=e.realWidth,o=e.realHeight,a=r.gl;(t.width!==n||t.height!==o||t.dirtyId<0)&&(t.width=n,t.height=o,a.texImage2D(e.target,0,t.internalFormat,n,o,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:r}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const s=this.managedTextures.indexOf(e);s!==-1&&removeItems(this.managedTextures,s,1)}}updateTextureStyle(e){var r;const t=e._glTextures[this.CONTEXT_UID];!t||((e.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=WRAP_MODES.CLAMP:t.wrapMode=e.wrapMode,(r=e.resource)!=null&&r.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const r=this.gl;if(t.mipmap&&e.mipmap!==MIPMAP_MODES.ON_MANUAL&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===SCALE_MODES.LINEAR){const n=Math.min(e.anisotropicLevel,r.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"};extensions$1.add(TextureSystem);const tempTransform=new Transform;class GenerateTextureSystem{constructor(e){this.renderer=e,this._tempMatrix=new Matrix}generateTexture(e,t){const{region:r,...s}=t||{},n=r||e.getLocalBounds(null,!0);n.width===0&&(n.width=1),n.height===0&&(n.height=1);const o=RenderTexture.create({width:n.width,height:n.height,...s});this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const a=e.transform;return e.transform=tempTransform,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=a,o}destroy(){}}GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"};extensions$1.add(GenerateTextureSystem);class BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender,e.color&&(this.color=typeof e.color=="string"?string2hex(e.color):e.color),this.alpha=e.alpha}get color(){return this._backgroundColor}set color(e){this._backgroundColor=e,this._backgroundColorString=hex2string(e),hex2rgb(e,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(e){this._backgroundColorRgba[3]=e}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"};extensions$1.add(BackgroundSystem);class ViewSystem{constructor(e){this.renderer=e}init(e){this.screen=new Rectangle(0,0,e.width,e.height),this.element=e.view||settings.ADAPTER.createCanvas(),this.resolution=e.resolution||settings.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const r=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=r,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",r,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"};extensions$1.add(ViewSystem);class PluginSystem{constructor(e){this.renderer=e,this.plugins={}}init(e){for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"};extensions$1.add(PluginSystem);class SystemManager extends EventEmitter$1{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){var s;this.addRunners(...e.runners);const t=((s=e.priority)!=null?s:[]).filter(n=>e.systems[n]),r=[...t,...Object.keys(e.systems).filter(n=>!t.includes(n))];for(const n of r)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Runner(t)})}addSystem(e,t){const r=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=r,this._systemsHash[t]=r;for(const s in this.runners)this.runners[s].add(r);return this}emitWithCustomOptions(e,t){const r=Object.keys(this._systemsHash);e.items.forEach(s=>{const n=r.find(o=>this._systemsHash[o]===s);s[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}class StartupSystem{constructor(e){this.renderer=e}run(e){const t=this.renderer;t.emitWithCustomOptions(t.runners.init,e),e.hello&&console.log(`PixiJS 7.0.4 - ${t.rendererLogId} - https://pixijs.com`),t.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"};extensions$1.add(StartupSystem);class TransformFeedbackSystem{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,s=e._glTransformFeedbacks[r]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:r,renderer:s}=this;t&&s.shader.bind(t),r.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:r,CONTEXT_UID:s}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[s]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];!a||(r.buffer.update(a),a._glBuffers[s].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[s].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){const r=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&n.dispose(a,t))}!r||(t||s.deleteTransformFeedback(r),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"};extensions$1.add(TransformFeedbackSystem);const renderers=[];extensions$1.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(i){for(const e of renderers)if(e.test(i))return new e(i);throw new Error("Unable to auto-detect a suitable renderer.")}var $defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const defaultFilterVertex=$defaultFilterVertex,_Renderer=class extends SystemManager{constructor(i){var r,s;super(),i=Object.assign({},settings.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0);const e={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:_Renderer.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e);const t={hello:i.hello,_plugin:_Renderer.__plugins,background:{alpha:i.backgroundAlpha,color:(r=i.background)!=null?r:i.backgroundColor,clearBeforeRender:i.clearBeforeRender},_view:{height:i.height,width:i.width,autoDensity:i.autoDensity,resolution:i.resolution,view:i.view},context:{antialias:i.antialias,context:i.context,powerPreference:i.powerPreference,premultipliedAlpha:(s=i.premultipliedAlpha)!=null?s:i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",preserveDrawingBuffer:i.preserveDrawingBuffer}};this.startup.run(t)}static test(i){return i!=null&&i.forceCanvas?!1:isWebGLSupported()}render(i,e){this.objectRenderer.render(i,e)}resize(i,e){this._view.resizeView(i,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(i){this.background.color=i}get backgroundAlpha(){return this.background.color}set backgroundAlpha(i){this.background.alpha=i}get powerPreference(){return this.context.powerPreference}generateTexture(i,e){return this.textureGenerator.generateTexture(i,e)}};let Renderer=_Renderer;Renderer.extension={type:ExtensionType.Renderer,priority:1};Renderer.__plugins={};Renderer.__systems={};extensions$1.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);extensions$1.handleByMap(ExtensionType.RendererSystem,Renderer.__systems);extensions$1.add(Renderer);class BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}class BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}class ViewableBuffer{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}class BatchShaderGenerator{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=n;this.defaultGroupCache[e]=UniformGroup.from({uSamplers:r},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Program(this.vertexSrc,s)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[e]};return new Shader(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+=`if(vTextureId < ${r}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class BatchGeometry extends Geometry{constructor(e=!1){super(),this._buffer=new Buffer(null,e,!1),this._indexBuffer=new Buffer(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,TYPES.FLOAT).addIndex(this._indexBuffer)}}var defaultVertex=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const _BatchRenderer=class extends ObjectRenderer{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=BatchGeometry,this.vertexSize=6,this.state=State$1.for2d(),this.size=settings.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return defaultVertex}static get defaultFragmentTemplate(){return defaultFragment}setShaderGenerator({vertex:i=_BatchRenderer.defaultVertexSrc,fragment:e=_BatchRenderer.defaultFragmentTemplate}={}){this.shaderGenerator=new BatchShaderGenerator(i,e)}contextChange(){const i=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,i)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:e}=_BatchRenderer,t=this.size/4,r=Math.floor(t/this.MAX_TEXTURES)+1;for(;i.length<t;)i.push(new BatchDrawCall);for(;e.length<r;)e.push(new BatchTextureArray);for(let s=0;s<this.MAX_TEXTURES;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(i){!i._texture.valid||(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,MAX_TEXTURES:e}=this,t=_BatchRenderer._textureArrayPool,r=this.renderer.batch,s=this._tempBoundTextures,n=this.renderer.textureGC.count;let o=++BaseTexture._globalBatch,a=0,l=t[0],h=0;r.copyBoundTextures(s,e);for(let c=0;c<this._bufferSize;++c){const u=i[c];i[c]=null,u._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,h,c),h=c,l=t[++a],++o),u._batchEnabled=o,u.touched=n,l.elements[l.count++]=u)}l.count>0&&(r.boundArray(l,s,o,e),this.buildDrawCalls(l,h,this._bufferSize),++a,++o);for(let c=0;c<s.length;c++)s[c]=null;BaseTexture._globalBatch=o}buildDrawCalls(i,e,t){const{_bufferedElements:r,_attributeBuffer:s,_indexBuffer:n,vertexSize:o}=this,a=_BatchRenderer._drawCallPool;let l=this._dcIndex,h=this._aIndex,c=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=i;for(let d=e;d<t;++d){const f=r[d],p=f._texture.baseTexture,m=premultiplyBlendMode[p.alphaMode?1:0][f.blendMode];r[d]=null,e<d&&u.blend!==m&&(u.size=c-u.start,e=d,u=a[++l],u.texArray=i,u.start=c),this.packInterleavedGeometry(f,s,n,h,c),h+=f.vertexData.length/2*o,c+=f.indices.length,u.blend=m}e<t&&(u.size=c-u.start,++l),this._dcIndex=l,this._aIndex=h,this._iIndex=c}bindAndClearTexArray(i){const e=this.renderer.texture;for(let t=0;t<i.count;t++)e.bind(i.elements[t],i.ids[t]),i.elements[t]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:e,_indexBuffer:t}=this;settings.CAN_UPLOAD_SAME_BUFFER?(i[this._flushId]._buffer.update(e.rawBinaryData),i[this._flushId]._indexBuffer.update(t),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(e.rawBinaryData),i[this._flushId]._indexBuffer.update(t),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:e,state:t}=this.renderer,r=_BatchRenderer._drawCallPool;let s=null;for(let n=0;n<i;n++){const{texArray:o,type:a,size:l,start:h,blend:c}=r[n];s!==o&&(s=o,this.bindAndClearTexArray(o)),this.state.blendMode=c,t.set(this.state),e.drawElements(a,l,e.UNSIGNED_SHORT,h*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const e=nextPow2(Math.ceil(i/8)),t=log2(e),r=e*8;this._aBuffers.length<=t&&(this._iBuffers.length=t+1);let s=this._aBuffers[r];return s||(this._aBuffers[r]=s=new ViewableBuffer(r*this.vertexSize*4)),s}getIndexBuffer(i){const e=nextPow2(Math.ceil(i/12)),t=log2(e),r=e*12;this._iBuffers.length<=t&&(this._iBuffers.length=t+1);let s=this._iBuffers[t];return s||(this._iBuffers[t]=s=new Uint16Array(r)),s}packInterleavedGeometry(i,e,t,r,s){const{uint32View:n,float32View:o}=e,a=r/this.vertexSize,l=i.uvs,h=i.indices,c=i.vertexData,u=i._texture.baseTexture._batchLocation,d=Math.min(i.worldAlpha,1),f=d<1&&i._texture.baseTexture.alphaMode?premultiplyTint(i._tintRGB,d):i._tintRGB+(d*255<<24);for(let p=0;p<c.length;p+=2)o[r++]=c[p],o[r++]=c[p+1],o[r++]=l[p],o[r++]=l[p+1],n[r++]=f,o[r++]=u;for(let p=0;p<h.length;p++)t[s++]=a+h[p]}};let BatchRenderer=_BatchRenderer;BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin};BatchRenderer._drawCallPool=[];BatchRenderer._textureArrayPool=[];extensions$1.add(BatchRenderer);class GLBuffer{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class BufferSystem{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:r,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){const n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,r.bindBufferBase(r.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,r){const{gl:s,CONTEXT_UID:n}=this;r=r||0;const o=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,o.buffer,r*256,256)}update(e){const{gl:t,CONTEXT_UID:r}=this,s=e._glBuffers[r]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,t.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const r=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),r&&(t||s.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let r=0;r<t.length;r++)this.dispose(this.managedBuffers[t[r]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:r}=this;return e._glBuffers[t]=new GLBuffer(r.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"};extensions$1.add(BufferSystem);class MultisampleSystem{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const r=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,r)}else{const r=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,r)}t>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:t>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:t>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE}destroy(){}}MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"};extensions$1.add(MultisampleSystem);class ObjectRendererSystem{constructor(e){this.renderer=e}render(e,t){const r=this.renderer;let s,n,o,a;if(t&&(s=t.renderTexture,n=t.clear,o=t.transform,a=t.skipUpdateTransform),this.renderingToScreen=!s,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=o,!r.context.isLost){if(s||(this.lastObjectRendered=e),!a){const l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}r.renderTexture.bind(s),r.batch.currentRenderer.start(),(n!=null?n:r.background.clearBeforeRender)&&r.renderTexture.clear(),e.render(r),r.batch.currentRenderer.flush(),s&&(t.blit&&r.framebuffer.blit(),s.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"};extensions$1.add(ObjectRendererSystem);var fragment$2=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ColorMatrixFilter extends Filter{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(defaultFilterVertex,fragment$2,e),this.alpha=1}_loadMatrix(e,t=!1){let r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}tint(e,t){const r=e>>16&255,s=e>>8&255,n=e&255,o=[r/255,0,0,0,0,0,s/255,0,0,0,0,0,n/255,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){const r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const r=Math.cos(e),s=Math.sin(e),n=Math.sqrt,o=1/3,a=n(o),l=r+(1-r)*o,h=o*(1-r)-a*s,c=o*(1-r)+a*s,u=o*(1-r)+a*s,d=r+o*(1-r),f=o*(1-r)-a*s,p=o*(1-r)-a*s,m=o*(1-r)+a*s,g=r+o*(1-r),y=[l,h,c,0,0,u,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(y,t)}contrast(e,t){const r=(e||0)+1,s=-.5*(r-1),n=[r,0,0,0,s,0,r,0,0,s,0,0,r,0,s,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){const r=e*2/3+1,s=(r-1)*-.5,n=[r,s,s,0,0,s,r,s,0,0,s,s,r,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,r,s,n){e=e||.2,t=t||.15,r=r||16770432,s=s||3375104;const o=(r>>16&255)/255,a=(r>>8&255)/255,l=(r&255)/255,h=(s>>16&255)/255,c=(s>>8&255)/255,u=(s&255)/255,d=[.3,.59,.11,0,0,o,a,l,e,0,h,c,u,t,0,o-h,a-c,l-u,0,0];this._loadMatrix(d,n)}night(e,t){e=e||.1;const r=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(r,t)}predator(e,t){const r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;settings.SORTABLE_CHILDREN=!1;class Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(e=e||new Rectangle(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:r,b:s,c:n,d:o,tx:a,ty:l}=e,h=r*t.x+n*t.y+a,c=s*t.x+o*t.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(e){let t=this.minX,r=this.minY,s=this.maxX,n=this.maxY,o=e[0],a=e[1];t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[2],a=e[3],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[4],a=e[5],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,o=e[6],a=e[7],t=o<t?o:t,r=a<r?a:r,s=o>s?o:s,n=a>n?a:n,this.minX=t,this.minY=r,this.maxX=s,this.maxY=n}addFrame(e,t,r,s,n){this.addFrameMatrix(e.worldTransform,t,r,s,n)}addFrameMatrix(e,t,r,s,n){const o=e.a,a=e.b,l=e.c,h=e.d,c=e.tx,u=e.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*t+l*r+c,y=a*t+h*r+u;d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+l*r+c,y=a*s+h*r+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*t+l*n+c,y=a*t+h*n+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,g=o*s+l*n+c,y=a*s+h*n+u,d=g<d?g:d,f=y<f?y:f,p=g>p?g:p,m=y>m?y:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(e,t,r){let s=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=t;l<r;l+=2){const h=e[l],c=e[l+1];s=h<s?h:s,n=c<n?c:n,o=h>o?h:o,a=c>a?c:a}this.minX=s,this.minY=n,this.maxX=o,this.maxY=a}addVertices(e,t,r,s){this.addVerticesMatrix(e.worldTransform,t,r,s)}addVerticesMatrix(e,t,r,s,n=0,o=n){const a=e.a,l=e.b,h=e.c,c=e.d,u=e.tx,d=e.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let y=r;y<s;y+=2){const v=t[y],_=t[y+1],x=a*v+h*_+u,T=c*_+l*v+d;f=Math.min(f,x-n),m=Math.max(m,x+n),p=Math.min(p,T-o),g=Math.max(g,T+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(e){const t=this.minX,r=this.minY,s=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){const r=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=n&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const r=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=n&&s<=o){const a=this.minX,l=this.minY,h=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=s<l?s:l,this.maxX=n>h?n:h,this.maxY=o>c?o:c}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,r,s,n,o){e-=n,t-=o,r+=n,s+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}}class DisplayObject extends EventEmitter$1{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let r=0;r<t.length;++r){const s=t[r];Object.defineProperty(DisplayObject.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Rectangle),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);const t=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=r,this.transform=t,this._bounds=s,this._bounds.updateID+=this._boundsID-n,o}toGlobal(e,t,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,r,s){return t&&(e=t.toGlobal(e,r,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,r=1,s=1,n=0,o=0,a=0,l=0,h=0){return this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=s||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*RAD_TO_DEG}set angle(e){this.transform.rotation=e*DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class TemporaryDisplayObject extends DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(i,e){return i.zIndex===e.zIndex?i._lastSortedIndex-e._lastSortedIndex:i.zIndex-e.zIndex}class Container extends DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=settings.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const r=this.getChildIndex(e),s=this.getChildIndex(t);this.children[r]=t,this.children[s]=e,this.onChildrenChange(r<s?r:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(e);removeItems(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],r=this.children.indexOf(t);if(r===-1)return null;t.parent=null,t.transform._parentID=-1,removeItems(this.children,r,1),this._boundsID++,this.onChildrenChange(r),t.emit("removed",this),this.emit("childRemoved",t,this,r)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,removeItems(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const r=e,s=t,n=s-r;let o;if(n>0&&n<=s){o=this.children.splice(r,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,r=this.children.length;t<r;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const r=this.children[e];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(t._bounds,r._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const r=super.getLocalBounds(e);if(!t)for(let s=0,n=this.children.length;s<n;++s){const o=this.children[s];o.visible&&o.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let r,s;if(this.cullArea?(r=this.cullArea,s=this.worldTransform):this._render!==Container.prototype._render&&(r=this.getBounds(!0)),r&&t.intersects(r,s))this._render(e);else if(this.cullArea)return;for(let n=0,o=this.children.length;n<o;++n){const a=this.children[n],l=a.cullable;a.cullable=l||!this.cullArea,a.render(e),a.cullable=l}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||((t=this.filters)==null?void 0:t.length))this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let r=0,s=this.children.length;r<s;++r)this.children[r].render(e)}}renderAdvanced(e){var n,o,a;const t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<t.length;l++)t[l].enabled&&this._enabledFilters.push(t[l])}const s=t&&((n=this._enabledFilters)==null?void 0:n.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==MASK_TYPES.NONE));if(s&&e.batch.flush(),t&&((o=this._enabledFilters)==null?void 0:o.length)&&e.filter.push(this,this._enabledFilters),r&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let l=0,h=this.children.length;l<h;++l)this.children[l].render(e)}s&&e.batch.flush(),r&&e.mask.pop(this),t&&((a=this._enabledFilters)==null?void 0:a.length)&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,r=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<r.length;++s)r[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}}Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;const tempPoint$1=new Point,indices=new Uint16Array([0,1,2,0,2,3]);class Sprite extends Container{constructor(e){super(),this._anchor=new ObservablePoint(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||Texture.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=indices,this.pluginName="batch",this.isSprite=!0,this._roundPixels=settings.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,r=t.a,s=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=this.vertexData,c=e.trim,u=e.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(c?(p=c.x-d._x*u.width,f=p+c.width,g=c.y-d._y*u.height,m=g+c.height):(p=-d._x*u.width,f=p+u.width,g=-d._y*u.height,m=g+u.height),h[0]=r*p+n*g+a,h[1]=o*g+s*p+l,h[2]=r*f+n*g+a,h[3]=o*g+s*f+l,h[4]=r*f+n*m+a,h[5]=o*m+s*f+l,h[6]=r*p+n*m+a,h[7]=o*m+s*p+l,this._roundPixels){const y=settings.RESOLUTION;for(let v=0;v<h.length;++v)h[v]=Math.round(h[v]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,r=e.orig,s=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,c=n.tx,u=n.ty,d=-s._x*r.width,f=d+r.width,p=-s._y*r.height,m=p+r.height;t[0]=o*d+l*p+c,t[1]=h*p+a*d+u,t[2]=o*f+l*p+c,t[3]=h*p+a*f+u,t[4]=o*f+l*m+c,t[5]=h*m+a*f+u,t[6]=o*d+l*m+c,t[7]=h*m+a*d+u}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,tempPoint$1);const t=this._texture.orig.width,r=this._texture.orig.height,s=-t*this.anchor.x;let n=0;return tempPoint$1.x>=s&&tempPoint$1.x<s+t&&(n=-r*this.anchor.y,tempPoint$1.y>=n&&tempPoint$1.y<n+r)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const r=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(e,t){const r=e instanceof Texture?e:Texture.from(e,t);return new Sprite(r)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=sign(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=sign(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tint}set tint(e){this._tint=e,this._tintRGB=(e>>16)+(e&65280)+((e&255)<<16)}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=null;class CacheData{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let e;i?(this._cacheData||(this._cacheData=new CacheData),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});DisplayObject.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};DisplayObject.prototype._initCachedDisplayObject=function(e){var d,f,p;if((d=this._cacheData)!=null&&d.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const r=this.getLocalBounds(null,!0).clone();if((f=this.filters)!=null&&f.length){const m=this.filters[0].padding;r.pad(m)}r.ceil(settings.RESOLUTION);const s=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),a=e.projection.transform,l=RenderTexture.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:(p=this.cacheAsBitmapMultisample)!=null?p:e.multisample}),h=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=h,BaseTexture.addToCache(l.baseTexture,h),Texture.addToCache(l,h);const c=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:l,clear:!0,transform:c,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=a,e.renderTexture.bind(s,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const u=new Sprite(l);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(r.x/r.width),u.anchor.y=-(r.y/r.height),u.alpha=t,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};DisplayObject.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(e){var c;if((c=this._cacheData)!=null&&c.sprite)return;const t=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const s=e.canvasContext.activeContext,n=e._projTransform;t.ceil(settings.RESOLUTION);const o=RenderTexture.create({width:t.width,height:t.height}),a=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=a,BaseTexture.addToCache(o.baseTexture,a),Texture.addToCache(o,a);const l=_tempMatrix;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),e.canvasContext.activeContext=s,e._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const h=new Sprite(o);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(t.x/t.width),h.anchor.y=-(t.y/t.height),h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(e,t){for(let r=0,s=this.children.length;r<s;r++)if(this.children[r].name===e)return this.children[r];if(t)for(let r=0,s=this.children.length;r<s;r++){const n=this.children[r];if(!n.getChildByName)continue;const o=n.getChildByName(e,!0);if(o)return o}return null};DisplayObject.prototype.getGlobalPosition=function(e=new Point,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};const accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class FederatedEvent{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Point,this.page=new Point,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,r,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class FederatedMouseEvent extends FederatedEvent{constructor(){super(...arguments),this.client=new Point,this.movement=new Point,this.offset=new Point,this.global=new Point,this.screen=new Point}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,r,s,n,o,a,l,h,c,u,d,f,p,m){throw new Error("Method not implemented.")}}class FederatedPointerEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class FederatedWheelEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const PROPAGATION_LIMIT=2048,tempHitLocation=new Point,tempLocalMapping=new Point;class EventBoundary{constructor(e){this.dispatch=new EventEmitter$1,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((r,s)=>r.priority-s.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let r=0,s=t.length;r<s;r++)t[r].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){const r=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,tempHitLocation.set(e,t),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(e,t){if(!e.target)return;const r=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,n=r.length-1;s<n;s++)if(e.currentTarget=r[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=r.length-2;s>=0;s--)if(e.currentTarget=r[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,r=this.rootTarget){e.eventPhase=e.BUBBLING_PHASE;const s=r.children;if(s)for(let n=0;n<s.length;n++)this.all(e,t,s[n]);e.currentTarget=r,this.notifyTarget(e,t)}propagationPath(e){const t=[e];for(let r=0;r<PROPAGATION_LIMIT&&e!==this.rootTarget;r++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestRecursive(e,t,r,s,n){if(!e||!e.visible||n(e,r))return null;if(e.interactiveChildren&&e.children){const o=e.children;for(let a=o.length-1;a>=0;a--){const l=o[a],h=this.hitTestRecursive(l,t||l.interactive,r,s,n);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||e.interactive)&&h.push(e),h}}}return t&&s(e,r)?e.interactive?[e]:[]:null}hitPruneFn(e,t){var r;if(e.hitArea&&(e.worldTransform.applyInverse(t,tempLocalMapping),!e.hitArea.contains(tempLocalMapping.x,tempLocalMapping.y)))return!0;if(e._mask){const s=e._mask.isMaskData?e._mask.maskObject:e._mask;if(s&&!((r=s.containsPoint)!=null&&r.call(s,t)))return!0}return!1}hitTestFn(e,t){return e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){t=t!=null?t:e.type;const r=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,r),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const s=t.button===2;this.dispatchEvent(t,s?"rightdown":"mousedown")}const r=this.trackingData(e.pointerId);r.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var a;if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e),r=t.pointerType==="mouse"||t.pointerType==="pen",s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets&&n!==t.target){const l=e.type==="mousemove"?"mouseout":"pointerout",h=this.createPointerEvent(e,l,n);if(this.dispatchEvent(h,"pointerout"),r&&this.dispatchEvent(h,"mouseout"),!t.composedPath().includes(n)){const c=this.createPointerEvent(e,"pointerleave",n);for(c.eventPhase=c.AT_TARGET;c.target&&!t.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),r&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(h)}if(n!==t.target){const l=e.type==="mousemove"?"mouseover":"pointerover",h=this.clonePointerEvent(t,l);this.dispatchEvent(h,"pointerover"),r&&this.dispatchEvent(h,"mouseover");let c=n==null?void 0:n.parent;for(;c&&c!==this.rootTarget.parent&&c!==t.target;)c=c.parent;if(!c||c===this.rootTarget.parent){const d=this.clonePointerEvent(t,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==n&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),r&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(h)}const o=this.moveOnAll?"all":"dispatchEvent";this[o](t,"pointermove"),t.pointerType==="touch"&&this[o](t,"touchmove"),r&&(this[o](t,"mousemove"),this.cursor=(a=t.target)==null?void 0:a.cursor),s.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var o;if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.createPointerEvent(e),s=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),s&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(o=r.target)==null?void 0:o.cursor);const n=this.clonePointerEvent(r,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const r=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(n),r&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(e,"pointerleave",s);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),r&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[e.button]);let o=n;if(n&&!r.composedPath().includes(n)){let a=n;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const l=r.button===2;this.notifyTarget(r,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete s.pressTargetsByButton[e.button],o=a}if(o){const a=this.clonePointerEvent(r,"click");a.target=o,a.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:t});const l=s.clicksByButton[e.button];l.target===a.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=t,a.detail=l.clickCount,a.pointerType==="mouse"?this.dispatchEvent(a,"click"):a.pointerType==="touch"&&this.dispatchEvent(a,"tap"),this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(e){if(!(e instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),r=this.findMountedTarget(t.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(r){let n=r;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof FederatedWheelEvent)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let r=1;r<e.length&&e[r].parent===t;r++)t=e[r];return t}createPointerEvent(e,t,r){const s=this.allocateEvent(FederatedPointerEvent);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=r!=null?r:this.hitTest(s.global.x,s.global.y),typeof t=="string"&&(s.type=t),s}createWheelEvent(e){const t=this.allocateEvent(FederatedWheelEvent);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const r=this.allocateEvent(FederatedPointerEvent);return r.nativeEvent=e.nativeEvent,r.originalEvent=e.originalEvent,this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.target=e.target,r.path=e.composedPath().slice(),r.type=t!=null?t:r.type,r}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof FederatedPointerEvent&&t instanceof FederatedPointerEvent&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof FederatedMouseEvent&&t instanceof FederatedMouseEvent&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const r=e.currentTarget._events[t];if(!!r)if("fn"in r)r.fn.call(r.context,e);else for(let s=0,n=r.length;s<n&&!e.propagationImmediatelyStopped;s++)r[s].fn.call(r[s].context,e)}}const MOUSE_POINTER_ID=1,TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class EventSystem{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new EventBoundary(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new FederatedPointerEvent(null),this.rootWheelEvent=new FederatedWheelEvent(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:e,resolution:t}=this.renderer;this.setTargetElement(e),this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const r=this.cursorStyles[e];if(r)switch(typeof r){case"string":t&&(this.domElement.style.cursor=r);break;case"function":r(e);break;case"object":t&&Object.assign(this.domElement.style,r);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}onPointerDown(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch")return;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let r=0,s=t.length;r<s;r++){const n=t[r],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch")return;const t=this.normalizeToPointerData(e);for(let r=0,s=t.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch")return;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const r=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let n=0,o=s.length;n<o;n++){const a=this.bootstrapEvent(this.rootPointerEvent,s[n]);a.type+=r,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&e.pointerType==="touch")return;const t=this.normalizeToPointerData(e);for(let r=0,s=t.length;r<s;r++){const n=this.bootstrapEvent(this.rootPointerEvent,t[r]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,r){let s;this.domElement.parentElement?s=this.domElement.getBoundingClientRect():s={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*n,e.y=(r-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let r=0,s=e.changedTouches.length;r<s;r++){const n=e.changedTouches[r];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const r=e;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=MOUSE_POINTER_ID),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,t.push(r)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=TOUCH_TO_POINTER[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}}EventSystem.extension={name:"events",type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem]};extensions$1.add(EventSystem);const FederatedDisplayObject={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(i,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof e=="function"?void 0:e;i=r?`${i}capture`:i,e=typeof e=="function"?e:e.handleEvent,this.on(i,e,s)},removeEventListener(i,e,t){const r=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof e=="function"?void 0:e;i=r?`${i}capture`:i,e=typeof e=="function"?e:e.handleEvent,this.off(i,e,s)},dispatchEvent(i){if(!(i instanceof FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};DisplayObject.mixin(FederatedDisplayObject);DisplayObject.mixin(accessibleTarget);const KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2;class AccessibilityManager{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile.tablet||isMobile.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${DIV_TOUCH_SIZE}px`,t.style.height=`${DIV_TOUCH_SIZE}px`,t.style.position="absolute",t.style.top=`${DIV_TOUCH_POS_X}px`,t.style.left=`${DIV_TOUCH_POS_Y}px`,t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${DIV_HOOK_SIZE}px`,e.style.height=`${DIV_HOOK_SIZE}px`,e.style.position="absolute",e.style.top=`${DIV_HOOK_POS_X}px`,e.style.left=`${DIV_HOOK_POS_Y}px`,e.style.zIndex=DIV_HOOK_ZINDEX.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}update(){const e=performance.now();if(isMobile.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:r,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=s/o*l,c=n/a*l;let u=this.div;u.style.left=`${t}px`,u.style.top=`${r}px`,u.style.width=`${o}px`,u.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,removeItems(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{u=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(u.style.left=`${(m.tx+p.x*m.a)*h}px`,u.style.top=`${(m.ty+p.y*m.d)*c}px`,u.style.width=`${p.width*m.a*h}px`,u.style.height=`${p.height*m.d*c}px`):(p=f.getBounds(),this.capHitArea(p),u.style.left=`${p.x*h}px`,u.style.top=`${p.y*c}px`,u.style.width=`${p.width*h}px`,u.style.height=`${p.height*c}px`,u.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(u.title=f.accessibleTitle),u.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&u.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==u.title||f.tabIndex!==u.tabIndex)&&(u.title=f.accessibleTitle,u.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:r}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>r&&(e.height=r-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${DIV_TOUCH_SIZE}px`,t.style.height=`${DIV_TOUCH_SIZE}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=DIV_TOUCH_ZINDEX.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:r}=e.target,s=this.renderer.events.rootBoundary,n=Object.assign(new FederatedEvent(s),{target:r});s.rootTarget=this.renderer.lastObjectRendered,t.forEach(o=>s.dispatchEvent(n,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===KEY_CODE_TAB&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}AccessibilityManager.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]};extensions$1.add(AccessibilityManager);const _Application=class{constructor(i){this.stage=new Container,i=Object.assign({forceCanvas:!1},i),this.renderer=autoDetectRenderer(i),_Application._plugins.forEach(e=>{e.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,e){const t=_Application._plugins.slice(0);t.reverse(),t.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let Application=_Application;Application._plugins=[];extensions$1.handleByList(ExtensionType.Application,Application._plugins);class ResizePlugin{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;t=s,r=n}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=ExtensionType.Application;extensions$1.add(ResizePlugin);class BackgroundLoader{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const convertToList=(i,e)=>(Array.isArray(i)||(i=[i]),e?i.map(t=>typeof t=="string"?e(t):t):i);function processX(i,e,t,r,s){const n=e[t];for(let o=0;o<n.length;o++){const a=n[o];t<e.length-1?processX(i.replace(r[t],a),e,t+1,r,s):s.push(i.replace(r[t],a))}}function createStringVariations(i){const e=/\{(.*?)\}/g,t=i.match(e),r=[];if(t){const s=[];t.forEach(n=>{const o=n.substring(1,n.length-1).split(",");s.push(o)}),processX(i,s,0,t,r)}else r.push(i);return r}const isSingleItem=i=>!Array.isArray(i);class CacheClass{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){return this._cache.get(e)}set(e,t){const r=convertToList(e);let s;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(t)){s=l.getCacheableAssets(r,t);break}}s||(s={},r.forEach(a=>{s[a]=t}));const n=Object.keys(s),o={cacheKeys:n,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{this._cache.has(a)&&this._cache.get(a),this._cache.set(a,s[a])}),t instanceof Texture){const a=t;r.forEach(l=>{a.baseTexture!==Texture.EMPTY.baseTexture&&BaseTexture.addToCache(a.baseTexture,l),Texture.addToCache(a,l)})}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e))return;const t=this._cacheMap.get(e);t.cacheKeys.forEach(s=>{this._cache.delete(s)}),t.keys.forEach(s=>{this._cacheMap.delete(s)})}get parsers(){return this._parsers}}const Cache=new CacheClass;class Loader{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(e,t){const r={promise:null,parser:null};return r.promise=(async()=>{var n,o;let s=null;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.load&&((n=l.test)==null?void 0:n.call(l,e,t,this))){s=await l.load(e,t,this),r.parser=l;break}}if(!r.parser)return null;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];l.parse&&l.parse&&await((o=l.testParse)==null?void 0:o.call(l,s,t,this))&&(s=await l.parse(s,t,this)||s,r.parser=l)}return s})(),r}async load(e,t){let r=0;const s={},n=isSingleItem(e),o=convertToList(e,h=>({src:h})),a=o.length,l=o.map(async h=>{const c=path.toAbsolute(h.src);if(!s[h.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,h)),s[h.src]=await this.promiseCache[c].promise,t&&t(++r/a)}catch(u){throw delete this.promiseCache[c],delete s[h.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(l),n?s[o[0].src]:s}async unload(e){const r=convertToList(e,s=>({src:s})).map(async s=>{var a,l;const n=path.toAbsolute(s.src),o=this.promiseCache[n];if(o){const h=await o.promise;(l=(a=o.parser)==null?void 0:a.unload)==null||l.call(a,h,s,this),delete this.promiseCache[n]}});await Promise.all(r)}get parsers(){return this._parsers}}class Resolver{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(e){this._manifest,this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const r=[];Array.isArray(t)?t.forEach(s=>{typeof s.name=="string"?r.push(s.name):r.push(...s.name),this.add(s.name,s.srcs)}):Object.keys(t).forEach(s=>{r.push(s),this.add(s,t[s])}),this._bundles[e]=r}add(e,t,r){const s=convertToList(e);s.forEach(o=>{this._assetMap[o]}),Array.isArray(t)||(typeof t=="string"?t=createStringVariations(t):t=[t]);const n=t.map(o=>{var l;let a=o;if(typeof o=="string"){let h=!1;for(let c=0;c<this._parsers.length;c++){const u=this._parsers[c];if(u.test(o)){a=u.parse(o),h=!0;break}}h||(a={src:o})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=s),(this._basePath||this._rootPath)&&(a.src=path.toAbsolute(a.src,this._basePath,this._rootPath)),a.data=(l=a.data)!=null?l:r,a});s.forEach(o=>{this._assetMap[o]=n})}resolveBundle(e){const t=isSingleItem(e);e=convertToList(e);const r={};return e.forEach(s=>{const n=this._bundles[s];n&&(r[s]=this.resolve(n))}),t?r[e[0]]:r}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const r={};for(const s in t)r[s]=t[s].src;return r}return t.src}resolve(e){const t=isSingleItem(e);e=convertToList(e);const r={};return e.forEach(s=>{var n;if(!this._resolverHash[s])if(this._assetMap[s]){let o=this._assetMap[s];const a=this._getPreferredOrder(o),l=o[0];a==null||a.priority.forEach(h=>{a.params[h].forEach(c=>{const u=o.filter(d=>d[h]?d[h]===c:!1);u.length&&(o=u)})}),this._resolverHash[s]=(n=o[0])!=null?n:l}else{let o=s;(this._basePath||this._rootPath)&&(o=path.toAbsolute(o,this._basePath,this._rootPath)),this._resolverHash[s]={src:o}}r[s]=this._resolverHash[s]}),t?r[e[0]]:r}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const r=e[0],s=this._preferredOrder.find(n=>n.params.format.includes(r.format));if(s)return s}return this._preferredOrder[0]}}class AssetsClass{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Resolver,this.loader=new Loader,this.cache=Cache,this._backgroundLoader=new BackgroundLoader(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var n,o,a,l;if(this._initialized)return;if(this._initialized=!0,e.basePath&&(this.resolver.basePath=e.basePath),e.manifest){let h=e.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const t=(o=(n=e.texturePreference)==null?void 0:n.resolution)!=null?o:1,r=typeof t=="number"?[t]:t;let s=[];if((a=e.texturePreference)!=null&&a.format){const h=(l=e.texturePreference)==null?void 0:l.format;s=typeof h=="string"?[h]:h;for(const c of this._detections)await c.test()||(s=await c.remove(s))}else for(const h of this._detections)await h.test()&&(s=await h.add(s));this.resolver.prefer({params:{format:s,resolution:r}})}add(e,t,r){this.resolver.add(e,t,r)}async load(e,t){this._initialized||await this.init();const r=isSingleItem(e),s=convertToList(e).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):a),n=this.resolver.resolve(s),o=await this._mapLoadToResolve(n,t);return r?o[s[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);const s=this.resolver.resolveBundle(e),n={},o=Object.keys(s);let a=0,l=0;const h=()=>{t==null||t(++a/l)},c=o.map(u=>{const d=s[u];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{n[u]=f})});return await Promise.all(c),r?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Cache.get(e);const t={};for(let r=0;r<e.length;r++)t[r]=Cache.get(e[r]);return t}async _mapLoadToResolve(e,t){const r=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;const n=await this.loader.load(r,t);this._backgroundLoader.active=!0;const o={};return r.forEach((a,l)=>{const h=n[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[s[l]]=h,Cache.set(c,h)}),o}async unload(e){this._initialized||await this.init();const t=convertToList(e).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=convertToList(e);const t=this.resolver.resolveBundle(e),r=Object.keys(t).map(s=>this._unloadFromResolved(t[s]));await Promise.all(r)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(r=>{Cache.remove(r.src)}),await this.loader.unload(t)}get detections(){return this._detections}}const Assets=new AssetsClass;extensions$1.handleByList(ExtensionType.LoadParser,Assets.loader.parsers).handleByList(ExtensionType.ResolveParser,Assets.resolver.parsers).handleByList(ExtensionType.CacheParser,Assets.cache.parsers).handleByList(ExtensionType.DetectionParser,Assets.detections);const assetKeyMap={loader:ExtensionType.LoadParser,resolver:ExtensionType.ResolveParser,cache:ExtensionType.CacheParser,detection:ExtensionType.DetectionParser};extensions$1.handle(ExtensionType.Asset,i=>{const e=i.ref;Object.entries(assetKeyMap).filter(([t])=>!!e[t]).forEach(([t,r])=>{var s;return extensions$1.add(Object.assign(e[t],{extension:(s=e[t].extension)!=null?s:r}))})},i=>{const e=i.ref;Object.keys(assetKeyMap).filter(t=>!!e[t]).forEach(t=>extensions$1.remove(e[t]))});const cacheTextureArray={extension:ExtensionType.CacheParser,test:i=>Array.isArray(i)&&i.every(e=>e instanceof Texture),getCacheableAssets:(i,e)=>{const t={};return i.forEach(r=>{e.forEach((s,n)=>{t[r+(n===0?"":n+1)]=s})}),t}};extensions$1.add(cacheTextureArray);var LoaderParserPriority=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(LoaderParserPriority||{});const loadJson={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(i){return path.extname(i).includes(".json")},async load(i){return await(await settings.ADAPTER.fetch(i)).json()}};extensions$1.add(loadJson);const loadTxt={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(i){return path.extname(i).includes(".txt")},async load(i){return await(await settings.ADAPTER.fetch(i)).text()}};extensions$1.add(loadTxt);const validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"],validFonts=["woff","woff2","ttf","otf"];function getFontFamilyName(i){const e=path.extname(i);return path.basename(i,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}const loadWebFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(i){const t=i.split("?")[0].split(".").pop();return validFonts.includes(t)},async load(i,e){var r,s,n,o,a,l;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const t=settings.ADAPTER.getFontFaceSet();if(t){const h=[],c=(s=(r=e.data)==null?void 0:r.family)!=null?s:getFontFamilyName(i),u=(a=(o=(n=e.data)==null?void 0:n.weights)==null?void 0:o.filter(f=>validWeights.includes(f)))!=null?a:["normal"],d=(l=e.data)!=null?l:{};for(let f=0;f<u.length;f++){const p=u[f],m=new FontFace(c,`url(${i})`,{...d,weight:p});await m.load(),t.add(m),h.push(m)}return h.length===1?h[0]:h}return null},unload(i){(Array.isArray(i)?i:[i]).forEach(e=>settings.ADAPTER.getFontFaceSet().delete(e))}};extensions$1.add(loadWebFont);let UUID=0,MAX_WORKERS;const WHITE_PNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",checkImageBitmapCode={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${WHITE_PNG}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},workerCode={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let workerURL;class WorkerManagerClass{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const t=URL.createObjectURL(new Blob([checkImageBitmapCode.code],{type:"application/javascript"})),r=new Worker(t);r.addEventListener("message",s=>{r.terminate(),URL.revokeObjectURL(t),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){MAX_WORKERS===void 0&&(MAX_WORKERS=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<MAX_WORKERS&&(workerURL||(workerURL=URL.createObjectURL(new Blob([workerCode.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(workerURL),e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const r=new Promise((s,n)=>{this.queue.push({id:e,arguments:t,resolve:s,reject:n})});return this.next(),r}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),r=t.id;this.resolveHash[UUID]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:UUID++,id:r})}}const WorkerManager=new WorkerManagerClass;function checkExtension(i,e){const t=i.split("?")[0],r=path.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r.toLowerCase()):r.toLowerCase()===e}function createTexture(i,e,t){const r=new Texture(i);return r.baseTexture.on("dispose",()=>{delete e.promiseCache[t]}),r}const validImages$1=[".jpg",".png",".jpeg",".avif",".webp"];async function loadImageBitmap(i){const e=await settings.ADAPTER.fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const loadTextures={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{preferWorkers:!0},test(i){let e=!1;for(let t=0;t<validImages$1.length;t++)if(i.startsWith(`data:image/${validImages$1[t].slice(1)}`)){e=!0;break}return e||checkExtension(i,validImages$1)},async load(i,e,t){let r=null;globalThis.createImageBitmap?this.config.preferWorkers&&await WorkerManager.isImageBitmapSupported()?r=await WorkerManager.loadImageBitmap(i):r=await loadImageBitmap(i):r=await new Promise(n=>{r=new Image,r.crossOrigin="anonymous",r.src=i,r.complete?n(r):r.onload=()=>{n(r)}});const s=new BaseTexture(r,{resolution:getResolutionOfUrl(i),...e.data});return s.resource.src=i,createTexture(s,t,i)},unload(i){i.destroy(!0)}};extensions$1.add(loadTextures);ExtensionType.LoadParser,LoaderParserPriority.High,loadTextures.unload;const resolveTextureUrl={extension:ExtensionType.ResolveParser,test:loadTextures.test,parse:i=>{var e,t;return{resolution:parseFloat((t=(e=settings.RETINA_PREFIX.exec(i))==null?void 0:e[1])!=null?t:"1"),format:i.split(".").pop(),src:i}}};extensions$1.add(resolveTextureUrl);const detectAvif={extension:{type:ExtensionType.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",e=await settings.ADAPTER.fetch(i).then(t=>t.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(e=>e!=="avif")};extensions$1.add(detectAvif);const detectWebp={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",e=await settings.ADAPTER.fetch(i).then(t=>t.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(e=>e!=="webp")};extensions$1.add(detectWebp);const imageFormats=["png","jpg","jpeg"],detectDefaults={extension:{type:ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...imageFormats],remove:async i=>i.filter(e=>!imageFormats.includes(e))};extensions$1.add(detectDefaults);var INTERNAL_FORMATS=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(INTERNAL_FORMATS||{});const INTERNAL_FORMAT_TO_BYTES_PER_PIXEL={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class BlobResource extends BufferResource{constructor(e,t={width:1,height:1,autoLoad:!0}){let r,s;typeof e=="string"?(r=e,s=new Uint8Array):(r=null,s=e),super(s,t),this.origin=r,this.buffer=s?new ViewableBuffer(s):null,this.origin&&t.autoLoad!==!1&&this.load(),s!=null&&s.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}async load(){const r=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(r),this.buffer=new ViewableBuffer(r),this.loaded=!0,this.onBlobLoaded(r),this.update(),this}}class CompressedTextureResource extends BlobResource{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=CompressedTextureResource._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||CompressedTextureResource._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,r){const s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let o=0,a=this.levels;o<a;o++){const{levelID:l,levelWidth:h,levelHeight:c,levelBuffer:u}=this._levelBuffers[o];s.compressedTexImage2D(s.TEXTURE_2D,l,this.format,h,c,0,u)}return!0}onBlobLoaded(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,t,r,s,n,o,a){const l=new Array(r);let h=e.byteOffset,c=o,u=a,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[t];for(let m=0;m<r;m++)l[m]={levelID:m,levelWidth:r>1?c:d,levelHeight:r>1?u:f,levelBuffer:new Uint8Array(e.buffer,h,p)},h+=p,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),f=u+n-1&~(n-1),p=d*f*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[t];return l}}let storedGl,extensions;function getCompressedTextureExtensions(){extensions={s3tc:storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:storedGl.getExtension("WEBGL_compressed_texture_etc"),etc1:storedGl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:storedGl.getExtension("WEBGL_compressed_texture_atc"),astc:storedGl.getExtension("WEBGL_compressed_texture_astc")}}const detectCompressedTextures={extension:{type:ExtensionType.DetectionParser,priority:2},test:async()=>{const e=settings.ADAPTER.createCanvas().getContext("webgl");return e?(storedGl=e,!0):!1},add:async i=>{extensions||getCompressedTextureExtensions();const e=[];for(const t in extensions)!extensions[t]||e.push(t);return[...e,...i]},remove:async i=>(extensions||getCompressedTextureExtensions(),i.filter(e=>!(e in extensions)))};extensions$1.add(detectCompressedTextures);const DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT={[FOURCC_DXT1]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[FOURCC_DXT3]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[FOURCC_DXT5]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT},DXGI_TO_FORMAT={[70]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function parseDDS(i){const e=new Uint32Array(i);if(e[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(i,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),s=r[DDS_FIELDS.HEIGHT],n=r[DDS_FIELDS.WIDTH],o=r[DDS_FIELDS.MIPMAP_COUNT],a=new Uint32Array(i,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),l=a[PF_FLAGS];if(l&DDPF_FOURCC){const h=a[DDS_PF_FIELDS.FOURCC];if(h!==FOURCC_DX10){const _=FOURCC_TO_FORMAT[h],x=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,T=new Uint8Array(i,x);return[new CompressedTextureResource(T,{format:_,width:n,height:s,levels:o})]}const c=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,u=new Uint32Array(e.buffer,c,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),d=u[DDS_DX10_FIELDS.DXGI_FORMAT],f=u[DDS_DX10_FIELDS.RESOURCE_DIMENSION],p=u[DDS_DX10_FIELDS.MISC_FLAG],m=u[DDS_DX10_FIELDS.ARRAY_SIZE],g=DXGI_TO_FORMAT[d];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${d}`);if(p===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(f===6)throw new Error("DDSParser does not supported 3D texture data");const y=new Array,v=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(m===1)y.push(new Uint8Array(i,v));else{const _=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[g];let x=0,T=n,R=s;for(let S=0;S<o;S++){const M=Math.max(1,T+3&-4),D=Math.max(1,R+3&-4);x+=M*D*_,T=T>>>1,R=R>>>1}let A=v;for(let S=0;S<m;S++)y.push(new Uint8Array(i,A,x)),A+=x}return y.map(_=>new CompressedTextureResource(_,{format:g,width:n,height:s,levels:o}))}throw l&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):l&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):l&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):l&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT={[TYPES.UNSIGNED_BYTE]:1,[TYPES.UNSIGNED_SHORT]:2,[TYPES.INT]:4,[TYPES.UNSIGNED_INT]:4,[TYPES.FLOAT]:4,[TYPES.HALF_FLOAT]:8},FORMATS_TO_COMPONENTS={[FORMATS.RGBA]:4,[FORMATS.RGB]:3,[FORMATS.RG]:2,[FORMATS.RED]:1,[FORMATS.LUMINANCE]:1,[FORMATS.LUMINANCE_ALPHA]:2,[FORMATS.ALPHA]:1},TYPES_TO_BYTES_PER_PIXEL={[TYPES.UNSIGNED_SHORT_4_4_4_4]:2,[TYPES.UNSIGNED_SHORT_5_5_5_1]:2,[TYPES.UNSIGNED_SHORT_5_6_5]:2};function parseKTX(i,e,t=!1){const r=new DataView(e);if(!validate(i,r))return null;const s=r.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,n=r.getUint32(KTX_FIELDS.GL_TYPE,s),o=r.getUint32(KTX_FIELDS.GL_FORMAT,s),a=r.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,s),l=r.getUint32(KTX_FIELDS.PIXEL_WIDTH,s),h=r.getUint32(KTX_FIELDS.PIXEL_HEIGHT,s)||1,c=r.getUint32(KTX_FIELDS.PIXEL_DEPTH,s)||1,u=r.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=r.getUint32(KTX_FIELDS.NUMBER_OF_FACES,s),f=r.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,s),p=r.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,s);if(h===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,y=l+3&-4,v=h+3&-4,_=new Array(u);let x=l*h;n===0&&(x=y*v);let T;if(n!==0?TYPES_TO_BYTES_PER_COMPONENT[n]?T=TYPES_TO_BYTES_PER_COMPONENT[n]*FORMATS_TO_COMPONENTS[o]:T=TYPES_TO_BYTES_PER_PIXEL[n]:T=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[a],T===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const R=t?parseKvData(r,p,s):null;let S=x*T,M=l,D=h,I=y,P=v,w=FILE_HEADER_SIZE+p;for(let E=0;E<f;E++){const O=r.getUint32(w,s);let L=w+4;for(let C=0;C<u;C++){let k=_[C];k||(k=_[C]=new Array(f)),k[E]={levelID:E,levelWidth:f>1||n!==0?M:I,levelHeight:f>1||n!==0?D:P,levelBuffer:new Uint8Array(e,L,S)},L+=S}w+=O+4,w=w%4!==0?w+4-w%4:w,M=M>>1||1,D=D>>1||1,I=M+m-1&~(m-1),P=D+g-1&~(g-1),S=I*P*T}return n!==0?{uncompressed:_.map(E=>{let O=E[0].levelBuffer,L=!1;return n===TYPES.FLOAT?O=new Float32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4):n===TYPES.UNSIGNED_INT?(L=!0,O=new Uint32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)):n===TYPES.INT&&(L=!0,O=new Int32Array(E[0].levelBuffer.buffer,E[0].levelBuffer.byteOffset,E[0].levelBuffer.byteLength/4)),{resource:new BufferResource(O,{width:E[0].levelWidth,height:E[0].levelHeight}),type:n,format:L?convertFormatToInteger(o):o}}),kvData:R}:{compressed:_.map(E=>new CompressedTextureResource(null,{format:a,width:l,height:h,levels:f,levelBuffers:E})),kvData:R}}function validate(i,e){for(let t=0;t<FILE_IDENTIFIER.length;t++)if(e.getUint8(t)!==FILE_IDENTIFIER[t])return!1;return!0}function convertFormatToInteger(i){switch(i){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return i}}function parseKvData(i,e,t){const r=new Map;let s=0;for(;s<e;){const n=i.getUint32(FILE_HEADER_SIZE+s,t),o=FILE_HEADER_SIZE+s+4,a=3-(n+3)%4;if(n===0||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&i.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(i.buffer,o,l)),c=new DataView(i.buffer,o+l+1,n-l-1);r.set(h,c),s+=4+n+a}return r}const loadDDS={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test(i){return checkExtension(i,".dds")},async load(i,e,t){const s=await(await settings.ADAPTER.fetch(i)).arrayBuffer(),o=parseDDS(s).map(a=>{const l=new BaseTexture(a,{mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(i),...e.data});return createTexture(l,t,i)});return o.length===1?o[0]:o},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};extensions$1.add(loadDDS);const loadKTX={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test(i){return checkExtension(i,".ktx")},async load(i,e,t){const s=await(await settings.ADAPTER.fetch(i)).arrayBuffer(),{compressed:n,uncompressed:o,kvData:a}=parseKTX(i,s),l=n!=null?n:o,h={mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(i),...e.data},c=l.map(u=>{l===o&&Object.assign(h,{type:u.type,format:u.format});const d=new BaseTexture(u,h);return d.ktxKeyValueData=a,createTexture(d,t,i)});return c.length===1?c[0]:c},unload(i){Array.isArray(i)?i.forEach(e=>e.destroy(!0)):i.destroy(!0)}};extensions$1.add(loadKTX);const resolveCompressedTextureUrl={extension:ExtensionType.ResolveParser,test:i=>{const t=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(t)},parse:i=>{var r,s,n,o;if(i.split("?")[0].split(".").pop()==="ktx"){const a=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(a.some(l=>i.endsWith(l)))return{resolution:parseFloat((s=(r=settings.RETINA_PREFIX.exec(i))==null?void 0:r[1])!=null?s:"1"),format:a.find(l=>i.endsWith(l)),src:i}}return{resolution:parseFloat((o=(n=settings.RETINA_PREFIX.exec(i))==null?void 0:n[1])!=null?o:"1"),format:i.split(".").pop(),src:i}}};extensions$1.add(resolveCompressedTextureUrl);const TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,_Extract=class{constructor(i){this.renderer=i}async image(i,e,t){const r=new Image;return r.src=await this.base64(i,e,t),r}async base64(i,e,t){const r=this.canvas(i);if(r.toDataURL!==void 0)return r.toDataURL(e,t);if(r.convertToBlob!==void 0){const s=await r.convertToBlob({type:e,quality:t});return await new Promise(n=>{const o=new FileReader;o.onload=()=>n(o.result),o.readAsDataURL(s)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(i,e){const t=this.renderer;let r,s=!1,n,o=!1;i&&(i instanceof RenderTexture?n=i:(n=this.renderer.generateTexture(i),o=!0)),n?(r=n.baseTexture.resolution,e=e!=null?e:n.frame,s=!1,t.renderTexture.bind(n)):(r=t.resolution,e||(e=TEMP_RECT,e.width=t.width,e.height=t.height),s=!0,t.renderTexture.bind(null));const a=Math.round(e.width*r),l=Math.round(e.height*r);let h=new CanvasRenderTarget(a,l,1);const c=new Uint8Array(BYTES_PER_PIXEL*a*l),u=t.gl;u.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,u.RGBA,u.UNSIGNED_BYTE,c);const d=h.context.getImageData(0,0,a,l);if(_Extract.arrayPostDivide(c,d.data),h.context.putImageData(d,0,0),s){const f=new CanvasRenderTarget(h.width,h.height,1);f.context.scale(1,-1),f.context.drawImage(h.canvas,0,-l),h.destroy(),h=f}return o&&n.destroy(!0),h.canvas}pixels(i,e){const t=this.renderer;let r,s,n=!1;i&&(i instanceof RenderTexture?s=i:(s=this.renderer.generateTexture(i),n=!0)),s?(r=s.baseTexture.resolution,e=e!=null?e:s.frame,t.renderTexture.bind(s)):(r=t.resolution,e||(e=TEMP_RECT,e.width=t.width,e.height=t.height),t.renderTexture.bind(null));const o=Math.round(e.width*r),a=Math.round(e.height*r),l=new Uint8Array(BYTES_PER_PIXEL*o*a),h=t.gl;return h.readPixels(Math.round(e.x*r),Math.round(e.y*r),o,a,h.RGBA,h.UNSIGNED_BYTE,l),n&&s.destroy(!0),_Extract.arrayPostDivide(l,l),l}destroy(){this.renderer=null}static arrayPostDivide(i,e){for(let t=0;t<i.length;t+=4){const r=e[t+3]=i[t+3];r!==0?(e[t]=Math.round(Math.min(i[t]*255/r,255)),e[t+1]=Math.round(Math.min(i[t+1]*255/r,255)),e[t+2]=Math.round(Math.min(i[t+2]*255/r,255))):(e[t]=i[t],e[t+1]=i[t+1],e[t+2]=i[t+2])}}};let Extract=_Extract;Extract.extension={name:"extract",type:ExtensionType.RendererSystem};extensions$1.add(Extract);var LINE_JOIN=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(LINE_JOIN||{}),LINE_CAP=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(LINE_CAP||{});const GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,e=20){if(!this.adaptive||!i||isNaN(i))return e;let t=Math.ceil(i/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class FillStyle{constructor(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new FillStyle;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function fixOrientation(i,e=!1){const t=i.length;if(t<6)return;let r=0;for(let s=0,n=i[t-2],o=i[t-1];s<t;s+=2){const a=i[s],l=i[s+1];r+=(a-n)*(l+o),n=a,o=l}if(!e&&r>0||e&&r<=0){const s=t/2;for(let n=s+s%2;n<t;n+=2){const o=t-n-2,a=t-n-1,l=n,h=n+1;[i[o],i[l]]=[i[l],i[o]],[i[a],i[h]]=[i[h],i[a]]}}}const buildPoly={build(i){i.points=i.shape.points.slice()},triangulate(i,e){let t=i.points;const r=i.holes,s=e.points,n=e.indices;if(t.length>=6){fixOrientation(t,!1);const o=[];for(let h=0;h<r.length;h++){const c=r[h];fixOrientation(c.points,!0),o.push(t.length/2),t=t.concat(c.points)}const a=earcut$1.exports(t,o,2);if(!a)return;const l=s.length/2;for(let h=0;h<a.length;h+=3)n.push(a[h]+l),n.push(a[h+1]+l),n.push(a[h+2]+l);for(let h=0;h<t.length;h++)s.push(t[h])}}},buildCircle={build(i){const e=i.points;let t,r,s,n,o,a;if(i.type===SHAPES.CIRC){const p=i.shape;t=p.x,r=p.y,o=a=p.radius,s=n=0}else if(i.type===SHAPES.ELIP){const p=i.shape;t=p.x,r=p.y,o=p.width,a=p.height,s=n=0}else{const p=i.shape,m=p.width/2,g=p.height/2;t=p.x+m,r=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),s=m-o,n=g-a}if(!(o>=0&&a>=0&&s>=0&&n>=0)){e.length=0;return}const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(s?4:0)+(n?4:0);if(e.length=h,h===0)return;if(l===0){e.length=8,e[0]=e[6]=t+s,e[1]=e[3]=r+n,e[2]=e[4]=t-s,e[5]=e[7]=r-n;return}let c=0,u=l*4+(s?2:0)+2,d=u,f=h;{const p=s+o,m=n,g=t+p,y=t-p,v=r+m;if(e[c++]=g,e[c++]=v,e[--u]=v,e[--u]=y,n){const _=r-m;e[d++]=y,e[d++]=_,e[--f]=_,e[--f]=g}}for(let p=1;p<l;p++){const m=Math.PI/2*(p/l),g=s+Math.cos(m)*o,y=n+Math.sin(m)*a,v=t+g,_=t-g,x=r+y,T=r-y;e[c++]=v,e[c++]=x,e[--u]=x,e[--u]=_,e[d++]=_,e[d++]=T,e[--f]=T,e[--f]=v}{const p=s,m=n+a,g=t+p,y=t-p,v=r+m,_=r-m;e[c++]=g,e[c++]=v,e[--f]=_,e[--f]=g,s&&(e[c++]=y,e[c++]=v,e[--f]=_,e[--f]=y)}},triangulate(i,e){const t=i.points,r=e.points,s=e.indices;if(t.length===0)return;let n=r.length/2;const o=n;let a,l;if(i.type!==SHAPES.RREC){const c=i.shape;a=c.x,l=c.y}else{const c=i.shape;a=c.x+c.width/2,l=c.y+c.height/2}const h=i.matrix;r.push(i.matrix?h.a*a+h.c*l+h.tx:a,i.matrix?h.b*a+h.d*l+h.ty:l),n++,r.push(t[0],t[1]);for(let c=2;c<t.length;c+=2)r.push(t[c],t[c+1]),s.push(n++,o,n);s.push(o+1,o,n)}},buildRectangle={build(i){const e=i.shape,t=e.x,r=e.y,s=e.width,n=e.height,o=i.points;o.length=0,s>=0&&n>=0&&o.push(t,r,t+s,r,t+s,r+n,t,r+n)},triangulate(i,e){const t=i.points,r=e.points;if(t.length===0)return;const s=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},buildRoundedRectangle={build(i){buildCircle.build(i)},triangulate(i,e){buildCircle.triangulate(i,e)}};function square(i,e,t,r,s,n,o,a){const l=i-t*s,h=e-r*s,c=i+t*n,u=e+r*n;let d,f;o?(d=r,f=-t):(d=-r,f=t);const p=l+d,m=h+f,g=c+d,y=u+f;return a.push(p,m),a.push(g,y),2}function round(i,e,t,r,s,n,o,a){const l=t-i,h=r-e;let c=Math.atan2(l,h),u=Math.atan2(s-i,n-e);a&&c<u?c+=Math.PI*2:!a&&c>u&&(u+=Math.PI*2);let d=c;const f=u-c,p=Math.abs(f),m=Math.sqrt(l*l+h*h),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,y=f/g;if(d+=y,a){o.push(i,e),o.push(t,r);for(let v=1,_=d;v<g;v++,_+=y)o.push(i,e),o.push(i+Math.sin(_)*m,e+Math.cos(_)*m);o.push(i,e),o.push(s,n)}else{o.push(t,r),o.push(i,e);for(let v=1,_=d;v<g;v++,_+=y)o.push(i+Math.sin(_)*m,e+Math.cos(_)*m),o.push(i,e);o.push(s,n),o.push(i,e)}return g*2}function buildNonNativeLine(i,e){const t=i.shape;let r=i.points||t.points.slice();const s=e.closePointEps;if(r.length===0)return;const n=i.lineStyle,o=new Point(r[0],r[1]),a=new Point(r[r.length-2],r[r.length-1]),l=t.type!==SHAPES.POLY||t.closeStroke,h=Math.abs(o.x-a.x)<s&&Math.abs(o.y-a.y)<s;if(l){r=r.slice(),h&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const C=(o.x+a.x)*.5,k=(a.y+o.y)*.5;r.unshift(C,k),r.push(C,k)}const c=e.points,u=r.length/2;let d=r.length;const f=c.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit;let y=r[0],v=r[1],_=r[2],x=r[3],T=0,R=0,A=-(v-x),S=y-_,M=0,D=0,I=Math.sqrt(A*A+S*S);A/=I,S/=I,A*=p,S*=p;const P=n.alignment,w=(1-P)*2,E=P*2;l||(n.cap===LINE_CAP.ROUND?d+=round(y-A*(w-E)*.5,v-S*(w-E)*.5,y-A*w,v-S*w,y+A*E,v+S*E,c,!0)+2:n.cap===LINE_CAP.SQUARE&&(d+=square(y,v,A,S,w,E,!0,c))),c.push(y-A*w,v-S*w),c.push(y+A*E,v+S*E);for(let C=1;C<u-1;++C){y=r[(C-1)*2],v=r[(C-1)*2+1],_=r[C*2],x=r[C*2+1],T=r[(C+1)*2],R=r[(C+1)*2+1],A=-(v-x),S=y-_,I=Math.sqrt(A*A+S*S),A/=I,S/=I,A*=p,S*=p,M=-(x-R),D=_-T,I=Math.sqrt(M*M+D*D),M/=I,D/=I,M*=p,D*=p;const k=_-y,X=v-x,b=_-T,B=R-x,N=k*b+X*B,G=X*b-B*k,U=G<0;if(Math.abs(G)<.001*Math.abs(N)){c.push(_-A*w,x-S*w),c.push(_+A*E,x+S*E),N>=0&&(n.join===LINE_JOIN.ROUND?d+=round(_,x,_-A*w,x-S*w,_-M*w,x-D*w,c,!1)+4:d+=2,c.push(_-M*E,x-D*E),c.push(_+M*w,x+D*w));continue}const $=(-A+y)*(-S+x)-(-A+_)*(-S+v),F=(-M+T)*(-D+x)-(-M+_)*(-D+R),H=(k*F-b*$)/G,j=(B*$-X*F)/G,q=(H-_)*(H-_)+(j-x)*(j-x),Y=_+(H-_)*w,W=x+(j-x)*w,z=_-(H-_)*E,V=x-(j-x)*E,K=Math.min(k*k+X*X,b*b+B*B),Z=U?w:E,J=K+Z*Z*m;q<=J?n.join===LINE_JOIN.BEVEL||q/m>g?(U?(c.push(Y,W),c.push(_+A*E,x+S*E),c.push(Y,W),c.push(_+M*E,x+D*E)):(c.push(_-A*w,x-S*w),c.push(z,V),c.push(_-M*w,x-D*w),c.push(z,V)),d+=2):n.join===LINE_JOIN.ROUND?U?(c.push(Y,W),c.push(_+A*E,x+S*E),d+=round(_,x,_+A*E,x+S*E,_+M*E,x+D*E,c,!0)+4,c.push(Y,W),c.push(_+M*E,x+D*E)):(c.push(_-A*w,x-S*w),c.push(z,V),d+=round(_,x,_-A*w,x-S*w,_-M*w,x-D*w,c,!1)+4,c.push(_-M*w,x-D*w),c.push(z,V)):(c.push(Y,W),c.push(z,V)):(c.push(_-A*w,x-S*w),c.push(_+A*E,x+S*E),n.join===LINE_JOIN.ROUND?U?d+=round(_,x,_+A*E,x+S*E,_+M*E,x+D*E,c,!0)+2:d+=round(_,x,_-A*w,x-S*w,_-M*w,x-D*w,c,!1)+2:n.join===LINE_JOIN.MITER&&q/m<=g&&(U?(c.push(z,V),c.push(z,V)):(c.push(Y,W),c.push(Y,W)),d+=2),c.push(_-M*w,x-D*w),c.push(_+M*E,x+D*E),d+=2)}y=r[(u-2)*2],v=r[(u-2)*2+1],_=r[(u-1)*2],x=r[(u-1)*2+1],A=-(v-x),S=y-_,I=Math.sqrt(A*A+S*S),A/=I,S/=I,A*=p,S*=p,c.push(_-A*w,x-S*w),c.push(_+A*E,x+S*E),l||(n.cap===LINE_CAP.ROUND?d+=round(_-A*(w-E)*.5,x-S*(w-E)*.5,_-A*w,x-S*w,_+A*E,x+S*E,c,!1)+2:n.cap===LINE_CAP.SQUARE&&(d+=square(_,x,A,S,w,E,!1,c)));const O=e.indices,L=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon;for(let C=f;C<d+f-2;++C)y=c[C*2],v=c[C*2+1],_=c[(C+1)*2],x=c[(C+1)*2+1],T=c[(C+2)*2],R=c[(C+2)*2+1],!(Math.abs(y*(x-R)+_*(R-v)+T*(v-x))<L)&&O.push(C,C+1,C+2)}function buildNativeLine(i,e){let t=0;const r=i.shape,s=i.points||r.points,n=r.type!==SHAPES.POLY||r.closeStroke;if(s.length===0)return;const o=e.points,a=e.indices,l=s.length/2,h=o.length/2;let c=h;for(o.push(s[0],s[1]),t=1;t<l;t++)o.push(s[t*2],s[t*2+1]),a.push(c,c+1),c++;n&&a.push(c,h)}function buildLine(i,e){i.lineStyle.native?buildNativeLine(i,e):buildNonNativeLine(i,e)}class ArcUtils{static curveTo(e,t,r,s,n,o){const a=o[o.length-2],h=o[o.length-1]-t,c=a-e,u=s-t,d=r-e,f=Math.abs(h*d-c*u);if(f<1e-8||n===0)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;const p=h*h+c*c,m=u*u+d*d,g=h*u+c*d,y=n*Math.sqrt(p)/f,v=n*Math.sqrt(m)/f,_=y*g/p,x=v*g/m,T=y*d+v*c,R=y*u+v*h,A=c*(v+_),S=h*(v+_),M=d*(y+x),D=u*(y+x),I=Math.atan2(S-R,A-T),P=Math.atan2(D-R,M-T);return{cx:T+e,cy:R+t,radius:n,startAngle:I,endAngle:P,anticlockwise:c*u>d*h}}static arc(e,t,r,s,n,o,a,l,h){const c=a-o,u=GRAPHICS_CURVES._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/PI_2)*40),d=c/(u*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=u-1,y=g%1/g;for(let v=0;v<=g;++v){const _=v+y*v,x=d+o+f*_,T=Math.cos(x),R=-Math.sin(x);h.push((p*T+m*R)*n+r,(p*-R+m*T)*n+s)}}}class BezierUtils{static curveLength(e,t,r,s,n,o,a,l){let c=0,u=0,d=0,f=0,p=0,m=0,g=0,y=0,v=0,_=0,x=0,T=e,R=t;for(let A=1;A<=10;++A)u=A/10,d=u*u,f=d*u,p=1-u,m=p*p,g=m*p,y=g*e+3*m*u*r+3*p*d*n+f*a,v=g*t+3*m*u*s+3*p*d*o+f*l,_=T-y,x=R-v,T=y,R=v,c+=Math.sqrt(_*_+x*x);return c}static curveTo(e,t,r,s,n,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const c=GRAPHICS_CURVES._segmentsCount(BezierUtils.curveLength(l,h,e,t,r,s,n,o));let u=0,d=0,f=0,p=0,m=0;a.push(l,h);for(let g=1,y=0;g<=c;++g)y=g/c,u=1-y,d=u*u,f=d*u,p=y*y,m=p*y,a.push(f*l+3*d*y*e+3*u*p*r+m*n,f*h+3*d*y*t+3*u*p*s+m*o)}}class QuadraticUtils{static curveLength(e,t,r,s,n,o){const a=e-2*r+n,l=t-2*s+o,h=2*r-2*e,c=2*s-2*t,u=4*(a*a+l*l),d=4*(a*h+l*c),f=h*h+c*c,p=2*Math.sqrt(u+d+f),m=Math.sqrt(u),g=2*u*m,y=2*Math.sqrt(f),v=d/m;return(g*p+m*d*(p-y)+(4*f*u-d*d)*Math.log((2*m+v+p)/(v+y)))/(4*g)}static curveTo(e,t,r,s,n){const o=n[n.length-2],a=n[n.length-1],l=GRAPHICS_CURVES._segmentsCount(QuadraticUtils.curveLength(o,a,e,t,r,s));let h=0,c=0;for(let u=1;u<=l;++u){const d=u/l;h=o+(e-o)*d,c=a+(t-a)*d,n.push(h+(e+(r-e)*d-h)*d,c+(t+(s-t)*d-c)*d)}}}class BatchPart{constructor(){this.reset()}begin(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const FILL_COMMANDS={[SHAPES.POLY]:buildPoly,[SHAPES.CIRC]:buildCircle,[SHAPES.ELIP]:buildCircle,[SHAPES.RECT]:buildRectangle,[SHAPES.RREC]:buildRoundedRectangle},BATCH_POOL=[],DRAW_CALL_POOL=[];class GraphicsData{constructor(e,t=null,r=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const tmpPoint=new Point,_GraphicsGeometry=class extends BatchGeometry{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Bounds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const e=this.batches[i];e.reset(),BATCH_POOL.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,e=null,t=null,r=null){const s=new GraphicsData(i,e,t,r);return this.graphicsData.push(s),this.dirty++,this}drawHole(i,e=null){if(!this.graphicsData.length)return null;const t=new GraphicsData(i,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return t.lineStyle=r.lineStyle,r.holes.push(t),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const e=this.graphicsData;for(let t=0;t<e.length;++t){const r=e[t];if(!!r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(i,tmpPoint):tmpPoint.copyFrom(i),r.shape.contains(tmpPoint.x,tmpPoint.y))){let s=!1;if(r.holes){for(let n=0;n<r.holes.length;n++)if(r.holes[n].shape.contains(tmpPoint.x,tmpPoint.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,e=this.graphicsData;let t=null,r=null;this.batches.length>0&&(t=this.batches[this.batches.length-1],r=t.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;const l=e[a],h=l.fillStyle,c=l.lineStyle;FILL_COMMANDS[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(h.visible||c.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const f=d===0?h:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=WRAP_MODES.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-g;y!==0&&(t&&!this._compareStyles(r,f)&&(t.end(m,g),t=null),t||(t=BATCH_POOL.pop()||new BatchPart,t.begin(f,m,g),this.batches.push(t),r=f),this.addUvs(this.points,i,f.texture,g,y,f.matrix))}}const s=this.indices.length,n=this.points.length/2;if(t&&t.end(s,n),this.batches.length===0){this.batchable=!0;return}const o=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,e){return!(!i||!e||i.texture.baseTexture!==e.texture.baseTexture||i.color+i.alpha!==e.color+e.alpha||!!i.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,e=this.graphicsData.length;i<e;i++){const t=this.graphicsData[i],r=t.fillStyle,s=t.lineStyle;if(r&&!r.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let e=0,t=i.length;e<t;e++){const r=i[e];for(let s=0;s<r.size;s++){const n=r.start+s;this.indicesUint16[n]=this.indicesUint16[n]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let e=0;e<i.length;e++)if(i[e].style.native)return!1;return this.points.length<_GraphicsGeometry.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++BaseTexture._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[c]);this.drawCalls.length=0;const e=this.colors,t=this.textureIds;let r=DRAW_CALL_POOL.pop();r||(r=new BatchDrawCall,r.texArray=new BatchTextureArray),r.texArray.count=0,r.start=0,r.size=0,r.type=DRAW_MODES.TRIANGLES;let s=0,n=null,o=0,a=!1,l=DRAW_MODES.TRIANGLES,h=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const u=this.batches[c],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,n=null,s=d,i++),n!==p&&(n=p,p._batchEnabled!==i&&(s===d&&(i++,s=0,r.size>0&&(r=DRAW_CALL_POOL.pop(),r||(r=new BatchDrawCall,r.texArray=new BatchTextureArray),this.drawCalls.push(r)),r.start=h,r.size=0,r.texArray.count=0,r.type=l),p.touched=1,p._batchEnabled=i,p._batchLocation=s,p.wrapMode=WRAP_MODES.REPEAT,r.texArray.elements[r.texArray.count++]=p,s++)),r.size+=u.size,h+=u.size,o=p._batchLocation,this.addColors(e,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(t,o,u.attribSize,u.attribStart)}BaseTexture._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,e=this.uvs,t=this.colors,r=this.textureIds,s=new ArrayBuffer(i.length*3*4),n=new Float32Array(s),o=new Uint32Array(s);let a=0;for(let l=0;l<i.length/2;l++)n[a++]=i[l*2],n[a++]=i[l*2+1],n[a++]=e[l*2],n[a++]=e[l*2+1],o[a++]=t[l],n[a++]=r[l];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?buildPoly.triangulate(i,this):FILL_COMMANDS[i.type].triangulate(i,this)}processLine(i){buildLine(i,this);for(let e=0;e<i.holes.length;e++)buildLine(i.holes[e],this)}processHoles(i){for(let e=0;e<i.length;e++){const t=i[e];FILL_COMMANDS[t.type].build(t),t.matrix&&this.transformPoints(t.points,t.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,e){for(let t=0;t<i.length/2;t++){const r=i[t*2],s=i[t*2+1];i[t*2]=e.a*r+e.c*s+e.tx,i[t*2+1]=e.b*r+e.d*s+e.ty}}addColors(i,e,t,r,s=0){const n=(e>>16)+(e&65280)+((e&255)<<16),o=premultiplyTint(n,t);i.length=Math.max(i.length,s+r);for(let a=0;a<r;a++)i[s+a]=o}addTextureIds(i,e,t,r=0){i.length=Math.max(i.length,r+t);for(let s=0;s<t;s++)i[r+s]=e}addUvs(i,e,t,r,s,n=null){let o=0;const a=e.length,l=t.frame;for(;o<s;){let c=i[(r+o)*2],u=i[(r+o)*2+1];if(n){const d=n.a*c+n.c*u+n.tx;u=n.b*c+n.d*u+n.ty,c=d}o++,e.push(c/l.width,u/l.height)}const h=t.baseTexture;(l.width<h.width||l.height<h.height)&&this.adjustUvs(e,t,a,s)}adjustUvs(i,e,t,r){const s=e.baseTexture,n=1e-6,o=t+r*2,a=e.frame,l=a.width/s.width,h=a.height/s.height;let c=a.x/a.width,u=a.y/a.height,d=Math.floor(i[t]+n),f=Math.floor(i[t+1]+n);for(let p=t+2;p<o;p+=2)d=Math.min(d,Math.floor(i[p]+n)),f=Math.min(f,Math.floor(i[p+1]+n));c-=d,u-=f;for(let p=t;p<o;p+=2)i[p]=(i[p]+c)*l,i[p+1]=(i[p+1]+u)*h}};let GraphicsGeometry=_GraphicsGeometry;GraphicsGeometry.BATCHABLE_SIZE=100;class LineStyle extends FillStyle{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}clone(){const e=new LineStyle;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const temp=new Float32Array(3),DEFAULT_SHADERS={},_Graphics=class extends Container{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new FillStyle,this._lineStyle=new LineStyle,this._matrix=null,this._holeMode=!1,this.state=State$1.for2d(),this._geometry=i||new GraphicsGeometry,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new _Graphics(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(i){this._tint=i}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,e=0,t=1,r=.5,s=!1){return typeof i=="number"&&(i={width:i,color:e,alpha:t,alignment:r,native:s}),this.lineTextureStyle(i)}lineTextureStyle(i){i=Object.assign({width:0,texture:Texture.WHITE,color:i!=null&&i.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},i),this.currentPath&&this.startPoly();const e=i.width>0&&i.alpha>0;return e?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:e},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[e-2],i[e-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,e){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=e,this}lineTo(i,e){this.currentPath||this.moveTo(0,0);const t=this.currentPath.points,r=t[t.length-2],s=t[t.length-1];return(r!==i||s!==e)&&t.push(i,e),this}_initCurve(i=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,e]):this.moveTo(i,e)}quadraticCurveTo(i,e,t,r){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(i,e,t,r,s),this}bezierCurveTo(i,e,t,r,s,n){return this._initCurve(),BezierUtils.curveTo(i,e,t,r,s,n,this.currentPath.points),this}arcTo(i,e,t,r,s){this._initCurve(i,e);const n=this.currentPath.points,o=ArcUtils.curveTo(i,e,t,r,s,n);if(o){const{cx:a,cy:l,radius:h,startAngle:c,endAngle:u,anticlockwise:d}=o;this.arc(a,l,h,c,u,d)}return this}arc(i,e,t,r,s,n=!1){if(r===s)return this;if(!n&&s<=r?s+=PI_2:n&&r<=s&&(r+=PI_2),s-r===0)return this;const a=i+Math.cos(r)*t,l=e+Math.sin(r)*t,h=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-a),d=Math.abs(c[c.length-1]-l);u<h&&d<h||c.push(a,l)}else this.moveTo(a,l),c=this.currentPath.points;return ArcUtils.arc(a,l,i,e,t,r,s,n,c),this}beginFill(i=0,e=1){return this.beginTextureFill({texture:Texture.WHITE,color:i,alpha:e})}beginTextureFill(i){i=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},i),this.currentPath&&this.startPoly();const e=i.alpha>0;return e?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:e},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,e,t,r){return this.drawShape(new Rectangle(i,e,t,r))}drawRoundedRect(i,e,t,r,s){return this.drawShape(new RoundedRectangle(i,e,t,r,s))}drawCircle(i,e,t){return this.drawShape(new Circle(i,e,t))}drawEllipse(i,e,t,r){return this.drawShape(new Ellipse(i,e,t,r))}drawPolygon(...i){let e,t=!0;const r=i[0];r.points?(t=r.closeStroke,e=r.points):Array.isArray(i[0])?e=i[0]:e=i;const s=new Polygon(e);return s.closeStroke=t,this.drawShape(s),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===SHAPES.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,e=this.blendMode,t=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=t,this.vertexData=new Float32Array(i.points);for(let r=0;r<t;r++){const s=i.batches[r],n=s.style.color,o=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),a=new Float32Array(i.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),l=new Uint16Array(i.indicesUint16.buffer,s.start*2,s.size),h={vertexData:o,blendMode:e,indices:l,uvs:a,_batchRGB:hex2rgb(n),_tintRGB:n,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[r]=h}}_renderBatched(i){if(!!this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,t=this.batches.length;e<t;e++){const r=this.batches[e];r.worldAlpha=this.worldAlpha*r.alpha,i.plugins[this.pluginName].render(r)}}}_renderDirect(i){const e=this._resolveDirectShader(i),t=this._geometry,r=this.tint,s=this.worldAlpha,n=e.uniforms,o=t.drawCalls;n.translationMatrix=this.transform.worldTransform,n.tint[0]=(r>>16&255)/255*s,n.tint[1]=(r>>8&255)/255*s,n.tint[2]=(r&255)/255*s,n.tint[3]=s,i.shader.bind(e),i.geometry.bind(t,e),i.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(i,t.drawCalls[a])}_renderDrawCallDirect(i,e){const{texArray:t,type:r,size:s,start:n}=e,o=t.count;for(let a=0;a<o;a++)i.texture.bind(t.elements[a],a);i.geometry.draw(r,s,n)}_resolveDirectShader(i){let e=this.shader;const t=this.pluginName;if(!e){if(!DEFAULT_SHADERS[t]){const{MAX_TEXTURES:r}=i.plugins[t],s=new Int32Array(r);for(let a=0;a<r;a++)s[a]=a;const n={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:s},!0)},o=i.plugins[t]._shader.program;DEFAULT_SHADERS[t]=new Shader(o,n)}e=DEFAULT_SHADERS[t]}return e}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:e,minY:t,maxX:r,maxY:s}=i.bounds;this._bounds.addFrame(this.transform,e,t,r,s)}containsPoint(i){return this.worldTransform.applyInverse(i,_Graphics._TEMP_POINT),this._geometry.containsPoint(_Graphics._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const i=hex2rgb(this.tint,temp);for(let e=0;e<this.batches.length;e++){const t=this.batches[e],r=t._batchRGB,s=i[0]*r[0]*255,n=i[1]*r[1]*255,o=i[2]*r[2]*255,a=(s<<16)+(n<<8)+(o|0);t._tintRGB=(a>>16)+(a&65280)+((a&255)<<16)}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const e=this.transform.worldTransform,t=e.a,r=e.b,s=e.c,n=e.d,o=e.tx,a=e.ty,l=this._geometry.points,h=this.vertexData;let c=0;for(let u=0;u<l.length;u+=2){const d=l[u],f=l[u+1];h[c++]=t*d+s*f+o,h[c++]=n*f+r*d+a}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let Graphics=_Graphics;Graphics._TEMP_POINT=new Point;class MeshBatchUvs{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const tempPoint=new Point,tempPolygon=new Polygon,_Mesh=class extends Container{constructor(i,e,t,r=DRAW_MODES.TRIANGLES){super(),this.geometry=i,this.shader=e,this.state=t||State$1.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=settings.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&e.length<_Mesh.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),i.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(e),i.state.set(this.state),i.geometry.bind(this.geometry,e),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const e=this.geometry,t=this.shader;t.uvMatrix&&(t.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=t._tintRGB,this._texture=t.texture;const r=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[r]),i.plugins[r].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,r=e._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const s=this.transform.worldTransform,n=s.a,o=s.b,a=s.c,l=s.d,h=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const f=t[d*2],p=t[d*2+1];u[d*2]=n*f+a*p+h,u[d*2+1]=o*f+l*p+c}if(this._roundPixels){const d=settings.RESOLUTION;for(let f=0;f<u.length;++f)u[f]=Math.round(u[f]*d)/d}this.vertexDirty=r}calculateUvs(){const i=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(i,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,tempPoint);const e=this.geometry.getBuffer("aVertexPosition").data,t=tempPolygon.points,r=this.geometry.getIndex().data,s=r.length,n=this.drawMode===4?3:1;for(let o=0;o+2<s;o+=n){const a=r[o]*2,l=r[o+1]*2,h=r[o+2]*2;if(t[0]=e[a],t[1]=e[a+1],t[2]=e[l],t[3]=e[l+1],t[4]=e[h],t[5]=e[h+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Mesh=_Mesh;Mesh.BATCHABLE_SIZE=100;var fragment$1=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex$1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class MeshMaterial extends Shader{constructor(e,t){const r={uSampler:e,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(r,t.uniforms),super(t.program||Program.from(vertex$1,fragment$1),r),this._colorDirty=!1,this.uvMatrix=new TextureMatrix(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this.tint=t.tint,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this._tint&&(this._tint=e,this._tintRGB=(e>>16)+(e&65280)+((e&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,e.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class MeshGeometry extends Geometry{constructor(e,t,r){super();const s=new Buffer(e),n=new Buffer(t,!0),o=new Buffer(r,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",n,2,!1,TYPES.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class ParticleBuffer{constructor(e,t,r){this.geometry=new Geometry,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||TYPES.FLOAT,offset:n.offset},t[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=t,t+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=s,s+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===TYPES.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===TYPES.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(e,t,r){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(e,t,r,n.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,r){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(e,t,r,n.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var fragment=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ParticleRenderer extends ObjectRenderer{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Matrix,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Shader.from(vertex,fragment,{}),this.state=State$1.for2d()}render(e){const t=e.children,r=e._maxSize,s=e._batchSize,n=this.renderer;let o=t.length;if(o===0)return;o>r&&!e.autoResize&&(o=r);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));const l=t[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=correctBlendMode(e.blendMode,h),n.state.set(this.state);const c=n.gl,u=e.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,h),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=s,p+=1){let m=o-f;m>s&&(m=s),p>=a.length&&a.push(this._generateOneMoreBuffer(e));const g=a[p];g.uploadDynamic(t,f,m);const y=e._bufferUpdateIDs[p]||0;d=d||g._updateID<y,d&&(g._updateID=e._updateID,g.uploadStatic(t,f,m)),n.geometry.bind(g.geometry),c.drawElements(c.TRIANGLES,m*6,c.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],r=e._maxSize,s=e._batchSize,n=e._properties;for(let o=0;o<r;o+=s)t.push(new ParticleBuffer(this.properties,n,s));return t}_generateOneMoreBuffer(e){const t=e._batchSize,r=e._properties;return new ParticleBuffer(this.properties,r,t)}uploadVertices(e,t,r,s,n,o){let a=0,l=0,h=0,c=0;for(let u=0;u<r;++u){const d=e[t+u],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,y=f.orig;g?(l=g.x-d.anchor.x*y.width,a=l+g.width,c=g.y-d.anchor.y*y.height,h=c+g.height):(a=y.width*(1-d.anchor.x),l=y.width*-d.anchor.x,h=y.height*(1-d.anchor.y),c=y.height*-d.anchor.y),s[o]=l*p,s[o+1]=c*m,s[o+n]=a*p,s[o+n+1]=c*m,s[o+n*2]=a*p,s[o+n*2+1]=h*m,s[o+n*3]=l*p,s[o+n*3+1]=h*m,o+=n*4}}uploadPosition(e,t,r,s,n,o){for(let a=0;a<r;a++){const l=e[t+a].position;s[o]=l.x,s[o+1]=l.y,s[o+n]=l.x,s[o+n+1]=l.y,s[o+n*2]=l.x,s[o+n*2+1]=l.y,s[o+n*3]=l.x,s[o+n*3+1]=l.y,o+=n*4}}uploadRotation(e,t,r,s,n,o){for(let a=0;a<r;a++){const l=e[t+a].rotation;s[o]=l,s[o+n]=l,s[o+n*2]=l,s[o+n*3]=l,o+=n*4}}uploadUvs(e,t,r,s,n,o){for(let a=0;a<r;++a){const l=e[t+a]._texture._uvs;l?(s[o]=l.x0,s[o+1]=l.y0,s[o+n]=l.x1,s[o+n+1]=l.y1,s[o+n*2]=l.x2,s[o+n*2+1]=l.y2,s[o+n*3]=l.x3,s[o+n*3+1]=l.y3,o+=n*4):(s[o]=0,s[o+1]=0,s[o+n]=0,s[o+n+1]=0,s[o+n*2]=0,s[o+n*2+1]=0,s[o+n*3]=0,s[o+n*3+1]=0,o+=n*4)}}uploadTint(e,t,r,s,n,o){for(let a=0;a<r;++a){const l=e[t+a],h=l._texture.baseTexture.alphaMode>0,c=l.alpha,u=c<1&&h?premultiplyTint(l._tintRGB,c):l._tintRGB+(c*255<<24);s[o]=u,s[o+n]=u,s[o+n*2]=u,s[o+n*3]=u,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ParticleRenderer.extension={name:"particle",type:ExtensionType.RendererPlugin};extensions$1.add(ParticleRenderer);settings.UPLOADS_PER_FRAME=4;var TEXT_GRADIENT=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(TEXT_GRADIENT||{});const defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class TextStyle{constructor(e){this.styleID=0,this.reset(),deepCopyProperties(this,e,e)}clone(){const e={};return deepCopyProperties(e,this,defaultStyle),new TextStyle(e)}reset(){deepCopyProperties(this,defaultStyle,defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=getColor(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=getColor(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){areArraysEqual(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=getColor(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let r=t.length-1;r>=0;r--){let s=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!genericFontFamilies.includes(s)&&(s=`"${s}"`),t[r]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}}function getSingleColor(i){return typeof i=="number"?hex2string(i):(typeof i=="string"&&i.startsWith("0x")&&(i=i.replace("0x","#")),i)}function getColor(i){if(Array.isArray(i)){for(let e=0;e<i.length;++e)i[e]=getSingleColor(i[e]);return i}else return getSingleColor(i)}function areArraysEqual(i,e){if(!Array.isArray(i)||!Array.isArray(e)||i.length!==e.length)return!1;for(let t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function deepCopyProperties(i,e,t){for(const r in t)Array.isArray(e[r])?i[r]=e[r].slice():i[r]=e[r]}const contextSettings={willReadFrequently:!0};class TextMetrics{constructor(e,t,r,s,n,o,a,l,h){this.text=e,this.style=t,this.width=r,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h}static measureText(e,t,r,s=TextMetrics._canvas){r=r==null?t.wordWrap:r;const n=t.toFontString(),o=TextMetrics.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const a=s.getContext("2d",contextSettings);a.font=n;const h=(r?TextMetrics.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),c=new Array(h.length);let u=0;for(let m=0;m<h.length;m++){const g=a.measureText(h[m]).width+(h[m].length-1)*t.letterSpacing;c[m]=g,u=Math.max(u,g)}let d=u+t.strokeThickness;t.dropShadow&&(d+=t.dropShadowDistance);const f=t.lineHeight||o.fontSize+t.strokeThickness;let p=Math.max(f,o.fontSize+t.strokeThickness)+(h.length-1)*(f+t.leading);return t.dropShadow&&(p+=t.dropShadowDistance),new TextMetrics(e,t,d,p,h,c,f+t.leading,u,o)}static wordWrap(e,t,r=TextMetrics._canvas){const s=r.getContext("2d",contextSettings);let n=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:c}=t,u=TextMetrics.collapseSpaces(c),d=TextMetrics.collapseNewlines(c);let f=!u;const p=t.wordWrapWidth+h,m=TextMetrics.tokenize(e);for(let g=0;g<m.length;g++){let y=m[g];if(TextMetrics.isNewline(y)){if(!d){a+=TextMetrics.addLine(o),f=!u,o="",n=0;continue}y=" "}if(u){const _=TextMetrics.isBreakingSpace(y),x=TextMetrics.isBreakingSpace(o[o.length-1]);if(_&&x)continue}const v=TextMetrics.getFromCache(y,h,l,s);if(v>p)if(o!==""&&(a+=TextMetrics.addLine(o),o="",n=0),TextMetrics.canBreakWords(y,t.breakWords)){const _=TextMetrics.wordWrapSplit(y);for(let x=0;x<_.length;x++){let T=_[x],R=1;for(;_[x+R];){const S=_[x+R],M=T[T.length-1];if(TextMetrics.canBreakChars(M,S,y,x,t.breakWords))break}x+=T.length-1;const A=TextMetrics.getFromCache(T,h,l,s);A+n>p&&(a+=TextMetrics.addLine(o),f=!1,o="",n=0),o+=T,n+=A}}else{o.length>0&&(a+=TextMetrics.addLine(o),o="",n=0);const _=g===m.length-1;a+=TextMetrics.addLine(y,!_),f=!1,o="",n=0}else v+n>p&&(f=!1,a+=TextMetrics.addLine(o),o="",n=0),(o.length>0||!TextMetrics.isBreakingSpace(y)||f)&&(o+=y,n+=v)}return a+=TextMetrics.addLine(o,!1),a}static addLine(e,t=!0){return e=TextMetrics.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,r,s){let n=r[e];if(typeof n!="number"){const o=e.length*t;n=s.measureText(e).width+o,r[e]=n}return n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const r=e[t];if(!TextMetrics.isBreakingSpace(r))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:TextMetrics._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:TextMetrics._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let r="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){const n=e[s],o=e[s+1];if(TextMetrics.isBreakingSpace(n,o)||TextMetrics.isNewline(n)){r!==""&&(t.push(r),r=""),t.push(n);continue}r+=n}return r!==""&&t.push(r),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,r,s,n){return!0}static wordWrapSplit(e){return e.split("")}static measureFont(e){if(TextMetrics._fonts[e])return TextMetrics._fonts[e];const t={ascent:0,descent:0,fontSize:0},r=TextMetrics._canvas,s=TextMetrics._context;s.font=e;const n=TextMetrics.METRICS_STRING+TextMetrics.BASELINE_SYMBOL,o=Math.ceil(s.measureText(n).width);let a=Math.ceil(s.measureText(TextMetrics.BASELINE_SYMBOL).width);const l=Math.ceil(TextMetrics.HEIGHT_MULTIPLIER*a);a=a*TextMetrics.BASELINE_MULTIPLIER|0,r.width=o,r.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,a);const h=s.getImageData(0,0,o,l).data,c=h.length,u=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<u;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f+=u;else break}for(t.ascent=a-d,f=c-u,p=!1,d=l;d>a;--d){for(let m=0;m<u;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f-=u;else break}return t.descent=d-a,t.fontSize=t.ascent+t.descent,TextMetrics._fonts[e]=t,t}static clearMetrics(e=""){e?delete TextMetrics._fonts[e]:TextMetrics._fonts={}}static get _canvas(){if(!TextMetrics.__canvas){let e;try{const t=new OffscreenCanvas(0,0),r=t.getContext("2d",contextSettings);if(r!=null&&r.measureText)return TextMetrics.__canvas=t,t;e=settings.ADAPTER.createCanvas()}catch{e=settings.ADAPTER.createCanvas()}e.width=e.height=10,TextMetrics.__canvas=e}return TextMetrics.__canvas}static get _context(){return TextMetrics.__context||(TextMetrics.__context=TextMetrics._canvas.getContext("2d",contextSettings)),TextMetrics.__context}}TextMetrics._fonts={};TextMetrics.METRICS_STRING="|\xC9q\xC5";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_Text=class extends Sprite{constructor(i,e,t){let r=!1;t||(t=settings.ADAPTER.createCanvas(),r=!0),t.width=3,t.height=3;const s=Texture.from(t);s.orig=new Rectangle,s.trim=new Rectangle,super(s),this._ownCanvas=r,this.canvas=t,this.context=t.getContext("2d",{willReadFrequently:!0}),this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=e,this.localStyleID=-1}updateText(i){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const t=this.context,r=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=r.width,n=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,h=r.maxLineWidth,c=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),t.scale(this._resolution,this._resolution),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.font=this._font,t.lineWidth=e.strokeThickness,t.textBaseline=e.textBaseline,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit;let u,d;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const m=e.dropShadow&&p===0,g=m?Math.ceil(Math.max(1,n)+e.padding*2):0,y=g*this._resolution;if(m){t.fillStyle="black",t.strokeStyle="black";const _=e.dropShadowColor,x=hex2rgb(typeof _=="number"?_:string2hex(_)),T=e.dropShadowBlur*this._resolution,R=e.dropShadowDistance*this._resolution;t.shadowColor=`rgba(${x[0]*255},${x[1]*255},${x[2]*255},${e.dropShadowAlpha})`,t.shadowBlur=T,t.shadowOffsetX=Math.cos(e.dropShadowAngle)*R,t.shadowOffsetY=Math.sin(e.dropShadowAngle)*R+y}else t.fillStyle=this._generateFillStyle(e,o,r),t.strokeStyle=e.stroke,t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;let v=(a-c.fontSize)/2;a-c.fontSize<0&&(v=0);for(let _=0;_<o.length;_++)u=e.strokeThickness/2,d=e.strokeThickness/2+_*a+c.ascent+v,e.align==="right"?u+=h-l[_]:e.align==="center"&&(u+=(h-l[_])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[_],u+e.padding,d+e.padding-g,!0),e.fill&&this.drawLetterSpacing(o[_],u+e.padding,d+e.padding-g)}this.updateTexture()}drawLetterSpacing(i,e,t,r=!1){const n=this._style.letterSpacing,o=_Text.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(n===0||o){o&&(this.context.letterSpacing=n,this.context.textLetterSpacing=n),r?this.context.strokeText(i,e,t):this.context.fillText(i,e,t);return}let a=e;const l=Array.from?Array.from(i):i.split("");let h=this.context.measureText(i).width,c=0;for(let u=0;u<l.length;++u){const d=l[u];r?this.context.strokeText(d,a,t):this.context.fillText(d,a,t);let f="";for(let p=u+1;p<l.length;++p)f+=l[p];c=this.context.measureText(f).width,a+=h-c+n,h=c}}updateTexture(){const i=this.canvas;if(this._style.trim){const n=trimCanvas(i);n.data&&(i.width=n.width,i.height=n.height,this.context.putImageData(n.data,0,0))}const e=this._texture,t=this._style,r=t.trim?0:t.padding,s=e.baseTexture;e.trim.width=e._frame.width=i.width/this._resolution,e.trim.height=e._frame.height=i.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-r*2,e.orig.height=e._frame.height-r*2,this._onTextureUpdate(),s.setRealSize(i.width,i.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,e){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,e)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,e,t){const r=i.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let s;const n=i.dropShadow?i.dropShadowDistance:0,o=i.padding||0,a=this.canvas.width/this._resolution-n-o*2,l=this.canvas.height/this._resolution-n-o*2,h=r.slice(),c=i.fillGradientStops.slice();if(!c.length){const u=h.length+1;for(let d=1;d<u;++d)c.push(d/u)}if(h.unshift(r[0]),c.unshift(0),h.push(r[r.length-1]),c.push(1),i.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){s=this.context.createLinearGradient(a/2,o,a/2,l+o);const u=t.fontProperties.fontSize+i.strokeThickness;for(let d=0;d<e.length;d++){const f=t.lineHeight*(d-1)+u,p=t.lineHeight*d;let m=p;d>0&&f>p&&(m=(p+f)/2);const g=p+u,y=t.lineHeight*(d+1);let v=g;d+1<e.length&&y<g&&(v=(g+y)/2);const _=(v-m)/l;for(let x=0;x<h.length;x++){let T=0;typeof c[x]=="number"?T=c[x]:T=x/h.length;let R=Math.min(1,Math.max(0,m/l+T*_));R=Number(R.toFixed(5)),s.addColorStop(R,h[x])}}}else{s=this.context.createLinearGradient(o,l/2,a+o,l/2);const u=h.length+1;let d=1;for(let f=0;f<h.length;f++){let p;typeof c[f]=="number"?p=c[f]:p=d/u,s.addColorStop(p,h[f]),d++}}return s}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},defaultDestroyOptions,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const e=sign(this.scale.x)||1;this.scale.x=e*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const e=sign(this.scale.y)||1;this.scale.y=e*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof TextStyle?this._style=i:this._style=new TextStyle(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Text=_Text;Text.experimentalLetterSpacing=!1;class CountLimiter{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function findMultipleBaseTextures(i,e){var r;let t=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let s=0;s<i._textures.length;s++)if(i._textures[s]instanceof Texture){const n=i._textures[s].baseTexture;e.includes(n)||(e.push(n),t=!0)}}return t}function findBaseTexture(i,e){if(i.baseTexture instanceof BaseTexture){const t=i.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function findTexture(i,e){if(i._texture&&i._texture instanceof Texture){const t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function drawText(i,e){return e instanceof Text?(e.updateText(!0),!0):!1}function calculateTextStyle(i,e){if(e instanceof TextStyle){const t=e.toFontString();return TextMetrics.measureFont(t),!0}return!1}function findText(i,e){if(i instanceof Text){e.includes(i.style)||e.push(i.style),e.includes(i)||e.push(i);const t=i._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function findTextStyle(i,e){return i instanceof TextStyle?(e.includes(i)||e.push(i),!0):!1}class BasePrepare{constructor(e){this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let r=0,s=this.uploadHooks.length;r<s;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,r=e.length;t<r;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Container)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function uploadBaseTextures(i,e){return e instanceof BaseTexture?(e._glTextures[i.CONTEXT_UID]||i.texture.bind(e),!0):!1}function uploadGraphics(i,e){if(!(e instanceof Graphics))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:r}=t;for(let s=0;s<r.length;s++){const{texture:n}=r[s].style;n&&uploadBaseTextures(i,n.baseTexture)}return t.batchable||i.geometry.bind(t,e._resolveDirectShader(i)),!0}function findGraphics(i,e){return i instanceof Graphics?(e.push(i),!0):!1}class Prepare extends BasePrepare{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(findGraphics),this.registerUploadHook(uploadBaseTextures),this.registerUploadHook(uploadGraphics)}}Prepare.extension={name:"prepare",type:ExtensionType.RendererSystem};extensions$1.add(Prepare);const _Spritesheet=class{constructor(i,e,t=null){this.linkedSheets=[],this._texture=i instanceof Texture?i:null,this.baseTexture=i instanceof BaseTexture?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const r=this.baseTexture.resource;this.resolution=this._updateResolution(t||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:e}=this.data.meta;let t=getResolutionOfUrl(i,null);return t===null&&(t=parseFloat(e!=null?e:"1")),t!==1&&this.baseTexture.setResolution(t),t}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=_Spritesheet.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let e=i;const t=_Spritesheet.BATCH_SIZE;for(;e-i<t&&e<this._frameKeys.length;){const r=this._frameKeys[e],s=this._frames[r],n=s.frame;if(n){let o=null,a=null;const l=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,h=new Rectangle(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);s.rotated?o=new Rectangle(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.h)/this.resolution,Math.floor(n.w)/this.resolution):o=new Rectangle(Math.floor(n.x)/this.resolution,Math.floor(n.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(a=new Rectangle(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution)),this.textures[r]=new Texture(this.baseTexture,o,h,a,s.rotated?2:0,s.anchor),Texture.addToCache(this.textures[r],r)}e++}}_processAnimations(){const i=this.data.animations||{};for(const e in i){this.animations[e]=[];for(let t=0;t<i[e].length;t++){const r=i[e][t];this.animations[e].push(this.textures[r])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*_Spritesheet.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*_Spritesheet.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){var e;for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Spritesheet=_Spritesheet;Spritesheet.BATCH_SIZE=1e3;const validImages=["jpg","png","jpeg","avif","webp"];function getCacheableAssets(i,e,t){const r={};if(i.forEach(s=>{r[s]=e}),Object.keys(e.textures).forEach(s=>{r[s]=e.textures[s]}),!t){const s=path.dirname(i[0]);e.linkedSheets.forEach((n,o)=>{const a=getCacheableAssets([`${s}/${e.data.meta.related_multi_packs[o]}`],n,!0);Object.assign(r,a)})}return r}const spritesheetAsset={extension:ExtensionType.Asset,cache:{test:i=>i instanceof Spritesheet,getCacheableAssets:(i,e)=>getCacheableAssets(i,e,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),r=t.pop(),s=t.pop();return r==="json"&&validImages.includes(s)},parse:i=>{var t,r;const e=i.split(".");return{resolution:parseFloat((r=(t=settings.RETINA_PREFIX.exec(i))==null?void 0:t[1])!=null?r:"1"),format:e[e.length-2],src:i}}},loader:{extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},async testParse(i,e){return path.extname(e.src).includes(".json")&&!!i.frames},async parse(i,e,t){var h,c;let r=path.dirname(e.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");const s=r+i.meta.image,o=(await t.load([s]))[s],a=new Spritesheet(o.baseTexture,i,e.src);await a.parse();const l=(h=i==null?void 0:i.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(l)){const u=[];for(const f of l){if(typeof f!="string")continue;const p=r+f;(c=e.data)!=null&&c.ignoreMultiPack||u.push(t.load({src:p,data:{ignoreMultiPack:!0}}))}const d=await Promise.all(u);a.linkedSheets=d,d.forEach(f=>{f.linkedSheets=[a].concat(a.linkedSheets.filter(p=>p!==f))})}return a},unload(i){i.destroy(!0)}}};extensions$1.add(spritesheetAsset);new Point;var fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const tempMat=new Matrix;class TilingSpriteRenderer extends ObjectRenderer{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new QuadUv,this.state=State$1.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,t),this.shader=e.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,t):Shader.from(gl1VertexSrc,gl1FragmentSrc,t)}render(e){const t=this.renderer,r=this.quad;let s=r.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);const n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;s=r.uvs,s[0]=s[6]=-n,s[1]=s[3]=-o,s[2]=s[4]=1-n,s[5]=s[7]=1-o,r.invalidate();const a=e._texture,l=a.baseTexture,h=l.alphaMode>0,c=e.tileTransform.localTransform,u=e.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[t.CONTEXT_UID]?d=l.wrapMode!==WRAP_MODES.CLAMP:l.wrapMode===WRAP_MODES.CLAMP&&(l.wrapMode=WRAP_MODES.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=e._width,y=e._height;tempMat.set(c.a*p/g,c.b*p/y,c.c*m/g,c.d*m/y,c.tx/g,c.ty/y),tempMat.invert(),d?tempMat.prepend(u.mapCoord):(f.uniforms.uMapCoord=u.mapCoord.toArray(!0),f.uniforms.uClampFrame=u.uClampFrame,f.uniforms.uClampOffset=u.uClampOffset),f.uniforms.uTransform=tempMat.toArray(!0),f.uniforms.uColor=premultiplyTintToRgba(e.tint,e.worldAlpha,f.uniforms.uColor,h),f.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,t.shader.bind(f),t.geometry.bind(r),this.state.blendMode=correctBlendMode(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}TilingSpriteRenderer.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin};extensions$1.add(TilingSpriteRenderer);class BitmapFontData{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class TextFormat{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in t){const o=t[n].match(/^[a-z]+/gm)[0],a=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const c=a[h].split("="),u=c[0],d=c[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[u]=p}r[o].push(l)}const s=new BitmapFontData;return r.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),r.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),r.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),r.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),r.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),r.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class XMLFormat{static test(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new BitmapFontData,r=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let h=0;h<r.length;h++)t.info.push({face:r[h].getAttribute("face"),size:parseInt(r[h].getAttribute("size"),10)});for(let h=0;h<s.length;h++)t.common.push({lineHeight:parseInt(s[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)t.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<o.length;h++){const c=o[h];t.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)t.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)t.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return t}}class XMLStringFormat{static test(e){if(typeof e=="string"&&e.includes("<font>")){const t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.test(t)}return!1}static parse(e){const t=new globalThis.DOMParser().parseFromString(e,"text/xml");return XMLFormat.parse(t)}}const formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(i){for(let e=0;e<formats.length;e++)if(formats[e].test(i))return formats[e];return null}function generateFillStyle(i,e,t,r,s,n){const o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const l=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,c=i.width/r-l-h*2,u=i.height/r-l-h*2,d=o.slice(),f=t.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),t.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){a=e.createLinearGradient(c/2,h,c/2,u+h);let p=0;const g=(n.fontProperties.fontSize+t.strokeThickness)/u;for(let y=0;y<s.length;y++){const v=n.lineHeight*y;for(let _=0;_<d.length;_++){let x=0;typeof f[_]=="number"?x=f[_]:x=_/d.length;const T=v/u+x*g;let R=Math.max(p,T);R=Math.min(R,1),a.addColorStop(R,d[_]),p=R}}}else{a=e.createLinearGradient(h,u/2,c+h,u/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let y;typeof f[g]=="number"?y=f[g]:y=m/p,a.addColorStop(y,d[g]),m++}}return a}function drawGlyph(i,e,t,r,s,n,o){const a=t.text,l=t.fontProperties;e.translate(r,s),e.scale(n,n);const h=o.strokeThickness/2,c=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=generateFillStyle(i,e,o,n,[a],t),e.strokeStyle=o.stroke,o.dropShadow){const u=o.dropShadowColor,d=hex2rgb(typeof u=="number"?u:string2hex(u)),f=o.dropShadowBlur*n,p=o.dropShadowDistance*n;e.shadowColor=`rgba(${d[0]*255},${d[1]*255},${d[2]*255},${o.dropShadowAlpha})`,e.shadowBlur=f,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,h,c+t.lineHeight-l.descent),o.fill&&e.fillText(a,h,c+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function splitTextToCharacters(i){return Array.from?Array.from(i):i.split("")}function resolveCharacters(i){typeof i=="string"&&(i=[i]);const e=[];for(let t=0,r=i.length;t<r;t++){const s=i[t];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...splitTextToCharacters(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}function extractCharCode(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}const _BitmapFont=class{constructor(i,e,t){var h,c;const[r]=i.info,[s]=i.common,[n]=i.page,[o]=i.distanceField,a=getResolutionOfUrl(n.file),l={};this._ownsTextures=t,this.font=r.face,this.size=r.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(let u=0;u<i.page.length;u++){const{id:d,file:f}=i.page[u];l[d]=e instanceof Array?e[u]:e[f],(o==null?void 0:o.fieldType)&&o.fieldType!=="none"&&(l[d].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,l[d].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(let u=0;u<i.char.length;u++){const{id:d,page:f}=i.char[u];let{x:p,y:m,width:g,height:y,xoffset:v,yoffset:_,xadvance:x}=i.char[u];p/=a,m/=a,g/=a,y/=a,v/=a,_/=a,x/=a;const T=new Rectangle(p+l[f].frame.x/a,m+l[f].frame.y/a,g,y);this.chars[d]={xOffset:v,yOffset:_,xAdvance:x,kerning:{},texture:new Texture(l[f].baseTexture,T),page:f}}for(let u=0;u<i.kerning.length;u++){let{first:d,second:f,amount:p}=i.kerning[u];d/=a,f/=a,p/=a,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=o==null?void 0:o.distanceRange,this.distanceFieldType=(c=(h=o==null?void 0:o.fieldType)==null?void 0:h.toLowerCase())!=null?c:"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,e,t){let r;if(i instanceof BitmapFontData)r=i;else{const n=autoDetectFormat(i);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(i)}e instanceof Texture&&(e=[e]);const s=new _BitmapFont(r,e,t);return _BitmapFont.available[s.font]=s,s}static uninstall(i){const e=_BitmapFont.available[i];if(!e)throw new Error(`No font found named '${i}'`);e.destroy(),delete _BitmapFont.available[i]}static from(i,e,t){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:s,resolution:n,textureWidth:o,textureHeight:a,...l}=Object.assign({},_BitmapFont.defaultOptions,t),h=resolveCharacters(r),c=e instanceof TextStyle?e:new TextStyle(e),u=o,d=new BitmapFontData;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let f=0,p=0,m,g,y,v=0;const _=[];for(let T=0;T<h.length;T++){m||(m=settings.ADAPTER.createCanvas(),m.width=o,m.height=a,g=m.getContext("2d"),y=new BaseTexture(m,{resolution:n,...l}),_.push(new Texture(y)),d.page.push({id:_.length-1,file:""}));const R=h[T],A=TextMetrics.measureText(R,c,!1,m),S=A.width,M=Math.ceil(A.height),D=Math.ceil((c.fontStyle==="italic"?2:1)*S);if(p>=a-M*n){if(p===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--T,m=null,g=null,y=null,p=0,f=0,v=0;continue}if(v=Math.max(M+A.fontProperties.descent,v),D*n+f>=u){if(f===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${R}')`);--T,p+=v*n,p=Math.ceil(p),f=0,v=0;continue}drawGlyph(m,g,A,f,p,n,c);const I=extractCharCode(A.text);d.char.push({id:I,page:_.length-1,x:f/n,y:p/n,width:D,height:M,xoffset:0,yoffset:0,xadvance:Math.ceil(S-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),f+=(D+2*s)*n,f=Math.ceil(f)}for(let T=0,R=h.length;T<R;T++){const A=h[T];for(let S=0;S<R;S++){const M=h[S],D=g.measureText(A).width,I=g.measureText(M).width,w=g.measureText(A+M).width-(D+I);w&&d.kerning.push({first:extractCharCode(A),second:extractCharCode(M),amount:w})}}const x=new _BitmapFont(d,_,!0);return _BitmapFont.available[i]!==void 0&&_BitmapFont.uninstall(i),_BitmapFont.available[i]=x,x}};let BitmapFont=_BitmapFont;BitmapFont.ALPHA=[["a","z"],["A","Z"]," "];BitmapFont.NUMERIC=[["0","9"]];BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];BitmapFont.ASCII=[[" ","~"]];BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_BitmapFont.ALPHANUMERIC};BitmapFont.available={};var msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[],_BitmapText=class extends Container{constructor(i,e={}){super(),this._tint=16777215;const{align:t,tint:r,maxWidth:s,letterSpacing:n,fontName:o,fontSize:a}=Object.assign({},_BitmapText.styleDefaults,e);if(!BitmapFont.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=t,this._tint=r,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=i,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new ObservablePoint(()=>{this.dirty=!0},this,0,0),this._roundPixels=settings.ROUND_PIXELS,this.dirty=!0,this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var D;const i=BitmapFont.available[this._fontName],e=this.fontSize,t=e/i.size,r=new Point,s=[],n=[],o=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=splitTextToCharacters(a),h=this._maxWidth*i.size/e,c=i.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;let u=null,d=0,f=0,p=0,m=-1,g=0,y=0,v=0,_=0;for(let I=0;I<l.length;I++){const P=l[I],w=extractCharCode(P);if(/(?:\s)/.test(P)&&(m=I,g=d,_++),P==="\r"||P===`
`){n.push(d),o.push(-1),f=Math.max(f,d),++p,++y,r.x=0,r.y+=i.lineHeight,u=null,_=0;continue}const E=i.chars[w];if(!E)continue;u&&E.kerning[u]&&(r.x+=E.kerning[u]);const O=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};O.texture=E.texture,O.line=p,O.charCode=w,O.position.x=r.x+E.xOffset+this._letterSpacing/2,O.position.y=r.y+E.yOffset,O.prevSpaces=_,s.push(O),d=O.position.x+Math.max(E.xAdvance-E.xOffset,E.texture.orig.width),r.x+=E.xAdvance+this._letterSpacing,v=Math.max(v,E.yOffset+E.texture.height),u=w,m!==-1&&h>0&&r.x>h&&(++y,removeItems(s,1+m-y,1+I-m),I=m,m=-1,n.push(g),o.push(s.length>0?s[s.length-1].prevSpaces:0),f=Math.max(f,g),p++,r.x=0,r.y+=i.lineHeight,u=null,_=0)}const x=l[l.length-1];x!=="\r"&&x!==`
`&&(/(?:\s)/.test(x)&&(d=g),n.push(d),f=Math.max(f,d),o.push(-1));const T=[];for(let I=0;I<=p;I++){let P=0;this._align==="right"?P=f-n[I]:this._align==="center"?P=(f-n[I])/2:this._align==="justify"&&(P=o[I]<0?0:(f-n[I])/o[I]),T.push(P)}const R=s.length,A={},S=[],M=this._activePagesMeshData;c.push(...M);for(let I=0;I<R;I++){const P=s[I].texture,w=P.baseTexture.uid;if(!A[w]){let E=c.pop();if(!E){const L=new MeshGeometry;let C,k;i.distanceFieldType==="none"?(C=new MeshMaterial(Texture.EMPTY),k=BLEND_MODES.NORMAL):(C=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),k=BLEND_MODES.NORMAL_NPM);const X=new Mesh(L,C);X.blendMode=k,E={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:X,vertices:null,uvs:null,indices:null}}E.index=0,E.indexCount=0,E.vertexCount=0,E.uvsCount=0,E.total=0;const{_textureCache:O}=this;O[w]=O[w]||new Texture(P.baseTexture),E.mesh.texture=O[w],E.mesh.tint=this._tint,S.push(E),A[w]=E}A[w].total++}for(let I=0;I<M.length;I++)S.includes(M[I])||this.removeChild(M[I].mesh);for(let I=0;I<S.length;I++)S[I].mesh.parent!==this&&this.addChild(S[I].mesh);this._activePagesMeshData=S;for(const I in A){const P=A[I],w=P.total;if(!(((D=P.indices)==null?void 0:D.length)>6*w)||P.vertices.length<Mesh.BATCHABLE_SIZE*2)P.vertices=new Float32Array(4*2*w),P.uvs=new Float32Array(4*2*w),P.indices=new Uint16Array(6*w);else{const E=P.total,O=P.vertices;for(let L=E*4*2;L<O.length;L++)O[L]=0}P.mesh.size=6*w}for(let I=0;I<R;I++){const P=s[I];let w=P.position.x+T[P.line]*(this._align==="justify"?P.prevSpaces:1);this._roundPixels&&(w=Math.round(w));const E=w*t,O=P.position.y*t,L=P.texture,C=A[L.baseTexture.uid],k=L.frame,X=L._uvs,b=C.index++;C.indices[b*6+0]=0+b*4,C.indices[b*6+1]=1+b*4,C.indices[b*6+2]=2+b*4,C.indices[b*6+3]=0+b*4,C.indices[b*6+4]=2+b*4,C.indices[b*6+5]=3+b*4,C.vertices[b*8+0]=E,C.vertices[b*8+1]=O,C.vertices[b*8+2]=E+k.width*t,C.vertices[b*8+3]=O,C.vertices[b*8+4]=E+k.width*t,C.vertices[b*8+5]=O+k.height*t,C.vertices[b*8+6]=E,C.vertices[b*8+7]=O+k.height*t,C.uvs[b*8+0]=X.x0,C.uvs[b*8+1]=X.y0,C.uvs[b*8+2]=X.x1,C.uvs[b*8+3]=X.y1,C.uvs[b*8+4]=X.x2,C.uvs[b*8+5]=X.y2,C.uvs[b*8+6]=X.x3,C.uvs[b*8+7]=X.y3}this._textWidth=f*t,this._textHeight=(r.y+i.lineHeight)*t;for(const I in A){const P=A[I];if(this.anchor.x!==0||this.anchor.y!==0){let L=0;const C=this._textWidth*this.anchor.x,k=this._textHeight*this.anchor.y;for(let X=0;X<P.total;X++)P.vertices[L++]-=C,P.vertices[L++]-=k,P.vertices[L++]-=C,P.vertices[L++]-=k,P.vertices[L++]-=C,P.vertices[L++]-=k,P.vertices[L++]-=C,P.vertices[L++]-=k}this._maxLineHeight=v*t;const w=P.mesh.geometry.getBuffer("aVertexPosition"),E=P.mesh.geometry.getBuffer("aTextureCoord"),O=P.mesh.geometry.getIndex();w.data=P.vertices,E.data=P.uvs,O.data=P.indices,w.update(),E.update(),O.update()}for(let I=0;I<s.length;I++)charRenderDataPool.push(s[I]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:t,size:r}=BitmapFont.available[this._fontName];if(t!=="none"){const{a:s,b:n,c:o,d:a}=this.worldTransform,l=Math.sqrt(s*s+n*n),h=Math.sqrt(o*o+a*a),c=(Math.abs(l)+Math.abs(h))/2,u=this.fontSize/r,d=i._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=c*e*u*d}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=BitmapFont.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(i){if(this._tint!==i){this._tint=i;for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!BitmapFont.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){var i;return(i=this._fontSize)!=null?i:BitmapFont.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i==null?"":i),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:e}=this,r=BitmapFont.available[this._fontName].distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;r.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],r.filter(s=>e[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=Texture.EMPTY});for(const s in e)e[s].destroy(),delete e[s];this._font=null,this._textureCache=null,super.destroy(i)}};let BitmapText=_BitmapText;BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const validExtensions=[".xml",".fnt"],loadBitmapFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},test(i){return validExtensions.includes(path.extname(i))},async testParse(i){return TextFormat.test(i)||XMLStringFormat.test(i)},async parse(i,e,t){const r=TextFormat.test(i)?TextFormat.parse(i):XMLStringFormat.parse(i),{src:s}=e,{page:n}=r,o=[];for(let h=0;h<n.length;++h){const c=n[h].file,u=path.join(path.dirname(s),c);o.push(u)}const a=await t.load(o),l=o.map(h=>a[h]);return BitmapFont.install(r,l,!0)},async load(i,e){return(await settings.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};extensions$1.add(loadBitmapFont);var minimal$1={exports:{}},indexMinimal={},minimal={},aspromise=asPromise;function asPromise(i,e){for(var t=new Array(arguments.length-1),r=0,s=2,n=!0;s<arguments.length;)t[r++]=arguments[s++];return new Promise(function(a,l){t[r]=function(c){if(n)if(n=!1,c)l(c);else{for(var u=new Array(arguments.length-1),d=0;d<u.length;)u[d++]=arguments[d];a.apply(null,u)}};try{i.apply(e||null,t)}catch(h){n&&(n=!1,l(h))}})}var base64$1={};(function(i){var e=i;e.length=function(a){var l=a.length;if(!l)return 0;for(var h=0;--l%4>1&&a.charAt(l)==="=";)++h;return Math.ceil(a.length*3)/4-h};for(var t=new Array(64),r=new Array(123),s=0;s<64;)r[t[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;e.encode=function(a,l,h){for(var c=null,u=[],d=0,f=0,p;l<h;){var m=a[l++];switch(f){case 0:u[d++]=t[m>>2],p=(m&3)<<4,f=1;break;case 1:u[d++]=t[p|m>>4],p=(m&15)<<2,f=2;break;case 2:u[d++]=t[p|m>>6],u[d++]=t[m&63],f=0;break}d>8191&&((c||(c=[])).push(String.fromCharCode.apply(String,u)),d=0)}return f&&(u[d++]=t[p],u[d++]=61,f===1&&(u[d++]=61)),c?(d&&c.push(String.fromCharCode.apply(String,u.slice(0,d))),c.join("")):String.fromCharCode.apply(String,u.slice(0,d))};var n="invalid encoding";e.decode=function(a,l,h){for(var c=h,u=0,d,f=0;f<a.length;){var p=a.charCodeAt(f++);if(p===61&&u>1)break;if((p=r[p])===void 0)throw Error(n);switch(u){case 0:d=p,u=1;break;case 1:l[h++]=d<<2|(p&48)>>4,d=p,u=2;break;case 2:l[h++]=(d&15)<<4|(p&60)>>2,d=p,u=3;break;case 3:l[h++]=(d&3)<<6|p,u=0;break}}if(u===1)throw Error(n);return h-c},e.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};EventEmitter.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],s=0;s<r.length;)r[s].fn===t?r.splice(s,1):++s;return this};EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],s=1;s<arguments.length;)r.push(arguments[s++]);for(s=0;s<t.length;)t[s].fn.apply(t[s++].ctx,r)}return this};var float=factory(factory);function factory(i){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function s(l,h,c){e[0]=l,h[c]=t[0],h[c+1]=t[1],h[c+2]=t[2],h[c+3]=t[3]}function n(l,h,c){e[0]=l,h[c]=t[3],h[c+1]=t[2],h[c+2]=t[1],h[c+3]=t[0]}i.writeFloatLE=r?s:n,i.writeFloatBE=r?n:s;function o(l,h){return t[0]=l[h],t[1]=l[h+1],t[2]=l[h+2],t[3]=l[h+3],e[0]}function a(l,h){return t[3]=l[h],t[2]=l[h+1],t[1]=l[h+2],t[0]=l[h+3],e[0]}i.readFloatLE=r?o:a,i.readFloatBE=r?a:o}():function(){function e(r,s,n,o){var a=s<0?1:0;if(a&&(s=-s),s===0)r(1/s>0?0:2147483648,n,o);else if(isNaN(s))r(2143289344,n,o);else if(s>34028234663852886e22)r((a<<31|2139095040)>>>0,n,o);else if(s<11754943508222875e-54)r((a<<31|Math.round(s/1401298464324817e-60))>>>0,n,o);else{var l=Math.floor(Math.log(s)/Math.LN2),h=Math.round(s*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|h)>>>0,n,o)}}i.writeFloatLE=e.bind(null,writeUintLE),i.writeFloatBE=e.bind(null,writeUintBE);function t(r,s,n){var o=r(s,n),a=(o>>31)*2+1,l=o>>>23&255,h=o&8388607;return l===255?h?NaN:a*(1/0):l===0?a*1401298464324817e-60*h:a*Math.pow(2,l-150)*(h+8388608)}i.readFloatLE=t.bind(null,readUintLE),i.readFloatBE=t.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function s(l,h,c){e[0]=l,h[c]=t[0],h[c+1]=t[1],h[c+2]=t[2],h[c+3]=t[3],h[c+4]=t[4],h[c+5]=t[5],h[c+6]=t[6],h[c+7]=t[7]}function n(l,h,c){e[0]=l,h[c]=t[7],h[c+1]=t[6],h[c+2]=t[5],h[c+3]=t[4],h[c+4]=t[3],h[c+5]=t[2],h[c+6]=t[1],h[c+7]=t[0]}i.writeDoubleLE=r?s:n,i.writeDoubleBE=r?n:s;function o(l,h){return t[0]=l[h],t[1]=l[h+1],t[2]=l[h+2],t[3]=l[h+3],t[4]=l[h+4],t[5]=l[h+5],t[6]=l[h+6],t[7]=l[h+7],e[0]}function a(l,h){return t[7]=l[h],t[6]=l[h+1],t[5]=l[h+2],t[4]=l[h+3],t[3]=l[h+4],t[2]=l[h+5],t[1]=l[h+6],t[0]=l[h+7],e[0]}i.readDoubleLE=r?o:a,i.readDoubleBE=r?a:o}():function(){function e(r,s,n,o,a,l){var h=o<0?1:0;if(h&&(o=-o),o===0)r(0,a,l+s),r(1/o>0?0:2147483648,a,l+n);else if(isNaN(o))r(0,a,l+s),r(2146959360,a,l+n);else if(o>17976931348623157e292)r(0,a,l+s),r((h<<31|2146435072)>>>0,a,l+n);else{var c;if(o<22250738585072014e-324)c=o/5e-324,r(c>>>0,a,l+s),r((h<<31|c/4294967296)>>>0,a,l+n);else{var u=Math.floor(Math.log(o)/Math.LN2);u===1024&&(u=1023),c=o*Math.pow(2,-u),r(c*4503599627370496>>>0,a,l+s),r((h<<31|u+1023<<20|c*1048576&1048575)>>>0,a,l+n)}}}i.writeDoubleLE=e.bind(null,writeUintLE,0,4),i.writeDoubleBE=e.bind(null,writeUintBE,4,0);function t(r,s,n,o,a){var l=r(o,a+s),h=r(o,a+n),c=(h>>31)*2+1,u=h>>>20&2047,d=4294967296*(h&1048575)+l;return u===2047?d?NaN:c*(1/0):u===0?c*5e-324*d:c*Math.pow(2,u-1075)*(d+4503599627370496)}i.readDoubleLE=t.bind(null,readUintLE,0,4),i.readDoubleBE=t.bind(null,readUintBE,4,0)}(),i}function writeUintLE(i,e,t){e[t]=i&255,e[t+1]=i>>>8&255,e[t+2]=i>>>16&255,e[t+3]=i>>>24}function writeUintBE(i,e,t){e[t]=i>>>24,e[t+1]=i>>>16&255,e[t+2]=i>>>8&255,e[t+3]=i&255}function readUintLE(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24)>>>0}function readUintBE(i,e){return(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(i){}return null}var utf8$2={};(function(i){var e=i;e.length=function(r){for(var s=0,n=0,o=0;o<r.length;++o)n=r.charCodeAt(o),n<128?s+=1:n<2048?s+=2:(n&64512)===55296&&(r.charCodeAt(o+1)&64512)===56320?(++o,s+=4):s+=3;return s},e.read=function(r,s,n){var o=n-s;if(o<1)return"";for(var a=null,l=[],h=0,c;s<n;)c=r[s++],c<128?l[h++]=c:c>191&&c<224?l[h++]=(c&31)<<6|r[s++]&63:c>239&&c<365?(c=((c&7)<<18|(r[s++]&63)<<12|(r[s++]&63)<<6|r[s++]&63)-65536,l[h++]=55296+(c>>10),l[h++]=56320+(c&1023)):l[h++]=(c&15)<<12|(r[s++]&63)<<6|r[s++]&63,h>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,l)),h=0);return a?(h&&a.push(String.fromCharCode.apply(String,l.slice(0,h))),a.join("")):String.fromCharCode.apply(String,l.slice(0,h))},e.write=function(r,s,n){for(var o=n,a,l,h=0;h<r.length;++h)a=r.charCodeAt(h),a<128?s[n++]=a:a<2048?(s[n++]=a>>6|192,s[n++]=a&63|128):(a&64512)===55296&&((l=r.charCodeAt(h+1))&64512)===56320?(a=65536+((a&1023)<<10)+(l&1023),++h,s[n++]=a>>18|240,s[n++]=a>>12&63|128,s[n++]=a>>6&63|128,s[n++]=a&63|128):(s[n++]=a>>12|224,s[n++]=a>>6&63|128,s[n++]=a&63|128);return n-o}})(utf8$2);var pool_1=pool;function pool(i,e,t){var r=t||8192,s=r>>>1,n=null,o=r;return function(l){if(l<1||l>s)return i(l);o+l>r&&(n=i(r),o=0);var h=e.call(n,o,o+=l);return o&7&&(o=(o|7)+1),h}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var i=requireMinimal();function e(n,o){this.lo=n>>>0,this.hi=o>>>0}var t=e.zero=new e(0,0);t.toNumber=function(){return 0},t.zzEncode=t.zzDecode=function(){return this},t.length=function(){return 1};var r=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(o){if(o===0)return t;var a=o<0;a&&(o=-o);var l=o>>>0,h=(o-l)/4294967296>>>0;return a&&(h=~h>>>0,l=~l>>>0,++l>4294967295&&(l=0,++h>4294967295&&(h=0))),new e(l,h)},e.from=function(o){if(typeof o=="number")return e.fromNumber(o);if(i.isString(o))if(i.Long)o=i.Long.fromString(o);else return e.fromNumber(parseInt(o,10));return o.low||o.high?new e(o.low>>>0,o.high>>>0):t},e.prototype.toNumber=function(o){if(!o&&this.hi>>>31){var a=~this.lo+1>>>0,l=~this.hi>>>0;return a||(l=l+1>>>0),-(a+l*4294967296)}return this.lo+this.hi*4294967296},e.prototype.toLong=function(o){return i.Long?new i.Long(this.lo|0,this.hi|0,Boolean(o)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(o)}};var s=String.prototype.charCodeAt;return e.fromHash=function(o){return o===r?t:new e((s.call(o,0)|s.call(o,1)<<8|s.call(o,2)<<16|s.call(o,3)<<24)>>>0,(s.call(o,4)|s.call(o,5)<<8|s.call(o,6)<<16|s.call(o,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var o=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^o)>>>0,this.lo=(this.lo<<1^o)>>>0,this},e.prototype.zzDecode=function(){var o=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^o)>>>0,this.hi=(this.hi>>>1^o)>>>0,this},e.prototype.length=function(){var o=this.lo,a=(this.lo>>>28|this.hi<<4)>>>0,l=this.hi>>>24;return l===0?a===0?o<16384?o<128?1:2:o<2097152?3:4:a<16384?a<128?5:6:a<2097152?7:8:l<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(i){var e=i;e.asPromise=aspromise,e.base64=base64$1,e.EventEmitter=eventemitter,e.float=float,e.inquire=inquire_1,e.utf8=utf8$2,e.pool=pool_1,e.LongBits=requireLongbits(),e.isNode=Boolean(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n},e.isString=function(n){return typeof n=="string"||n instanceof String},e.isObject=function(n){return n&&typeof n=="object"},e.isset=e.isSet=function(n,o){var a=n[o];return a!=null&&n.hasOwnProperty(o)?typeof a!="object"||(Array.isArray(a)?a.length:Object.keys(a).length)>0:!1},e.Buffer=function(){try{var s=e.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(n){return typeof n=="number"?e.Buffer?e._Buffer_allocUnsafe(n):new e.Array(n):e.Buffer?e._Buffer_from(n):typeof Uint8Array>"u"?n:new Uint8Array(n)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(n){return n?e.LongBits.from(n).toHash():e.LongBits.zeroHash},e.longFromHash=function(n,o){var a=e.LongBits.fromHash(n);return e.Long?e.Long.fromBits(a.lo,a.hi,o):a.toNumber(Boolean(o))};function t(s,n,o){for(var a=Object.keys(n),l=0;l<a.length;++l)(s[a[l]]===void 0||!o)&&(s[a[l]]=n[a[l]]);return s}e.merge=t,e.lcFirst=function(n){return n.charAt(0).toLowerCase()+n.substring(1)};function r(s){function n(o,a){if(!(this instanceof n))return new n(o,a);Object.defineProperty(this,"message",{get:function(){return o}}),Error.captureStackTrace?Error.captureStackTrace(this,n):Object.defineProperty(this,"stack",{value:new Error().stack||""}),a&&t(this,a)}return n.prototype=Object.create(Error.prototype,{constructor:{value:n,writable:!0,enumerable:!1,configurable:!0},name:{get(){return s},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),n}e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(n){for(var o={},a=0;a<n.length;++a)o[n[a]]=1;return function(){for(var l=Object.keys(this),h=l.length-1;h>-1;--h)if(o[l[h]]===1&&this[l[h]]!==void 0&&this[l[h]]!==null)return l[h]}},e.oneOfSetter=function(n){return function(o){for(var a=0;a<n.length;++a)n[a]!==o&&delete this[n[a]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var s=e.Buffer;if(!s){e._Buffer_from=e._Buffer_allocUnsafe=null;return}e._Buffer_from=s.from!==Uint8Array.from&&s.from||function(o,a){return new s(o,a)},e._Buffer_allocUnsafe=s.allocUnsafe||function(o){return new s(o)}}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(i,e,t){this.fn=i,this.len=e,this.next=void 0,this.val=t}function noop(){}function State(i){this.head=i.head,this.tail=i.tail,this.len=i.len,this.next=i.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function i(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function i(e){return new util$4.Array(e)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function i(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this};function writeByte(i,e,t){e[t]=i&255}function writeVarint32(i,e,t){for(;i>127;)e[t++]=i&127|128,i>>>=7;e[t]=i}function VarintOp(i,e){this.len=i,this.next=void 0,this.val=e}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function i(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Writer$1.prototype.int32=function i(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)};Writer$1.prototype.sint32=function i(e){return this.uint32((e<<1^e>>31)>>>0)};function writeVarint64(i,e,t){for(;i.hi;)e[t++]=i.lo&127|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)e[t++]=i.lo&127|128,i.lo=i.lo>>>7;e[t++]=i.lo}Writer$1.prototype.uint64=function i(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function i(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)};Writer$1.prototype.bool=function i(e){return this._push(writeByte,1,e?1:0)};function writeFixed32(i,e,t){e[t]=i&255,e[t+1]=i>>>8&255,e[t+2]=i>>>16&255,e[t+3]=i>>>24}Writer$1.prototype.fixed32=function i(e){return this._push(writeFixed32,4,e>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function i(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function i(e){return this._push(util$4.float.writeFloatLE,4,e)};Writer$1.prototype.double=function i(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function i(e,t,r){t.set(e,r)}:function i(e,t,r){for(var s=0;s<e.length;++s)t[r+s]=e[s]};Writer$1.prototype.bytes=function i(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)};Writer$1.prototype.string=function i(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)};Writer$1.prototype.fork=function i(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function i(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function i(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};Writer$1.prototype.finish=function i(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};Writer$1._configure=function(i){BufferWriter$1=i,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var s=0;s<e.length;)t[r++]=e[s++]}};BufferWriter.prototype.bytes=function i(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this};function writeStringBuffer(i,e,t){i.length<40?util$3.utf8.write(i,e,t):e.utf8Write?e.utf8Write(i,t):e.write(i,t)}BufferWriter.prototype.string=function i(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(i,e){return RangeError("index out of range: "+i.pos+" + "+(e||1)+" > "+i.len)}function Reader$1(i){this.buf=i,this.pos=0,this.len=i.length}var create_array=typeof Uint8Array<"u"?function i(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function i(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function i(){return util$2.Buffer?function(t){return(Reader$1.create=function(s){return util$2.Buffer.isBuffer(s)?new BufferReader$1(s):create_array(s)})(t)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function i(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}}();Reader$1.prototype.int32=function i(){return this.uint32()|0};Reader$1.prototype.sint32=function i(){var e=this.uint32();return e>>>1^-(e&1)|0};function readLongVarint(){var i=new LongBits(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(i.lo=(i.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(this.buf[this.pos]&127)<<28)>>>0,i.hi=(i.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return i;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(i.lo=(i.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,i}if(this.len-this.pos>4){for(;e<5;++e)if(i.hi=(i.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return i}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(i.hi=(i.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function i(){return this.uint32()!==0};function readFixed32_end(i,e){return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0}Reader$1.prototype.fixed32=function i(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function i(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function i(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Reader$1.prototype.double=function i(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Reader$1.prototype.bytes=function i(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)};Reader$1.prototype.string=function i(){var e=this.bytes();return utf8.read(e,0,e.length)};Reader$1.prototype.skip=function i(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(i){switch(i){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(i=this.uint32()&7)!==4;)this.skipType(i);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+i+" at offset "+this.pos)}return this};Reader$1._configure=function(i){BufferReader$1=i,Reader$1.create=create(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(i){Reader.call(this,i)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function i(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(i,e,t){if(typeof i!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=i,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}Service.prototype.rpcCall=function i(e,t,r,s,n){if(!s)throw TypeError("request must be specified");var o=this;if(!n)return util.asPromise(i,o,e,t,r,s);if(!o.rpcImpl){setTimeout(function(){n(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(l,h){if(l)return o.emit("error",l,e),n(l);if(h===null){o.end(!0);return}if(!(h instanceof r))try{h=r[o.responseDelimited?"decodeDelimited":"decode"](h)}catch(c){return o.emit("error",c,e),n(c)}return o.emit("data",h,e),n(null,h)})}catch(a){o.emit("error",a,e),setTimeout(function(){n(a)},0);return}};Service.prototype.end=function i(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(i){var e=i;e.Service=service})(rpc);var roots={};(function(i){var e=i;e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=t;function t(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}t()})(indexMinimal);(function(i){i.exports=indexMinimal})(minimal$1);var ClientMsgType;(function(i){i[i.join_lobby=0]="join_lobby",i[i.lobby_msg=1]="lobby_msg",i[i.create_lobby_game=2]="create_lobby_game",i[i.join_lobby_game=3]="join_lobby_game",i[i.leave_lobby_game=4]="leave_lobby_game",i[i.player_move=5]="player_move",i[i.leave_game=6]="leave_game",i[i.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientMsgType||(ClientMsgType={}));var ServerMsgType;(function(i){i[i.lobby_state=0]="lobby_state",i[i.player_msg=1]="player_msg",i[i.player_join_lobby=2]="player_join_lobby",i[i.player_leave_lobby=3]="player_leave_lobby",i[i.lobby_game_updated=4]="lobby_game_updated",i[i.player_join=5]="player_join",i[i.game_start=6]="game_start",i[i.game_end=7]="game_end",i[i.tick=8]="tick",i[i.player_left=9]="player_left",i[i.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ServerMsgType||(ServerMsgType={}));var GameStatus;(function(i){i[i.WAITING=0]="WAITING",i[i.RUNNING=1]="RUNNING",i[i.PLAYER_WON=2]="PLAYER_WON",i[i.AI_WON=3]="AI_WON",i[i.TIE=4]="TIE",i[i.UNRECOGNIZED=-1]="UNRECOGNIZED"})(GameStatus||(GameStatus={}));function gameStatusFromJSON(i){switch(i){case 0:case"WAITING":return GameStatus.WAITING;case 1:case"RUNNING":return GameStatus.RUNNING;case 2:case"PLAYER_WON":return GameStatus.PLAYER_WON;case 3:case"AI_WON":return GameStatus.AI_WON;case 4:case"TIE":return GameStatus.TIE;case-1:case"UNRECOGNIZED":default:return GameStatus.UNRECOGNIZED}}function gameStatusToJSON(i){switch(i){case GameStatus.WAITING:return"WAITING";case GameStatus.RUNNING:return"RUNNING";case GameStatus.PLAYER_WON:return"PLAYER_WON";case GameStatus.AI_WON:return"AI_WON";case GameStatus.TIE:return"TIE";case GameStatus.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function createBasePlayer(){return{id:0,clientId:0,playerNumber:0,name:"",color:0,cursor:void 0,dead:!1}}const Player={encode(i,e=minimal$1.exports.Writer.create()){return i.id!==0&&e.uint32(8).uint32(i.id),i.clientId!==0&&e.uint32(16).uint32(i.clientId),i.playerNumber!==0&&e.uint32(24).uint32(i.playerNumber),i.name!==""&&e.uint32(34).string(i.name),i.color!==0&&e.uint32(40).uint32(i.color),i.cursor!==void 0&&Cursor.encode(i.cursor,e.uint32(50).fork()).ldelim(),i.dead===!0&&e.uint32(56).bool(i.dead),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBasePlayer();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.id=t.uint32();break;case 2:s.clientId=t.uint32();break;case 3:s.playerNumber=t.uint32();break;case 4:s.name=t.string();break;case 5:s.color=t.uint32();break;case 6:s.cursor=Cursor.decode(t,t.uint32());break;case 7:s.dead=t.bool();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{id:isSet(i.id)?Number(i.id):0,clientId:isSet(i.clientId)?Number(i.clientId):0,playerNumber:isSet(i.playerNumber)?Number(i.playerNumber):0,name:isSet(i.name)?String(i.name):"",color:isSet(i.color)?Number(i.color):0,cursor:isSet(i.cursor)?Cursor.fromJSON(i.cursor):void 0,dead:isSet(i.dead)?Boolean(i.dead):!1}},toJSON(i){const e={};return i.id!==void 0&&(e.id=Math.round(i.id)),i.clientId!==void 0&&(e.clientId=Math.round(i.clientId)),i.playerNumber!==void 0&&(e.playerNumber=Math.round(i.playerNumber)),i.name!==void 0&&(e.name=i.name),i.color!==void 0&&(e.color=Math.round(i.color)),i.cursor!==void 0&&(e.cursor=i.cursor?Cursor.toJSON(i.cursor):void 0),i.dead!==void 0&&(e.dead=i.dead),e},fromPartial(i){var e,t,r,s,n,o;const a=createBasePlayer();return a.id=(e=i.id)!==null&&e!==void 0?e:0,a.clientId=(t=i.clientId)!==null&&t!==void 0?t:0,a.playerNumber=(r=i.playerNumber)!==null&&r!==void 0?r:0,a.name=(s=i.name)!==null&&s!==void 0?s:"",a.color=(n=i.color)!==null&&n!==void 0?n:0,a.cursor=i.cursor!==void 0&&i.cursor!==null?Cursor.fromPartial(i.cursor):void 0,a.dead=(o=i.dead)!==null&&o!==void 0?o:!1,a}};function createBaseCursor(){return{player:0,x:0,y:0}}const Cursor={encode(i,e=minimal$1.exports.Writer.create()){return i.player!==0&&e.uint32(8).uint32(i.player),i.x!==0&&e.uint32(16).uint32(i.x),i.y!==0&&e.uint32(24).uint32(i.y),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseCursor();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.player=t.uint32();break;case 2:s.x=t.uint32();break;case 3:s.y=t.uint32();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{player:isSet(i.player)?Number(i.player):0,x:isSet(i.x)?Number(i.x):0,y:isSet(i.y)?Number(i.y):0}},toJSON(i){const e={};return i.player!==void 0&&(e.player=Math.round(i.player)),i.x!==void 0&&(e.x=Math.round(i.x)),i.y!==void 0&&(e.y=Math.round(i.y)),e},fromPartial(i){var e,t,r;const s=createBaseCursor();return s.player=(e=i.player)!==null&&e!==void 0?e:0,s.x=(t=i.x)!==null&&t!==void 0?t:0,s.y=(r=i.y)!==null&&r!==void 0?r:0,s}};function createBaseBall(){return{player:0,color:0,x:0,y:0}}const Ball={encode(i,e=minimal$1.exports.Writer.create()){return i.player!==0&&e.uint32(8).uint32(i.player),i.color!==0&&e.uint32(16).uint32(i.color),i.x!==0&&e.uint32(29).float(i.x),i.y!==0&&e.uint32(37).float(i.y),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseBall();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.player=t.uint32();break;case 2:s.color=t.uint32();break;case 3:s.x=t.float();break;case 4:s.y=t.float();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{player:isSet(i.player)?Number(i.player):0,color:isSet(i.color)?Number(i.color):0,x:isSet(i.x)?Number(i.x):0,y:isSet(i.y)?Number(i.y):0}},toJSON(i){const e={};return i.player!==void 0&&(e.player=Math.round(i.player)),i.color!==void 0&&(e.color=Math.round(i.color)),i.x!==void 0&&(e.x=i.x),i.y!==void 0&&(e.y=i.y),e},fromPartial(i){var e,t,r,s;const n=createBaseBall();return n.player=(e=i.player)!==null&&e!==void 0?e:0,n.color=(t=i.color)!==null&&t!==void 0?t:0,n.x=(r=i.x)!==null&&r!==void 0?r:0,n.y=(s=i.y)!==null&&s!==void 0?s:0,n}};function createBaseLobbyGame(){return{gameId:"",players:0,maxPlayers:0}}const LobbyGame={encode(i,e=minimal$1.exports.Writer.create()){return i.gameId!==""&&e.uint32(10).string(i.gameId),i.players!==0&&e.uint32(16).uint32(i.players),i.maxPlayers!==0&&e.uint32(24).uint32(i.maxPlayers),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseLobbyGame();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.players=t.uint32();break;case 3:s.maxPlayers=t.uint32();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):"",players:isSet(i.players)?Number(i.players):0,maxPlayers:isSet(i.maxPlayers)?Number(i.maxPlayers):0}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.players!==void 0&&(e.players=Math.round(i.players)),i.maxPlayers!==void 0&&(e.maxPlayers=Math.round(i.maxPlayers)),e},fromPartial(i){var e,t,r;const s=createBaseLobbyGame();return s.gameId=(e=i.gameId)!==null&&e!==void 0?e:"",s.players=(t=i.players)!==null&&t!==void 0?t:0,s.maxPlayers=(r=i.maxPlayers)!==null&&r!==void 0?r:0,s}};function createBaseLobbyPlayer(){return{playerId:0,name:""}}const LobbyPlayer={encode(i,e=minimal$1.exports.Writer.create()){return i.playerId!==0&&e.uint32(16).uint32(i.playerId),i.name!==""&&e.uint32(26).string(i.name),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseLobbyPlayer();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 2:s.playerId=t.uint32();break;case 3:s.name=t.string();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{playerId:isSet(i.playerId)?Number(i.playerId):0,name:isSet(i.name)?String(i.name):""}},toJSON(i){const e={};return i.playerId!==void 0&&(e.playerId=Math.round(i.playerId)),i.name!==void 0&&(e.name=i.name),e},fromPartial(i){var e,t;const r=createBaseLobbyPlayer();return r.playerId=(e=i.playerId)!==null&&e!==void 0?e:0,r.name=(t=i.name)!==null&&t!==void 0?t:"",r}};function createBaseLobbyState(){return{games:[],players:[]}}const LobbyState={encode(i,e=minimal$1.exports.Writer.create()){for(const t of i.games)LobbyGame.encode(t,e.uint32(10).fork()).ldelim();for(const t of i.players)LobbyPlayer.encode(t,e.uint32(18).fork()).ldelim();return e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseLobbyState();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.games.push(LobbyGame.decode(t,t.uint32()));break;case 2:s.players.push(LobbyPlayer.decode(t,t.uint32()));break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{games:Array.isArray(i==null?void 0:i.games)?i.games.map(e=>LobbyGame.fromJSON(e)):[],players:Array.isArray(i==null?void 0:i.players)?i.players.map(e=>LobbyPlayer.fromJSON(e)):[]}},toJSON(i){const e={};return i.games?e.games=i.games.map(t=>t?LobbyGame.toJSON(t):void 0):e.games=[],i.players?e.players=i.players.map(t=>t?LobbyPlayer.toJSON(t):void 0):e.players=[],e},fromPartial(i){var e,t;const r=createBaseLobbyState();return r.games=((e=i.games)===null||e===void 0?void 0:e.map(s=>LobbyGame.fromPartial(s)))||[],r.players=((t=i.players)===null||t===void 0?void 0:t.map(s=>LobbyPlayer.fromPartial(s)))||[],r}};function createBaseGameStart(){return{gameId:"",players:[],balls:[]}}const GameStart={encode(i,e=minimal$1.exports.Writer.create()){i.gameId!==""&&e.uint32(10).string(i.gameId);for(const t of i.players)Player.encode(t,e.uint32(18).fork()).ldelim();for(const t of i.balls)Ball.encode(t,e.uint32(26).fork()).ldelim();return e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseGameStart();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.players.push(Player.decode(t,t.uint32()));break;case 3:s.balls.push(Ball.decode(t,t.uint32()));break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):"",players:Array.isArray(i==null?void 0:i.players)?i.players.map(e=>Player.fromJSON(e)):[],balls:Array.isArray(i==null?void 0:i.balls)?i.balls.map(e=>Ball.fromJSON(e)):[]}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.players?e.players=i.players.map(t=>t?Player.toJSON(t):void 0):e.players=[],i.balls?e.balls=i.balls.map(t=>t?Ball.toJSON(t):void 0):e.balls=[],e},fromPartial(i){var e,t,r;const s=createBaseGameStart();return s.gameId=(e=i.gameId)!==null&&e!==void 0?e:"",s.players=((t=i.players)===null||t===void 0?void 0:t.map(n=>Player.fromPartial(n)))||[],s.balls=((r=i.balls)===null||r===void 0?void 0:r.map(n=>Ball.fromPartial(n)))||[],s}};function createBaseGameEnd(){return{gameId:"",result:0,winner:void 0}}const GameEnd={encode(i,e=minimal$1.exports.Writer.create()){return i.gameId!==""&&e.uint32(10).string(i.gameId),i.result!==0&&e.uint32(16).int32(i.result),i.winner!==void 0&&Player.encode(i.winner,e.uint32(26).fork()).ldelim(),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseGameEnd();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.result=t.int32();break;case 3:s.winner=Player.decode(t,t.uint32());break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):"",result:isSet(i.result)?gameStatusFromJSON(i.result):0,winner:isSet(i.winner)?Player.fromJSON(i.winner):void 0}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.result!==void 0&&(e.result=gameStatusToJSON(i.result)),i.winner!==void 0&&(e.winner=i.winner?Player.toJSON(i.winner):void 0),e},fromPartial(i){var e,t;const r=createBaseGameEnd();return r.gameId=(e=i.gameId)!==null&&e!==void 0?e:"",r.result=(t=i.result)!==null&&t!==void 0?t:0,r.winner=i.winner!==void 0&&i.winner!==null?Player.fromPartial(i.winner):void 0,r}};function createBaseTick(){return{gameId:"",cursors:[],balls:[]}}const Tick={encode(i,e=minimal$1.exports.Writer.create()){i.gameId!==""&&e.uint32(10).string(i.gameId);for(const t of i.cursors)Cursor.encode(t,e.uint32(18).fork()).ldelim();for(const t of i.balls)Ball.encode(t,e.uint32(26).fork()).ldelim();return e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseTick();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.cursors.push(Cursor.decode(t,t.uint32()));break;case 3:s.balls.push(Ball.decode(t,t.uint32()));break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):"",cursors:Array.isArray(i==null?void 0:i.cursors)?i.cursors.map(e=>Cursor.fromJSON(e)):[],balls:Array.isArray(i==null?void 0:i.balls)?i.balls.map(e=>Ball.fromJSON(e)):[]}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.cursors?e.cursors=i.cursors.map(t=>t?Cursor.toJSON(t):void 0):e.cursors=[],i.balls?e.balls=i.balls.map(t=>t?Ball.toJSON(t):void 0):e.balls=[],e},fromPartial(i){var e,t,r;const s=createBaseTick();return s.gameId=(e=i.gameId)!==null&&e!==void 0?e:"",s.cursors=((t=i.cursors)===null||t===void 0?void 0:t.map(n=>Cursor.fromPartial(n)))||[],s.balls=((r=i.balls)===null||r===void 0?void 0:r.map(n=>Ball.fromPartial(n)))||[],s}};function createBaseGameOptions(){return{serverTickRate:0,liquidPerPlayer:0,cursorSpeed:0,players:0}}const GameOptions={encode(i,e=minimal$1.exports.Writer.create()){return i.serverTickRate!==0&&e.uint32(8).uint32(i.serverTickRate),i.liquidPerPlayer!==0&&e.uint32(16).uint32(i.liquidPerPlayer),i.cursorSpeed!==0&&e.uint32(24).uint32(i.cursorSpeed),i.players!==0&&e.uint32(32).uint32(i.players),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBaseGameOptions();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.serverTickRate=t.uint32();break;case 2:s.liquidPerPlayer=t.uint32();break;case 3:s.cursorSpeed=t.uint32();break;case 4:s.players=t.uint32();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{serverTickRate:isSet(i.serverTickRate)?Number(i.serverTickRate):0,liquidPerPlayer:isSet(i.liquidPerPlayer)?Number(i.liquidPerPlayer):0,cursorSpeed:isSet(i.cursorSpeed)?Number(i.cursorSpeed):0,players:isSet(i.players)?Number(i.players):0}},toJSON(i){const e={};return i.serverTickRate!==void 0&&(e.serverTickRate=Math.round(i.serverTickRate)),i.liquidPerPlayer!==void 0&&(e.liquidPerPlayer=Math.round(i.liquidPerPlayer)),i.cursorSpeed!==void 0&&(e.cursorSpeed=Math.round(i.cursorSpeed)),i.players!==void 0&&(e.players=Math.round(i.players)),e},fromPartial(i){var e,t,r,s;const n=createBaseGameOptions();return n.serverTickRate=(e=i.serverTickRate)!==null&&e!==void 0?e:0,n.liquidPerPlayer=(t=i.liquidPerPlayer)!==null&&t!==void 0?t:0,n.cursorSpeed=(r=i.cursorSpeed)!==null&&r!==void 0?r:0,n.players=(s=i.players)!==null&&s!==void 0?s:0,n}};function createBasePlayerJoinLobby(){return{playerId:0,name:""}}const PlayerJoinLobby={encode(i,e=minimal$1.exports.Writer.create()){return i.playerId!==0&&e.uint32(8).uint32(i.playerId),i.name!==""&&e.uint32(18).string(i.name),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBasePlayerJoinLobby();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.playerId=t.uint32();break;case 2:s.name=t.string();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{playerId:isSet(i.playerId)?Number(i.playerId):0,name:isSet(i.name)?String(i.name):""}},toJSON(i){const e={};return i.playerId!==void 0&&(e.playerId=Math.round(i.playerId)),i.name!==void 0&&(e.name=i.name),e},fromPartial(i){var e,t;const r=createBasePlayerJoinLobby();return r.playerId=(e=i.playerId)!==null&&e!==void 0?e:0,r.name=(t=i.name)!==null&&t!==void 0?t:"",r}};function createBasePlayerCreateGame(){return{playerId:0,name:"",color:"",options:void 0}}const PlayerCreateGame={encode(i,e=minimal$1.exports.Writer.create()){return i.playerId!==0&&e.uint32(8).uint32(i.playerId),i.name!==""&&e.uint32(18).string(i.name),i.color!==""&&e.uint32(26).string(i.color),i.options!==void 0&&GameOptions.encode(i.options,e.uint32(34).fork()).ldelim(),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBasePlayerCreateGame();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.playerId=t.uint32();break;case 2:s.name=t.string();break;case 3:s.color=t.string();break;case 4:s.options=GameOptions.decode(t,t.uint32());break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{playerId:isSet(i.playerId)?Number(i.playerId):0,name:isSet(i.name)?String(i.name):"",color:isSet(i.color)?String(i.color):"",options:isSet(i.options)?GameOptions.fromJSON(i.options):void 0}},toJSON(i){const e={};return i.playerId!==void 0&&(e.playerId=Math.round(i.playerId)),i.name!==void 0&&(e.name=i.name),i.color!==void 0&&(e.color=i.color),i.options!==void 0&&(e.options=i.options?GameOptions.toJSON(i.options):void 0),e},fromPartial(i){var e,t,r;const s=createBasePlayerCreateGame();return s.playerId=(e=i.playerId)!==null&&e!==void 0?e:0,s.name=(t=i.name)!==null&&t!==void 0?t:"",s.color=(r=i.color)!==null&&r!==void 0?r:"",s.options=i.options!==void 0&&i.options!==null?GameOptions.fromPartial(i.options):void 0,s}};function createBasePlayerJoinGame(){return{gameId:void 0,playerId:0,name:"",color:"",options:void 0}}const PlayerJoinGame={encode(i,e=minimal$1.exports.Writer.create()){return i.gameId!==void 0&&e.uint32(10).string(i.gameId),i.playerId!==0&&e.uint32(16).uint32(i.playerId),i.name!==""&&e.uint32(26).string(i.name),i.color!==""&&e.uint32(34).string(i.color),i.options!==void 0&&GameOptions.encode(i.options,e.uint32(42).fork()).ldelim(),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBasePlayerJoinGame();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.playerId=t.uint32();break;case 3:s.name=t.string();break;case 4:s.color=t.string();break;case 5:s.options=GameOptions.decode(t,t.uint32());break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):void 0,playerId:isSet(i.playerId)?Number(i.playerId):0,name:isSet(i.name)?String(i.name):"",color:isSet(i.color)?String(i.color):"",options:isSet(i.options)?GameOptions.fromJSON(i.options):void 0}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.playerId!==void 0&&(e.playerId=Math.round(i.playerId)),i.name!==void 0&&(e.name=i.name),i.color!==void 0&&(e.color=i.color),i.options!==void 0&&(e.options=i.options?GameOptions.toJSON(i.options):void 0),e},fromPartial(i){var e,t,r,s;const n=createBasePlayerJoinGame();return n.gameId=(e=i.gameId)!==null&&e!==void 0?e:void 0,n.playerId=(t=i.playerId)!==null&&t!==void 0?t:0,n.name=(r=i.name)!==null&&r!==void 0?r:"",n.color=(s=i.color)!==null&&s!==void 0?s:"",n.options=i.options!==void 0&&i.options!==null?GameOptions.fromPartial(i.options):void 0,n}};function createBasePlayerMove(){return{gameId:"",playerNumber:0,mouseX:0,mouseY:0}}const PlayerMove={encode(i,e=minimal$1.exports.Writer.create()){return i.gameId!==""&&e.uint32(10).string(i.gameId),i.playerNumber!==0&&e.uint32(16).uint32(i.playerNumber),i.mouseX!==0&&e.uint32(24).uint32(i.mouseX),i.mouseY!==0&&e.uint32(32).uint32(i.mouseY),e},decode(i,e){const t=i instanceof minimal$1.exports.Reader?i:new minimal$1.exports.Reader(i);let r=e===void 0?t.len:t.pos+e;const s=createBasePlayerMove();for(;t.pos<r;){const n=t.uint32();switch(n>>>3){case 1:s.gameId=t.string();break;case 2:s.playerNumber=t.uint32();break;case 3:s.mouseX=t.uint32();break;case 4:s.mouseY=t.uint32();break;default:t.skipType(n&7);break}}return s},fromJSON(i){return{gameId:isSet(i.gameId)?String(i.gameId):"",playerNumber:isSet(i.playerNumber)?Number(i.playerNumber):0,mouseX:isSet(i.mouseX)?Number(i.mouseX):0,mouseY:isSet(i.mouseY)?Number(i.mouseY):0}},toJSON(i){const e={};return i.gameId!==void 0&&(e.gameId=i.gameId),i.playerNumber!==void 0&&(e.playerNumber=Math.round(i.playerNumber)),i.mouseX!==void 0&&(e.mouseX=Math.round(i.mouseX)),i.mouseY!==void 0&&(e.mouseY=Math.round(i.mouseY)),e},fromPartial(i){var e,t,r,s;const n=createBasePlayerMove();return n.gameId=(e=i.gameId)!==null&&e!==void 0?e:"",n.playerNumber=(t=i.playerNumber)!==null&&t!==void 0?t:0,n.mouseX=(r=i.mouseX)!==null&&r!==void 0?r:0,n.mouseY=(s=i.mouseY)!==null&&s!==void 0?s:0,n}};function isSet(i){return i!=null}const getEnv=i=>{if(!i)throw new Error("Undefined environment variable!");return i},WS_URL=getEnv("wss://liquid-war.fly.dev");var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var i=1e3,e=i*60,t=e*60,r=t*24,s=r*7,n=r*365.25;ms=function(c,u){u=u||{};var d=typeof c;if(d==="string"&&c.length>0)return o(c);if(d==="number"&&isFinite(c))return u.long?l(c):a(c);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(c))};function o(c){if(c=String(c),!(c.length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(c);if(!!u){var d=parseFloat(u[1]),f=(u[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return d*n;case"weeks":case"week":case"w":return d*s;case"days":case"day":case"d":return d*r;case"hours":case"hour":case"hrs":case"hr":case"h":return d*t;case"minutes":case"minute":case"mins":case"min":case"m":return d*e;case"seconds":case"second":case"secs":case"sec":case"s":return d*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(c){var u=Math.abs(c);return u>=r?Math.round(c/r)+"d":u>=t?Math.round(c/t)+"h":u>=e?Math.round(c/e)+"m":u>=i?Math.round(c/i)+"s":c+"ms"}function l(c){var u=Math.abs(c);return u>=r?h(c,u,r,"day"):u>=t?h(c,u,t,"hour"):u>=e?h(c,u,e,"minute"):u>=i?h(c,u,i,"second"):c+" ms"}function h(c,u,d,f){var p=u>=d*1.5;return Math.round(c/d)+" "+f+(p?"s":"")}return ms}function setup(i){t.debug=t,t.default=t,t.coerce=l,t.disable=n,t.enable=s,t.enabled=o,t.humanize=requireMs(),t.destroy=h,Object.keys(i).forEach(c=>{t[c]=i[c]}),t.names=[],t.skips=[],t.formatters={};function e(c){let u=0;for(let d=0;d<c.length;d++)u=(u<<5)-u+c.charCodeAt(d),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(c){let u,d=null,f,p;function m(...g){if(!m.enabled)return;const y=m,v=Number(new Date),_=v-(u||v);y.diff=_,y.prev=u,y.curr=v,u=v,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let x=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(R,A)=>{if(R==="%%")return"%";x++;const S=t.formatters[A];if(typeof S=="function"){const M=g[x];R=S.call(y,M),g.splice(x,1),x--}return R}),t.formatArgs.call(y,g),(y.log||t.log).apply(y,g)}return m.namespace=c,m.useColors=t.useColors(),m.color=t.selectColor(c),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(f!==t.namespaces&&(f=t.namespaces,p=t.enabled(c)),p),set:g=>{d=g}}),typeof t.init=="function"&&t.init(m),m}function r(c,u){const d=t(this.namespace+(typeof u>"u"?":":u)+c);return d.log=this.log,d}function s(c){t.save(c),t.namespaces=c,t.names=[],t.skips=[];let u;const d=(typeof c=="string"?c:"").split(/[\s,]+/),f=d.length;for(u=0;u<f;u++)!d[u]||(c=d[u].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.slice(1)+"$")):t.names.push(new RegExp("^"+c+"$")))}function n(){const c=[...t.names.map(a),...t.skips.map(a).map(u=>"-"+u)].join(",");return t.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let u,d;for(u=0,d=t.skips.length;u<d;u++)if(t.skips[u].test(c))return!1;for(u=0,d=t.names.length;u<d;u++)if(t.names[u].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function l(c){return c instanceof Error?c.stack||c.message:c}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common=setup;(function(i,e){e.formatArgs=r,e.save=s,e.load=n,e.useColors=t,e.storage=o(),e.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+i.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;l.splice(1,0,h,"color: inherit");let c=0,u=0;l[0].replace(/%[a-zA-Z%]/g,d=>{d!=="%%"&&(c++,d==="%c"&&(u=c))}),l.splice(u,0,h)}e.log=console.debug||console.log||(()=>{});function s(l){try{l?e.storage.setItem("debug",l):e.storage.removeItem("debug")}catch{}}function n(){let l;try{l=e.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=process.env.DEBUG),l}function o(){try{return localStorage}catch{}}i.exports=common(e);const{formatters:a}=i.exports;a.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(browser,browser.exports);const debug=browser.exports,logger=debug("game"),log={print(i,e,t,r){const s=i==="info"?t:`%c ${i.toUpperCase()} -> ${t}`;r&&i==="info"?logger(s,r):r?logger(s,`color: ${e}`,r):i==="info"?logger(s):logger(s,`color: ${e}`)},debug(i,e){return this.print("debug","#c563ff",i,e)},info(i,e){return this.print("info","",i,e)},warn(i,e){return this.print("warn","#f3f32c",i,e)},error(i,e){return this.print("error","#ff4242",i,e)}},enableDebug=i=>{i?debug.enable("game"):debug.disable()};let socket=null;const socketActions={connect(i){socket=new WebSocket(WS_URL),socket.binaryType="arraybuffer",socket.onopen=()=>{console.log("Connected"),i({e:"connected"})},socket.onerror=e=>{console.debug("Socket error",e),i({e:"error",err:e})},socket.onclose=()=>{console.log("Disconnected"),socket=null,i({e:"disconnected"})},socket.onmessage=e=>{const{data:t}=e,r=new Uint8Array(t),s=r.slice(1),n=r[0];switch(n){case ServerMsgType.lobby_state:i({e:ServerMsgType.lobby_state,data:LobbyState.decode(s)});break;case ServerMsgType.player_msg:case ServerMsgType.player_join_lobby:case ServerMsgType.player_leave_lobby:case ServerMsgType.lobby_game_updated:case ServerMsgType.player_join:log.debug(`Read type ${n}`);break;case ServerMsgType.game_start:{i({e:ServerMsgType.game_start,data:GameStart.decode(s)});break}case ServerMsgType.game_end:{i({e:ServerMsgType.game_end,data:GameEnd.decode(s)});break}case ServerMsgType.tick:{i({e:ServerMsgType.tick,data:Tick.decode(s)});break}default:log.error(`Unknown message type: ${n}`)}}},emit(i,e){const t=new Uint8Array(e.length+1);t.set([i],0),t.set(e,1),socket==null||socket.send(t)},emitJoinLobby(i){const e=PlayerJoinLobby.encode(i).finish(),t=new Uint8Array(e.length+1);t.set([ClientMsgType.join_lobby],0),t.set(e,1),socket==null||socket.send(t)},emitJoinGame(i){const e=PlayerJoinGame.encode(i).finish(),t=new Uint8Array(e.length+1);t.set([ClientMsgType.join_lobby_game],0),t.set(e,1),socket==null||socket.send(t)},emitMove(i){const e=PlayerMove.encode(i).finish(),t=new Uint8Array(e.length+1);t.set([ClientMsgType.player_move],0),t.set(e,1),socket==null||socket.send(t)}},lobbyGames=writable([]),lobbyPlayers=writable([]),playerName=writable("unknown"),gameState=writable("connecting"),gameEnd=writable(void 0),gameId=writable(""),players=writable([]),balls$1=writable([]),playerId=Math.ceil(Math.random()*1e5),localPlayer=writable(void 0),retryConnectTimeout=writable();function handleMessages(i){var e;switch(log.debug("Event:",i),i.e){case"connected":socketActions.emitJoinLobby({playerId,name:get_store_value(playerName)}),gameState.set("lobby");break;case"disconnected":gameState.set("connecting"),retryConnectTimeout.set(setTimeout(()=>{socketActions.connect(handleMessages)},1e3));break;case ServerMsgType.lobby_state:lobbyGames.set(i.data.games),lobbyPlayers.set(i.data.players);break;case ServerMsgType.game_start:gameId.set(i.data.gameId),players.set(i.data.players),balls$1.set(i.data.balls),localPlayer.set(i.data.players.find(s=>s.id===playerId)),gfxActions.initGame(i.data.players,i.data.balls),gameState.set("game-running");break;case ServerMsgType.game_end:gameEnd.set(i.data),gfxActions.destroy(),gameState.set("game-ended");break;case ServerMsgType.tick:const t=i.data;players.update(s=>(t.cursors.forEach((n,o)=>{s[o].cursor=n}),s));const r=get_store_value(mouse);socketActions.emitMove({gameId:t.gameId,playerNumber:((e=get_store_value(localPlayer))==null?void 0:e.playerNumber)||0,mouseX:r.x,mouseY:r.y}),gfxActions.updateBalls(t.balls);break}}const gameActions={setPlayerName(i){playerName.set(i)},runGame(){gameState.set("connecting"),socketActions.connect(handleMessages)},joinLobby(){gameState.set("lobby"),socketActions.emit(ClientMsgType.join_lobby,PlayerJoinLobby.encode({playerId,name:get_store_value(playerName)}).finish())},createGame(i){const e={playerId,name:get_store_value(playerName),color:"poop",options:i};socketActions.emit(ClientMsgType.create_lobby_game,PlayerCreateGame.encode(e).finish()),gameState.set("waiting-game-start")},joinGame(i,e){const t={gameId:i.gameId,playerId,name:get_store_value(playerName),color:"poop",options:e};socketActions.emit(ClientMsgType.join_lobby_game,PlayerJoinGame.encode(t).finish()),gameState.set("waiting-game-start")}},width=1920,height=1072,ballDiameter=16,globalCursors=writable([]),balls=writable([]),mouse=writable({x:0,y:0});let app;const gfxActions={initGame(i,e){app=new Application({width,height,backgroundAlpha:0});let t=performance.now();app.ticker.add(()=>{var a;const r=(a=get_store_value(localPlayer))==null?void 0:a.playerNumber;if(get_store_value(gameState)!=="game-running")return;if(r===void 0){console.error("undefined playerNumber!");return}const s=performance.now()-t;t=performance.now();const n=.01*s,o=Math.min(1,.01*s);balls.update(l=>l.map(h=>(h.x+=(h.targetX-h.x)*n,h.y+=(h.targetY-h.y)*n,h.pixiBall.x=h.x,h.pixiBall.y=h.y,h))),globalCursors.update(l=>l.map(h=>(h.player==r?(h.x=get_store_value(mouse).x,h.y=get_store_value(mouse).y):(h.x+=(h.targetX-h.x)*o,h.y+=(h.targetY-h.y)*o),h)))}),globalCursors.set(i.map(r=>({...r.cursor,color:r.color,targetX:r.cursor.x,targetY:r.cursor.y}))),balls.set(e.map(r=>{const s=new Graphics;return s.lineStyle(0),s.beginFill(16777215,1),s.drawCircle(0,0,ballDiameter/2),s.endFill(),app.stage.addChild(s),{...r,targetX:r.x,targetY:r.y,pixiBall:s}}))},destroy(){globalCursors.set([]),balls.set([])},updateMouse(i,e){mouse.set({x:i,y:e})},updateBalls(i){balls.update(e=>e.map((t,r)=>{const s=i[r].color;return t.pixiBall.tint=s,{...t,targetX:i[r].x,targetY:i[r].y,color:s}}))}},Canvas_svelte_svelte_type_style_lang="";function create_fragment$2(i){let e,t,r=`${width} / ${height}`,s,n,o,a,l,h;return{c(){e=element("div"),t=element("div"),s=space(),n=svg_element("svg"),o=svg_element("defs"),a=svg_element("filter"),l=svg_element("feGaussianBlur"),h=svg_element("feColorMatrix"),attr(t,"class","canvas-wrapper svelte-12q2bxa"),set_style(t,"aspect-ratio",r),attr(l,"in","SourceGraphic"),attr(l,"stdDeviation","11"),attr(l,"result","blur"),attr(h,"in","blur"),attr(h,"mode","matrix"),attr(h,"values","1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 60 -9"),attr(a,"id","goo"),attr(n,"xmlns","http://www.w3.org/2000/svg"),set_style(n,"display","none"),attr(e,"class","game svelte-12q2bxa")},m(c,u){insert(c,e,u),append(e,t),append(e,s),append(e,n),append(n,o),append(o,a),append(a,l),append(a,h)},p:noop$1,i:noop$1,o:noop$1,d(c){c&&detach(e)}}}function instance$2(i){return onMount(()=>{document.getElementsByClassName("canvas-wrapper")[0].appendChild(app.view)}),[]}class Canvas extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$2,create_fragment$2,safe_not_equal,{})}}const Lobby_svelte_svelte_type_style_lang="";function get_each_context(i,e,t){const r=i.slice();return r[14]=e[t],r[16]=t,r}function create_else_block(i){let e,t=i[4],r=[];for(let s=0;s<t.length;s+=1)r[s]=create_each_block(get_each_context(i,t,s));return{c(){e=element("ul");for(let s=0;s<r.length;s+=1)r[s].c();attr(e,"class","svelte-1beqg5q")},m(s,n){insert(s,e,n);for(let o=0;o<r.length;o+=1)r[o].m(e,null)},p(s,n){if(n&272){t=s[4];let o;for(o=0;o<t.length;o+=1){const a=get_each_context(s,t,o);r[o]?r[o].p(a,n):(r[o]=create_each_block(a),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=t.length}},d(s){s&&detach(e),destroy_each(r,s)}}}function create_if_block$1(i){let e;return{c(){e=element("h3"),e.textContent="No games",set_style(e,"margin-top","2rem")},m(t,r){insert(t,e,r)},p:noop$1,d(t){t&&detach(e)}}}function create_each_block(i){let e,t,r,s,n=i[14].players+"",o,a,l=i[14].maxPlayers+"",h,c,u,d;function f(){return i[9](i[16])}return{c(){e=element("li"),t=element("div"),r=element("button"),s=text("Players: "),o=text(n),a=text("/"),h=text(l),c=space(),attr(r,"class","svelte-1beqg5q")},m(p,m){insert(p,e,m),append(e,t),append(t,r),append(r,s),append(r,o),append(r,a),append(r,h),append(e,c),u||(d=listen(r,"click",f),u=!0)},p(p,m){i=p,m&16&&n!==(n=i[14].players+"")&&set_data(o,n),m&16&&l!==(l=i[14].maxPlayers+"")&&set_data(h,l)},d(p){p&&detach(e),u=!1,d()}}}function create_fragment$1(i){let e,t,r,s,n,o,a,l,h,c,u,d,f,p,m,g,y,v,_,x,T,R,A,S,M,D,I,P,w,E,O,L,C,k,X,b,B,N;function G(F,H){return F[4].length===0?create_if_block$1:create_else_block}let U=G(i),$=U(i);return{c(){e=element("div"),t=element("h1"),t.textContent="Liquid War",r=space(),s=element("div"),n=element("div"),$.c(),o=space(),a=element("form"),l=element("div"),h=element("label"),h.textContent="Name",c=space(),u=element("input"),d=space(),f=element("button"),f.textContent="Play",p=space(),m=element("details"),g=element("summary"),g.textContent="Custom game options",y=space(),v=element("div"),_=element("label"),_.textContent="Server tick rate",x=space(),T=element("input"),R=space(),A=element("div"),S=element("label"),S.textContent="Liquid per player",M=space(),D=element("input"),I=space(),P=element("div"),w=element("label"),w.textContent="Cursor speed",E=space(),O=element("input"),L=space(),C=element("div"),k=element("label"),k.textContent="Players",X=space(),b=element("input"),attr(t,"class","svelte-1beqg5q"),attr(n,"class","games svelte-1beqg5q"),attr(h,"for","name"),attr(h,"class","svelte-1beqg5q"),attr(u,"id","name"),u.value=i[5],attr(u,"class","svelte-1beqg5q"),attr(l,"class","field svelte-1beqg5q"),set_style(f,"background","var(--confirm-color)"),attr(f,"class","svelte-1beqg5q"),attr(g,"class","svelte-1beqg5q"),attr(_,"for","serverTickRate"),attr(_,"class","svelte-1beqg5q"),attr(T,"id","serverTickRate"),attr(T,"class","svelte-1beqg5q"),attr(v,"class","field svelte-1beqg5q"),attr(S,"for","liquid"),attr(S,"class","svelte-1beqg5q"),attr(D,"id","liquid"),attr(D,"class","svelte-1beqg5q"),attr(A,"class","field svelte-1beqg5q"),attr(w,"for","cursor"),attr(w,"class","svelte-1beqg5q"),attr(O,"id","cursor"),attr(O,"class","svelte-1beqg5q"),attr(P,"class","field svelte-1beqg5q"),attr(k,"for","players"),attr(k,"class","svelte-1beqg5q"),attr(b,"id","players"),attr(b,"class","svelte-1beqg5q"),attr(C,"class","field svelte-1beqg5q"),m.open=!0,attr(m,"class","svelte-1beqg5q"),attr(a,"class","svelte-1beqg5q"),attr(s,"class","body svelte-1beqg5q"),attr(e,"class","container svelte-1beqg5q")},m(F,H){insert(F,e,H),append(e,t),append(e,r),append(e,s),append(s,n),$.m(n,null),append(s,o),append(s,a),append(a,l),append(l,h),append(l,c),append(l,u),append(a,d),append(a,f),append(a,p),append(a,m),append(m,g),append(m,y),append(m,v),append(v,_),append(v,x),append(v,T),set_input_value(T,i[0]),append(m,R),append(m,A),append(A,S),append(A,M),append(A,D),set_input_value(D,i[1]),append(m,I),append(m,P),append(P,w),append(P,E),append(P,O),set_input_value(O,i[2]),append(m,L),append(m,C),append(C,k),append(C,X),append(C,b),set_input_value(b,i[3]),B||(N=[listen(u,"input",i[6]),listen(T,"input",i[10]),listen(D,"input",i[11]),listen(O,"input",i[12]),listen(b,"input",i[13]),listen(a,"submit",prevent_default(i[7]))],B=!0)},p(F,[H]){U===(U=G(F))&&$?$.p(F,H):($.d(1),$=U(F),$&&($.c(),$.m(n,null))),H&32&&u.value!==F[5]&&(u.value=F[5]),H&1&&T.value!==F[0]&&set_input_value(T,F[0]),H&2&&D.value!==F[1]&&set_input_value(D,F[1]),H&4&&O.value!==F[2]&&set_input_value(O,F[2]),H&8&&b.value!==F[3]&&set_input_value(b,F[3])},i:noop$1,o:noop$1,d(F){F&&detach(e),$.d(),B=!1,run_all(N)}}}function instance$1(i,e,t){let r,s;component_subscribe(i,lobbyGames,y=>t(4,r=y)),component_subscribe(i,playerName,y=>t(5,s=y));let n,o,a,l=2;function h(y){gameActions.setPlayerName(y.currentTarget.value)}function c(){gameActions.createGame({serverTickRate:n||0,liquidPerPlayer:o||0,cursorSpeed:a||0,players:l})}function u(y){const v=r[y];gameActions.joinGame(v,{serverTickRate:n||0,liquidPerPlayer:o||0,cursorSpeed:a||0,players:l})}onMount(()=>{window.addEventListener("message",y=>{y.origin==="http://localhost:5174"&&y.data.type==="play"&&(t(3,l=y.data.players),document.querySelector("button").click())})});const d=y=>u(y);function f(){n=this.value,t(0,n)}function p(){o=this.value,t(1,o)}function m(){a=this.value,t(2,a)}function g(){l=this.value,t(3,l)}return[n,o,a,l,r,s,h,c,u,d,f,p,m,g]}class Lobby extends SvelteComponent{constructor(e){super(),init$1(this,e,instance$1,create_fragment$1,safe_not_equal,{})}}function initializeAI(){balls.subscribe(i=>{const e=get_store_value(localPlayer);if(e){const t=i.find(r=>r.player!==e.playerNumber);mouse.set({x:t.x,y:t.y})}})}const App_svelte_svelte_type_style_lang="";function create_if_block_4(i){let e;return{c(){e=element("div"),e.innerHTML=`<h1 class="svelte-1p7dfao">Liquid War</h1> 
      <p>Connecting...</p>`,attr(e,"class","loading-menu svelte-1p7dfao")},m(t,r){insert(t,e,r)},p:noop$1,i:noop$1,o:noop$1,d(t){t&&detach(e)}}}function create_if_block_3(i){let e,t;return e=new Canvas({}),{c(){create_component(e.$$.fragment)},m(r,s){mount_component(e,r,s),t=!0},p:noop$1,i(r){t||(transition_in(e.$$.fragment,r),t=!0)},o(r){transition_out(e.$$.fragment,r),t=!1},d(r){destroy_component(e,r)}}}function create_if_block_2(i){let e,t,r,s,n,o,a,l,h;return{c(){e=element("div"),t=element("marquee"),t.textContent="Game ended",r=space(),s=element("p"),n=text(i[0]),o=space(),a=element("button"),a.textContent="Play again",attr(t,"class","title svelte-1p7dfao"),attr(t,"width","50%"),attr(s,"class","game-winner svelte-1p7dfao"),attr(a,"class","svelte-1p7dfao"),attr(e,"class","end-menu svelte-1p7dfao")},m(c,u){insert(c,e,u),append(e,t),append(e,r),append(e,s),append(s,n),append(e,o),append(e,a),l||(h=listen(a,"click",i[2]),l=!0)},p(c,u){u&1&&set_data(n,c[0])},i:noop$1,o:noop$1,d(c){c&&detach(e),l=!1,h()}}}function create_if_block_1(i){let e,t;return e=new Lobby({}),{c(){create_component(e.$$.fragment)},m(r,s){mount_component(e,r,s),t=!0},p:noop$1,i(r){t||(transition_in(e.$$.fragment,r),t=!0)},o(r){transition_out(e.$$.fragment,r),t=!1},d(r){destroy_component(e,r)}}}function create_if_block(i){let e;return{c(){e=element("div"),e.innerHTML="<h2>Waiting for players\u2026</h2>",attr(e,"class","loading-menu svelte-1p7dfao")},m(t,r){insert(t,e,r)},p:noop$1,i:noop$1,o:noop$1,d(t){t&&detach(e)}}}function create_fragment(i){let e,t,r,s;const n=[create_if_block,create_if_block_1,create_if_block_2,create_if_block_3,create_if_block_4],o=[];function a(l,h){return l[1]==="waiting-game-start"?0:l[1]==="lobby"?1:l[1]==="game-ended"?2:l[1]==="game-running"?3:l[1]==="connecting"?4:-1}return~(t=a(i))&&(r=o[t]=n[t](i)),{c(){e=element("main"),r&&r.c(),attr(e,"class","svelte-1p7dfao")},m(l,h){insert(l,e,h),~t&&o[t].m(e,null),s=!0},p(l,[h]){let c=t;t=a(l),t===c?~t&&o[t].p(l,h):(r&&(group_outros(),transition_out(o[c],1,1,()=>{o[c]=null}),check_outros()),~t?(r=o[t],r?r.p(l,h):(r=o[t]=n[t](l),r.c()),transition_in(r,1),r.m(e,null)):r=null)},i(l){s||(transition_in(r),s=!0)},o(l){transition_out(r),s=!1},d(l){l&&detach(e),~t&&o[t].d()}}}function instance(i,e,t){let r,s;component_subscribe(i,gameEnd,a=>t(3,r=a)),component_subscribe(i,gameState,a=>t(1,s=a));let n="";onMount(()=>{const a=new URLSearchParams(window.location.search);a.has("autoplay")&&window.addEventListener("load",()=>{document.querySelector("button").click()}),a.has("ai")&&initializeAI(),window.addEventListener("mousemove",function(l){let h=document.querySelector("canvas");if(!h)return;let c=h.getBoundingClientRect();if(l.clientX>=c.left&&l.clientX<c.right&&l.clientY>=c.top&&l.clientY<c.bottom){let u=h.width/c.width,d=h.height/c.height;gfxActions.updateMouse((l.clientX-c.left)*u,(l.clientY-c.top)*d)}},!1),gameActions.runGame()});function o(){gameActions.joinLobby()}return i.$$.update=()=>{var a,l;if(i.$$.dirty&8){const h=r;h&&(h.result===GameStatus.PLAYER_WON&&((a=h.winner)==null?void 0:a.id)===playerId?t(0,n="You won \u{1F3C6} :DD"):h.result===GameStatus.PLAYER_WON&&((l=h.winner)==null?void 0:l.id)!==playerId?t(0,n="You lost \u{1F635}"):h.result===GameStatus.TIE?t(0,n="Tie \u{1F926}\u200D\u2642\uFE0F"):h.result===GameStatus.AI_WON?t(0,n="Computer won \u{1F916}"):t(0,n=`Something weird happened: ${GameStatus}`))}},[n,s,o,r]}class App extends SvelteComponent{constructor(e){super(),init$1(this,e,instance,create_fragment,safe_not_equal,{})}}const index="";enableDebug(!1);const el=document.querySelector("#app");el&&new App({target:el});
