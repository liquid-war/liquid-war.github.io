(function(){const _=document.createElement("link").relList;if(_&&_.supports&&_.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))A(R);new MutationObserver(R=>{for(const I of R)if(I.type==="childList")for(const P of I.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&A(P)}).observe(document,{childList:!0,subtree:!0});function E(R){const I={};return R.integrity&&(I.integrity=R.integrity),R.referrerpolicy&&(I.referrerPolicy=R.referrerpolicy),R.crossorigin==="use-credentials"?I.credentials="include":R.crossorigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function A(R){if(R.ep)return;R.ep=!0;const I=E(R);fetch(R.href,I)}})();function noop$1(){}function run(T){return T()}function blank_object(){return Object.create(null)}function run_all(T){T.forEach(run)}function is_function(T){return typeof T=="function"}function safe_not_equal(T,_){return T!=T?_==_:T!==_||T&&typeof T=="object"||typeof T=="function"}function is_empty(T){return Object.keys(T).length===0}function subscribe(T,..._){if(T==null)return noop$1;const E=T.subscribe(..._);return E.unsubscribe?()=>E.unsubscribe():E}function get_store_value(T){let _;return subscribe(T,E=>_=E)(),_}function component_subscribe(T,_,E){T.$$.on_destroy.push(subscribe(_,E))}function append(T,_){T.appendChild(_)}function insert(T,_,E){T.insertBefore(_,E||null)}function detach(T){T.parentNode.removeChild(T)}function destroy_each(T,_){for(let E=0;E<T.length;E+=1)T[E]&&T[E].d(_)}function element(T){return document.createElement(T)}function text(T){return document.createTextNode(T)}function space(){return text(" ")}function listen(T,_,E,A){return T.addEventListener(_,E,A),()=>T.removeEventListener(_,E,A)}function prevent_default(T){return function(_){return _.preventDefault(),T.call(this,_)}}function attr(T,_,E){E==null?T.removeAttribute(_):T.getAttribute(_)!==E&&T.setAttribute(_,E)}function children(T){return Array.from(T.childNodes)}function set_data(T,_){_=""+_,T.wholeText!==_&&(T.data=_)}function set_input_value(T,_){T.value=_==null?"":_}function set_style(T,_,E,A){E===null?T.style.removeProperty(_):T.style.setProperty(_,E,A?"important":"")}let current_component;function set_current_component(T){current_component=T}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(T){get_current_component().$$.on_mount.push(T)}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(T){render_callbacks.push(T)}const seen_callbacks=new Set;let flushidx=0;function flush(){const T=current_component;do{for(;flushidx<dirty_components.length;){const _=dirty_components[flushidx];flushidx++,set_current_component(_),update(_.$$)}for(set_current_component(null),dirty_components.length=0,flushidx=0;binding_callbacks.length;)binding_callbacks.pop()();for(let _=0;_<render_callbacks.length;_+=1){const E=render_callbacks[_];seen_callbacks.has(E)||(seen_callbacks.add(E),E())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,seen_callbacks.clear(),set_current_component(T)}function update(T){if(T.fragment!==null){T.update(),run_all(T.before_update);const _=T.dirty;T.dirty=[-1],T.fragment&&T.fragment.p(T.ctx,_),T.after_update.forEach(add_render_callback)}}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(T,_){T&&T.i&&(outroing.delete(T),T.i(_))}function transition_out(T,_,E,A){if(T&&T.o){if(outroing.has(T))return;outroing.add(T),outros.c.push(()=>{outroing.delete(T),A&&(E&&T.d(1),A())}),T.o(_)}else A&&A()}function create_component(T){T&&T.c()}function mount_component(T,_,E,A){const{fragment:R,after_update:I}=T.$$;R&&R.m(_,E),A||add_render_callback(()=>{const P=T.$$.on_mount.map(run).filter(is_function);T.$$.on_destroy?T.$$.on_destroy.push(...P):run_all(P),T.$$.on_mount=[]}),I.forEach(add_render_callback)}function destroy_component(T,_){const E=T.$$;E.fragment!==null&&(run_all(E.on_destroy),E.fragment&&E.fragment.d(_),E.on_destroy=E.fragment=null,E.ctx=[])}function make_dirty(T,_){T.$$.dirty[0]===-1&&(dirty_components.push(T),schedule_update(),T.$$.dirty.fill(0)),T.$$.dirty[_/31|0]|=1<<_%31}function init$1(T,_,E,A,R,I,P,C=[-1]){const D=current_component;set_current_component(T);const B=T.$$={fragment:null,ctx:[],props:I,update:noop$1,not_equal:R,bound:blank_object(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(_.context||(D?D.$$.context:[])),callbacks:blank_object(),dirty:C,skip_bound:!1,root:_.target||D.$$.root};P&&P(B.root);let O=!1;if(B.ctx=E?E(T,_.props||{},(F,L,...U)=>{const G=U.length?U[0]:L;return B.ctx&&R(B.ctx[F],B.ctx[F]=G)&&(!B.skip_bound&&B.bound[F]&&B.bound[F](G),O&&make_dirty(T,F)),L}):[],B.update(),O=!0,run_all(B.before_update),B.fragment=A?A(B.ctx):!1,_.target){if(_.hydrate){const F=children(_.target);B.fragment&&B.fragment.l(F),F.forEach(detach)}else B.fragment&&B.fragment.c();_.intro&&transition_in(T.$$.fragment),mount_component(T,_.target,_.anchor,_.customElement),flush()}set_current_component(D)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop$1}$on(_,E){if(!is_function(E))return noop$1;const A=this.$$.callbacks[_]||(this.$$.callbacks[_]=[]);return A.push(E),()=>{const R=A.indexOf(E);R!==-1&&A.splice(R,1)}}$set(_){this.$$set&&!is_empty(_)&&(this.$$.skip_bound=!0,this.$$set(_),this.$$.skip_bound=!1)}}var r$1={grad:.9,turn:360,rad:360/(2*Math.PI)},t$1=function(T){return typeof T=="string"?T.length>0:typeof T=="number"},n$1=function(T,_,E){return _===void 0&&(_=0),E===void 0&&(E=Math.pow(10,_)),Math.round(E*T)/E+0},e$1=function(T,_,E){return _===void 0&&(_=0),E===void 0&&(E=1),T>E?E:T>_?T:_},u$1=function(T){return(T=isFinite(T)?T%360:0)>0?T:T+360},a$1=function(T){return{r:e$1(T.r,0,255),g:e$1(T.g,0,255),b:e$1(T.b,0,255),a:e$1(T.a)}},o$1=function(T){return{r:n$1(T.r),g:n$1(T.g),b:n$1(T.b),a:n$1(T.a,3)}},i$1=/^#([0-9a-f]{3,8})$/i,s=function(T){var _=T.toString(16);return _.length<2?"0"+_:_},h$1=function(T){var _=T.r,E=T.g,A=T.b,R=T.a,I=Math.max(_,E,A),P=I-Math.min(_,E,A),C=P?I===_?(E-A)/P:I===E?2+(A-_)/P:4+(_-E)/P:0;return{h:60*(C<0?C+6:C),s:I?P/I*100:0,v:I/255*100,a:R}},b=function(T){var _=T.h,E=T.s,A=T.v,R=T.a;_=_/360*6,E/=100,A/=100;var I=Math.floor(_),P=A*(1-E),C=A*(1-(_-I)*E),D=A*(1-(1-_+I)*E),B=I%6;return{r:255*[A,C,P,P,D,A][B],g:255*[D,A,A,C,P,P][B],b:255*[P,P,D,A,A,C][B],a:R}},g=function(T){return{h:u$1(T.h),s:e$1(T.s,0,100),l:e$1(T.l,0,100),a:e$1(T.a)}},d=function(T){return{h:n$1(T.h),s:n$1(T.s),l:n$1(T.l),a:n$1(T.a,3)}},f$1=function(T){return b((E=(_=T).s,{h:_.h,s:(E*=((A=_.l)<50?A:100-A)/100)>0?2*E/(A+E)*100:0,v:A+E,a:_.a}));var _,E,A},c$1=function(T){return{h:(_=h$1(T)).h,s:(R=(200-(E=_.s))*(A=_.v)/100)>0&&R<200?E*A/100/(R<=100?R:200-R)*100:0,l:R/2,a:_.a};var _,E,A,R},l=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,p$1=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,y={string:[[function(T){var _=i$1.exec(T);return _?(T=_[1]).length<=4?{r:parseInt(T[0]+T[0],16),g:parseInt(T[1]+T[1],16),b:parseInt(T[2]+T[2],16),a:T.length===4?n$1(parseInt(T[3]+T[3],16)/255,2):1}:T.length===6||T.length===8?{r:parseInt(T.substr(0,2),16),g:parseInt(T.substr(2,2),16),b:parseInt(T.substr(4,2),16),a:T.length===8?n$1(parseInt(T.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(T){var _=v.exec(T)||m.exec(T);return _?_[2]!==_[4]||_[4]!==_[6]?null:a$1({r:Number(_[1])/(_[2]?100/255:1),g:Number(_[3])/(_[4]?100/255:1),b:Number(_[5])/(_[6]?100/255:1),a:_[7]===void 0?1:Number(_[7])/(_[8]?100:1)}):null},"rgb"],[function(T){var _=l.exec(T)||p$1.exec(T);if(!_)return null;var E,A,R=g({h:(E=_[1],A=_[2],A===void 0&&(A="deg"),Number(E)*(r$1[A]||1)),s:Number(_[3]),l:Number(_[4]),a:_[5]===void 0?1:Number(_[5])/(_[6]?100:1)});return f$1(R)},"hsl"]],object:[[function(T){var _=T.r,E=T.g,A=T.b,R=T.a,I=R===void 0?1:R;return t$1(_)&&t$1(E)&&t$1(A)?a$1({r:Number(_),g:Number(E),b:Number(A),a:Number(I)}):null},"rgb"],[function(T){var _=T.h,E=T.s,A=T.l,R=T.a,I=R===void 0?1:R;if(!t$1(_)||!t$1(E)||!t$1(A))return null;var P=g({h:Number(_),s:Number(E),l:Number(A),a:Number(I)});return f$1(P)},"hsl"],[function(T){var _=T.h,E=T.s,A=T.v,R=T.a,I=R===void 0?1:R;if(!t$1(_)||!t$1(E)||!t$1(A))return null;var P=function(C){return{h:u$1(C.h),s:e$1(C.s,0,100),v:e$1(C.v,0,100),a:e$1(C.a)}}({h:Number(_),s:Number(E),v:Number(A),a:Number(I)});return b(P)},"hsv"]]},N=function(T,_){for(var E=0;E<_.length;E++){var A=_[E][0](T);if(A)return[A,_[E][1]]}return[null,void 0]},x=function(T){return typeof T=="string"?N(T.trim(),y.string):typeof T=="object"&&T!==null?N(T,y.object):[null,void 0]},M=function(T,_){var E=c$1(T);return{h:E.h,s:e$1(E.s+100*_,0,100),l:E.l,a:E.a}},H=function(T){return(299*T.r+587*T.g+114*T.b)/1e3/255},$=function(T,_){var E=c$1(T);return{h:E.h,s:E.s,l:e$1(E.l+100*_,0,100),a:E.a}},j=function(){function T(_){this.parsed=x(_)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return T.prototype.isValid=function(){return this.parsed!==null},T.prototype.brightness=function(){return n$1(H(this.rgba),2)},T.prototype.isDark=function(){return H(this.rgba)<.5},T.prototype.isLight=function(){return H(this.rgba)>=.5},T.prototype.toHex=function(){return _=o$1(this.rgba),E=_.r,A=_.g,R=_.b,P=(I=_.a)<1?s(n$1(255*I)):"","#"+s(E)+s(A)+s(R)+P;var _,E,A,R,I,P},T.prototype.toRgb=function(){return o$1(this.rgba)},T.prototype.toRgbString=function(){return _=o$1(this.rgba),E=_.r,A=_.g,R=_.b,(I=_.a)<1?"rgba("+E+", "+A+", "+R+", "+I+")":"rgb("+E+", "+A+", "+R+")";var _,E,A,R,I},T.prototype.toHsl=function(){return d(c$1(this.rgba))},T.prototype.toHslString=function(){return _=d(c$1(this.rgba)),E=_.h,A=_.s,R=_.l,(I=_.a)<1?"hsla("+E+", "+A+"%, "+R+"%, "+I+")":"hsl("+E+", "+A+"%, "+R+"%)";var _,E,A,R,I},T.prototype.toHsv=function(){return _=h$1(this.rgba),{h:n$1(_.h),s:n$1(_.s),v:n$1(_.v),a:n$1(_.a,3)};var _},T.prototype.invert=function(){return w({r:255-(_=this.rgba).r,g:255-_.g,b:255-_.b,a:_.a});var _},T.prototype.saturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,_))},T.prototype.desaturate=function(_){return _===void 0&&(_=.1),w(M(this.rgba,-_))},T.prototype.grayscale=function(){return w(M(this.rgba,-1))},T.prototype.lighten=function(_){return _===void 0&&(_=.1),w($(this.rgba,_))},T.prototype.darken=function(_){return _===void 0&&(_=.1),w($(this.rgba,-_))},T.prototype.rotate=function(_){return _===void 0&&(_=15),this.hue(this.hue()+_)},T.prototype.alpha=function(_){return typeof _=="number"?w({r:(E=this.rgba).r,g:E.g,b:E.b,a:_}):n$1(this.rgba.a,3);var E},T.prototype.hue=function(_){var E=c$1(this.rgba);return typeof _=="number"?w({h:_,s:E.s,l:E.l,a:E.a}):n$1(E.h)},T.prototype.isEqual=function(_){return this.toHex()===w(_).toHex()},T}(),w=function(T){return T instanceof j?T:new j(T)},S=[],k=function(T){T.forEach(function(_){S.indexOf(_)<0&&(_(j,y),S.push(_))})},t=function(T,_,E){return _===void 0&&(_=0),E===void 0&&(E=1),T>E?E:T>_?T:_},a=function(T){var _=T/255;return _<.04045?_/12.92:Math.pow((_+.055)/1.055,2.4)},n=function(T){return 255*(T>.0031308?1.055*Math.pow(T,1/2.4)-.055:12.92*T)},r=96.422,o=100,u=82.521,e=function(T){var _,E,A={x:.9555766*(_=T).x+-.0230393*_.y+.0631636*_.z,y:-.0282895*_.x+1.0099416*_.y+.0210077*_.z,z:.0122982*_.x+-.020483*_.y+1.3299098*_.z};return E={r:n(.032404542*A.x-.015371385*A.y-.004985314*A.z),g:n(-.00969266*A.x+.018760108*A.y+41556e-8*A.z),b:n(556434e-9*A.x-.002040259*A.y+.010572252*A.z),a:T.a},{r:t(E.r,0,255),g:t(E.g,0,255),b:t(E.b,0,255),a:t(E.a)}},i=function(T){var _=a(T.r),E=a(T.g),A=a(T.b);return function(R){return{x:t(R.x,0,r),y:t(R.y,0,o),z:t(R.z,0,u),a:t(R.a)}}(function(R){return{x:1.0478112*R.x+.0228866*R.y+-.050127*R.z,y:.0295424*R.x+.9904844*R.y+-.0170491*R.z,z:-.0092345*R.x+.0150436*R.y+.7521316*R.z,a:R.a}}({x:100*(.4124564*_+.3575761*E+.1804375*A),y:100*(.2126729*_+.7151522*E+.072175*A),z:100*(.0193339*_+.119192*E+.9503041*A),a:T.a}))},p=216/24389,h=24389/27,f=function(T){var _=i(T),E=_.x/r,A=_.y/o,R=_.z/u;return E=E>p?Math.cbrt(E):(h*E+16)/116,{l:116*(A=A>p?Math.cbrt(A):(h*A+16)/116)-16,a:500*(E-A),b:200*(A-(R=R>p?Math.cbrt(R):(h*R+16)/116)),alpha:_.a}},c=function(T,_,E){var A,R=f(T),I=f(_);return function(P){var C=(P.l+16)/116,D=P.a/500+C,B=C-P.b/200;return e({x:(Math.pow(D,3)>p?Math.pow(D,3):(116*D-16)/h)*r,y:(P.l>8?Math.pow((P.l+16)/116,3):P.l/h)*o,z:(Math.pow(B,3)>p?Math.pow(B,3):(116*B-16)/h)*u,a:P.alpha})}({l:t((A={l:R.l*(1-E)+I.l*E,a:R.a*(1-E)+I.a*E,b:R.b*(1-E)+I.b*E,alpha:R.alpha*(1-E)+I.alpha*E}).l,0,400),a:A.a,b:A.b,alpha:t(A.alpha)})};function mixPlugin(T){function _(E,A,R){R===void 0&&(R=5);for(var I=[],P=1/(R-1),C=0;C<=R-1;C++)I.push(E.mix(A,P*C));return I}T.prototype.mix=function(E,A){A===void 0&&(A=.5);var R=E instanceof T?E:new T(E),I=c(this.toRgb(),R.toRgb(),A);return new T(I)},T.prototype.tints=function(E){return _(this,"#fff",E)},T.prototype.shades=function(E){return _(this,"#000",E)},T.prototype.tones=function(E){return _(this,"#808080",E)}}var ENV=(T=>(T[T.WEBGL_LEGACY=0]="WEBGL_LEGACY",T[T.WEBGL=1]="WEBGL",T[T.WEBGL2=2]="WEBGL2",T))(ENV||{}),BUFFER_BITS=(T=>(T[T.COLOR=16384]="COLOR",T[T.DEPTH=256]="DEPTH",T[T.STENCIL=1024]="STENCIL",T))(BUFFER_BITS||{}),BLEND_MODES=(T=>(T[T.NORMAL=0]="NORMAL",T[T.ADD=1]="ADD",T[T.MULTIPLY=2]="MULTIPLY",T[T.SCREEN=3]="SCREEN",T[T.OVERLAY=4]="OVERLAY",T[T.DARKEN=5]="DARKEN",T[T.LIGHTEN=6]="LIGHTEN",T[T.COLOR_DODGE=7]="COLOR_DODGE",T[T.COLOR_BURN=8]="COLOR_BURN",T[T.HARD_LIGHT=9]="HARD_LIGHT",T[T.SOFT_LIGHT=10]="SOFT_LIGHT",T[T.DIFFERENCE=11]="DIFFERENCE",T[T.EXCLUSION=12]="EXCLUSION",T[T.HUE=13]="HUE",T[T.SATURATION=14]="SATURATION",T[T.COLOR=15]="COLOR",T[T.LUMINOSITY=16]="LUMINOSITY",T[T.NORMAL_NPM=17]="NORMAL_NPM",T[T.ADD_NPM=18]="ADD_NPM",T[T.SCREEN_NPM=19]="SCREEN_NPM",T[T.NONE=20]="NONE",T[T.SRC_OVER=0]="SRC_OVER",T[T.SRC_IN=21]="SRC_IN",T[T.SRC_OUT=22]="SRC_OUT",T[T.SRC_ATOP=23]="SRC_ATOP",T[T.DST_OVER=24]="DST_OVER",T[T.DST_IN=25]="DST_IN",T[T.DST_OUT=26]="DST_OUT",T[T.DST_ATOP=27]="DST_ATOP",T[T.ERASE=26]="ERASE",T[T.SUBTRACT=28]="SUBTRACT",T[T.XOR=29]="XOR",T))(BLEND_MODES||{}),DRAW_MODES=(T=>(T[T.POINTS=0]="POINTS",T[T.LINES=1]="LINES",T[T.LINE_LOOP=2]="LINE_LOOP",T[T.LINE_STRIP=3]="LINE_STRIP",T[T.TRIANGLES=4]="TRIANGLES",T[T.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",T[T.TRIANGLE_FAN=6]="TRIANGLE_FAN",T))(DRAW_MODES||{}),FORMATS=(T=>(T[T.RGBA=6408]="RGBA",T[T.RGB=6407]="RGB",T[T.RG=33319]="RG",T[T.RED=6403]="RED",T[T.RGBA_INTEGER=36249]="RGBA_INTEGER",T[T.RGB_INTEGER=36248]="RGB_INTEGER",T[T.RG_INTEGER=33320]="RG_INTEGER",T[T.RED_INTEGER=36244]="RED_INTEGER",T[T.ALPHA=6406]="ALPHA",T[T.LUMINANCE=6409]="LUMINANCE",T[T.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",T[T.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",T[T.DEPTH_STENCIL=34041]="DEPTH_STENCIL",T))(FORMATS||{}),TARGETS=(T=>(T[T.TEXTURE_2D=3553]="TEXTURE_2D",T[T.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",T[T.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",T[T.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",T[T.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",T[T.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",T[T.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",T[T.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",T[T.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",T))(TARGETS||{}),TYPES=(T=>(T[T.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",T[T.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",T[T.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",T[T.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",T[T.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",T[T.UNSIGNED_INT=5125]="UNSIGNED_INT",T[T.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",T[T.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",T[T.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",T[T.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",T[T.BYTE=5120]="BYTE",T[T.SHORT=5122]="SHORT",T[T.INT=5124]="INT",T[T.FLOAT=5126]="FLOAT",T[T.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",T[T.HALF_FLOAT=36193]="HALF_FLOAT",T))(TYPES||{}),SAMPLER_TYPES=(T=>(T[T.FLOAT=0]="FLOAT",T[T.INT=1]="INT",T[T.UINT=2]="UINT",T))(SAMPLER_TYPES||{}),SCALE_MODES=(T=>(T[T.NEAREST=0]="NEAREST",T[T.LINEAR=1]="LINEAR",T))(SCALE_MODES||{}),WRAP_MODES=(T=>(T[T.CLAMP=33071]="CLAMP",T[T.REPEAT=10497]="REPEAT",T[T.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",T))(WRAP_MODES||{}),MIPMAP_MODES=(T=>(T[T.OFF=0]="OFF",T[T.POW2=1]="POW2",T[T.ON=2]="ON",T[T.ON_MANUAL=3]="ON_MANUAL",T))(MIPMAP_MODES||{}),ALPHA_MODES=(T=>(T[T.NPM=0]="NPM",T[T.UNPACK=1]="UNPACK",T[T.PMA=2]="PMA",T[T.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",T[T.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",T[T.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",T))(ALPHA_MODES||{}),CLEAR_MODES=(T=>(T[T.NO=0]="NO",T[T.YES=1]="YES",T[T.AUTO=2]="AUTO",T[T.BLEND=0]="BLEND",T[T.CLEAR=1]="CLEAR",T[T.BLIT=2]="BLIT",T))(CLEAR_MODES||{}),GC_MODES=(T=>(T[T.AUTO=0]="AUTO",T[T.MANUAL=1]="MANUAL",T))(GC_MODES||{}),PRECISION=(T=>(T.LOW="lowp",T.MEDIUM="mediump",T.HIGH="highp",T))(PRECISION||{}),MASK_TYPES=(T=>(T[T.NONE=0]="NONE",T[T.SCISSOR=1]="SCISSOR",T[T.STENCIL=2]="STENCIL",T[T.SPRITE=3]="SPRITE",T[T.COLOR=4]="COLOR",T))(MASK_TYPES||{}),MSAA_QUALITY=(T=>(T[T.NONE=0]="NONE",T[T.LOW=2]="LOW",T[T.MEDIUM=4]="MEDIUM",T[T.HIGH=8]="HIGH",T))(MSAA_QUALITY||{}),BUFFER_TYPE=(T=>(T[T.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",T[T.ARRAY_BUFFER=34962]="ARRAY_BUFFER",T[T.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",T))(BUFFER_TYPE||{});const BrowserAdapter={createCanvas:(T,_)=>{const E=document.createElement("canvas");return E.width=T,E.height=_,E},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var T;return(T=document.baseURI)!=null?T:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(T,_)=>fetch(T,_)};var appleIphone=/iPhone/i,appleIpod=/iPod/i,appleTablet=/iPad/i,appleUniversal=/\biOS-universal(?:.+)Mac\b/i,androidPhone=/\bAndroid(?:.+)Mobile\b/i,androidTablet=/Android/i,amazonPhone=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,amazonTablet=/Silk/i,windowsPhone=/Windows Phone/i,windowsTablet=/\bWindows(?:.+)ARM\b/i,otherBlackBerry=/BlackBerry/i,otherBlackBerry10=/BB10/i,otherOpera=/Opera Mini/i,otherChrome=/\b(CriOS|Chrome)(?:.+)Mobile/i,otherFirefox=/Mobile(?:.+)Firefox\b/i,isAppleTabletOnIos13=function(T){return typeof T<"u"&&T.platform==="MacIntel"&&typeof T.maxTouchPoints=="number"&&T.maxTouchPoints>1&&typeof MSStream>"u"};function createMatch(T){return function(_){return _.test(T)}}function isMobile$1(T){var _={userAgent:"",platform:"",maxTouchPoints:0};!T&&typeof navigator<"u"?_={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof T=="string"?_.userAgent=T:T&&T.userAgent&&(_={userAgent:T.userAgent,platform:T.platform,maxTouchPoints:T.maxTouchPoints||0});var E=_.userAgent,A=E.split("[FBAN");typeof A[1]<"u"&&(E=A[0]),A=E.split("Twitter"),typeof A[1]<"u"&&(E=A[0]);var R=createMatch(E),I={apple:{phone:R(appleIphone)&&!R(windowsPhone),ipod:R(appleIpod),tablet:!R(appleIphone)&&(R(appleTablet)||isAppleTabletOnIos13(_))&&!R(windowsPhone),universal:R(appleUniversal),device:(R(appleIphone)||R(appleIpod)||R(appleTablet)||R(appleUniversal)||isAppleTabletOnIos13(_))&&!R(windowsPhone)},amazon:{phone:R(amazonPhone),tablet:!R(amazonPhone)&&R(amazonTablet),device:R(amazonPhone)||R(amazonTablet)},android:{phone:!R(windowsPhone)&&R(amazonPhone)||!R(windowsPhone)&&R(androidPhone),tablet:!R(windowsPhone)&&!R(amazonPhone)&&!R(androidPhone)&&(R(amazonTablet)||R(androidTablet)),device:!R(windowsPhone)&&(R(amazonPhone)||R(amazonTablet)||R(androidPhone)||R(androidTablet))||R(/\bokhttp\b/i)},windows:{phone:R(windowsPhone),tablet:R(windowsTablet),device:R(windowsPhone)||R(windowsTablet)},other:{blackberry:R(otherBlackBerry),blackberry10:R(otherBlackBerry10),opera:R(otherOpera),firefox:R(otherFirefox),chrome:R(otherChrome),device:R(otherBlackBerry)||R(otherBlackBerry10)||R(otherOpera)||R(otherFirefox)||R(otherChrome)},any:!1,phone:!1,tablet:!1};return I.any=I.apple.device||I.android.device||I.windows.device||I.other.device,I.phone=I.apple.phone||I.android.phone||I.windows.phone,I.tablet=I.apple.tablet||I.android.tablet||I.windows.tablet,I}const isMobile=isMobile$1(globalThis.navigator);function canUploadSameBuffer(){return!isMobile.apple.device}function maxRecommendedTextures(T){let _=!0;if(isMobile.tablet||isMobile.phone){if(isMobile.apple.device){const E=navigator.userAgent.match(/OS (\d+)_(\d+)?/);E&&parseInt(E[1],10)<11&&(_=!1)}if(isMobile.android.device){const E=navigator.userAgent.match(/Android\s([0-9.]*)/);E&&parseInt(E[1],10)<7&&(_=!1)}}return _?T:4}const settings={ADAPTER:BrowserAdapter,MIPMAP_TEXTURES:MIPMAP_MODES.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:MSAA_QUALITY.NONE,SPRITE_MAX_TEXTURES:maxRecommendedTextures(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:GC_MODES.AUTO,GC_MAX_IDLE:60*60,GC_MAX_CHECK_COUNT:60*10,WRAP_MODE:WRAP_MODES.CLAMP,SCALE_MODE:SCALE_MODES.LINEAR,PRECISION_VERTEX:PRECISION.HIGH,PRECISION_FRAGMENT:isMobile.apple.device?PRECISION.HIGH:PRECISION.MEDIUM,CAN_UPLOAD_SAME_BUFFER:canUploadSameBuffer(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};settings.PREFER_ENV=ENV.WEBGL2;settings.STRICT_TEXTURE_CACHE=!1;var ExtensionType=(T=>(T.Renderer="renderer",T.Application="application",T.RendererSystem="renderer-webgl-system",T.RendererPlugin="renderer-webgl-plugin",T.CanvasRendererSystem="renderer-canvas-system",T.CanvasRendererPlugin="renderer-canvas-plugin",T.Asset="asset",T.LoadParser="load-parser",T.ResolveParser="resolve-parser",T.CacheParser="cache-parser",T.DetectionParser="detection-parser",T))(ExtensionType||{});const normalizeExtension=T=>{if((typeof T=="function"||typeof T=="object"&&T.extension)&&(T={...typeof T.extension!="object"?{type:T.extension}:T.extension,ref:T}),typeof T=="object")T={...T};else throw new Error("Invalid extension type");return typeof T.type=="string"&&(T.type=[T.type]),T},extensions$1={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...T){return T.map(normalizeExtension).forEach(_=>{_.type.forEach(E=>{var A,R;return(R=(A=this._removeHandlers)[E])==null?void 0:R.call(A,_)})}),this},add(...T){return T.map(normalizeExtension).forEach(_=>{_.type.forEach(E=>{const A=this._addHandlers,R=this._queue;A[E]?A[E](_):(R[E]=R[E]||[],R[E].push(_))})}),this},handle(T,_,E){const A=this._addHandlers,R=this._removeHandlers;A[T]=_,R[T]=E;const I=this._queue;return I[T]&&(I[T].forEach(P=>_(P)),delete I[T]),this},handleByMap(T,_){return this.handle(T,E=>{_[E.name]=E.ref},E=>{delete _[E.name]})},handleByList(T,_){return this.handle(T,E=>{_.includes(E.ref)||(_.push(E.ref),_.sort((A,R)=>{var I,P;return((I=R.priority)!=null?I:-1)-((P=A.priority)!=null?P:-1)}))},E=>{const A=_.indexOf(E.ref);A!==-1&&_.splice(A,1)})}},PI_2=Math.PI*2,RAD_TO_DEG=180/Math.PI,DEG_TO_RAD=Math.PI/180;var SHAPES=(T=>(T[T.POLY=0]="POLY",T[T.RECT=1]="RECT",T[T.CIRC=2]="CIRC",T[T.ELIP=3]="ELIP",T[T.RREC=4]="RREC",T))(SHAPES||{});class Point{constructor(_=0,E=0){this.x=0,this.y=0,this.x=_,this.y=E}clone(){return new Point(this.x,this.y)}copyFrom(_){return this.set(_.x,_.y),this}copyTo(_){return _.set(this.x,this.y),_}equals(_){return _.x===this.x&&_.y===this.y}set(_=0,E=_){return this.x=_,this.y=E,this}}const tempPoints$1=[new Point,new Point,new Point,new Point];class Rectangle{constructor(_=0,E=0,A=0,R=0){this.x=Number(_),this.y=Number(E),this.width=Number(A),this.height=Number(R),this.type=SHAPES.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Rectangle(0,0,0,0)}clone(){return new Rectangle(this.x,this.y,this.width,this.height)}copyFrom(_){return this.x=_.x,this.y=_.y,this.width=_.width,this.height=_.height,this}copyTo(_){return _.x=this.x,_.y=this.y,_.width=this.width,_.height=this.height,_}contains(_,E){return this.width<=0||this.height<=0?!1:_>=this.x&&_<this.x+this.width&&E>=this.y&&E<this.y+this.height}intersects(_,E){if(!E){const Q=this.x<_.x?_.x:this.x;if((this.right>_.right?_.right:this.right)<=Q)return!1;const at=this.y<_.y?_.y:this.y;return(this.bottom>_.bottom?_.bottom:this.bottom)>at}const A=this.left,R=this.right,I=this.top,P=this.bottom;if(R<=A||P<=I)return!1;const C=tempPoints$1[0].set(_.left,_.top),D=tempPoints$1[1].set(_.left,_.bottom),B=tempPoints$1[2].set(_.right,_.top),O=tempPoints$1[3].set(_.right,_.bottom);if(B.x<=C.x||D.y<=C.y)return!1;const F=Math.sign(E.a*E.d-E.b*E.c);if(F===0||(E.apply(C,C),E.apply(D,D),E.apply(B,B),E.apply(O,O),Math.max(C.x,D.x,B.x,O.x)<=A||Math.min(C.x,D.x,B.x,O.x)>=R||Math.max(C.y,D.y,B.y,O.y)<=I||Math.min(C.y,D.y,B.y,O.y)>=P))return!1;const L=F*(D.y-C.y),U=F*(C.x-D.x),G=L*A+U*I,X=L*R+U*I,W=L*A+U*P,V=L*R+U*P;if(Math.max(G,X,W,V)<=L*C.x+U*C.y||Math.min(G,X,W,V)>=L*O.x+U*O.y)return!1;const q=F*(C.y-B.y),z=F*(B.x-C.x),Y=q*A+z*I,K=q*R+z*I,it=q*A+z*P,et=q*R+z*P;return!(Math.max(Y,K,it,et)<=q*C.x+z*C.y||Math.min(Y,K,it,et)>=q*O.x+z*O.y)}pad(_=0,E=_){return this.x-=_,this.y-=E,this.width+=_*2,this.height+=E*2,this}fit(_){const E=Math.max(this.x,_.x),A=Math.min(this.x+this.width,_.x+_.width),R=Math.max(this.y,_.y),I=Math.min(this.y+this.height,_.y+_.height);return this.x=E,this.width=Math.max(A-E,0),this.y=R,this.height=Math.max(I-R,0),this}ceil(_=1,E=.001){const A=Math.ceil((this.x+this.width-E)*_)/_,R=Math.ceil((this.y+this.height-E)*_)/_;return this.x=Math.floor((this.x+E)*_)/_,this.y=Math.floor((this.y+E)*_)/_,this.width=A-this.x,this.height=R-this.y,this}enlarge(_){const E=Math.min(this.x,_.x),A=Math.max(this.x+this.width,_.x+_.width),R=Math.min(this.y,_.y),I=Math.max(this.y+this.height,_.y+_.height);return this.x=E,this.width=A-E,this.y=R,this.height=I-R,this}}class Circle{constructor(_=0,E=0,A=0){this.x=_,this.y=E,this.radius=A,this.type=SHAPES.CIRC}clone(){return new Circle(this.x,this.y,this.radius)}contains(_,E){if(this.radius<=0)return!1;const A=this.radius*this.radius;let R=this.x-_,I=this.y-E;return R*=R,I*=I,R+I<=A}getBounds(){return new Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}class Ellipse{constructor(_=0,E=0,A=0,R=0){this.x=_,this.y=E,this.width=A,this.height=R,this.type=SHAPES.ELIP}clone(){return new Ellipse(this.x,this.y,this.width,this.height)}contains(_,E){if(this.width<=0||this.height<=0)return!1;let A=(_-this.x)/this.width,R=(E-this.y)/this.height;return A*=A,R*=R,A+R<=1}getBounds(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}}class Polygon{constructor(..._){let E=Array.isArray(_[0])?_[0]:_;if(typeof E[0]!="number"){const A=[];for(let R=0,I=E.length;R<I;R++)A.push(E[R].x,E[R].y);E=A}this.points=E,this.type=SHAPES.POLY,this.closeStroke=!0}clone(){const _=this.points.slice(),E=new Polygon(_);return E.closeStroke=this.closeStroke,E}contains(_,E){let A=!1;const R=this.points.length/2;for(let I=0,P=R-1;I<R;P=I++){const C=this.points[I*2],D=this.points[I*2+1],B=this.points[P*2],O=this.points[P*2+1];D>E!=O>E&&_<(B-C)*((E-D)/(O-D))+C&&(A=!A)}return A}}class RoundedRectangle{constructor(_=0,E=0,A=0,R=0,I=20){this.x=_,this.y=E,this.width=A,this.height=R,this.radius=I,this.type=SHAPES.RREC}clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}contains(_,E){if(this.width<=0||this.height<=0)return!1;if(_>=this.x&&_<=this.x+this.width&&E>=this.y&&E<=this.y+this.height){const A=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(E>=this.y+A&&E<=this.y+this.height-A||_>=this.x+A&&_<=this.x+this.width-A)return!0;let R=_-(this.x+A),I=E-(this.y+A);const P=A*A;if(R*R+I*I<=P||(R=_-(this.x+this.width-A),R*R+I*I<=P)||(I=E-(this.y+this.height-A),R*R+I*I<=P)||(R=_-(this.x+A),R*R+I*I<=P))return!0}return!1}}class ObservablePoint{constructor(_,E,A=0,R=0){this._x=A,this._y=R,this.cb=_,this.scope=E}clone(_=this.cb,E=this.scope){return new ObservablePoint(_,E,this._x,this._y)}set(_=0,E=_){return(this._x!==_||this._y!==E)&&(this._x=_,this._y=E,this.cb.call(this.scope)),this}copyFrom(_){return(this._x!==_.x||this._y!==_.y)&&(this._x=_.x,this._y=_.y,this.cb.call(this.scope)),this}copyTo(_){return _.set(this._x,this._y),_}equals(_){return _.x===this._x&&_.y===this._y}get x(){return this._x}set x(_){this._x!==_&&(this._x=_,this.cb.call(this.scope))}get y(){return this._y}set y(_){this._y!==_&&(this._y=_,this.cb.call(this.scope))}}class Matrix{constructor(_=1,E=0,A=0,R=1,I=0,P=0){this.array=null,this.a=_,this.b=E,this.c=A,this.d=R,this.tx=I,this.ty=P}fromArray(_){this.a=_[0],this.b=_[1],this.c=_[3],this.d=_[4],this.tx=_[2],this.ty=_[5]}set(_,E,A,R,I,P){return this.a=_,this.b=E,this.c=A,this.d=R,this.tx=I,this.ty=P,this}toArray(_,E){this.array||(this.array=new Float32Array(9));const A=E||this.array;return _?(A[0]=this.a,A[1]=this.b,A[2]=0,A[3]=this.c,A[4]=this.d,A[5]=0,A[6]=this.tx,A[7]=this.ty,A[8]=1):(A[0]=this.a,A[1]=this.c,A[2]=this.tx,A[3]=this.b,A[4]=this.d,A[5]=this.ty,A[6]=0,A[7]=0,A[8]=1),A}apply(_,E){E=E||new Point;const A=_.x,R=_.y;return E.x=this.a*A+this.c*R+this.tx,E.y=this.b*A+this.d*R+this.ty,E}applyInverse(_,E){E=E||new Point;const A=1/(this.a*this.d+this.c*-this.b),R=_.x,I=_.y;return E.x=this.d*A*R+-this.c*A*I+(this.ty*this.c-this.tx*this.d)*A,E.y=this.a*A*I+-this.b*A*R+(-this.ty*this.a+this.tx*this.b)*A,E}translate(_,E){return this.tx+=_,this.ty+=E,this}scale(_,E){return this.a*=_,this.d*=E,this.c*=_,this.b*=E,this.tx*=_,this.ty*=E,this}rotate(_){const E=Math.cos(_),A=Math.sin(_),R=this.a,I=this.c,P=this.tx;return this.a=R*E-this.b*A,this.b=R*A+this.b*E,this.c=I*E-this.d*A,this.d=I*A+this.d*E,this.tx=P*E-this.ty*A,this.ty=P*A+this.ty*E,this}append(_){const E=this.a,A=this.b,R=this.c,I=this.d;return this.a=_.a*E+_.b*R,this.b=_.a*A+_.b*I,this.c=_.c*E+_.d*R,this.d=_.c*A+_.d*I,this.tx=_.tx*E+_.ty*R+this.tx,this.ty=_.tx*A+_.ty*I+this.ty,this}setTransform(_,E,A,R,I,P,C,D,B){return this.a=Math.cos(C+B)*I,this.b=Math.sin(C+B)*I,this.c=-Math.sin(C-D)*P,this.d=Math.cos(C-D)*P,this.tx=_-(A*this.a+R*this.c),this.ty=E-(A*this.b+R*this.d),this}prepend(_){const E=this.tx;if(_.a!==1||_.b!==0||_.c!==0||_.d!==1){const A=this.a,R=this.c;this.a=A*_.a+this.b*_.c,this.b=A*_.b+this.b*_.d,this.c=R*_.a+this.d*_.c,this.d=R*_.b+this.d*_.d}return this.tx=E*_.a+this.ty*_.c+_.tx,this.ty=E*_.b+this.ty*_.d+_.ty,this}decompose(_){const E=this.a,A=this.b,R=this.c,I=this.d,P=_.pivot,C=-Math.atan2(-R,I),D=Math.atan2(A,E),B=Math.abs(C+D);return B<1e-5||Math.abs(PI_2-B)<1e-5?(_.rotation=D,_.skew.x=_.skew.y=0):(_.rotation=0,_.skew.x=C,_.skew.y=D),_.scale.x=Math.sqrt(E*E+A*A),_.scale.y=Math.sqrt(R*R+I*I),_.position.x=this.tx+(P.x*E+P.y*R),_.position.y=this.ty+(P.x*A+P.y*I),_}invert(){const _=this.a,E=this.b,A=this.c,R=this.d,I=this.tx,P=_*R-E*A;return this.a=R/P,this.b=-E/P,this.c=-A/P,this.d=_/P,this.tx=(A*this.ty-R*I)/P,this.ty=-(_*this.ty-E*I)/P,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const _=new Matrix;return _.a=this.a,_.b=this.b,_.c=this.c,_.d=this.d,_.tx=this.tx,_.ty=this.ty,_}copyTo(_){return _.a=this.a,_.b=this.b,_.c=this.c,_.d=this.d,_.tx=this.tx,_.ty=this.ty,_}copyFrom(_){return this.a=_.a,this.b=_.b,this.c=_.c,this.d=_.d,this.tx=_.tx,this.ty=_.ty,this}static get IDENTITY(){return new Matrix}static get TEMP_MATRIX(){return new Matrix}}const ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],rotationCayley=[],rotationMatrices=[],signum=Math.sign;function init(){for(let T=0;T<16;T++){const _=[];rotationCayley.push(_);for(let E=0;E<16;E++){const A=signum(ux[T]*ux[E]+vx[T]*uy[E]),R=signum(uy[T]*ux[E]+vy[T]*uy[E]),I=signum(ux[T]*vx[E]+vx[T]*vy[E]),P=signum(uy[T]*vx[E]+vy[T]*vy[E]);for(let C=0;C<16;C++)if(ux[C]===A&&uy[C]===R&&vx[C]===I&&vy[C]===P){_.push(C);break}}}for(let T=0;T<16;T++){const _=new Matrix;_.set(ux[T],uy[T],vx[T],vy[T],0,0),rotationMatrices.push(_)}}init();const groupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:T=>ux[T],uY:T=>uy[T],vX:T=>vx[T],vY:T=>vy[T],inv:T=>T&8?T&15:-T&7,add:(T,_)=>rotationCayley[T][_],sub:(T,_)=>rotationCayley[T][groupD8.inv(_)],rotate180:T=>T^4,isVertical:T=>(T&3)===2,byDirection:(T,_)=>Math.abs(T)*2<=Math.abs(_)?_>=0?groupD8.S:groupD8.N:Math.abs(_)*2<=Math.abs(T)?T>0?groupD8.E:groupD8.W:_>0?T>0?groupD8.SE:groupD8.SW:T>0?groupD8.NE:groupD8.NW,matrixAppendRotationInv:(T,_,E=0,A=0)=>{const R=rotationMatrices[groupD8.inv(_)];R.tx=E,R.ty=A,T.append(R)}},_Transform=class{constructor(){this.worldTransform=new Matrix,this.localTransform=new Matrix,this.position=new ObservablePoint(this.onChange,this,0,0),this.scale=new ObservablePoint(this.onChange,this,1,1),this.pivot=new ObservablePoint(this.onChange,this,0,0),this.skew=new ObservablePoint(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const T=this.localTransform;this._localID!==this._currentLocalID&&(T.a=this._cx*this.scale.x,T.b=this._sx*this.scale.x,T.c=this._cy*this.scale.y,T.d=this._sy*this.scale.y,T.tx=this.position.x-(this.pivot.x*T.a+this.pivot.y*T.c),T.ty=this.position.y-(this.pivot.x*T.b+this.pivot.y*T.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(T){const _=this.localTransform;if(this._localID!==this._currentLocalID&&(_.a=this._cx*this.scale.x,_.b=this._sx*this.scale.x,_.c=this._cy*this.scale.y,_.d=this._sy*this.scale.y,_.tx=this.position.x-(this.pivot.x*_.a+this.pivot.y*_.c),_.ty=this.position.y-(this.pivot.x*_.b+this.pivot.y*_.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==T._worldID){const E=T.worldTransform,A=this.worldTransform;A.a=_.a*E.a+_.b*E.c,A.b=_.a*E.b+_.b*E.d,A.c=_.c*E.a+_.d*E.c,A.d=_.c*E.b+_.d*E.d,A.tx=_.tx*E.a+_.ty*E.c+E.tx,A.ty=_.tx*E.b+_.ty*E.d+E.ty,this._parentID=T._worldID,this._worldID++}}setFromMatrix(T){T.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(T){this._rotation!==T&&(this._rotation=T,this.updateSkew())}};let Transform=_Transform;Transform.IDENTITY=new _Transform;class Runner{constructor(_){this.items=[],this._name=_,this._aliasCount=0}emit(_,E,A,R,I,P,C,D){if(arguments.length>8)throw new Error("max arguments reached");const{name:B,items:O}=this;this._aliasCount++;for(let F=0,L=O.length;F<L;F++)O[F][B](_,E,A,R,I,P,C,D);return O===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(_){return _[this._name]&&(this.ensureNonAliasedItems(),this.remove(_),this.items.push(_)),this}remove(_){const E=this.items.indexOf(_);return E!==-1&&(this.ensureNonAliasedItems(),this.items.splice(E,1)),this}contains(_){return this.items.includes(_)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Runner.prototype,{dispatch:{value:Runner.prototype.emit},run:{value:Runner.prototype.emit}});settings.TARGET_FPMS=.06;var UPDATE_PRIORITY=(T=>(T[T.HIGH=25]="HIGH",T[T.NORMAL=0]="NORMAL",T[T.LOW=-25]="LOW",T[T.UTILITY=-50]="UTILITY",T))(UPDATE_PRIORITY||{});class TickerListener{constructor(_,E=null,A=0,R=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=_,this.context=E,this.priority=A,this.once=R}match(_,E=null){return this.fn===_&&this.context===E}emit(_){this.fn&&(this.context?this.fn.call(this.context,_):this.fn(_));const E=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),E}connect(_){this.previous=_,_.next&&(_.next.previous=this),this.next=_.next,_.next=this}destroy(_=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const E=this.next;return this.next=_?null:E,this.previous=null,E}}class Ticker{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new TickerListener(null,null,1/0),this.deltaMS=1/settings.TARGET_FPMS,this.elapsedMS=1/settings.TARGET_FPMS,this._tick=_=>{this._requestId=null,this.started&&(this.update(_),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(_,E,A=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(_,E,A))}addOnce(_,E,A=UPDATE_PRIORITY.NORMAL){return this._addListener(new TickerListener(_,E,A,!0))}_addListener(_){let E=this._head.next,A=this._head;if(!E)_.connect(A);else{for(;E;){if(_.priority>E.priority){_.connect(A);break}A=E,E=E.next}_.previous||_.connect(A)}return this._startIfPossible(),this}remove(_,E){let A=this._head.next;for(;A;)A.match(_,E)?A=A.destroy():A=A.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let _=0,E=this._head;for(;E=E.next;)_++;return _}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let _=this._head.next;for(;_;)_=_.destroy(!0);this._head.destroy(),this._head=null}}update(_=performance.now()){let E;if(_>this.lastTime){if(E=this.elapsedMS=_-this.lastTime,E>this._maxElapsedMS&&(E=this._maxElapsedMS),E*=this.speed,this._minElapsedMS){const I=_-this._lastFrame|0;if(I<this._minElapsedMS)return;this._lastFrame=_-I%this._minElapsedMS}this.deltaMS=E,this.deltaTime=this.deltaMS*settings.TARGET_FPMS;const A=this._head;let R=A.next;for(;R;)R=R.emit(this.deltaTime);A.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=_}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(_){const E=Math.min(this.maxFPS,_),A=Math.min(Math.max(0,E)/1e3,settings.TARGET_FPMS);this._maxElapsedMS=1/A}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(_){if(_===0)this._minElapsedMS=0;else{const E=Math.max(this.minFPS,_);this._minElapsedMS=1/(E/1e3)}}static get shared(){if(!Ticker._shared){const _=Ticker._shared=new Ticker;_.autoStart=!0,_._protected=!0}return Ticker._shared}static get system(){if(!Ticker._system){const _=Ticker._system=new Ticker;_.autoStart=!0,_._protected=!0}return Ticker._system}}class TickerPlugin{static init(_){_=Object.assign({autoStart:!0,sharedTicker:!1},_),Object.defineProperty(this,"ticker",{set(E){this._ticker&&this._ticker.remove(this.render,this),this._ticker=E,E&&E.add(this.render,this,UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=_.sharedTicker?Ticker.shared:new Ticker,_.autoStart&&this.start()}static destroy(){if(this._ticker){const _=this._ticker;this.ticker=null,_.destroy()}}}TickerPlugin.extension=ExtensionType.Application;extensions$1.add(TickerPlugin);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},eventemitter3={exports:{}};(function(T){var _=Object.prototype.hasOwnProperty,E="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(E=!1));function R(D,B,O){this.fn=D,this.context=B,this.once=O||!1}function I(D,B,O,F,L){if(typeof O!="function")throw new TypeError("The listener must be a function");var U=new R(O,F||D,L),G=E?E+B:B;return D._events[G]?D._events[G].fn?D._events[G]=[D._events[G],U]:D._events[G].push(U):(D._events[G]=U,D._eventsCount++),D}function P(D,B){--D._eventsCount===0?D._events=new A:delete D._events[B]}function C(){this._events=new A,this._eventsCount=0}C.prototype.eventNames=function(){var B=[],O,F;if(this._eventsCount===0)return B;for(F in O=this._events)_.call(O,F)&&B.push(E?F.slice(1):F);return Object.getOwnPropertySymbols?B.concat(Object.getOwnPropertySymbols(O)):B},C.prototype.listeners=function(B){var O=E?E+B:B,F=this._events[O];if(!F)return[];if(F.fn)return[F.fn];for(var L=0,U=F.length,G=new Array(U);L<U;L++)G[L]=F[L].fn;return G},C.prototype.listenerCount=function(B){var O=E?E+B:B,F=this._events[O];return F?F.fn?1:F.length:0},C.prototype.emit=function(B,O,F,L,U,G){var X=E?E+B:B;if(!this._events[X])return!1;var W=this._events[X],V=arguments.length,q,z;if(W.fn){switch(W.once&&this.removeListener(B,W.fn,void 0,!0),V){case 1:return W.fn.call(W.context),!0;case 2:return W.fn.call(W.context,O),!0;case 3:return W.fn.call(W.context,O,F),!0;case 4:return W.fn.call(W.context,O,F,L),!0;case 5:return W.fn.call(W.context,O,F,L,U),!0;case 6:return W.fn.call(W.context,O,F,L,U,G),!0}for(z=1,q=new Array(V-1);z<V;z++)q[z-1]=arguments[z];W.fn.apply(W.context,q)}else{var Y=W.length,K;for(z=0;z<Y;z++)switch(W[z].once&&this.removeListener(B,W[z].fn,void 0,!0),V){case 1:W[z].fn.call(W[z].context);break;case 2:W[z].fn.call(W[z].context,O);break;case 3:W[z].fn.call(W[z].context,O,F);break;case 4:W[z].fn.call(W[z].context,O,F,L);break;default:if(!q)for(K=1,q=new Array(V-1);K<V;K++)q[K-1]=arguments[K];W[z].fn.apply(W[z].context,q)}}return!0},C.prototype.on=function(B,O,F){return I(this,B,O,F,!1)},C.prototype.once=function(B,O,F){return I(this,B,O,F,!0)},C.prototype.removeListener=function(B,O,F,L){var U=E?E+B:B;if(!this._events[U])return this;if(!O)return P(this,U),this;var G=this._events[U];if(G.fn)G.fn===O&&(!L||G.once)&&(!F||G.context===F)&&P(this,U);else{for(var X=0,W=[],V=G.length;X<V;X++)(G[X].fn!==O||L&&!G[X].once||F&&G[X].context!==F)&&W.push(G[X]);W.length?this._events[U]=W.length===1?W[0]:W:P(this,U)}return this},C.prototype.removeAllListeners=function(B){var O;return B?(O=E?E+B:B,this._events[O]&&P(this,O)):(this._events=new A,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=E,C.EventEmitter=C,T.exports=C})(eventemitter3);const EventEmitter$1=eventemitter3.exports;var earcut$1={exports:{}};earcut$1.exports=earcut;earcut$1.exports.default=earcut;function earcut(T,_,E){E=E||2;var A=_&&_.length,R=A?_[0]*E:T.length,I=linkedList(T,0,R,E,!0),P=[];if(!I||I.next===I.prev)return P;var C,D,B,O,F,L,U;if(A&&(I=eliminateHoles(T,_,I,E)),T.length>80*E){C=B=T[0],D=O=T[1];for(var G=E;G<R;G+=E)F=T[G],L=T[G+1],F<C&&(C=F),L<D&&(D=L),F>B&&(B=F),L>O&&(O=L);U=Math.max(B-C,O-D),U=U!==0?32767/U:0}return earcutLinked(I,P,E,C,D,U,0),P}function linkedList(T,_,E,A,R){var I,P;if(R===signedArea(T,_,E,A)>0)for(I=_;I<E;I+=A)P=insertNode(I,T[I],T[I+1],P);else for(I=E-A;I>=_;I-=A)P=insertNode(I,T[I],T[I+1],P);return P&&equals(P,P.next)&&(removeNode(P),P=P.next),P}function filterPoints(T,_){if(!T)return T;_||(_=T);var E=T,A;do if(A=!1,!E.steiner&&(equals(E,E.next)||area(E.prev,E,E.next)===0)){if(removeNode(E),E=_=E.prev,E===E.next)break;A=!0}else E=E.next;while(A||E!==_);return _}function earcutLinked(T,_,E,A,R,I,P){if(!!T){!P&&I&&indexCurve(T,A,R,I);for(var C=T,D,B;T.prev!==T.next;){if(D=T.prev,B=T.next,I?isEarHashed(T,A,R,I):isEar(T)){_.push(D.i/E|0),_.push(T.i/E|0),_.push(B.i/E|0),removeNode(T),T=B.next,C=B.next;continue}if(T=B,T===C){P?P===1?(T=cureLocalIntersections(filterPoints(T),_,E),earcutLinked(T,_,E,A,R,I,2)):P===2&&splitEarcut(T,_,E,A,R,I):earcutLinked(filterPoints(T),_,E,A,R,I,1);break}}}}function isEar(T){var _=T.prev,E=T,A=T.next;if(area(_,E,A)>=0)return!1;for(var R=_.x,I=E.x,P=A.x,C=_.y,D=E.y,B=A.y,O=R<I?R<P?R:P:I<P?I:P,F=C<D?C<B?C:B:D<B?D:B,L=R>I?R>P?R:P:I>P?I:P,U=C>D?C>B?C:B:D>B?D:B,G=A.next;G!==_;){if(G.x>=O&&G.x<=L&&G.y>=F&&G.y<=U&&pointInTriangle(R,C,I,D,P,B,G.x,G.y)&&area(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function isEarHashed(T,_,E,A){var R=T.prev,I=T,P=T.next;if(area(R,I,P)>=0)return!1;for(var C=R.x,D=I.x,B=P.x,O=R.y,F=I.y,L=P.y,U=C<D?C<B?C:B:D<B?D:B,G=O<F?O<L?O:L:F<L?F:L,X=C>D?C>B?C:B:D>B?D:B,W=O>F?O>L?O:L:F>L?F:L,V=zOrder(U,G,_,E,A),q=zOrder(X,W,_,E,A),z=T.prevZ,Y=T.nextZ;z&&z.z>=V&&Y&&Y.z<=q;){if(z.x>=U&&z.x<=X&&z.y>=G&&z.y<=W&&z!==R&&z!==P&&pointInTriangle(C,O,D,F,B,L,z.x,z.y)&&area(z.prev,z,z.next)>=0||(z=z.prevZ,Y.x>=U&&Y.x<=X&&Y.y>=G&&Y.y<=W&&Y!==R&&Y!==P&&pointInTriangle(C,O,D,F,B,L,Y.x,Y.y)&&area(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;z&&z.z>=V;){if(z.x>=U&&z.x<=X&&z.y>=G&&z.y<=W&&z!==R&&z!==P&&pointInTriangle(C,O,D,F,B,L,z.x,z.y)&&area(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;Y&&Y.z<=q;){if(Y.x>=U&&Y.x<=X&&Y.y>=G&&Y.y<=W&&Y!==R&&Y!==P&&pointInTriangle(C,O,D,F,B,L,Y.x,Y.y)&&area(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function cureLocalIntersections(T,_,E){var A=T;do{var R=A.prev,I=A.next.next;!equals(R,I)&&intersects(R,A,A.next,I)&&locallyInside(R,I)&&locallyInside(I,R)&&(_.push(R.i/E|0),_.push(A.i/E|0),_.push(I.i/E|0),removeNode(A),removeNode(A.next),A=T=I),A=A.next}while(A!==T);return filterPoints(A)}function splitEarcut(T,_,E,A,R,I){var P=T;do{for(var C=P.next.next;C!==P.prev;){if(P.i!==C.i&&isValidDiagonal(P,C)){var D=splitPolygon(P,C);P=filterPoints(P,P.next),D=filterPoints(D,D.next),earcutLinked(P,_,E,A,R,I,0),earcutLinked(D,_,E,A,R,I,0);return}C=C.next}P=P.next}while(P!==T)}function eliminateHoles(T,_,E,A){var R=[],I,P,C,D,B;for(I=0,P=_.length;I<P;I++)C=_[I]*A,D=I<P-1?_[I+1]*A:T.length,B=linkedList(T,C,D,A,!1),B===B.next&&(B.steiner=!0),R.push(getLeftmost(B));for(R.sort(compareX),I=0;I<R.length;I++)E=eliminateHole(R[I],E);return E}function compareX(T,_){return T.x-_.x}function eliminateHole(T,_){var E=findHoleBridge(T,_);if(!E)return _;var A=splitPolygon(E,T);return filterPoints(A,A.next),filterPoints(E,E.next)}function findHoleBridge(T,_){var E=_,A=T.x,R=T.y,I=-1/0,P;do{if(R<=E.y&&R>=E.next.y&&E.next.y!==E.y){var C=E.x+(R-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(C<=A&&C>I&&(I=C,P=E.x<E.next.x?E:E.next,C===A))return P}E=E.next}while(E!==_);if(!P)return null;var D=P,B=P.x,O=P.y,F=1/0,L;E=P;do A>=E.x&&E.x>=B&&A!==E.x&&pointInTriangle(R<O?A:I,R,B,O,R<O?I:A,R,E.x,E.y)&&(L=Math.abs(R-E.y)/(A-E.x),locallyInside(E,T)&&(L<F||L===F&&(E.x>P.x||E.x===P.x&&sectorContainsSector(P,E)))&&(P=E,F=L)),E=E.next;while(E!==D);return P}function sectorContainsSector(T,_){return area(T.prev,T,_.prev)<0&&area(_.next,T,T.next)<0}function indexCurve(T,_,E,A){var R=T;do R.z===0&&(R.z=zOrder(R.x,R.y,_,E,A)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==T);R.prevZ.nextZ=null,R.prevZ=null,sortLinked(R)}function sortLinked(T){var _,E,A,R,I,P,C,D,B=1;do{for(E=T,T=null,I=null,P=0;E;){for(P++,A=E,C=0,_=0;_<B&&(C++,A=A.nextZ,!!A);_++);for(D=B;C>0||D>0&&A;)C!==0&&(D===0||!A||E.z<=A.z)?(R=E,E=E.nextZ,C--):(R=A,A=A.nextZ,D--),I?I.nextZ=R:T=R,R.prevZ=I,I=R;E=A}I.nextZ=null,B*=2}while(P>1);return T}function zOrder(T,_,E,A,R){return T=(T-E)*R|0,_=(_-A)*R|0,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,_=(_|_<<8)&16711935,_=(_|_<<4)&252645135,_=(_|_<<2)&858993459,_=(_|_<<1)&1431655765,T|_<<1}function getLeftmost(T){var _=T,E=T;do(_.x<E.x||_.x===E.x&&_.y<E.y)&&(E=_),_=_.next;while(_!==T);return E}function pointInTriangle(T,_,E,A,R,I,P,C){return(R-P)*(_-C)>=(T-P)*(I-C)&&(T-P)*(A-C)>=(E-P)*(_-C)&&(E-P)*(I-C)>=(R-P)*(A-C)}function isValidDiagonal(T,_){return T.next.i!==_.i&&T.prev.i!==_.i&&!intersectsPolygon(T,_)&&(locallyInside(T,_)&&locallyInside(_,T)&&middleInside(T,_)&&(area(T.prev,T,_.prev)||area(T,_.prev,_))||equals(T,_)&&area(T.prev,T,T.next)>0&&area(_.prev,_,_.next)>0)}function area(T,_,E){return(_.y-T.y)*(E.x-_.x)-(_.x-T.x)*(E.y-_.y)}function equals(T,_){return T.x===_.x&&T.y===_.y}function intersects(T,_,E,A){var R=sign$1(area(T,_,E)),I=sign$1(area(T,_,A)),P=sign$1(area(E,A,T)),C=sign$1(area(E,A,_));return!!(R!==I&&P!==C||R===0&&onSegment(T,E,_)||I===0&&onSegment(T,A,_)||P===0&&onSegment(E,T,A)||C===0&&onSegment(E,_,A))}function onSegment(T,_,E){return _.x<=Math.max(T.x,E.x)&&_.x>=Math.min(T.x,E.x)&&_.y<=Math.max(T.y,E.y)&&_.y>=Math.min(T.y,E.y)}function sign$1(T){return T>0?1:T<0?-1:0}function intersectsPolygon(T,_){var E=T;do{if(E.i!==T.i&&E.next.i!==T.i&&E.i!==_.i&&E.next.i!==_.i&&intersects(E,E.next,T,_))return!0;E=E.next}while(E!==T);return!1}function locallyInside(T,_){return area(T.prev,T,T.next)<0?area(T,_,T.next)>=0&&area(T,T.prev,_)>=0:area(T,_,T.prev)<0||area(T,T.next,_)<0}function middleInside(T,_){var E=T,A=!1,R=(T.x+_.x)/2,I=(T.y+_.y)/2;do E.y>I!=E.next.y>I&&E.next.y!==E.y&&R<(E.next.x-E.x)*(I-E.y)/(E.next.y-E.y)+E.x&&(A=!A),E=E.next;while(E!==T);return A}function splitPolygon(T,_){var E=new Node(T.i,T.x,T.y),A=new Node(_.i,_.x,_.y),R=T.next,I=_.prev;return T.next=_,_.prev=T,E.next=R,R.prev=E,A.next=E,E.prev=A,I.next=A,A.prev=I,A}function insertNode(T,_,E,A){var R=new Node(T,_,E);return A?(R.next=A.next,R.prev=A,A.next.prev=R,A.next=R):(R.prev=R,R.next=R),R}function removeNode(T){T.next.prev=T.prev,T.prev.next=T.next,T.prevZ&&(T.prevZ.nextZ=T.nextZ),T.nextZ&&(T.nextZ.prevZ=T.prevZ)}function Node(T,_,E){this.i=T,this.x=_,this.y=E,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}earcut.deviation=function(T,_,E,A){var R=_&&_.length,I=R?_[0]*E:T.length,P=Math.abs(signedArea(T,0,I,E));if(R)for(var C=0,D=_.length;C<D;C++){var B=_[C]*E,O=C<D-1?_[C+1]*E:T.length;P-=Math.abs(signedArea(T,B,O,E))}var F=0;for(C=0;C<A.length;C+=3){var L=A[C]*E,U=A[C+1]*E,G=A[C+2]*E;F+=Math.abs((T[L]-T[G])*(T[U+1]-T[L+1])-(T[L]-T[U])*(T[G+1]-T[L+1]))}return P===0&&F===0?0:Math.abs((F-P)/P)};function signedArea(T,_,E,A){for(var R=0,I=_,P=E-A;I<E;I+=A)R+=(T[P]-T[I])*(T[I+1]+T[P+1]),P=I;return R}earcut.flatten=function(T){for(var _=T[0][0].length,E={vertices:[],holes:[],dimensions:_},A=0,R=0;R<T.length;R++){for(var I=0;I<T[R].length;I++)for(var P=0;P<_;P++)E.vertices.push(T[R][I][P]);R>0&&(A+=T[R-1].length,E.holes.push(A))}return E};var punycode$1={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(T,_){(function(E){var A=_&&!_.nodeType&&_,R=T&&!T.nodeType&&T,I=typeof commonjsGlobal=="object"&&commonjsGlobal;(I.global===I||I.window===I||I.self===I)&&(E=I);var P,C=2147483647,D=36,B=1,O=26,F=38,L=700,U=72,G=128,X="-",W=/^xn--/,V=/[^\x20-\x7E]/,q=/[\x2E\u3002\uFF0E\uFF61]/g,z={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Y=D-B,K=Math.floor,it=String.fromCharCode,et;function Q(J){throw RangeError(z[J])}function ot(J,lt){for(var dt=J.length,mt=[];dt--;)mt[dt]=lt(J[dt]);return mt}function at(J,lt){var dt=J.split("@"),mt="";dt.length>1&&(mt=dt[0]+"@",J=dt[1]),J=J.replace(q,".");var pt=J.split("."),gt=ot(pt,lt).join(".");return mt+gt}function rt(J){for(var lt=[],dt=0,mt=J.length,pt,gt;dt<mt;)pt=J.charCodeAt(dt++),pt>=55296&&pt<=56319&&dt<mt?(gt=J.charCodeAt(dt++),(gt&64512)==56320?lt.push(((pt&1023)<<10)+(gt&1023)+65536):(lt.push(pt),dt--)):lt.push(pt);return lt}function nt(J){return ot(J,function(lt){var dt="";return lt>65535&&(lt-=65536,dt+=it(lt>>>10&1023|55296),lt=56320|lt&1023),dt+=it(lt),dt}).join("")}function tt(J){return J-48<10?J-22:J-65<26?J-65:J-97<26?J-97:D}function Z(J,lt){return J+22+75*(J<26)-((lt!=0)<<5)}function ht(J,lt,dt){var mt=0;for(J=dt?K(J/L):J>>1,J+=K(J/lt);J>Y*O>>1;mt+=D)J=K(J/Y);return K(mt+(Y+1)*J/(J+F))}function ut(J){var lt=[],dt=J.length,mt,pt=0,gt=G,ct=U,_t,bt,St,Et,xt,vt,Tt,wt,At;for(_t=J.lastIndexOf(X),_t<0&&(_t=0),bt=0;bt<_t;++bt)J.charCodeAt(bt)>=128&&Q("not-basic"),lt.push(J.charCodeAt(bt));for(St=_t>0?_t+1:0;St<dt;){for(Et=pt,xt=1,vt=D;St>=dt&&Q("invalid-input"),Tt=tt(J.charCodeAt(St++)),(Tt>=D||Tt>K((C-pt)/xt))&&Q("overflow"),pt+=Tt*xt,wt=vt<=ct?B:vt>=ct+O?O:vt-ct,!(Tt<wt);vt+=D)At=D-wt,xt>K(C/At)&&Q("overflow"),xt*=At;mt=lt.length+1,ct=ht(pt-Et,mt,Et==0),K(pt/mt)>C-gt&&Q("overflow"),gt+=K(pt/mt),pt%=mt,lt.splice(pt++,0,gt)}return nt(lt)}function st(J){var lt,dt,mt,pt,gt,ct,_t,bt,St,Et,xt,vt=[],Tt,wt,At,Rt;for(J=rt(J),Tt=J.length,lt=G,dt=0,gt=U,ct=0;ct<Tt;++ct)xt=J[ct],xt<128&&vt.push(it(xt));for(mt=pt=vt.length,pt&&vt.push(X);mt<Tt;){for(_t=C,ct=0;ct<Tt;++ct)xt=J[ct],xt>=lt&&xt<_t&&(_t=xt);for(wt=mt+1,_t-lt>K((C-dt)/wt)&&Q("overflow"),dt+=(_t-lt)*wt,lt=_t,ct=0;ct<Tt;++ct)if(xt=J[ct],xt<lt&&++dt>C&&Q("overflow"),xt==lt){for(bt=dt,St=D;Et=St<=gt?B:St>=gt+O?O:St-gt,!(bt<Et);St+=D)Rt=bt-Et,At=D-Et,vt.push(it(Z(Et+Rt%At,0))),bt=K(Rt/At);vt.push(it(Z(bt,0))),gt=ht(dt,wt,mt==pt),dt=0,++mt}++dt,++lt}return vt.join("")}function ft(J){return at(J,function(lt){return W.test(lt)?ut(lt.slice(4).toLowerCase()):lt})}function yt(J){return at(J,function(lt){return V.test(lt)?"xn--"+st(lt):lt})}if(P={version:"1.3.2",ucs2:{decode:rt,encode:nt},decode:ut,encode:st,toASCII:yt,toUnicode:ft},A&&R)if(T.exports==A)R.exports=P;else for(et in P)P.hasOwnProperty(et)&&(A[et]=P[et]);else E.punycode=P})(commonjsGlobal)})(punycode$1,punycode$1.exports);var util$6={isString:function(T){return typeof T=="string"},isObject:function(T){return typeof T=="object"&&T!==null},isNull:function(T){return T===null},isNullOrUndefined:function(T){return T==null}},querystring$1={};function hasOwnProperty(T,_){return Object.prototype.hasOwnProperty.call(T,_)}var decode=function(T,_,E,A){_=_||"&",E=E||"=";var R={};if(typeof T!="string"||T.length===0)return R;var I=/\+/g;T=T.split(_);var P=1e3;A&&typeof A.maxKeys=="number"&&(P=A.maxKeys);var C=T.length;P>0&&C>P&&(C=P);for(var D=0;D<C;++D){var B=T[D].replace(I,"%20"),O=B.indexOf(E),F,L,U,G;O>=0?(F=B.substr(0,O),L=B.substr(O+1)):(F=B,L=""),U=decodeURIComponent(F),G=decodeURIComponent(L),hasOwnProperty(R,U)?Array.isArray(R[U])?R[U].push(G):R[U]=[R[U],G]:R[U]=G}return R},stringifyPrimitive=function(T){switch(typeof T){case"string":return T;case"boolean":return T?"true":"false";case"number":return isFinite(T)?T:"";default:return""}},encode=function(T,_,E,A){return _=_||"&",E=E||"=",T===null&&(T=void 0),typeof T=="object"?Object.keys(T).map(function(R){var I=encodeURIComponent(stringifyPrimitive(R))+E;return Array.isArray(T[R])?T[R].map(function(P){return I+encodeURIComponent(stringifyPrimitive(P))}).join(_):I+encodeURIComponent(stringifyPrimitive(T[R]))}).join(_):A?encodeURIComponent(stringifyPrimitive(A))+E+encodeURIComponent(stringifyPrimitive(T)):""};querystring$1.decode=querystring$1.parse=decode;querystring$1.encode=querystring$1.stringify=encode;var punycode=punycode$1.exports,util$5=util$6,parse=urlParse,resolve=urlResolve,format=urlFormat;function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r",`
`,"	"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=querystring$1;function urlParse(T,_,E){if(T&&util$5.isObject(T)&&T instanceof Url)return T;var A=new Url;return A.parse(T,_,E),A}Url.prototype.parse=function(T,_,E){if(!util$5.isString(T))throw new TypeError("Parameter 'url' must be a string, not "+typeof T);var A=T.indexOf("?"),R=A!==-1&&A<T.indexOf("#")?"?":"#",I=T.split(R),P=/\\/g;I[0]=I[0].replace(P,"/"),T=I.join(R);var C=T;if(C=C.trim(),!E&&T.split("#").length===1){var D=simplePathPattern.exec(C);if(D)return this.path=C,this.href=C,this.pathname=D[1],D[2]?(this.search=D[2],_?this.query=querystring.parse(this.search.substr(1)):this.query=this.search.substr(1)):_&&(this.search="",this.query={}),this}var B=protocolPattern.exec(C);if(B){B=B[0];var O=B.toLowerCase();this.protocol=O,C=C.substr(B.length)}if(E||B||C.match(/^\/\/[^@\/]+@[^@\/]+/)){var F=C.substr(0,2)==="//";F&&!(B&&hostlessProtocol[B])&&(C=C.substr(2),this.slashes=!0)}if(!hostlessProtocol[B]&&(F||B&&!slashedProtocol[B])){for(var L=-1,U=0;U<hostEndingChars.length;U++){var G=C.indexOf(hostEndingChars[U]);G!==-1&&(L===-1||G<L)&&(L=G)}var X,W;L===-1?W=C.lastIndexOf("@"):W=C.lastIndexOf("@",L),W!==-1&&(X=C.slice(0,W),C=C.slice(W+1),this.auth=decodeURIComponent(X)),L=-1;for(var U=0;U<nonHostChars.length;U++){var G=C.indexOf(nonHostChars[U]);G!==-1&&(L===-1||G<L)&&(L=G)}L===-1&&(L=C.length),this.host=C.slice(0,L),C=C.slice(L),this.parseHost(),this.hostname=this.hostname||"";var V=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!V)for(var q=this.hostname.split(/\./),U=0,z=q.length;U<z;U++){var Y=q[U];if(!!Y&&!Y.match(hostnamePartPattern)){for(var K="",it=0,et=Y.length;it<et;it++)Y.charCodeAt(it)>127?K+="x":K+=Y[it];if(!K.match(hostnamePartPattern)){var Q=q.slice(0,U),ot=q.slice(U+1),at=Y.match(hostnamePartStart);at&&(Q.push(at[1]),ot.unshift(at[2])),ot.length&&(C="/"+ot.join(".")+C),this.hostname=Q.join(".");break}}}this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),V||(this.hostname=punycode.toASCII(this.hostname));var rt=this.port?":"+this.port:"",nt=this.hostname||"";this.host=nt+rt,this.href+=this.host,V&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),C[0]!=="/"&&(C="/"+C))}if(!unsafeProtocol[O])for(var U=0,z=autoEscape.length;U<z;U++){var tt=autoEscape[U];if(C.indexOf(tt)!==-1){var Z=encodeURIComponent(tt);Z===tt&&(Z=escape(tt)),C=C.split(tt).join(Z)}}var ht=C.indexOf("#");ht!==-1&&(this.hash=C.substr(ht),C=C.slice(0,ht));var ut=C.indexOf("?");if(ut!==-1?(this.search=C.substr(ut),this.query=C.substr(ut+1),_&&(this.query=querystring.parse(this.query)),C=C.slice(0,ut)):_&&(this.search="",this.query={}),C&&(this.pathname=C),slashedProtocol[O]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var rt=this.pathname||"",st=this.search||"";this.path=rt+st}return this.href=this.format(),this};function urlFormat(T){return util$5.isString(T)&&(T=urlParse(T)),T instanceof Url?T.format():Url.prototype.format.call(T)}Url.prototype.format=function(){var T=this.auth||"";T&&(T=encodeURIComponent(T),T=T.replace(/%3A/i,":"),T+="@");var _=this.protocol||"",E=this.pathname||"",A=this.hash||"",R=!1,I="";this.host?R=T+this.host:this.hostname&&(R=T+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(R+=":"+this.port)),this.query&&util$5.isObject(this.query)&&Object.keys(this.query).length&&(I=querystring.stringify(this.query));var P=this.search||I&&"?"+I||"";return _&&_.substr(-1)!==":"&&(_+=":"),this.slashes||(!_||slashedProtocol[_])&&R!==!1?(R="//"+(R||""),E&&E.charAt(0)!=="/"&&(E="/"+E)):R||(R=""),A&&A.charAt(0)!=="#"&&(A="#"+A),P&&P.charAt(0)!=="?"&&(P="?"+P),E=E.replace(/[?#]/g,function(C){return encodeURIComponent(C)}),P=P.replace("#","%23"),_+R+E+P+A};function urlResolve(T,_){return urlParse(T,!1,!0).resolve(_)}Url.prototype.resolve=function(T){return this.resolveObject(urlParse(T,!1,!0)).format()};Url.prototype.resolveObject=function(T){if(util$5.isString(T)){var _=new Url;_.parse(T,!1,!0),T=_}for(var E=new Url,A=Object.keys(this),R=0;R<A.length;R++){var I=A[R];E[I]=this[I]}if(E.hash=T.hash,T.href==="")return E.href=E.format(),E;if(T.slashes&&!T.protocol){for(var P=Object.keys(T),C=0;C<P.length;C++){var D=P[C];D!=="protocol"&&(E[D]=T[D])}return slashedProtocol[E.protocol]&&E.hostname&&!E.pathname&&(E.path=E.pathname="/"),E.href=E.format(),E}if(T.protocol&&T.protocol!==E.protocol){if(!slashedProtocol[T.protocol]){for(var B=Object.keys(T),O=0;O<B.length;O++){var F=B[O];E[F]=T[F]}return E.href=E.format(),E}if(E.protocol=T.protocol,!T.host&&!hostlessProtocol[T.protocol]){for(var z=(T.pathname||"").split("/");z.length&&!(T.host=z.shift()););T.host||(T.host=""),T.hostname||(T.hostname=""),z[0]!==""&&z.unshift(""),z.length<2&&z.unshift(""),E.pathname=z.join("/")}else E.pathname=T.pathname;if(E.search=T.search,E.query=T.query,E.host=T.host||"",E.auth=T.auth,E.hostname=T.hostname||T.host,E.port=T.port,E.pathname||E.search){var L=E.pathname||"",U=E.search||"";E.path=L+U}return E.slashes=E.slashes||T.slashes,E.href=E.format(),E}var G=E.pathname&&E.pathname.charAt(0)==="/",X=T.host||T.pathname&&T.pathname.charAt(0)==="/",W=X||G||E.host&&T.pathname,V=W,q=E.pathname&&E.pathname.split("/")||[],z=T.pathname&&T.pathname.split("/")||[],Y=E.protocol&&!slashedProtocol[E.protocol];if(Y&&(E.hostname="",E.port=null,E.host&&(q[0]===""?q[0]=E.host:q.unshift(E.host)),E.host="",T.protocol&&(T.hostname=null,T.port=null,T.host&&(z[0]===""?z[0]=T.host:z.unshift(T.host)),T.host=null),W=W&&(z[0]===""||q[0]==="")),X)E.host=T.host||T.host===""?T.host:E.host,E.hostname=T.hostname||T.hostname===""?T.hostname:E.hostname,E.search=T.search,E.query=T.query,q=z;else if(z.length)q||(q=[]),q.pop(),q=q.concat(z),E.search=T.search,E.query=T.query;else if(!util$5.isNullOrUndefined(T.search)){if(Y){E.hostname=E.host=q.shift();var K=E.host&&E.host.indexOf("@")>0?E.host.split("@"):!1;K&&(E.auth=K.shift(),E.host=E.hostname=K.shift())}return E.search=T.search,E.query=T.query,(!util$5.isNull(E.pathname)||!util$5.isNull(E.search))&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.href=E.format(),E}if(!q.length)return E.pathname=null,E.search?E.path="/"+E.search:E.path=null,E.href=E.format(),E;for(var it=q.slice(-1)[0],et=(E.host||T.host||q.length>1)&&(it==="."||it==="..")||it==="",Q=0,ot=q.length;ot>=0;ot--)it=q[ot],it==="."?q.splice(ot,1):it===".."?(q.splice(ot,1),Q++):Q&&(q.splice(ot,1),Q--);if(!W&&!V)for(;Q--;Q)q.unshift("..");W&&q[0]!==""&&(!q[0]||q[0].charAt(0)!=="/")&&q.unshift(""),et&&q.join("/").substr(-1)!=="/"&&q.push("");var at=q[0]===""||q[0]&&q[0].charAt(0)==="/";if(Y){E.hostname=E.host=at?"":q.length?q.shift():"";var K=E.host&&E.host.indexOf("@")>0?E.host.split("@"):!1;K&&(E.auth=K.shift(),E.host=E.hostname=K.shift())}return W=W||E.host&&q.length,W&&!at&&q.unshift(""),q.length?E.pathname=q.join("/"):(E.pathname=null,E.path=null),(!util$5.isNull(E.pathname)||!util$5.isNull(E.search))&&(E.path=(E.pathname?E.pathname:"")+(E.search?E.search:"")),E.auth=T.auth||E.auth,E.slashes=E.slashes||T.slashes,E.href=E.format(),E};Url.prototype.parseHost=function(){var T=this.host,_=portPattern.exec(T);_&&(_=_[0],_!==":"&&(this.port=_.substr(1)),T=T.substr(0,T.length-_.length)),T&&(this.hostname=T)};const url={parse,format,resolve};function assertPath(T){if(typeof T!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(T)}`)}function removeUrlParams(T){return T.split("?")[0].split("#")[0]}function escapeRegExp(T){return T.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function replaceAll(T,_,E){return T.replace(new RegExp(escapeRegExp(_),"g"),E)}function normalizeStringPosix(T,_){let E="",A=0,R=-1,I=0,P;for(let C=0;C<=T.length;++C){if(C<T.length)P=T.charCodeAt(C);else{if(P===47)break;P=47}if(P===47){if(!(R===C-1||I===1))if(R!==C-1&&I===2){if(E.length<2||A!==2||E.charCodeAt(E.length-1)!==46||E.charCodeAt(E.length-2)!==46){if(E.length>2){const D=E.lastIndexOf("/");if(D!==E.length-1){D===-1?(E="",A=0):(E=E.slice(0,D),A=E.length-1-E.lastIndexOf("/")),R=C,I=0;continue}}else if(E.length===2||E.length===1){E="",A=0,R=C,I=0;continue}}_&&(E.length>0?E+="/..":E="..",A=2)}else E.length>0?E+=`/${T.slice(R+1,C)}`:E=T.slice(R+1,C),A=C-R-1;R=C,I=0}else P===46&&I!==-1?++I:I=-1}return E}const path={toPosix(T){return replaceAll(T,"\\","/")},isUrl(T){return/^https?:/.test(this.toPosix(T))},isDataUrl(T){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(T)},hasProtocol(T){return/^[^/:]+:\//.test(this.toPosix(T))},getProtocol(T){assertPath(T),T=this.toPosix(T);let _="";const E=/^file:\/\/\//.exec(T),A=/^[^/:]+:\/\//.exec(T),R=/^[^/:]+:\//.exec(T);if(E||A||R){const I=(E==null?void 0:E[0])||(A==null?void 0:A[0])||(R==null?void 0:R[0]);_=I,T=T.slice(I.length)}return _},toAbsolute(T,_,E){if(this.isDataUrl(T))return T;const A=removeUrlParams(this.toPosix(_!=null?_:settings.ADAPTER.getBaseUrl())),R=removeUrlParams(this.toPosix(E!=null?E:this.rootname(A)));return assertPath(T),T=this.toPosix(T),T.startsWith("/")?path.join(R,T.slice(1)):this.isAbsolute(T)?T:this.join(A,T)},normalize(T){if(T=this.toPosix(T),assertPath(T),T.length===0)return".";let _="";const E=T.startsWith("/");this.hasProtocol(T)&&(_=this.rootname(T),T=T.slice(_.length));const A=T.endsWith("/");return T=normalizeStringPosix(T,!1),T.length>0&&A&&(T+="/"),E?`/${T}`:_+T},isAbsolute(T){return assertPath(T),T=this.toPosix(T),this.hasProtocol(T)?!0:T.startsWith("/")},join(...T){var E;if(T.length===0)return".";let _;for(let A=0;A<T.length;++A){const R=T[A];if(assertPath(R),R.length>0)if(_===void 0)_=R;else{const I=(E=T[A-1])!=null?E:"";this.extname(I)?_+=`/../${R}`:_+=`/${R}`}}return _===void 0?".":this.normalize(_)},dirname(T){if(assertPath(T),T.length===0)return".";T=this.toPosix(T);let _=T.charCodeAt(0);const E=_===47;let A=-1,R=!0;const I=this.getProtocol(T),P=T;T=T.slice(I.length);for(let C=T.length-1;C>=1;--C)if(_=T.charCodeAt(C),_===47){if(!R){A=C;break}}else R=!1;return A===-1?E?"/":this.isUrl(P)?I+T:I:E&&A===1?"//":I+T.slice(0,A)},rootname(T){assertPath(T),T=this.toPosix(T);let _="";if(T.startsWith("/")?_="/":_=this.getProtocol(T),this.isUrl(T)){const E=T.indexOf("/",_.length);E!==-1?_=T.slice(0,E):_=T,_.endsWith("/")||(_+="/")}return _},basename(T,_){assertPath(T),_&&assertPath(_),T=this.toPosix(T);let E=0,A=-1,R=!0,I;if(_!==void 0&&_.length>0&&_.length<=T.length){if(_.length===T.length&&_===T)return"";let P=_.length-1,C=-1;for(I=T.length-1;I>=0;--I){const D=T.charCodeAt(I);if(D===47){if(!R){E=I+1;break}}else C===-1&&(R=!1,C=I+1),P>=0&&(D===_.charCodeAt(P)?--P===-1&&(A=I):(P=-1,A=C))}return E===A?A=C:A===-1&&(A=T.length),T.slice(E,A)}for(I=T.length-1;I>=0;--I)if(T.charCodeAt(I)===47){if(!R){E=I+1;break}}else A===-1&&(R=!1,A=I+1);return A===-1?"":T.slice(E,A)},extname(T){assertPath(T),T=this.toPosix(T);let _=-1,E=0,A=-1,R=!0,I=0;for(let P=T.length-1;P>=0;--P){const C=T.charCodeAt(P);if(C===47){if(!R){E=P+1;break}continue}A===-1&&(R=!1,A=P+1),C===46?_===-1?_=P:I!==1&&(I=1):_!==-1&&(I=-1)}return _===-1||A===-1||I===0||I===1&&_===A-1&&_===E+1?"":T.slice(_,A)},parse(T){assertPath(T);const _={root:"",dir:"",base:"",ext:"",name:""};if(T.length===0)return _;T=this.toPosix(T);let E=T.charCodeAt(0);const A=this.isAbsolute(T);let R;_.root=this.rootname(T),A||this.hasProtocol(T)?R=1:R=0;let I=-1,P=0,C=-1,D=!0,B=T.length-1,O=0;for(;B>=R;--B){if(E=T.charCodeAt(B),E===47){if(!D){P=B+1;break}continue}C===-1&&(D=!1,C=B+1),E===46?I===-1?I=B:O!==1&&(O=1):I!==-1&&(O=-1)}return I===-1||C===-1||O===0||O===1&&I===C-1&&I===P+1?C!==-1&&(P===0&&A?_.base=_.name=T.slice(1,C):_.base=_.name=T.slice(P,C)):(P===0&&A?(_.name=T.slice(1,I),_.base=T.slice(1,C)):(_.name=T.slice(P,I),_.base=T.slice(P,C)),_.ext=T.slice(I,C)),_.dir=this.dirname(T),_},sep:"/",delimiter:":"};settings.RETINA_PREFIX=/@([0-9\.]+)x/;settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;let supported;function isWebGLSupported(){return typeof supported>"u"&&(supported=function(){const _={stencil:!0,failIfMajorPerformanceCaveat:settings.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!settings.ADAPTER.getWebGLRenderingContext())return!1;const E=settings.ADAPTER.createCanvas();let A=E.getContext("webgl",_)||E.getContext("experimental-webgl",_);const R=!!(A&&A.getContextAttributes().stencil);if(A){const I=A.getExtension("WEBGL_lose_context");I&&I.loseContext()}return A=null,R}catch{return!1}}()),supported}var aliceblue="#f0f8ff",antiquewhite="#faebd7",aqua="#00ffff",aquamarine="#7fffd4",azure="#f0ffff",beige="#f5f5dc",bisque="#ffe4c4",black="#000000",blanchedalmond="#ffebcd",blue="#0000ff",blueviolet="#8a2be2",brown="#a52a2a",burlywood="#deb887",cadetblue="#5f9ea0",chartreuse="#7fff00",chocolate="#d2691e",coral="#ff7f50",cornflowerblue="#6495ed",cornsilk="#fff8dc",crimson="#dc143c",cyan="#00ffff",darkblue="#00008b",darkcyan="#008b8b",darkgoldenrod="#b8860b",darkgray="#a9a9a9",darkgreen="#006400",darkgrey="#a9a9a9",darkkhaki="#bdb76b",darkmagenta="#8b008b",darkolivegreen="#556b2f",darkorange="#ff8c00",darkorchid="#9932cc",darkred="#8b0000",darksalmon="#e9967a",darkseagreen="#8fbc8f",darkslateblue="#483d8b",darkslategray="#2f4f4f",darkslategrey="#2f4f4f",darkturquoise="#00ced1",darkviolet="#9400d3",deeppink="#ff1493",deepskyblue="#00bfff",dimgray="#696969",dimgrey="#696969",dodgerblue="#1e90ff",firebrick="#b22222",floralwhite="#fffaf0",forestgreen="#228b22",fuchsia="#ff00ff",gainsboro="#dcdcdc",ghostwhite="#f8f8ff",goldenrod="#daa520",gold="#ffd700",gray="#808080",green="#008000",greenyellow="#adff2f",grey="#808080",honeydew="#f0fff0",hotpink="#ff69b4",indianred="#cd5c5c",indigo="#4b0082",ivory="#fffff0",khaki="#f0e68c",lavenderblush="#fff0f5",lavender="#e6e6fa",lawngreen="#7cfc00",lemonchiffon="#fffacd",lightblue="#add8e6",lightcoral="#f08080",lightcyan="#e0ffff",lightgoldenrodyellow="#fafad2",lightgray="#d3d3d3",lightgreen="#90ee90",lightgrey="#d3d3d3",lightpink="#ffb6c1",lightsalmon="#ffa07a",lightseagreen="#20b2aa",lightskyblue="#87cefa",lightslategray="#778899",lightslategrey="#778899",lightsteelblue="#b0c4de",lightyellow="#ffffe0",lime="#00ff00",limegreen="#32cd32",linen="#faf0e6",magenta="#ff00ff",maroon="#800000",mediumaquamarine="#66cdaa",mediumblue="#0000cd",mediumorchid="#ba55d3",mediumpurple="#9370db",mediumseagreen="#3cb371",mediumslateblue="#7b68ee",mediumspringgreen="#00fa9a",mediumturquoise="#48d1cc",mediumvioletred="#c71585",midnightblue="#191970",mintcream="#f5fffa",mistyrose="#ffe4e1",moccasin="#ffe4b5",navajowhite="#ffdead",navy="#000080",oldlace="#fdf5e6",olive="#808000",olivedrab="#6b8e23",orange="#ffa500",orangered="#ff4500",orchid="#da70d6",palegoldenrod="#eee8aa",palegreen="#98fb98",paleturquoise="#afeeee",palevioletred="#db7093",papayawhip="#ffefd5",peachpuff="#ffdab9",peru="#cd853f",pink="#ffc0cb",plum="#dda0dd",powderblue="#b0e0e6",purple="#800080",rebeccapurple="#663399",red="#ff0000",rosybrown="#bc8f8f",royalblue="#4169e1",saddlebrown="#8b4513",salmon="#fa8072",sandybrown="#f4a460",seagreen="#2e8b57",seashell="#fff5ee",sienna="#a0522d",silver="#c0c0c0",skyblue="#87ceeb",slateblue="#6a5acd",slategray="#708090",slategrey="#708090",snow="#fffafa",springgreen="#00ff7f",steelblue="#4682b4",tan="#d2b48c",teal="#008080",thistle="#d8bfd8",tomato="#ff6347",turquoise="#40e0d0",violet="#ee82ee",wheat="#f5deb3",white="#ffffff",whitesmoke="#f5f5f5",yellow="#ffff00",yellowgreen="#9acd32",cssColorNames={aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkgrey,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkslategrey,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dimgrey,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,goldenrod,gold,gray,green,greenyellow,grey,honeydew,hotpink,indianred,indigo,ivory,khaki,lavenderblush,lavender,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgray,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightslategrey,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,rebeccapurple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,slategrey,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen};function hex2rgb(T,_=[]){return _[0]=(T>>16&255)/255,_[1]=(T>>8&255)/255,_[2]=(T&255)/255,_}function hex2string(T){let _=T.toString(16);return _="000000".substring(0,6-_.length)+_,`#${_}`}function string2hex(T){if(typeof T=="string"&&(T=cssColorNames[T.toLowerCase()]||T,T[0]==="#"&&(T=T.slice(1)),T.length===3)){const[_,E,A]=T;T=_+_+E+E+A+A}return parseInt(T,16)}function mapPremultipliedBlendModes(){const T=[],_=[];for(let A=0;A<32;A++)T[A]=A,_[A]=A;T[BLEND_MODES.NORMAL_NPM]=BLEND_MODES.NORMAL,T[BLEND_MODES.ADD_NPM]=BLEND_MODES.ADD,T[BLEND_MODES.SCREEN_NPM]=BLEND_MODES.SCREEN,_[BLEND_MODES.NORMAL]=BLEND_MODES.NORMAL_NPM,_[BLEND_MODES.ADD]=BLEND_MODES.ADD_NPM,_[BLEND_MODES.SCREEN]=BLEND_MODES.SCREEN_NPM;const E=[];return E.push(_),E.push(T),E}const premultiplyBlendMode=mapPremultipliedBlendModes();function correctBlendMode(T,_){return premultiplyBlendMode[_?1:0][T]}function premultiplyRgba(T,_,E,A){return E=E||new Float32Array(4),A||A===void 0?(E[0]=T[0]*_,E[1]=T[1]*_,E[2]=T[2]*_):(E[0]=T[0],E[1]=T[1],E[2]=T[2]),E[3]=_,E}function premultiplyTint(T,_){if(_===1)return(_*255<<24)+T;if(_===0)return 0;let E=T>>16&255,A=T>>8&255,R=T&255;return E=E*_+.5|0,A=A*_+.5|0,R=R*_+.5|0,(_*255<<24)+(E<<16)+(A<<8)+R}function premultiplyTintToRgba(T,_,E,A){return E=E||new Float32Array(4),E[0]=(T>>16&255)/255,E[1]=(T>>8&255)/255,E[2]=(T&255)/255,(A||A===void 0)&&(E[0]*=_,E[1]*=_,E[2]*=_),E[3]=_,E}function createIndicesForQuads(T,_=null){const E=T*6;if(_=_||new Uint16Array(E),_.length!==E)throw new Error(`Out buffer length is incorrect, got ${_.length} and expected ${E}`);for(let A=0,R=0;A<E;A+=6,R+=4)_[A+0]=R+0,_[A+1]=R+1,_[A+2]=R+2,_[A+3]=R+0,_[A+4]=R+2,_[A+5]=R+3;return _}function getBufferType(T){if(T.BYTES_PER_ELEMENT===4)return T instanceof Float32Array?"Float32Array":T instanceof Uint32Array?"Uint32Array":"Int32Array";if(T.BYTES_PER_ELEMENT===2){if(T instanceof Uint16Array)return"Uint16Array"}else if(T.BYTES_PER_ELEMENT===1&&T instanceof Uint8Array)return"Uint8Array";return null}function nextPow2(T){return T+=T===0?1:0,--T,T|=T>>>1,T|=T>>>2,T|=T>>>4,T|=T>>>8,T|=T>>>16,T+1}function isPow2(T){return!(T&T-1)&&!!T}function log2(T){let _=(T>65535?1:0)<<4;T>>>=_;let E=(T>255?1:0)<<3;return T>>>=E,_|=E,E=(T>15?1:0)<<2,T>>>=E,_|=E,E=(T>3?1:0)<<1,T>>>=E,_|=E,_|T>>1}function removeItems(T,_,E){const A=T.length;let R;if(_>=A||E===0)return;E=_+E>A?A-_:E;const I=A-E;for(R=_;R<I;++R)T[R]=T[R+E];T.length=I}function sign(T){return T===0?0:T<0?-1:1}let nextUid=0;function uid(){return++nextUid}const ProgramCache={},TextureCache=Object.create(null),BaseTextureCache=Object.create(null);class CanvasRenderTarget{constructor(_,E,A){this.canvas=settings.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=A||settings.RESOLUTION,this.resize(_,E)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(_,E){this.canvas.width=Math.round(_*this.resolution),this.canvas.height=Math.round(E*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(_){this.canvas.width=Math.round(_)}get height(){return this.canvas.height}set height(_){this.canvas.height=Math.round(_)}}function trimCanvas(T){let _=T.width,E=T.height;const A=T.getContext("2d",{willReadFrequently:!0}),I=A.getImageData(0,0,_,E).data,P=I.length,C={top:null,left:null,right:null,bottom:null};let D=null,B,O,F;for(B=0;B<P;B+=4)I[B+3]!==0&&(O=B/4%_,F=~~(B/4/_),C.top===null&&(C.top=F),(C.left===null||O<C.left)&&(C.left=O),(C.right===null||C.right<O)&&(C.right=O+1),(C.bottom===null||C.bottom<F)&&(C.bottom=F));return C.top!==null&&(_=C.right-C.left,E=C.bottom-C.top+1,D=A.getImageData(C.left,C.top,_,E)),{height:E,width:_,data:D}}let tempAnchor;function determineCrossOrigin(T,_=globalThis.location){if(T.startsWith("data:"))return"";_=_||globalThis.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=T;const E=url.parse(tempAnchor.href),A=!E.port&&_.port===""||E.port===_.port;return E.hostname!==_.hostname||!A||E.protocol!==_.protocol?"anonymous":""}function getResolutionOfUrl(T,_=1){const E=settings.RETINA_PREFIX.exec(T);return E?parseFloat(E[1]):_}const INSTALLED=[];function autoDetectResource(T,_){if(!T)return null;let E="";if(typeof T=="string"){const A=/\.(\w{3,4})(?:$|\?|#)/i.exec(T);A&&(E=A[1].toLowerCase())}for(let A=INSTALLED.length-1;A>=0;--A){const R=INSTALLED[A];if(R.test&&R.test(T,E))return new R(T,_)}throw new Error("Unrecognized source type to auto-detect Resource")}class Resource{constructor(_=0,E=0){this._width=_,this._height=E,this.destroyed=!1,this.internal=!1,this.onResize=new Runner("setRealSize"),this.onUpdate=new Runner("update"),this.onError=new Runner("onError")}bind(_){this.onResize.add(_),this.onUpdate.add(_),this.onError.add(_),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(_){this.onResize.remove(_),this.onUpdate.remove(_),this.onError.remove(_)}resize(_,E){(_!==this._width||E!==this._height)&&(this._width=_,this._height=E,this.onResize.emit(_,E))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(_,E,A){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(_,E){return!1}}class BufferResource extends Resource{constructor(_,E){const{width:A,height:R}=E||{};if(!A||!R)throw new Error("BufferResource width or height invalid");super(A,R),this.data=_}upload(_,E,A){const R=_.gl;R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,E.alphaMode===ALPHA_MODES.UNPACK);const I=E.realWidth,P=E.realHeight;return A.width===I&&A.height===P?R.texSubImage2D(E.target,0,0,0,I,P,E.format,A.type,this.data):(A.width=I,A.height=P,R.texImage2D(E.target,0,A.internalFormat,I,P,0,E.format,A.type,this.data)),!0}dispose(){this.data=null}static test(_){return _ instanceof Float32Array||_ instanceof Uint8Array||_ instanceof Uint32Array}}const defaultBufferOptions={scaleMode:SCALE_MODES.NEAREST,format:FORMATS.RGBA,alphaMode:ALPHA_MODES.NPM},_BaseTexture=class extends EventEmitter$1{constructor(T=null,_=null){super(),_=_||{};const{alphaMode:E,mipmap:A,anisotropicLevel:R,scaleMode:I,width:P,height:C,wrapMode:D,format:B,type:O,target:F,resolution:L,resourceOptions:U}=_;T&&!(T instanceof Resource)&&(T=autoDetectResource(T,U),T.internal=!0),this.resolution=L||settings.RESOLUTION,this.width=Math.round((P||0)*this.resolution)/this.resolution,this.height=Math.round((C||0)*this.resolution)/this.resolution,this._mipmap=A!=null?A:settings.MIPMAP_TEXTURES,this.anisotropicLevel=R!=null?R:settings.ANISOTROPIC_LEVEL,this._wrapMode=D||settings.WRAP_MODE,this._scaleMode=I!=null?I:settings.SCALE_MODE,this.format=B||FORMATS.RGBA,this.type=O||TYPES.UNSIGNED_BYTE,this.target=F||TARGETS.TEXTURE_2D,this.alphaMode=E!=null?E:ALPHA_MODES.UNPACK,this.uid=uid(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=P>0&&C>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(T)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(T){this._mipmap!==T&&(this._mipmap=T,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(T){this._scaleMode!==T&&(this._scaleMode=T,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(T){this._wrapMode!==T&&(this._wrapMode=T,this.dirtyStyleId++)}setStyle(T,_){let E;return T!==void 0&&T!==this.scaleMode&&(this.scaleMode=T,E=!0),_!==void 0&&_!==this.mipmap&&(this.mipmap=_,E=!0),E&&this.dirtyStyleId++,this}setSize(T,_,E){return E=E||this.resolution,this.setRealSize(T*E,_*E,E)}setRealSize(T,_,E){return this.resolution=E||this.resolution,this.width=Math.round(T)/this.resolution,this.height=Math.round(_)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=isPow2(this.realWidth)&&isPow2(this.realHeight)}setResolution(T){const _=this.resolution;return _===T?this:(this.resolution=T,this.valid&&(this.width=Math.round(this.width*_)/T,this.height=Math.round(this.height*_)/T,this.emit("update",this)),this._refreshPOT(),this)}setResource(T){if(this.resource===T)return this;if(this.resource)throw new Error("Resource can be set only once");return T.bind(this),this.resource=T,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(T){this.emit("error",this,T)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete BaseTextureCache[this.cacheId],delete TextureCache[this.cacheId],this.cacheId=null),this.dispose(),_BaseTexture.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(T,_,E=settings.STRICT_TEXTURE_CACHE){const A=typeof T=="string";let R=null;if(A)R=T;else{if(!T._pixiId){const P=(_==null?void 0:_.pixiIdPrefix)||"pixiid";T._pixiId=`${P}_${uid()}`}R=T._pixiId}let I=BaseTextureCache[R];if(A&&E&&!I)throw new Error(`The cacheId "${R}" does not exist in BaseTextureCache.`);return I||(I=new _BaseTexture(T,_),I.cacheId=R,_BaseTexture.addToCache(I,R)),I}static fromBuffer(T,_,E,A){T=T||new Float32Array(_*E*4);const R=new BufferResource(T,{width:_,height:E}),I=T instanceof Float32Array?TYPES.FLOAT:TYPES.UNSIGNED_BYTE;return new _BaseTexture(R,Object.assign({},defaultBufferOptions,A||{width:_,height:E,type:I}))}static addToCache(T,_){_&&(T.textureCacheIds.includes(_)||T.textureCacheIds.push(_),BaseTextureCache[_]&&console.warn(`BaseTexture added to the cache with an id [${_}] that already had an entry`),BaseTextureCache[_]=T)}static removeFromCache(T){if(typeof T=="string"){const _=BaseTextureCache[T];if(_){const E=_.textureCacheIds.indexOf(T);return E>-1&&_.textureCacheIds.splice(E,1),delete BaseTextureCache[T],_}}else if(T!=null&&T.textureCacheIds){for(let _=0;_<T.textureCacheIds.length;++_)delete BaseTextureCache[T.textureCacheIds[_]];return T.textureCacheIds.length=0,T}return null}};let BaseTexture=_BaseTexture;BaseTexture._globalBatch=0;class AbstractMultiResource extends Resource{constructor(_,E){const{width:A,height:R}=E||{};super(A,R),this.items=[],this.itemDirtyIds=[];for(let I=0;I<_;I++){const P=new BaseTexture;this.items.push(P),this.itemDirtyIds.push(-2)}this.length=_,this._load=null,this.baseTexture=null}initFromArray(_,E){for(let A=0;A<this.length;A++)!_[A]||(_[A].castToBaseTexture?this.addBaseTextureAt(_[A].castToBaseTexture(),A):_[A]instanceof Resource?this.addResourceAt(_[A],A):this.addResourceAt(autoDetectResource(_[A],E),A))}dispose(){for(let _=0,E=this.length;_<E;_++)this.items[_].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(_,E){if(!this.items[E])throw new Error(`Index ${E} is out of bounds`);return _.valid&&!this.valid&&this.resize(_.width,_.height),this.items[E].setResource(_),this}bind(_){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(_);for(let E=0;E<this.length;E++)this.items[E].parentTextureArray=_,this.items[E].on("update",_.update,_)}unbind(_){super.unbind(_);for(let E=0;E<this.length;E++)this.items[E].parentTextureArray=null,this.items[E].off("update",_.update,_)}load(){if(this._load)return this._load;const E=this.items.map(A=>A.resource).filter(A=>A).map(A=>A.load());return this._load=Promise.all(E).then(()=>{const{realWidth:A,realHeight:R}=this.items[0];return this.resize(A,R),Promise.resolve(this)}),this._load}}class ArrayResource extends AbstractMultiResource{constructor(_,E){const{width:A,height:R}=E||{};let I,P;Array.isArray(_)?(I=_,P=_.length):P=_,super(P,{width:A,height:R}),I&&this.initFromArray(I,E)}addBaseTextureAt(_,E){if(_.resource)this.addResourceAt(_.resource,E);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(_){super.bind(_),_.target=TARGETS.TEXTURE_2D_ARRAY}upload(_,E,A){const{length:R,itemDirtyIds:I,items:P}=this,{gl:C}=_;A.dirtyId<0&&C.texImage3D(C.TEXTURE_2D_ARRAY,0,A.internalFormat,this._width,this._height,R,0,E.format,A.type,null);for(let D=0;D<R;D++){const B=P[D];I[D]<B.dirtyId&&(I[D]=B.dirtyId,B.valid&&C.texSubImage3D(C.TEXTURE_2D_ARRAY,0,0,0,D,B.resource.width,B.resource.height,1,E.format,A.type,B.resource.source))}return!0}}class BaseImageResource extends Resource{constructor(_){const E=_,A=E.naturalWidth||E.videoWidth||E.width,R=E.naturalHeight||E.videoHeight||E.height;super(A,R),this.source=_,this.noSubImage=!1}static crossOrigin(_,E,A){A===void 0&&!E.startsWith("data:")?_.crossOrigin=determineCrossOrigin(E):A!==!1&&(_.crossOrigin=typeof A=="string"?A:"anonymous")}upload(_,E,A,R){const I=_.gl,P=E.realWidth,C=E.realHeight;if(R=R||this.source,typeof HTMLImageElement<"u"&&R instanceof HTMLImageElement){if(!R.complete||R.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&R instanceof HTMLVideoElement&&R.readyState<=1&&R.buffered.length===0)return!1;return I.pixelStorei(I.UNPACK_PREMULTIPLY_ALPHA_WEBGL,E.alphaMode===ALPHA_MODES.UNPACK),!this.noSubImage&&E.target===I.TEXTURE_2D&&A.width===P&&A.height===C?I.texSubImage2D(I.TEXTURE_2D,0,0,0,E.format,A.type,R):(A.width=P,A.height=C,I.texImage2D(E.target,0,A.internalFormat,E.format,A.type,R)),!0}update(){if(this.destroyed)return;const _=this.source,E=_.naturalWidth||_.videoWidth||_.width,A=_.naturalHeight||_.videoHeight||_.height;this.resize(E,A),super.update()}dispose(){this.source=null}}class CanvasResource extends BaseImageResource{constructor(_){super(_)}static test(_){const{OffscreenCanvas:E}=globalThis;return E&&_ instanceof E?!0:globalThis.HTMLCanvasElement&&_ instanceof HTMLCanvasElement}}const _CubeResource=class extends AbstractMultiResource{constructor(T,_){const{width:E,height:A,autoLoad:R,linkBaseTexture:I}=_||{};if(T&&T.length!==_CubeResource.SIDES)throw new Error(`Invalid length. Got ${T.length}, expected 6`);super(6,{width:E,height:A});for(let P=0;P<_CubeResource.SIDES;P++)this.items[P].target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+P;this.linkBaseTexture=I!==!1,T&&this.initFromArray(T,_),R!==!1&&this.load()}bind(T){super.bind(T),T.target=TARGETS.TEXTURE_CUBE_MAP}addBaseTextureAt(T,_,E){if(E===void 0&&(E=this.linkBaseTexture),!this.items[_])throw new Error(`Index ${_} is out of bounds`);if(!this.linkBaseTexture||T.parentTextureArray||Object.keys(T._glTextures).length>0)if(T.resource)this.addResourceAt(T.resource,_);else throw new Error("CubeResource does not support copying of renderTexture.");else T.target=TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+_,T.parentTextureArray=this.baseTexture,this.items[_]=T;return T.valid&&!this.valid&&this.resize(T.realWidth,T.realHeight),this.items[_]=T,this}upload(T,_,E){const A=this.itemDirtyIds;for(let R=0;R<_CubeResource.SIDES;R++){const I=this.items[R];(A[R]<I.dirtyId||E.dirtyId<_.dirtyId)&&(I.valid&&I.resource?(I.resource.upload(T,I,E),A[R]=I.dirtyId):A[R]<-1&&(T.gl.texImage2D(I.target,0,E.internalFormat,_.realWidth,_.realHeight,0,_.format,E.type,null),A[R]=-1))}return!0}static test(T){return Array.isArray(T)&&T.length===_CubeResource.SIDES}};let CubeResource=_CubeResource;CubeResource.SIDES=6;class ImageResource extends BaseImageResource{constructor(_,E){var A;if(E=E||{},typeof _=="string"){const R=new Image;BaseImageResource.crossOrigin(R,_,E.crossorigin),R.src=_,_=R}super(_),!_.complete&&!!this._width&&!!this._height&&(this._width=0,this._height=0),this.url=_.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=((A=E.createBitmap)!=null?A:settings.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof E.alphaMode=="number"?E.alphaMode:null,this.bitmap=null,this._load=null,E.autoLoad!==!1&&this.load()}load(_){return this._load?this._load:(_!==void 0&&(this.createBitmap=_),this._load=new Promise((E,A)=>{const R=this.source;this.url=R.src;const I=()=>{this.destroyed||(R.onload=null,R.onerror=null,this.resize(R.width,R.height),this._load=null,this.createBitmap?E(this.process()):E(this))};R.complete&&R.src?I():(R.onload=I,R.onerror=P=>{A(P),this.onError.emit(P)})}),this._load)}process(){const _=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const E=globalThis.createImageBitmap,A=!_.crossOrigin||_.crossOrigin==="anonymous";return this._process=fetch(_.src,{mode:A?"cors":"no-cors"}).then(R=>R.blob()).then(R=>E(R,0,0,_.width,_.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"})).then(R=>this.destroyed?Promise.reject():(this.bitmap=R,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(_,E,A){if(typeof this.alphaMode=="number"&&(E.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(_,E,A);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(_,E,A,this.bitmap),!this.preserveBitmap){let R=!0;const I=E._glTextures;for(const P in I){const C=I[P];if(C!==A&&C.dirtyId!==E.dirtyId){R=!1;break}}R&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(_){return typeof HTMLImageElement<"u"&&(typeof _=="string"||_ instanceof HTMLImageElement)}}const _SVGResource=class extends BaseImageResource{constructor(T,_){_=_||{},super(settings.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=T,this.scale=_.scale||1,this._overrideWidth=_.width,this._overrideHeight=_.height,this._resolve=null,this._crossorigin=_.crossorigin,this._load=null,_.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(T=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),T(this)},_SVGResource.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const T=new Image;BaseImageResource.crossOrigin(T,this.svg,this._crossorigin),T.src=this.svg,T.onerror=_=>{!this._resolve||(T.onerror=null,this.onError.emit(_))},T.onload=()=>{if(!this._resolve)return;const _=T.width,E=T.height;if(!_||!E)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let A=_*this.scale,R=E*this.scale;(this._overrideWidth||this._overrideHeight)&&(A=this._overrideWidth||this._overrideHeight/E*_,R=this._overrideHeight||this._overrideWidth/_*E),A=Math.round(A),R=Math.round(R);const I=this.source;I.width=A,I.height=R,I._pixiId=`canvas_${uid()}`,I.getContext("2d").drawImage(T,0,0,_,E,0,0,A,R),this._resolve(),this._resolve=null}}static getSize(T){const _=_SVGResource.SVG_SIZE.exec(T),E={};return _&&(E[_[1]]=Math.round(parseFloat(_[3])),E[_[5]]=Math.round(parseFloat(_[7]))),E}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(T,_){return _==="svg"||typeof T=="string"&&T.startsWith("data:image/svg+xml")||typeof T=="string"&&_SVGResource.SVG_XML.test(T)}};let SVGResource=_SVGResource;SVGResource.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;SVGResource.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const _VideoResource=class extends BaseImageResource{constructor(T,_){if(_=_||{},!(T instanceof HTMLVideoElement)){const E=document.createElement("video");E.setAttribute("preload","auto"),E.setAttribute("webkit-playsinline",""),E.setAttribute("playsinline",""),typeof T=="string"&&(T=[T]);const A=T[0].src||T[0];BaseImageResource.crossOrigin(E,A,_.crossorigin);for(let R=0;R<T.length;++R){const I=document.createElement("source");let{src:P,mime:C}=T[R];P=P||T[R];const D=P.split("?").shift().toLowerCase(),B=D.slice(D.lastIndexOf(".")+1);C=C||_VideoResource.MIME_TYPES[B]||`video/${B}`,I.src=P,I.type=C,E.appendChild(I)}T=E}super(T),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=_.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=_.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),_.autoLoad!==!1&&this.load()}update(T=0){if(!this.destroyed){const _=Ticker.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-_),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const T=this.source;return(T.readyState===T.HAVE_ENOUGH_DATA||T.readyState===T.HAVE_FUTURE_DATA)&&T.width&&T.height&&(T.complete=!0),T.addEventListener("play",this._onPlayStart.bind(this)),T.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(T.addEventListener("canplay",this._onCanPlay),T.addEventListener("canplaythrough",this._onCanPlay),T.addEventListener("error",this._onError,!0)),this._load=new Promise(_=>{this.valid?_(this):(this._resolve=_,T.load())}),this._load}_onError(T){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(T)}_isSourcePlaying(){const T=this.source;return!T.paused&&!T.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const T=this.source;T.removeEventListener("canplay",this._onCanPlay),T.removeEventListener("canplaythrough",this._onCanPlay);const _=this.valid;this.resize(T.videoWidth,T.videoHeight),!_&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&T.play()}dispose(){this._isConnectedToTicker&&(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1);const T=this.source;T&&(T.removeEventListener("error",this._onError,!0),T.pause(),T.src="",T.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(T){T!==this._autoUpdate&&(this._autoUpdate=T,!this._autoUpdate&&this._isConnectedToTicker?(Ticker.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ticker.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(T){T!==this._updateFPS&&(this._updateFPS=T)}static test(T,_){return globalThis.HTMLVideoElement&&T instanceof HTMLVideoElement||_VideoResource.TYPES.includes(_)}};let VideoResource=_VideoResource;VideoResource.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];VideoResource.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ImageBitmapResource extends BaseImageResource{constructor(_,E){var R;var A=(...I)=>{super(...I)};E=E||{},typeof _=="string"?(A(ImageBitmapResource.EMPTY),this.url=_):(A(_),this.url=null),this.crossOrigin=(R=E.crossOrigin)!=null?R:!0,this.alphaMode=typeof E.alphaMode=="number"?E.alphaMode:null,this._load=null,E.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(_,E)=>{if(this.url===null){_(this);return}try{const A=await settings.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const R=await A.blob();if(this.destroyed)return;const I=await createImageBitmap(R,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===ALPHA_MODES.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=I,this.update(),_(this)}catch(A){if(this.destroyed)return;E(A),this.onError.emit(A)}}),this._load)}upload(_,E,A){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(E.alphaMode=this.alphaMode),super.upload(_,E,A)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(_){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof _=="string"||_ instanceof ImageBitmap)}static get EMPTY(){var _;return ImageBitmapResource._EMPTY=(_=ImageBitmapResource._EMPTY)!=null?_:settings.ADAPTER.createCanvas(0,0),ImageBitmapResource._EMPTY}}INSTALLED.push(ImageBitmapResource,ImageResource,CanvasResource,VideoResource,SVGResource,BufferResource,CubeResource,ArrayResource);class DepthResource extends BufferResource{upload(_,E,A){const R=_.gl;R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,E.alphaMode===ALPHA_MODES.UNPACK);const I=E.realWidth,P=E.realHeight;return A.width===I&&A.height===P?R.texSubImage2D(E.target,0,0,0,I,P,E.format,A.type,this.data):(A.width=I,A.height=P,R.texImage2D(E.target,0,A.internalFormat,I,P,0,E.format,A.type,this.data)),!0}}class Framebuffer{constructor(_,E){this.width=Math.round(_||100),this.height=Math.round(E||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Runner("disposeFramebuffer"),this.multisample=MSAA_QUALITY.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(_=0,E){return this.colorTextures[_]=E||new BaseTexture(null,{scaleMode:SCALE_MODES.NEAREST,resolution:1,mipmap:MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(_){return this.depthTexture=_||new BaseTexture(new DepthResource(null,{width:this.width,height:this.height}),{scaleMode:SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:MIPMAP_MODES.OFF,format:FORMATS.DEPTH_COMPONENT,type:TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(_,E){if(_=Math.round(_),E=Math.round(E),!(_===this.width&&E===this.height)){this.width=_,this.height=E,this.dirtyId++,this.dirtySize++;for(let A=0;A<this.colorTextures.length;A++){const R=this.colorTextures[A],I=R.resolution;R.setSize(_/I,E/I)}if(this.depthTexture){const A=this.depthTexture.resolution;this.depthTexture.setSize(_/A,E/A)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class BaseRenderTexture extends BaseTexture{constructor(_={}){var E;if(typeof _=="number"){const A=arguments[0],R=arguments[1],I=arguments[2],P=arguments[3];_={width:A,height:R,scaleMode:I,resolution:P}}_.width=_.width||100,_.height=_.height||100,(E=_.multisample)!=null||(_.multisample=MSAA_QUALITY.NONE),super(null,_),this.mipmap=MIPMAP_MODES.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Framebuffer(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=_.multisample,this.maskStack=[],this.filterStack=[{}]}resize(_,E){this.framebuffer.resize(_*this.resolution,E*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class TextureUvs{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(_,E,A){const R=E.width,I=E.height;if(A){const P=_.width/2/R,C=_.height/2/I,D=_.x/R+P,B=_.y/I+C;A=groupD8.add(A,groupD8.NW),this.x0=D+P*groupD8.uX(A),this.y0=B+C*groupD8.uY(A),A=groupD8.add(A,2),this.x1=D+P*groupD8.uX(A),this.y1=B+C*groupD8.uY(A),A=groupD8.add(A,2),this.x2=D+P*groupD8.uX(A),this.y2=B+C*groupD8.uY(A),A=groupD8.add(A,2),this.x3=D+P*groupD8.uX(A),this.y3=B+C*groupD8.uY(A)}else this.x0=_.x/R,this.y0=_.y/I,this.x1=(_.x+_.width)/R,this.y1=_.y/I,this.x2=(_.x+_.width)/R,this.y2=(_.y+_.height)/I,this.x3=_.x/R,this.y3=(_.y+_.height)/I;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const DEFAULT_UVS=new TextureUvs;function removeAllHandlers(T){T.destroy=function(){},T.on=function(){},T.once=function(){},T.emit=function(){}}class Texture extends EventEmitter$1{constructor(_,E,A,R,I,P){if(super(),this.noFrame=!1,E||(this.noFrame=!0,E=new Rectangle(0,0,1,1)),_ instanceof Texture&&(_=_.baseTexture),this.baseTexture=_,this._frame=E,this.trim=R,this.valid=!1,this._uvs=DEFAULT_UVS,this.uvMatrix=null,this.orig=A||E,this._rotate=Number(I||0),I===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=P?new Point(P.x,P.y):new Point(0,0),this._updateID=0,this.textureCacheIds=[],_.valid?this.noFrame?_.valid&&this.onBaseTextureUpdated(_):this.frame=E:_.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&_.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(_){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=_.width,this._frame.height=_.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(_){if(this.baseTexture){if(_){const{resource:E}=this.baseTexture;(E==null?void 0:E.url)&&TextureCache[E.url]&&Texture.removeFromCache(E.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Texture.removeFromCache(this),this.textureCacheIds=null}clone(){var R;const _=this._frame.clone(),E=this._frame===this.orig?_:this.orig.clone(),A=new Texture(this.baseTexture,!this.noFrame&&_,E,(R=this.trim)==null?void 0:R.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(A._frame=_),A}updateUvs(){this._uvs===DEFAULT_UVS&&(this._uvs=new TextureUvs),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(_,E={},A=settings.STRICT_TEXTURE_CACHE){const R=typeof _=="string";let I=null;if(R)I=_;else if(_ instanceof BaseTexture){if(!_.cacheId){const C=(E==null?void 0:E.pixiIdPrefix)||"pixiid";_.cacheId=`${C}-${uid()}`,BaseTexture.addToCache(_,_.cacheId)}I=_.cacheId}else{if(!_._pixiId){const C=(E==null?void 0:E.pixiIdPrefix)||"pixiid";_._pixiId=`${C}_${uid()}`}I=_._pixiId}let P=TextureCache[I];if(R&&A&&!P)throw new Error(`The cacheId "${I}" does not exist in TextureCache.`);return!P&&!(_ instanceof BaseTexture)?(E.resolution||(E.resolution=getResolutionOfUrl(_)),P=new Texture(new BaseTexture(_,E)),P.baseTexture.cacheId=I,BaseTexture.addToCache(P.baseTexture,I),Texture.addToCache(P,I)):!P&&_ instanceof BaseTexture&&(P=new Texture(_),Texture.addToCache(P,I)),P}static fromURL(_,E){const A=Object.assign({autoLoad:!1},E==null?void 0:E.resourceOptions),R=Texture.from(_,Object.assign({resourceOptions:A},E),!1),I=R.baseTexture.resource;return R.baseTexture.valid?Promise.resolve(R):I.load().then(()=>Promise.resolve(R))}static fromBuffer(_,E,A,R){return new Texture(BaseTexture.fromBuffer(_,E,A,R))}static fromLoader(_,E,A,R){const I=new BaseTexture(_,Object.assign({scaleMode:settings.SCALE_MODE,resolution:getResolutionOfUrl(E)},R)),{resource:P}=I;P instanceof ImageResource&&(P.url=E);const C=new Texture(I);return A||(A=E),BaseTexture.addToCache(C.baseTexture,A),Texture.addToCache(C,A),A!==E&&(BaseTexture.addToCache(C.baseTexture,E),Texture.addToCache(C,E)),C.baseTexture.valid?Promise.resolve(C):new Promise(D=>{C.baseTexture.once("loaded",()=>D(C))})}static addToCache(_,E){E&&(_.textureCacheIds.includes(E)||_.textureCacheIds.push(E),TextureCache[E]&&console.warn(`Texture added to the cache with an id [${E}] that already had an entry`),TextureCache[E]=_)}static removeFromCache(_){if(typeof _=="string"){const E=TextureCache[_];if(E){const A=E.textureCacheIds.indexOf(_);return A>-1&&E.textureCacheIds.splice(A,1),delete TextureCache[_],E}}else if(_!=null&&_.textureCacheIds){for(let E=0;E<_.textureCacheIds.length;++E)TextureCache[_.textureCacheIds[E]]===_&&delete TextureCache[_.textureCacheIds[E]];return _.textureCacheIds.length=0,_}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(_){this._frame=_,this.noFrame=!1;const{x:E,y:A,width:R,height:I}=_,P=E+R>this.baseTexture.width,C=A+I>this.baseTexture.height;if(P||C){const D=P&&C?"and":"or",B=`X: ${E} + ${R} = ${E+R} > ${this.baseTexture.width}`,O=`Y: ${A} + ${I} = ${A+I} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${B} ${D} ${O}`)}this.valid=R&&I&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=_),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(_){this._rotate=_,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Texture._EMPTY||(Texture._EMPTY=new Texture(new BaseTexture),removeAllHandlers(Texture._EMPTY),removeAllHandlers(Texture._EMPTY.baseTexture)),Texture._EMPTY}static get WHITE(){if(!Texture._WHITE){const _=settings.ADAPTER.createCanvas(16,16),E=_.getContext("2d");_.width=16,_.height=16,E.fillStyle="white",E.fillRect(0,0,16,16),Texture._WHITE=new Texture(BaseTexture.from(_)),removeAllHandlers(Texture._WHITE),removeAllHandlers(Texture._WHITE.baseTexture)}return Texture._WHITE}}class RenderTexture extends Texture{constructor(_,E){super(_,E),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(_){this.framebuffer.multisample=_}resize(_,E,A=!0){const R=this.baseTexture.resolution,I=Math.round(_*R)/R,P=Math.round(E*R)/R;this.valid=I>0&&P>0,this._frame.width=this.orig.width=I,this._frame.height=this.orig.height=P,A&&this.baseTexture.resize(I,P),this.updateUvs()}setResolution(_){const{baseTexture:E}=this;E.resolution!==_&&(E.setResolution(_),this.resize(E.width,E.height,!1))}static create(_){return new RenderTexture(new BaseRenderTexture(_))}}class RenderTexturePool{constructor(_){this.texturePool={},this.textureOptions=_||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(_,E,A=MSAA_QUALITY.NONE){const R=new BaseRenderTexture(Object.assign({width:_,height:E,resolution:1,multisample:A},this.textureOptions));return new RenderTexture(R)}getOptimalTexture(_,E,A=1,R=MSAA_QUALITY.NONE){let I;_=Math.ceil(_*A-1e-6),E=Math.ceil(E*A-1e-6),!this.enableFullScreen||_!==this._pixelsWidth||E!==this._pixelsHeight?(_=nextPow2(_),E=nextPow2(E),I=((_&65535)<<16|E&65535)>>>0,R>1&&(I+=R*4294967296)):I=R>1?-R:-1,this.texturePool[I]||(this.texturePool[I]=[]);let P=this.texturePool[I].pop();return P||(P=this.createTexture(_,E,R)),P.filterPoolKey=I,P.setResolution(A),P}getFilterTexture(_,E,A){const R=this.getOptimalTexture(_.width,_.height,E||_.resolution,A||MSAA_QUALITY.NONE);return R.filterFrame=_.filterFrame,R}returnTexture(_){const E=_.filterPoolKey;_.filterFrame=null,this.texturePool[E].push(_)}returnFilterTexture(_){this.returnTexture(_)}clear(_){if(_=_!==!1,_)for(const E in this.texturePool){const A=this.texturePool[E];if(A)for(let R=0;R<A.length;R++)A[R].destroy(!0)}this.texturePool={}}setScreenSize(_){if(!(_.width===this._pixelsWidth&&_.height===this._pixelsHeight)){this.enableFullScreen=_.width>0&&_.height>0;for(const E in this.texturePool){if(!(Number(E)<0))continue;const A=this.texturePool[E];if(A)for(let R=0;R<A.length;R++)A[R].destroy(!0);this.texturePool[E]=[]}this._pixelsWidth=_.width,this._pixelsHeight=_.height}}}RenderTexturePool.SCREEN_KEY=-1;class Attribute{constructor(_,E=0,A=!1,R=TYPES.FLOAT,I,P,C){this.buffer=_,this.size=E,this.normalized=A,this.type=R,this.stride=I,this.start=P,this.instance=C}destroy(){this.buffer=null}static from(_,E,A,R,I){return new Attribute(_,E,A,R,I)}}let UID$4=0;class Buffer{constructor(_,E=!0,A=!1){this.data=_||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=A,this.static=E,this.id=UID$4++,this.disposeRunner=new Runner("disposeBuffer")}update(_){_ instanceof Array&&(_=new Float32Array(_)),this.data=_||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(_){this.type=_?BUFFER_TYPE.ELEMENT_ARRAY_BUFFER:BUFFER_TYPE.ARRAY_BUFFER}get index(){return this.type===BUFFER_TYPE.ELEMENT_ARRAY_BUFFER}static from(_){return _ instanceof Array&&(_=new Float32Array(_)),new Buffer(_)}}const map$1={Float32Array,Uint32Array,Int32Array,Uint8Array};function interleaveTypedArrays(T,_){let E=0,A=0;const R={};for(let D=0;D<T.length;D++)A+=_[D],E+=T[D].length;const I=new ArrayBuffer(E*4);let P=null,C=0;for(let D=0;D<T.length;D++){const B=_[D],O=T[D],F=getBufferType(O);R[F]||(R[F]=new map$1[F](I)),P=R[F];for(let L=0;L<O.length;L++){const U=(L/B|0)*A+C,G=L%B;P[U+G]=O[L]}C+=B}return new Float32Array(I)}const byteSizeMap$1={5126:4,5123:2,5121:1};let UID$3=0;const map={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Geometry{constructor(_=[],E={}){this.buffers=_,this.indexBuffer=null,this.attributes=E,this.glVertexArrayObjects={},this.id=UID$3++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Runner("disposeGeometry"),this.refCount=0}addAttribute(_,E,A=0,R=!1,I,P,C,D=!1){if(!E)throw new Error("You must pass a buffer when creating an attribute");E instanceof Buffer||(E instanceof Array&&(E=new Float32Array(E)),E=new Buffer(E));const B=_.split("|");if(B.length>1){for(let F=0;F<B.length;F++)this.addAttribute(B[F],E,A,R,I);return this}let O=this.buffers.indexOf(E);return O===-1&&(this.buffers.push(E),O=this.buffers.length-1),this.attributes[_]=new Attribute(O,A,R,I,P,C,D),this.instanced=this.instanced||D,this}getAttribute(_){return this.attributes[_]}getBuffer(_){return this.buffers[this.getAttribute(_).buffer]}addIndex(_){return _ instanceof Buffer||(_ instanceof Array&&(_=new Uint16Array(_)),_=new Buffer(_)),_.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER,this.indexBuffer=_,this.buffers.includes(_)||this.buffers.push(_),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const _=[],E=[],A=new Buffer;let R;for(R in this.attributes){const I=this.attributes[R],P=this.buffers[I.buffer];_.push(P.data),E.push(I.size*byteSizeMap$1[I.type]/4),I.buffer=0}for(A.data=interleaveTypedArrays(_,E),R=0;R<this.buffers.length;R++)this.buffers[R]!==this.indexBuffer&&this.buffers[R].destroy();return this.buffers=[A],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const _ in this.attributes){const E=this.attributes[_];return this.buffers[E.buffer].data.length/(E.stride/4||E.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const _=new Geometry;for(let E=0;E<this.buffers.length;E++)_.buffers[E]=new Buffer(this.buffers[E].data.slice(0));for(const E in this.attributes){const A=this.attributes[E];_.attributes[E]=new Attribute(A.buffer,A.size,A.normalized,A.type,A.stride,A.start,A.instance)}return this.indexBuffer&&(_.indexBuffer=_.buffers[this.buffers.indexOf(this.indexBuffer)],_.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER),_}static merge(_){const E=new Geometry,A=[],R=[],I=[];let P;for(let C=0;C<_.length;C++){P=_[C];for(let D=0;D<P.buffers.length;D++)R[D]=R[D]||0,R[D]+=P.buffers[D].data.length,I[D]=0}for(let C=0;C<P.buffers.length;C++)A[C]=new map[getBufferType(P.buffers[C].data)](R[C]),E.buffers[C]=new Buffer(A[C]);for(let C=0;C<_.length;C++){P=_[C];for(let D=0;D<P.buffers.length;D++)A[D].set(P.buffers[D].data,I[D]),I[D]+=P.buffers[D].data.length}if(E.attributes=P.attributes,P.indexBuffer){E.indexBuffer=E.buffers[P.buffers.indexOf(P.indexBuffer)],E.indexBuffer.type=BUFFER_TYPE.ELEMENT_ARRAY_BUFFER;let C=0,D=0,B=0,O=0;for(let F=0;F<P.buffers.length;F++)if(P.buffers[F]!==P.indexBuffer){O=F;break}for(const F in P.attributes){const L=P.attributes[F];(L.buffer|0)===O&&(D+=L.size*byteSizeMap$1[L.type]/4)}for(let F=0;F<_.length;F++){const L=_[F].indexBuffer.data;for(let U=0;U<L.length;U++)E.indexBuffer.data[U+B]+=C;C+=_[F].buffers[O].data.length/D,B+=L.length}}return E}}class Quad extends Geometry{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class QuadUv extends Geometry{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Buffer(this.vertices),this.uvBuffer=new Buffer(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(_,E){let A=0,R=0;return this.uvs[0]=A,this.uvs[1]=R,this.uvs[2]=A+E.width/_.width,this.uvs[3]=R,this.uvs[4]=A+E.width/_.width,this.uvs[5]=R+E.height/_.height,this.uvs[6]=A,this.uvs[7]=R+E.height/_.height,A=E.x,R=E.y,this.vertices[0]=A,this.vertices[1]=R,this.vertices[2]=A+E.width,this.vertices[3]=R,this.vertices[4]=A+E.width,this.vertices[5]=R+E.height,this.vertices[6]=A,this.vertices[7]=R+E.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let UID$2=0;class UniformGroup{constructor(_,E,A){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=UID$2++,this.static=!!E,this.ubo=!!A,_ instanceof Buffer?(this.buffer=_,this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=_,this.ubo&&(this.buffer=new Buffer(new Float32Array(1)),this.buffer.type=BUFFER_TYPE.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(_,E,A){if(!this.ubo)this.uniforms[_]=new UniformGroup(E,A);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(_,E,A){return new UniformGroup(_,E,A)}static uboFrom(_,E){return new UniformGroup(_,E!=null?E:!0,!0)}}class FilterState{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=MSAA_QUALITY.NONE,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.bindingSourceFrame=new Rectangle,this.bindingDestinationFrame=new Rectangle,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const tempPoints=[new Point,new Point,new Point,new Point],tempMatrix$1=new Matrix;class FilterSystem{constructor(_){this.renderer=_,this.defaultFilterStack=[{}],this.texturePool=new RenderTexturePool,this.statePool=[],this.quad=new Quad,this.quadUv=new QuadUv,this.tempRect=new Rectangle,this.activeState={},this.globalUniforms=new UniformGroup({outputFrame:new Rectangle,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(_,E){var G,X;const A=this.renderer,R=this.defaultFilterStack,I=this.statePool.pop()||new FilterState,P=this.renderer.renderTexture;let C=E[0].resolution,D=E[0].multisample,B=E[0].padding,O=E[0].autoFit,F=(G=E[0].legacy)!=null?G:!0;for(let W=1;W<E.length;W++){const V=E[W];C=Math.min(C,V.resolution),D=Math.min(D,V.multisample),B=this.useMaxPadding?Math.max(B,V.padding):B+V.padding,O=O&&V.autoFit,F=F||((X=V.legacy)!=null?X:!0)}R.length===1&&(this.defaultFilterStack[0].renderTexture=P.current),R.push(I),I.resolution=C,I.multisample=D,I.legacy=F,I.target=_,I.sourceFrame.copyFrom(_.filterArea||_.getBounds(!0)),I.sourceFrame.pad(B);const L=this.tempRect.copyFrom(P.sourceFrame);A.projection.transform&&this.transformAABB(tempMatrix$1.copyFrom(A.projection.transform).invert(),L),O?(I.sourceFrame.fit(L),(I.sourceFrame.width<=0||I.sourceFrame.height<=0)&&(I.sourceFrame.width=0,I.sourceFrame.height=0)):I.sourceFrame.intersects(L)||(I.sourceFrame.width=0,I.sourceFrame.height=0),this.roundFrame(I.sourceFrame,P.current?P.current.resolution:A.resolution,P.sourceFrame,P.destinationFrame,A.projection.transform),I.renderTexture=this.getOptimalFilterTexture(I.sourceFrame.width,I.sourceFrame.height,C,D),I.filters=E,I.destinationFrame.width=I.renderTexture.width,I.destinationFrame.height=I.renderTexture.height;const U=this.tempRect;U.x=0,U.y=0,U.width=I.sourceFrame.width,U.height=I.sourceFrame.height,I.renderTexture.filterFrame=I.sourceFrame,I.bindingSourceFrame.copyFrom(P.sourceFrame),I.bindingDestinationFrame.copyFrom(P.destinationFrame),I.transform=A.projection.transform,A.projection.transform=null,P.bind(I.renderTexture,I.sourceFrame,U),A.framebuffer.clear(0,0,0,0)}pop(){const _=this.defaultFilterStack,E=_.pop(),A=E.filters;this.activeState=E;const R=this.globalUniforms.uniforms;R.outputFrame=E.sourceFrame,R.resolution=E.resolution;const I=R.inputSize,P=R.inputPixel,C=R.inputClamp;if(I[0]=E.destinationFrame.width,I[1]=E.destinationFrame.height,I[2]=1/I[0],I[3]=1/I[1],P[0]=Math.round(I[0]*E.resolution),P[1]=Math.round(I[1]*E.resolution),P[2]=1/P[0],P[3]=1/P[1],C[0]=.5*P[2],C[1]=.5*P[3],C[2]=E.sourceFrame.width*I[2]-.5*P[2],C[3]=E.sourceFrame.height*I[3]-.5*P[3],E.legacy){const B=R.filterArea;B[0]=E.destinationFrame.width,B[1]=E.destinationFrame.height,B[2]=E.sourceFrame.x,B[3]=E.sourceFrame.y,R.filterClamp=R.inputClamp}this.globalUniforms.update();const D=_[_.length-1];if(this.renderer.framebuffer.blit(),A.length===1)A[0].apply(this,E.renderTexture,D.renderTexture,CLEAR_MODES.BLEND,E),this.returnFilterTexture(E.renderTexture);else{let B=E.renderTexture,O=this.getOptimalFilterTexture(B.width,B.height,E.resolution);O.filterFrame=B.filterFrame;let F=0;for(F=0;F<A.length-1;++F){F===1&&E.multisample>1&&(O=this.getOptimalFilterTexture(B.width,B.height,E.resolution),O.filterFrame=B.filterFrame),A[F].apply(this,B,O,CLEAR_MODES.CLEAR,E);const L=B;B=O,O=L}A[F].apply(this,B,D.renderTexture,CLEAR_MODES.BLEND,E),F>1&&E.multisample>1&&this.returnFilterTexture(E.renderTexture),this.returnFilterTexture(B),this.returnFilterTexture(O)}E.clear(),this.statePool.push(E)}bindAndClear(_,E=CLEAR_MODES.CLEAR){const{renderTexture:A,state:R}=this.renderer;if(_===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,_!=null&&_.filterFrame){const P=this.tempRect;P.x=0,P.y=0,P.width=_.filterFrame.width,P.height=_.filterFrame.height,A.bind(_,_.filterFrame,P)}else _!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?A.bind(_):this.renderer.renderTexture.bind(_,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const I=R.stateId&1||this.forceClear;(E===CLEAR_MODES.CLEAR||E===CLEAR_MODES.BLIT&&I)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(_,E,A,R){const I=this.renderer;I.state.set(_.state),this.bindAndClear(A,R),_.uniforms.uSampler=E,_.uniforms.filterGlobals=this.globalUniforms,I.shader.bind(_),_.legacy=!!_.program.attributeData.aTextureCoord,_.legacy?(this.quadUv.map(E._frame,E.filterFrame),I.geometry.bind(this.quadUv),I.geometry.draw(DRAW_MODES.TRIANGLES)):(I.geometry.bind(this.quad),I.geometry.draw(DRAW_MODES.TRIANGLE_STRIP))}calculateSpriteMatrix(_,E){const{sourceFrame:A,destinationFrame:R}=this.activeState,{orig:I}=E._texture,P=_.set(R.width,0,0,R.height,A.x,A.y),C=E.worldTransform.copyTo(Matrix.TEMP_MATRIX);return C.invert(),P.prepend(C),P.scale(1/I.width,1/I.height),P.translate(E.anchor.x,E.anchor.y),P}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(_,E,A=1,R=MSAA_QUALITY.NONE){return this.texturePool.getOptimalTexture(_,E,A,R)}getFilterTexture(_,E,A){if(typeof _=="number"){const I=_;_=E,E=I}_=_||this.activeState.renderTexture;const R=this.texturePool.getOptimalTexture(_.width,_.height,E||_.resolution,A||MSAA_QUALITY.NONE);return R.filterFrame=_.filterFrame,R}returnFilterTexture(_){this.texturePool.returnTexture(_)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(_,E){const A=tempPoints[0],R=tempPoints[1],I=tempPoints[2],P=tempPoints[3];A.set(E.left,E.top),R.set(E.left,E.bottom),I.set(E.right,E.top),P.set(E.right,E.bottom),_.apply(A,A),_.apply(R,R),_.apply(I,I),_.apply(P,P);const C=Math.min(A.x,R.x,I.x,P.x),D=Math.min(A.y,R.y,I.y,P.y),B=Math.max(A.x,R.x,I.x,P.x),O=Math.max(A.y,R.y,I.y,P.y);E.x=C,E.y=D,E.width=B-C,E.height=O-D}roundFrame(_,E,A,R,I){if(!(_.width<=0||_.height<=0||A.width<=0||A.height<=0)){if(I){const{a:P,b:C,c:D,d:B}=I;if((Math.abs(C)>1e-4||Math.abs(D)>1e-4)&&(Math.abs(P)>1e-4||Math.abs(B)>1e-4))return}I=I?tempMatrix$1.copyFrom(I):tempMatrix$1.identity(),I.translate(-A.x,-A.y).scale(R.width/A.width,R.height/A.height).translate(R.x,R.y),this.transformAABB(I,_),_.ceil(E),this.transformAABB(I.invert(),_)}}}FilterSystem.extension={type:ExtensionType.RendererSystem,name:"filter"};extensions$1.add(FilterSystem);class ObjectRenderer{constructor(_){this.renderer=_}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(_){}}class BatchSystem{constructor(_){this.renderer=_,this.emptyRenderer=new ObjectRenderer(_),this.currentRenderer=this.emptyRenderer}setObjectRenderer(_){this.currentRenderer!==_&&(this.currentRenderer.stop(),this.currentRenderer=_,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(_,E){const{boundTextures:A}=this.renderer.texture;for(let R=E-1;R>=0;--R)_[R]=A[R]||null,_[R]&&(_[R]._batchLocation=R)}boundArray(_,E,A,R){const{elements:I,ids:P,count:C}=_;let D=0;for(let B=0;B<C;B++){const O=I[B],F=O._batchLocation;if(F>=0&&F<R&&E[F]===O){P[B]=F;continue}for(;D<R;){const L=E[D];if(L&&L._batchEnabled===A&&L._batchLocation===D){D++;continue}P[B]=D,O._batchLocation=D,E[D]=O;break}}}destroy(){this.renderer=null}}BatchSystem.extension={type:ExtensionType.RendererSystem,name:"batch"};extensions$1.add(BatchSystem);let CONTEXT_UID_COUNTER=0;class ContextSystem{constructor(_){this.renderer=_,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(_){this.gl=_,this.renderer.gl=_,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,_.isContextLost()&&_.getExtension("WEBGL_lose_context")&&_.getExtension("WEBGL_lose_context").restoreContext()}init(_){var E;if(_.context)this.initFromContext(_.context);else{const A=this.renderer.background.alpha<1,R=(E=_.premultipliedAlpha)!=null?E:!0;this.preserveDrawingBuffer=_.preserveDrawingBuffer,this.useContextAlpha=_.useContextAlpha,this.powerPreference=_.powerPreference,this.initFromOptions({alpha:A,premultipliedAlpha:R,antialias:_.antialias,stencil:!0,preserveDrawingBuffer:_.preserveDrawingBuffer,powerPreference:_.powerPreference})}}initFromContext(_){this.gl=_,this.validateContext(_),this.renderer.gl=_,this.renderer.CONTEXT_UID=CONTEXT_UID_COUNTER++,this.renderer.runners.contextChange.emit(_);const E=this.renderer.view;E.addEventListener!==void 0&&(E.addEventListener("webglcontextlost",this.handleContextLost,!1),E.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(_){const E=this.createContext(this.renderer.view,_);this.initFromContext(E)}createContext(_,E){let A;if(settings.PREFER_ENV>=ENV.WEBGL2&&(A=_.getContext("webgl2",E)),A)this.webGLVersion=2;else if(this.webGLVersion=1,A=_.getContext("webgl",E)||_.getContext("experimental-webgl",E),!A)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=A,this.getExtensions(),this.gl}getExtensions(){const{gl:_}=this,E={anisotropicFiltering:_.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:_.getExtension("OES_texture_float_linear"),s3tc:_.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:_.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:_.getExtension("WEBGL_compressed_texture_etc"),etc1:_.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:_.getExtension("WEBGL_compressed_texture_pvrtc")||_.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:_.getExtension("WEBGL_compressed_texture_atc"),astc:_.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,E,{drawBuffers:_.getExtension("WEBGL_draw_buffers"),depthTexture:_.getExtension("WEBGL_depth_texture"),loseContext:_.getExtension("WEBGL_lose_context"),vertexArrayObject:_.getExtension("OES_vertex_array_object")||_.getExtension("MOZ_OES_vertex_array_object")||_.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:_.getExtension("OES_element_index_uint"),floatTexture:_.getExtension("OES_texture_float"),floatTextureLinear:_.getExtension("OES_texture_float_linear"),textureHalfFloat:_.getExtension("OES_texture_half_float"),textureHalfFloatLinear:_.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,E,{colorBufferFloat:_.getExtension("EXT_color_buffer_float")})}handleContextLost(_){_.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const _=this.renderer.view;this.renderer=null,_.removeEventListener!==void 0&&(_.removeEventListener("webglcontextlost",this.handleContextLost),_.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(_){const E=_.getContextAttributes(),A="WebGL2RenderingContext"in globalThis&&_ instanceof globalThis.WebGL2RenderingContext;A&&(this.webGLVersion=2),E&&!E.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const R=A||!!_.getExtension("OES_element_index_uint");this.supports.uint32Indices=R,R||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ContextSystem.extension={type:ExtensionType.RendererSystem,name:"context"};extensions$1.add(ContextSystem);class GLFramebuffer{constructor(_){this.framebuffer=_,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const tempRectangle=new Rectangle;class FramebufferSystem{constructor(_){this.renderer=_,this.managedFramebuffers=[],this.unknownFramebuffer=new Framebuffer(10,10),this.msaaSamples=null}contextChange(){const _=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Rectangle,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){let E=this.renderer.context.extensions.drawBuffers,A=this.renderer.context.extensions.depthTexture;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(E=null,A=null),E?_.drawBuffers=R=>E.drawBuffersWEBGL(R):(this.hasMRT=!1,_.drawBuffers=()=>{}),A||(this.writeDepthTexture=!1)}else this.msaaSamples=_.getInternalformatParameter(_.RENDERBUFFER,_.RGBA8,_.SAMPLES)}bind(_,E,A=0){const{gl:R}=this;if(_){const I=_.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(_);this.current!==_&&(this.current=_,R.bindFramebuffer(R.FRAMEBUFFER,I.framebuffer)),I.mipLevel!==A&&(_.dirtyId++,_.dirtyFormat++,I.mipLevel=A),I.dirtyId!==_.dirtyId&&(I.dirtyId=_.dirtyId,I.dirtyFormat!==_.dirtyFormat?(I.dirtyFormat=_.dirtyFormat,I.dirtySize=_.dirtySize,this.updateFramebuffer(_,A)):I.dirtySize!==_.dirtySize&&(I.dirtySize=_.dirtySize,this.resizeFramebuffer(_)));for(let P=0;P<_.colorTextures.length;P++){const C=_.colorTextures[P];this.renderer.texture.unbind(C.parentTextureArray||C)}if(_.depthTexture&&this.renderer.texture.unbind(_.depthTexture),E){const P=E.width>>A,C=E.height>>A,D=P/E.width;this.setViewport(E.x*D,E.y*D,P,C)}else{const P=_.width>>A,C=_.height>>A;this.setViewport(0,0,P,C)}}else this.current&&(this.current=null,R.bindFramebuffer(R.FRAMEBUFFER,null)),E?this.setViewport(E.x,E.y,E.width,E.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(_,E,A,R){const I=this.viewport;_=Math.round(_),E=Math.round(E),A=Math.round(A),R=Math.round(R),(I.width!==A||I.height!==R||I.x!==_||I.y!==E)&&(I.x=_,I.y=E,I.width=A,I.height=R,this.gl.viewport(_,E,A,R))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(_,E,A,R,I=BUFFER_BITS.COLOR|BUFFER_BITS.DEPTH){const{gl:P}=this;P.clearColor(_,E,A,R),P.clear(I)}initFramebuffer(_){const{gl:E}=this,A=new GLFramebuffer(E.createFramebuffer());return A.multisample=this.detectSamples(_.multisample),_.glFramebuffers[this.CONTEXT_UID]=A,this.managedFramebuffers.push(_),_.disposeRunner.add(this),A}resizeFramebuffer(_){const{gl:E}=this,A=_.glFramebuffers[this.CONTEXT_UID];A.stencil&&(E.bindRenderbuffer(E.RENDERBUFFER,A.stencil),A.msaaBuffer?E.renderbufferStorageMultisample(E.RENDERBUFFER,A.multisample,E.DEPTH24_STENCIL8,_.width,_.height):E.renderbufferStorage(E.RENDERBUFFER,E.DEPTH_STENCIL,_.width,_.height));const R=_.colorTextures;let I=R.length;E.drawBuffers||(I=Math.min(I,1));for(let P=0;P<I;P++){const C=R[P],D=C.parentTextureArray||C;this.renderer.texture.bind(D,0),P===0&&A.msaaBuffer&&(E.bindRenderbuffer(E.RENDERBUFFER,A.msaaBuffer),E.renderbufferStorageMultisample(E.RENDERBUFFER,A.multisample,D._glTextures[this.CONTEXT_UID].internalFormat,_.width,_.height))}_.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(_.depthTexture,0)}updateFramebuffer(_,E){const{gl:A}=this,R=_.glFramebuffers[this.CONTEXT_UID],I=_.colorTextures;let P=I.length;A.drawBuffers||(P=Math.min(P,1)),R.multisample>1&&this.canMultisampleFramebuffer(_)?R.msaaBuffer=R.msaaBuffer||A.createRenderbuffer():R.msaaBuffer&&(A.deleteRenderbuffer(R.msaaBuffer),R.msaaBuffer=null,R.blitFramebuffer&&(R.blitFramebuffer.dispose(),R.blitFramebuffer=null));const C=[];for(let D=0;D<P;D++){const B=I[D],O=B.parentTextureArray||B;this.renderer.texture.bind(O,0),D===0&&R.msaaBuffer?(A.bindRenderbuffer(A.RENDERBUFFER,R.msaaBuffer),A.renderbufferStorageMultisample(A.RENDERBUFFER,R.multisample,O._glTextures[this.CONTEXT_UID].internalFormat,_.width,_.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.RENDERBUFFER,R.msaaBuffer)):(A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0+D,B.target,O._glTextures[this.CONTEXT_UID].texture,E),C.push(A.COLOR_ATTACHMENT0+D))}if(C.length>1&&A.drawBuffers(C),_.depthTexture&&this.writeDepthTexture){const B=_.depthTexture;this.renderer.texture.bind(B,0),A.framebufferTexture2D(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.TEXTURE_2D,B._glTextures[this.CONTEXT_UID].texture,E)}(_.stencil||_.depth)&&!(_.depthTexture&&this.writeDepthTexture)?(R.stencil=R.stencil||A.createRenderbuffer(),A.bindRenderbuffer(A.RENDERBUFFER,R.stencil),R.msaaBuffer?A.renderbufferStorageMultisample(A.RENDERBUFFER,R.multisample,A.DEPTH24_STENCIL8,_.width,_.height):A.renderbufferStorage(A.RENDERBUFFER,A.DEPTH_STENCIL,_.width,_.height),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,R.stencil)):R.stencil&&(A.deleteRenderbuffer(R.stencil),R.stencil=null)}canMultisampleFramebuffer(_){return this.renderer.context.webGLVersion!==1&&_.colorTextures.length<=1&&!_.depthTexture}detectSamples(_){const{msaaSamples:E}=this;let A=MSAA_QUALITY.NONE;if(_<=1||E===null)return A;for(let R=0;R<E.length;R++)if(E[R]<=_){A=E[R];break}return A===1&&(A=MSAA_QUALITY.NONE),A}blit(_,E,A){const{current:R,renderer:I,gl:P,CONTEXT_UID:C}=this;if(I.context.webGLVersion!==2||!R)return;const D=R.glFramebuffers[C];if(!D)return;if(!_){if(!D.msaaBuffer)return;const O=R.colorTextures[0];if(!O)return;D.blitFramebuffer||(D.blitFramebuffer=new Framebuffer(R.width,R.height),D.blitFramebuffer.addColorTexture(0,O)),_=D.blitFramebuffer,_.colorTextures[0]!==O&&(_.colorTextures[0]=O,_.dirtyId++,_.dirtyFormat++),(_.width!==R.width||_.height!==R.height)&&(_.width=R.width,_.height=R.height,_.dirtyId++,_.dirtySize++)}E||(E=tempRectangle,E.width=R.width,E.height=R.height),A||(A=E);const B=E.width===A.width&&E.height===A.height;this.bind(_),P.bindFramebuffer(P.READ_FRAMEBUFFER,D.framebuffer),P.blitFramebuffer(E.left,E.top,E.right,E.bottom,A.left,A.top,A.right,A.bottom,P.COLOR_BUFFER_BIT,B?P.NEAREST:P.LINEAR)}disposeFramebuffer(_,E){const A=_.glFramebuffers[this.CONTEXT_UID],R=this.gl;if(!A)return;delete _.glFramebuffers[this.CONTEXT_UID];const I=this.managedFramebuffers.indexOf(_);I>=0&&this.managedFramebuffers.splice(I,1),_.disposeRunner.remove(this),E||(R.deleteFramebuffer(A.framebuffer),A.msaaBuffer&&R.deleteRenderbuffer(A.msaaBuffer),A.stencil&&R.deleteRenderbuffer(A.stencil)),A.blitFramebuffer&&A.blitFramebuffer.dispose()}disposeAll(_){const E=this.managedFramebuffers;this.managedFramebuffers=[];for(let A=0;A<E.length;A++)this.disposeFramebuffer(E[A],_)}forceStencil(){const _=this.current;if(!_)return;const E=_.glFramebuffers[this.CONTEXT_UID];if(!E||E.stencil)return;_.stencil=!0;const A=_.width,R=_.height,I=this.gl,P=I.createRenderbuffer();I.bindRenderbuffer(I.RENDERBUFFER,P),E.msaaBuffer?I.renderbufferStorageMultisample(I.RENDERBUFFER,E.multisample,I.DEPTH24_STENCIL8,A,R):I.renderbufferStorage(I.RENDERBUFFER,I.DEPTH_STENCIL,A,R),E.stencil=P,I.framebufferRenderbuffer(I.FRAMEBUFFER,I.DEPTH_STENCIL_ATTACHMENT,I.RENDERBUFFER,P)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Rectangle}destroy(){this.renderer=null}}FramebufferSystem.extension={type:ExtensionType.RendererSystem,name:"framebuffer"};extensions$1.add(FramebufferSystem);const byteSizeMap={5126:4,5123:2,5121:1};class GeometrySystem{constructor(_){this.renderer=_,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const _=this.gl=this.renderer.gl,E=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,E.webGLVersion!==2){let A=this.renderer.context.extensions.vertexArrayObject;settings.PREFER_ENV===ENV.WEBGL_LEGACY&&(A=null),A?(_.createVertexArray=()=>A.createVertexArrayOES(),_.bindVertexArray=R=>A.bindVertexArrayOES(R),_.deleteVertexArray=R=>A.deleteVertexArrayOES(R)):(this.hasVao=!1,_.createVertexArray=()=>null,_.bindVertexArray=()=>null,_.deleteVertexArray=()=>null)}if(E.webGLVersion!==2){const A=_.getExtension("ANGLE_instanced_arrays");A?(_.vertexAttribDivisor=(R,I)=>A.vertexAttribDivisorANGLE(R,I),_.drawElementsInstanced=(R,I,P,C,D)=>A.drawElementsInstancedANGLE(R,I,P,C,D),_.drawArraysInstanced=(R,I,P,C)=>A.drawArraysInstancedANGLE(R,I,P,C)):this.hasInstance=!1}this.canUseUInt32ElementIndex=E.webGLVersion===2||!!E.extensions.uint32ElementIndex}bind(_,E){E=E||this.renderer.shader.shader;const{gl:A}=this;let R=_.glVertexArrayObjects[this.CONTEXT_UID],I=!1;R||(this.managedGeometries[_.id]=_,_.disposeRunner.add(this),_.glVertexArrayObjects[this.CONTEXT_UID]=R={},I=!0);const P=R[E.program.id]||this.initGeometryVao(_,E,I);this._activeGeometry=_,this._activeVao!==P&&(this._activeVao=P,this.hasVao?A.bindVertexArray(P):this.activateVao(_,E.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const _=this._activeGeometry,E=this.renderer.buffer;for(let A=0;A<_.buffers.length;A++){const R=_.buffers[A];E.update(R)}}checkCompatibility(_,E){const A=_.attributes,R=E.attributeData;for(const I in R)if(!A[I])throw new Error(`shader and geometry incompatible, geometry missing the "${I}" attribute`)}getSignature(_,E){const A=_.attributes,R=E.attributeData,I=["g",_.id];for(const P in A)R[P]&&I.push(P,R[P].location);return I.join("-")}initGeometryVao(_,E,A=!0){const R=this.gl,I=this.CONTEXT_UID,P=this.renderer.buffer,C=E.program;C.glPrograms[I]||this.renderer.shader.generateProgram(E),this.checkCompatibility(_,C);const D=this.getSignature(_,C),B=_.glVertexArrayObjects[this.CONTEXT_UID];let O=B[D];if(O)return B[C.id]=O,O;const F=_.buffers,L=_.attributes,U={},G={};for(const X in F)U[X]=0,G[X]=0;for(const X in L)!L[X].size&&C.attributeData[X]?L[X].size=C.attributeData[X].size:L[X].size||console.warn(`PIXI Geometry attribute '${X}' size cannot be determined (likely the bound shader does not have the attribute)`),U[L[X].buffer]+=L[X].size*byteSizeMap[L[X].type];for(const X in L){const W=L[X],V=W.size;W.stride===void 0&&(U[W.buffer]===V*byteSizeMap[W.type]?W.stride=0:W.stride=U[W.buffer]),W.start===void 0&&(W.start=G[W.buffer],G[W.buffer]+=V*byteSizeMap[W.type])}O=R.createVertexArray(),R.bindVertexArray(O);for(let X=0;X<F.length;X++){const W=F[X];P.bind(W),A&&W._glBuffers[I].refCount++}return this.activateVao(_,C),B[C.id]=O,B[D]=O,R.bindVertexArray(null),P.unbind(BUFFER_TYPE.ARRAY_BUFFER),O}disposeGeometry(_,E){var C;if(!this.managedGeometries[_.id])return;delete this.managedGeometries[_.id];const A=_.glVertexArrayObjects[this.CONTEXT_UID],R=this.gl,I=_.buffers,P=(C=this.renderer)==null?void 0:C.buffer;if(_.disposeRunner.remove(this),!!A){if(P)for(let D=0;D<I.length;D++){const B=I[D]._glBuffers[this.CONTEXT_UID];B&&(B.refCount--,B.refCount===0&&!E&&P.dispose(I[D],E))}if(!E){for(const D in A)if(D[0]==="g"){const B=A[D];this._activeVao===B&&this.unbind(),R.deleteVertexArray(B)}}delete _.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(_){const E=Object.keys(this.managedGeometries);for(let A=0;A<E.length;A++)this.disposeGeometry(this.managedGeometries[E[A]],_)}activateVao(_,E){const A=this.gl,R=this.CONTEXT_UID,I=this.renderer.buffer,P=_.buffers,C=_.attributes;_.indexBuffer&&I.bind(_.indexBuffer);let D=null;for(const B in C){const O=C[B],F=P[O.buffer],L=F._glBuffers[R];if(E.attributeData[B]){D!==L&&(I.bind(F),D=L);const U=E.attributeData[B].location;if(A.enableVertexAttribArray(U),A.vertexAttribPointer(U,O.size,O.type||A.FLOAT,O.normalized,O.stride,O.start),O.instance)if(this.hasInstance)A.vertexAttribDivisor(U,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(_,E,A,R){const{gl:I}=this,P=this._activeGeometry;if(P.indexBuffer){const C=P.indexBuffer.data.BYTES_PER_ELEMENT,D=C===2?I.UNSIGNED_SHORT:I.UNSIGNED_INT;C===2||C===4&&this.canUseUInt32ElementIndex?P.instanced?I.drawElementsInstanced(_,E||P.indexBuffer.data.length,D,(A||0)*C,R||1):I.drawElements(_,E||P.indexBuffer.data.length,D,(A||0)*C):console.warn("unsupported index buffer type: uint32")}else P.instanced?I.drawArraysInstanced(_,A,E||P.getSize(),R||1):I.drawArrays(_,A,E||P.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}GeometrySystem.extension={type:ExtensionType.RendererSystem,name:"geometry"};extensions$1.add(GeometrySystem);class MaskData{constructor(_=null){this.type=MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=_||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(_){_?this._filters?this._filters[0]=_:this._filters=[_]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=MASK_TYPES.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(_){_?(this._stencilCounter=_._stencilCounter,this._scissorCounter=_._scissorCounter,this._scissorRect=_._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}function compileShader(T,_,E){const A=T.createShader(_);return T.shaderSource(A,E),T.compileShader(A),A}function logPrettyShaderError(T,_){const E=T.getShaderSource(_).split(`
`).map((B,O)=>`${O}: ${B}`),A=T.getShaderInfoLog(_),R=A.split(`
`),I={},P=R.map(B=>parseFloat(B.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(B=>B&&!I[B]?(I[B]=!0,!0):!1),C=[""];P.forEach(B=>{E[B-1]=`%c${E[B-1]}%c`,C.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const D=E.join(`
`);C[0]=D,console.error(A),console.groupCollapsed("click to view full shader code"),console.warn(...C),console.groupEnd()}function logProgramError(T,_,E,A){T.getProgramParameter(_,T.LINK_STATUS)||(T.getShaderParameter(E,T.COMPILE_STATUS)||logPrettyShaderError(T,E),T.getShaderParameter(A,T.COMPILE_STATUS)||logPrettyShaderError(T,A),console.error("PixiJS Error: Could not initialize shader."),T.getProgramInfoLog(_)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",T.getProgramInfoLog(_)))}function booleanArray(T){const _=new Array(T);for(let E=0;E<_.length;E++)_[E]=!1;return _}function defaultValue(T,_){switch(T){case"float":return 0;case"vec2":return new Float32Array(2*_);case"vec3":return new Float32Array(3*_);case"vec4":return new Float32Array(4*_);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*_);case"ivec3":return new Int32Array(3*_);case"ivec4":return new Int32Array(4*_);case"uvec2":return new Uint32Array(2*_);case"uvec3":return new Uint32Array(3*_);case"uvec4":return new Uint32Array(4*_);case"bool":return!1;case"bvec2":return booleanArray(2*_);case"bvec3":return booleanArray(3*_);case"bvec4":return booleanArray(4*_);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const unknownContext={};let context=unknownContext;function getTestContext(){if(context===unknownContext||(context==null?void 0:context.isContextLost())){const T=settings.ADAPTER.createCanvas();let _;settings.PREFER_ENV>=ENV.WEBGL2&&(_=T.getContext("webgl2",{})),_||(_=T.getContext("webgl",{})||T.getContext("experimental-webgl",{}),_?_.getExtension("WEBGL_draw_buffers"):_=null),context=_}return context}let maxFragmentPrecision;function getMaxFragmentPrecision(){if(!maxFragmentPrecision){maxFragmentPrecision=PRECISION.MEDIUM;const T=getTestContext();T&&T.getShaderPrecisionFormat&&(maxFragmentPrecision=T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.HIGH_FLOAT).precision?PRECISION.HIGH:PRECISION.MEDIUM)}return maxFragmentPrecision}function setPrecision(T,_,E){if(T.substring(0,9)!=="precision"){let A=_;return _===PRECISION.HIGH&&E!==PRECISION.HIGH&&(A=PRECISION.MEDIUM),`precision ${A} float;
${T}`}else if(E!==PRECISION.HIGH&&T.substring(0,15)==="precision highp")return T.replace("precision highp","precision mediump");return T}const GLSL_TO_SIZE={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function mapSize(T){return GLSL_TO_SIZE[T]}let GL_TABLE=null;const GL_TO_GLSL_TYPES={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function mapType(T,_){if(!GL_TABLE){const E=Object.keys(GL_TO_GLSL_TYPES);GL_TABLE={};for(let A=0;A<E.length;++A){const R=E[A];GL_TABLE[T[R]]=GL_TO_GLSL_TYPES[R]}}return GL_TABLE[_]}const uniformParsers=[{test:T=>T.type==="float"&&T.size===1&&!T.isArray,code:T=>`
            if(uv["${T}"] !== ud["${T}"].value)
            {
                ud["${T}"].value = uv["${T}"]
                gl.uniform1f(ud["${T}"].location, uv["${T}"])
            }
            `},{test:(T,_)=>(T.type==="sampler2D"||T.type==="samplerCube"||T.type==="sampler2DArray")&&T.size===1&&!T.isArray&&(_==null||_.castToBaseTexture!==void 0),code:T=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${T}"], t);

            if(ud["${T}"].value !== t)
            {
                ud["${T}"].value = t;
                gl.uniform1i(ud["${T}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(T,_)=>T.type==="mat3"&&T.size===1&&!T.isArray&&_.a!==void 0,code:T=>`
            gl.uniformMatrix3fv(ud["${T}"].location, false, uv["${T}"].toArray(true));
            `,codeUbo:T=>`
                var ${T}_matrix = uv.${T}.toArray(true);

                data[offset] = ${T}_matrix[0];
                data[offset+1] = ${T}_matrix[1];
                data[offset+2] = ${T}_matrix[2];
        
                data[offset + 4] = ${T}_matrix[3];
                data[offset + 5] = ${T}_matrix[4];
                data[offset + 6] = ${T}_matrix[5];
        
                data[offset + 8] = ${T}_matrix[6];
                data[offset + 9] = ${T}_matrix[7];
                data[offset + 10] = ${T}_matrix[8];
            `},{test:(T,_)=>T.type==="vec2"&&T.size===1&&!T.isArray&&_.x!==void 0,code:T=>`
                cv = ud["${T}"].value;
                v = uv["${T}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${T}"].location, v.x, v.y);
                }`,codeUbo:T=>`
                v = uv.${T};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:T=>T.type==="vec2"&&T.size===1&&!T.isArray,code:T=>`
                cv = ud["${T}"].value;
                v = uv["${T}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${T}"].location, v[0], v[1]);
                }
            `},{test:(T,_)=>T.type==="vec4"&&T.size===1&&!T.isArray&&_.width!==void 0,code:T=>`
                cv = ud["${T}"].value;
                v = uv["${T}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${T}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:T=>`
                    v = uv.${T};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:T=>T.type==="vec4"&&T.size===1&&!T.isArray,code:T=>`
                cv = ud["${T}"].value;
                v = uv["${T}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${T}"].location, v[0], v[1], v[2], v[3])
                }`}],GLSL_TO_SINGLE_SETTERS_CACHED={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},GLSL_TO_ARRAY_SETTERS={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function generateUniformsSync(T,_){var A;const E=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const R in T.uniforms){const I=_[R];if(!I){(A=T.uniforms[R])!=null&&A.group&&(T.uniforms[R].ubo?E.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${R}, '${R}');
                    `):E.push(`
                        renderer.shader.syncUniformGroup(uv.${R}, syncData);
                    `));continue}const P=T.uniforms[R];let C=!1;for(let D=0;D<uniformParsers.length;D++)if(uniformParsers[D].test(I,P)){E.push(uniformParsers[D].code(R,P)),C=!0;break}if(!C){const B=(I.size===1&&!I.isArray?GLSL_TO_SINGLE_SETTERS_CACHED:GLSL_TO_ARRAY_SETTERS)[I.type].replace("location",`ud["${R}"].location`);E.push(`
            cu = ud["${R}"];
            cv = cu.value;
            v = uv["${R}"];
            ${B};`)}}return new Function("ud","uv","renderer","syncData",E.join(`
`))}const fragTemplate=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function generateIfTestSrc(T){let _="";for(let E=0;E<T;++E)E>0&&(_+=`
else `),E<T-1&&(_+=`if(test == ${E}.0){}`);return _}function checkMaxIfStatementsInShader(T,_){if(T===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const E=_.createShader(_.FRAGMENT_SHADER);for(;;){const A=fragTemplate.replace(/%forloop%/gi,generateIfTestSrc(T));if(_.shaderSource(E,A),_.compileShader(E),!_.getShaderParameter(E,_.COMPILE_STATUS))T=T/2|0;else break}return T}let unsafeEval;function unsafeEvalSupported(){if(typeof unsafeEval=="boolean")return unsafeEval;try{unsafeEval=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{unsafeEval=!1}return unsafeEval}var defaultFragment$2=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,defaultVertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;let UID$1=0;const nameCache={};class Program{constructor(_,E,A="pixi-shader",R={}){this.extra={},this.id=UID$1++,this.vertexSrc=_||Program.defaultVertexSrc,this.fragmentSrc=E||Program.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=R,this.vertexSrc.substring(0,8)!=="#version"&&(A=A.replace(/\s+/g,"-"),nameCache[A]?(nameCache[A]++,A+=`-${nameCache[A]}`):nameCache[A]=1,this.vertexSrc=`#define SHADER_NAME ${A}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${A}
${this.fragmentSrc}`,this.vertexSrc=setPrecision(this.vertexSrc,settings.PRECISION_VERTEX,PRECISION.HIGH),this.fragmentSrc=setPrecision(this.fragmentSrc,settings.PRECISION_FRAGMENT,getMaxFragmentPrecision())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return defaultVertex$2}static get defaultFragmentSrc(){return defaultFragment$2}static from(_,E,A){const R=_+E;let I=ProgramCache[R];return I||(ProgramCache[R]=I=new Program(_,E,A)),I}}class Shader{constructor(_,E){this.uniformBindCount=0,this.program=_,E?E instanceof UniformGroup?this.uniformGroup=E:this.uniformGroup=new UniformGroup(E):this.uniformGroup=new UniformGroup({}),this.disposeRunner=new Runner("disposeShader")}checkUniformExists(_,E){if(E.uniforms[_])return!0;for(const A in E.uniforms){const R=E.uniforms[A];if(R.group&&this.checkUniformExists(_,R))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(_,E,A){const R=Program.from(_,E);return new Shader(R,A)}}const BLEND$1=0,OFFSET$1=1,CULLING$1=2,DEPTH_TEST$1=3,WINDING$1=4,DEPTH_MASK$1=5;class State$1{constructor(){this.data=0,this.blendMode=BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<BLEND$1)}set blend(_){!!(this.data&1<<BLEND$1)!==_&&(this.data^=1<<BLEND$1)}get offsets(){return!!(this.data&1<<OFFSET$1)}set offsets(_){!!(this.data&1<<OFFSET$1)!==_&&(this.data^=1<<OFFSET$1)}get culling(){return!!(this.data&1<<CULLING$1)}set culling(_){!!(this.data&1<<CULLING$1)!==_&&(this.data^=1<<CULLING$1)}get depthTest(){return!!(this.data&1<<DEPTH_TEST$1)}set depthTest(_){!!(this.data&1<<DEPTH_TEST$1)!==_&&(this.data^=1<<DEPTH_TEST$1)}get depthMask(){return!!(this.data&1<<DEPTH_MASK$1)}set depthMask(_){!!(this.data&1<<DEPTH_MASK$1)!==_&&(this.data^=1<<DEPTH_MASK$1)}get clockwiseFrontFace(){return!!(this.data&1<<WINDING$1)}set clockwiseFrontFace(_){!!(this.data&1<<WINDING$1)!==_&&(this.data^=1<<WINDING$1)}get blendMode(){return this._blendMode}set blendMode(_){this.blend=_!==BLEND_MODES.NONE,this._blendMode=_}get polygonOffset(){return this._polygonOffset}set polygonOffset(_){this.offsets=!!_,this._polygonOffset=_}static for2d(){const _=new State$1;return _.depthTest=!1,_.blend=!0,_}}var defaultFragment$1=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,defaultVertex$1=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;class Filter extends Shader{constructor(_,E,A){const R=Program.from(_||Filter.defaultVertexSrc,E||Filter.defaultFragmentSrc);super(R,A),this.padding=0,this.resolution=settings.FILTER_RESOLUTION,this.multisample=settings.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new State$1}apply(_,E,A,R,I){_.applyFilter(this,E,A,R)}get blendMode(){return this.state.blendMode}set blendMode(_){this.state.blendMode=_}get resolution(){return this._resolution}set resolution(_){this._resolution=_}static get defaultVertexSrc(){return defaultVertex$1}static get defaultFragmentSrc(){return defaultFragment$1}}var vertex$2=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,fragment$3=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`;const tempMat$1=new Matrix;class TextureMatrix{constructor(_,E){this._texture=_,this.mapCoord=new Matrix,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof E>"u"?.5:E,this.isSimple=!1}get texture(){return this._texture}set texture(_){this._texture=_,this._textureID=-1}multiplyUvs(_,E){E===void 0&&(E=_);const A=this.mapCoord;for(let R=0;R<_.length;R+=2){const I=_[R],P=_[R+1];E[R]=I*A.a+P*A.c+A.tx,E[R+1]=I*A.b+P*A.d+A.ty}return E}update(_){const E=this._texture;if(!E||!E.valid||!_&&this._textureID===E._updateID)return!1;this._textureID=E._updateID,this._updateID++;const A=E._uvs;this.mapCoord.set(A.x1-A.x0,A.y1-A.y0,A.x3-A.x0,A.y3-A.y0,A.x0,A.y0);const R=E.orig,I=E.trim;I&&(tempMat$1.set(R.width/I.width,0,0,R.height/I.height,-I.x/I.width,-I.y/I.height),this.mapCoord.append(tempMat$1));const P=E.baseTexture,C=this.uClampFrame,D=this.clampMargin/P.resolution,B=this.clampOffset;return C[0]=(E._frame.x+D+B)/P.width,C[1]=(E._frame.y+D+B)/P.height,C[2]=(E._frame.x+E._frame.width-D+B)/P.width,C[3]=(E._frame.y+E._frame.height-D+B)/P.height,this.uClampOffset[0]=B/P.realWidth,this.uClampOffset[1]=B/P.realHeight,this.isSimple=E._frame.width===P.width&&E._frame.height===P.height&&E.rotate===0,!0}}class SpriteMaskFilter extends Filter{constructor(_,E,A){let R=null;typeof _!="string"&&E===void 0&&A===void 0&&(R=_,_=void 0,E=void 0,A=void 0),super(_||vertex$2,E||fragment$3,A),this.maskSprite=R,this.maskMatrix=new Matrix}get maskSprite(){return this._maskSprite}set maskSprite(_){this._maskSprite=_,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(_,E,A,R){const I=this._maskSprite,P=I._texture;!P.valid||(P.uvMatrix||(P.uvMatrix=new TextureMatrix(P,0)),P.uvMatrix.update(),this.uniforms.npmAlpha=P.baseTexture.alphaMode?0:1,this.uniforms.mask=P,this.uniforms.otherMatrix=_.calculateSpriteMatrix(this.maskMatrix,I).prepend(P.uvMatrix.mapCoord),this.uniforms.alpha=I.worldAlpha,this.uniforms.maskClamp=P.uvMatrix.uClampFrame,_.applyFilter(this,E,A,R))}}class MaskSystem{constructor(_){this.renderer=_,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(_){this.maskStack=_,this.renderer.scissor.setMaskStack(_),this.renderer.stencil.setMaskStack(_)}push(_,E){let A=E;if(!A.isMaskData){const I=this.maskDataPool.pop()||new MaskData;I.pooled=!0,I.maskObject=E,A=I}const R=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(A.copyCountersOrReset(R),A._colorMask=R?R._colorMask:15,A.autoDetect&&this.detect(A),A._target=_,A.type!==MASK_TYPES.SPRITE&&this.maskStack.push(A),A.enabled)switch(A.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.push(A);break;case MASK_TYPES.STENCIL:this.renderer.stencil.push(A);break;case MASK_TYPES.SPRITE:A.copyCountersOrReset(null),this.pushSpriteMask(A);break;case MASK_TYPES.COLOR:this.pushColorMask(A);break}A.type===MASK_TYPES.SPRITE&&this.maskStack.push(A)}pop(_){const E=this.maskStack.pop();if(!(!E||E._target!==_)){if(E.enabled)switch(E.type){case MASK_TYPES.SCISSOR:this.renderer.scissor.pop(E);break;case MASK_TYPES.STENCIL:this.renderer.stencil.pop(E.maskObject);break;case MASK_TYPES.SPRITE:this.popSpriteMask(E);break;case MASK_TYPES.COLOR:this.popColorMask(E);break}if(E.reset(),E.pooled&&this.maskDataPool.push(E),this.maskStack.length!==0){const A=this.maskStack[this.maskStack.length-1];A.type===MASK_TYPES.SPRITE&&A._filters&&(A._filters[0].maskSprite=A.maskObject)}}}detect(_){const E=_.maskObject;E?E.isSprite?_.type=MASK_TYPES.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(_)?_.type=MASK_TYPES.SCISSOR:_.type=MASK_TYPES.STENCIL:_.type=MASK_TYPES.COLOR}pushSpriteMask(_){var O,F;const{maskObject:E}=_,A=_._target;let R=_._filters;R||(R=this.alphaMaskPool[this.alphaMaskIndex],R||(R=this.alphaMaskPool[this.alphaMaskIndex]=[new SpriteMaskFilter]));const I=this.renderer,P=I.renderTexture;let C,D;if(P.current){const L=P.current;C=_.resolution||L.resolution,D=(O=_.multisample)!=null?O:L.multisample}else C=_.resolution||I.resolution,D=(F=_.multisample)!=null?F:I.multisample;R[0].resolution=C,R[0].multisample=D,R[0].maskSprite=E;const B=A.filterArea;A.filterArea=E.getBounds(!0),I.filter.push(A,R),A.filterArea=B,_._filters||this.alphaMaskIndex++}popSpriteMask(_){this.renderer.filter.pop(),_._filters?_._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(_){const E=_._colorMask,A=_._colorMask=E&_.colorMask;A!==E&&this.renderer.gl.colorMask((A&1)!==0,(A&2)!==0,(A&4)!==0,(A&8)!==0)}popColorMask(_){const E=_._colorMask,A=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;A!==E&&this.renderer.gl.colorMask((A&1)!==0,(A&2)!==0,(A&4)!==0,(A&8)!==0)}destroy(){this.renderer=null}}MaskSystem.extension={type:ExtensionType.RendererSystem,name:"mask"};extensions$1.add(MaskSystem);class AbstractMaskSystem{constructor(_){this.renderer=_,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(_){const{gl:E}=this.renderer,A=this.getStackLength();this.maskStack=_;const R=this.getStackLength();R!==A&&(R===0?E.disable(this.glConst):(E.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const tempMatrix=new Matrix,rectPool=[],_ScissorSystem=class extends AbstractMaskSystem{constructor(T){super(T),this.glConst=settings.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const T=this.maskStack[this.maskStack.length-1];return T?T._scissorCounter:0}calcScissorRect(T){var P;if(T._scissorRectLocal)return;const _=T._scissorRect,{maskObject:E}=T,{renderer:A}=this,R=A.renderTexture,I=E.getBounds(!0,(P=rectPool.pop())!=null?P:new Rectangle);this.roundFrameToPixels(I,R.current?R.current.resolution:A.resolution,R.sourceFrame,R.destinationFrame,A.projection.transform),_&&I.fit(_),T._scissorRectLocal=I}static isMatrixRotated(T){if(!T)return!1;const{a:_,b:E,c:A,d:R}=T;return(Math.abs(E)>1e-4||Math.abs(A)>1e-4)&&(Math.abs(_)>1e-4||Math.abs(R)>1e-4)}testScissor(T){const{maskObject:_}=T;if(!_.isFastRect||!_.isFastRect()||_ScissorSystem.isMatrixRotated(_.worldTransform)||_ScissorSystem.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(T);const E=T._scissorRectLocal;return E.width>0&&E.height>0}roundFrameToPixels(T,_,E,A,R){_ScissorSystem.isMatrixRotated(R)||(R=R?tempMatrix.copyFrom(R):tempMatrix.identity(),R.translate(-E.x,-E.y).scale(A.width/E.width,A.height/E.height).translate(A.x,A.y),this.renderer.filter.transformAABB(R,T),T.fit(A),T.x=Math.round(T.x*_),T.y=Math.round(T.y*_),T.width=Math.round(T.width*_),T.height=Math.round(T.height*_))}push(T){T._scissorRectLocal||this.calcScissorRect(T);const{gl:_}=this.renderer;T._scissorRect||_.enable(_.SCISSOR_TEST),T._scissorCounter++,T._scissorRect=T._scissorRectLocal,this._useCurrent()}pop(T){const{gl:_}=this.renderer;T&&rectPool.push(T._scissorRectLocal),this.getStackLength()>0?this._useCurrent():_.disable(_.SCISSOR_TEST)}_useCurrent(){const T=this.maskStack[this.maskStack.length-1]._scissorRect;let _;this.renderer.renderTexture.current?_=T.y:_=this.renderer.height-T.height-T.y,this.renderer.gl.scissor(T.x,_,T.width,T.height)}};let ScissorSystem=_ScissorSystem;ScissorSystem.extension={type:ExtensionType.RendererSystem,name:"scissor"};extensions$1.add(ScissorSystem);class StencilSystem extends AbstractMaskSystem{constructor(_){super(_),this.glConst=settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const _=this.maskStack[this.maskStack.length-1];return _?_._stencilCounter:0}push(_){const E=_.maskObject,{gl:A}=this.renderer,R=_._stencilCounter;R===0&&(this.renderer.framebuffer.forceStencil(),A.clearStencil(0),A.clear(A.STENCIL_BUFFER_BIT),A.enable(A.STENCIL_TEST)),_._stencilCounter++;const I=_._colorMask;I!==0&&(_._colorMask=0,A.colorMask(!1,!1,!1,!1)),A.stencilFunc(A.EQUAL,R,4294967295),A.stencilOp(A.KEEP,A.KEEP,A.INCR),E.renderable=!0,E.render(this.renderer),this.renderer.batch.flush(),E.renderable=!1,I!==0&&(_._colorMask=I,A.colorMask((I&1)!==0,(I&2)!==0,(I&4)!==0,(I&8)!==0)),this._useCurrent()}pop(_){const E=this.renderer.gl;if(this.getStackLength()===0)E.disable(E.STENCIL_TEST);else{const A=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,R=A?A._colorMask:15;R!==0&&(A._colorMask=0,E.colorMask(!1,!1,!1,!1)),E.stencilOp(E.KEEP,E.KEEP,E.DECR),_.renderable=!0,_.render(this.renderer),this.renderer.batch.flush(),_.renderable=!1,R!==0&&(A._colorMask=R,E.colorMask((R&1)!==0,(R&2)!==0,(R&4)!==0,(R&8)!==0)),this._useCurrent()}}_useCurrent(){const _=this.renderer.gl;_.stencilFunc(_.EQUAL,this.getStackLength(),4294967295),_.stencilOp(_.KEEP,_.KEEP,_.KEEP)}}StencilSystem.extension={type:ExtensionType.RendererSystem,name:"stencil"};extensions$1.add(StencilSystem);class ProjectionSystem{constructor(_){this.renderer=_,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Matrix,this.transform=null}update(_,E,A,R){this.destinationFrame=_||this.destinationFrame||this.defaultFrame,this.sourceFrame=E||this.sourceFrame||_,this.calculateProjection(this.destinationFrame,this.sourceFrame,A,R),this.transform&&this.projectionMatrix.append(this.transform);const I=this.renderer;I.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,I.globalUniforms.update(),I.shader.shader&&I.shader.syncUniformGroup(I.shader.shader.uniforms.globals)}calculateProjection(_,E,A,R){const I=this.projectionMatrix,P=R?-1:1;I.identity(),I.a=1/E.width*2,I.d=P*(1/E.height*2),I.tx=-1-E.x*I.a,I.ty=-P-E.y*I.d}setTransform(_){}destroy(){this.renderer=null}}ProjectionSystem.extension={type:ExtensionType.RendererSystem,name:"projection"};extensions$1.add(ProjectionSystem);const tempRect=new Rectangle,tempRect2=new Rectangle;class RenderTextureSystem{constructor(_){this.renderer=_,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Rectangle,this.destinationFrame=new Rectangle,this.viewportFrame=new Rectangle}bind(_=null,E,A){const R=this.renderer;this.current=_;let I,P,C;_?(I=_.baseTexture,C=I.resolution,E||(tempRect.width=_.frame.width,tempRect.height=_.frame.height,E=tempRect),A||(tempRect2.x=_.frame.x,tempRect2.y=_.frame.y,tempRect2.width=E.width,tempRect2.height=E.height,A=tempRect2),P=I.framebuffer):(C=R.resolution,E||(tempRect.width=R._view.screen.width,tempRect.height=R._view.screen.height,E=tempRect),A||(A=tempRect,A.width=E.width,A.height=E.height));const D=this.viewportFrame;D.x=A.x*C,D.y=A.y*C,D.width=A.width*C,D.height=A.height*C,_||(D.y=R.view.height-(D.y+D.height)),D.ceil(),this.renderer.framebuffer.bind(P,D),this.renderer.projection.update(A,E,C,!P),_?this.renderer.mask.setMaskStack(I.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(E),this.destinationFrame.copyFrom(A)}clear(_,E){this.current?_=_||this.current.baseTexture.clearColor:_=_||this.renderer.background.colorRgba;const A=this.destinationFrame,R=this.current?this.current.baseTexture:this.renderer._view.screen,I=A.width!==R.width||A.height!==R.height;if(I){let{x:P,y:C,width:D,height:B}=this.viewportFrame;P=Math.round(P),C=Math.round(C),D=Math.round(D),B=Math.round(B),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(P,C,D,B)}this.renderer.framebuffer.clear(_[0],_[1],_[2],_[3],E),I&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}RenderTextureSystem.extension={type:ExtensionType.RendererSystem,name:"renderTexture"};extensions$1.add(RenderTextureSystem);function uboUpdate(T,_,E,A,R){E.buffer.update(R)}const UBO_TO_SINGLE_SETTERS={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},GLSL_TO_STD40_SIZE={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function createUBOElements(T){const _=T.map(I=>({data:I,offset:0,dataLen:0,dirty:0}));let E=0,A=0,R=0;for(let I=0;I<_.length;I++){const P=_[I];if(E=GLSL_TO_STD40_SIZE[P.data.type],P.data.size>1&&(E=Math.max(E,16)*P.data.size),P.dataLen=E,A%E!==0&&A<16){const C=A%E%16;A+=C,R+=C}A+E>16?(R=Math.ceil(R/16)*16,P.offset=R,R+=E,A=E):(P.offset=R,A+=E,R+=E)}return R=Math.ceil(R/16)*16,{uboElements:_,size:R}}function getUBOData(T,_){const E=[];for(const A in T)_[A]&&E.push(_[A]);return E.sort((A,R)=>A.index-R.index),E}function generateUniformBufferSync(T,_){if(!T.autoManage)return{size:0,syncFunc:uboUpdate};const E=getUBOData(T.uniforms,_),{uboElements:A,size:R}=createUBOElements(E),I=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let P=0;P<A.length;P++){const C=A[P],D=T.uniforms[C.data.name],B=C.data.name;let O=!1;for(let F=0;F<uniformParsers.length;F++){const L=uniformParsers[F];if(L.codeUbo&&L.test(C.data,D)){I.push(`offset = ${C.offset/4};`,uniformParsers[F].codeUbo(C.data.name,D)),O=!0;break}}if(!O)if(C.data.size>1){const F=mapSize(C.data.type),L=Math.max(GLSL_TO_STD40_SIZE[C.data.type]/16,1),U=F/L,G=(4-U%4)%4;I.push(`
                cv = ud.${B}.value;
                v = uv.${B};
                offset = ${C.offset/4};

                t = 0;

                for(var i=0; i < ${C.data.size*L}; i++)
                {
                    for(var j = 0; j < ${U}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${G};
                }

                `)}else{const F=UBO_TO_SINGLE_SETTERS[C.data.type];I.push(`
                cv = ud.${B}.value;
                v = uv.${B};
                offset = ${C.offset/4};
                ${F};
                `)}}return I.push(`
       renderer.buffer.update(buffer);
    `),{size:R,syncFunc:new Function("ud","uv","renderer","syncData","buffer",I.join(`
`))}}class GLProgram{constructor(_,E){this.program=_,this.uniformData=E,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function getAttributeData(T,_){const E={},A=_.getProgramParameter(T,_.ACTIVE_ATTRIBUTES);for(let R=0;R<A;R++){const I=_.getActiveAttrib(T,R);if(I.name.startsWith("gl_"))continue;const P=mapType(_,I.type),C={type:P,name:I.name,size:mapSize(P),location:_.getAttribLocation(T,I.name)};E[I.name]=C}return E}function getUniformData(T,_){const E={},A=_.getProgramParameter(T,_.ACTIVE_UNIFORMS);for(let R=0;R<A;R++){const I=_.getActiveUniform(T,R),P=I.name.replace(/\[.*?\]$/,""),C=!!I.name.match(/\[.*?\]$/),D=mapType(_,I.type);E[P]={name:P,index:R,type:D,size:I.size,isArray:C,value:defaultValue(D,I.size)}}return E}function generateProgram(T,_){var D;const E=compileShader(T,T.VERTEX_SHADER,_.vertexSrc),A=compileShader(T,T.FRAGMENT_SHADER,_.fragmentSrc),R=T.createProgram();T.attachShader(R,E),T.attachShader(R,A);const I=(D=_.extra)==null?void 0:D.transformFeedbackVaryings;if(I&&(typeof T.transformFeedbackVaryings!="function"||T.transformFeedbackVaryings(R,I.names,I.bufferMode==="separate"?T.SEPARATE_ATTRIBS:T.INTERLEAVED_ATTRIBS)),T.linkProgram(R),T.getProgramParameter(R,T.LINK_STATUS)||logProgramError(T,R,E,A),_.attributeData=getAttributeData(R,T),_.uniformData=getUniformData(R,T),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(_.vertexSrc)){const B=Object.keys(_.attributeData);B.sort((O,F)=>O>F?1:-1);for(let O=0;O<B.length;O++)_.attributeData[B[O]].location=O,T.bindAttribLocation(R,O,B[O]);T.linkProgram(R)}T.deleteShader(E),T.deleteShader(A);const P={};for(const B in _.uniformData){const O=_.uniformData[B];P[B]={location:T.getUniformLocation(R,B),value:defaultValue(O.type,O.size)}}return new GLProgram(R,P)}let UID=0;const defaultSyncData={textureCount:0,uboCount:0};class ShaderSystem{constructor(_){this.destroyed=!1,this.renderer=_,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=UID++}systemCheck(){if(!unsafeEvalSupported())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(_){this.gl=_,this.reset()}bind(_,E){_.disposeRunner.add(this),_.uniforms.globals=this.renderer.globalUniforms;const A=_.program,R=A.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(_);return this.shader=_,this.program!==A&&(this.program=A,this.gl.useProgram(R.program)),E||(defaultSyncData.textureCount=0,defaultSyncData.uboCount=0,this.syncUniformGroup(_.uniformGroup,defaultSyncData)),R}setUniforms(_){const E=this.shader.program,A=E.glPrograms[this.renderer.CONTEXT_UID];E.syncUniforms(A.uniformData,_,this.renderer)}syncUniformGroup(_,E){const A=this.getGlProgram();(!_.static||_.dirtyId!==A.uniformDirtyGroups[_.id])&&(A.uniformDirtyGroups[_.id]=_.dirtyId,this.syncUniforms(_,A,E))}syncUniforms(_,E,A){(_.syncUniforms[this.shader.program.id]||this.createSyncGroups(_))(E.uniformData,_.uniforms,this.renderer,A)}createSyncGroups(_){const E=this.getSignature(_,this.shader.program.uniformData,"u");return this.cache[E]||(this.cache[E]=generateUniformsSync(_,this.shader.program.uniformData)),_.syncUniforms[this.shader.program.id]=this.cache[E],_.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(_,E){const A=this.getGlProgram();if(!_.static||_.dirtyId!==0||!A.uniformGroups[_.id]){_.dirtyId=0;const R=A.uniformGroups[_.id]||this.createSyncBufferGroup(_,A,E);_.buffer.update(),R(A.uniformData,_.uniforms,this.renderer,defaultSyncData,_.buffer)}this.renderer.buffer.bindBufferBase(_.buffer,A.uniformBufferBindings[E])}createSyncBufferGroup(_,E,A){const{gl:R}=this.renderer;this.renderer.buffer.bind(_.buffer);const I=this.gl.getUniformBlockIndex(E.program,A);E.uniformBufferBindings[A]=this.shader.uniformBindCount,R.uniformBlockBinding(E.program,I,this.shader.uniformBindCount),this.shader.uniformBindCount++;const P=this.getSignature(_,this.shader.program.uniformData,"ubo");let C=this._uboCache[P];if(C||(C=this._uboCache[P]=generateUniformBufferSync(_,this.shader.program.uniformData)),_.autoManage){const D=new Float32Array(C.size/4);_.buffer.update(D)}return E.uniformGroups[_.id]=C.syncFunc,E.uniformGroups[_.id]}getSignature(_,E,A){const R=_.uniforms,I=[`${A}-`];for(const P in R)I.push(P),E[P]&&I.push(E[P].type);return I.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(_){const E=this.gl,A=_.program,R=generateProgram(E,A);return A.glPrograms[this.renderer.CONTEXT_UID]=R,R}reset(){this.program=null,this.shader=null}disposeShader(_){this.shader===_&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}ShaderSystem.extension={type:ExtensionType.RendererSystem,name:"shader"};extensions$1.add(ShaderSystem);function mapWebGLBlendModesToPixi(T,_=[]){return _[BLEND_MODES.NORMAL]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.ADD]=[T.ONE,T.ONE],_[BLEND_MODES.MULTIPLY]=[T.DST_COLOR,T.ONE_MINUS_SRC_ALPHA,T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SCREEN]=[T.ONE,T.ONE_MINUS_SRC_COLOR,T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.OVERLAY]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DARKEN]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.LIGHTEN]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR_DODGE]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR_BURN]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.HARD_LIGHT]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SOFT_LIGHT]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DIFFERENCE]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.EXCLUSION]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.HUE]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SATURATION]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.COLOR]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.LUMINOSITY]=[T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.NONE]=[0,0],_[BLEND_MODES.NORMAL_NPM]=[T.SRC_ALPHA,T.ONE_MINUS_SRC_ALPHA,T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.ADD_NPM]=[T.SRC_ALPHA,T.ONE,T.ONE,T.ONE],_[BLEND_MODES.SCREEN_NPM]=[T.SRC_ALPHA,T.ONE_MINUS_SRC_COLOR,T.ONE,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SRC_IN]=[T.DST_ALPHA,T.ZERO],_[BLEND_MODES.SRC_OUT]=[T.ONE_MINUS_DST_ALPHA,T.ZERO],_[BLEND_MODES.SRC_ATOP]=[T.DST_ALPHA,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DST_OVER]=[T.ONE_MINUS_DST_ALPHA,T.ONE],_[BLEND_MODES.DST_IN]=[T.ZERO,T.SRC_ALPHA],_[BLEND_MODES.DST_OUT]=[T.ZERO,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.DST_ATOP]=[T.ONE_MINUS_DST_ALPHA,T.SRC_ALPHA],_[BLEND_MODES.XOR]=[T.ONE_MINUS_DST_ALPHA,T.ONE_MINUS_SRC_ALPHA],_[BLEND_MODES.SUBTRACT]=[T.ONE,T.ONE,T.ONE,T.ONE,T.FUNC_REVERSE_SUBTRACT,T.FUNC_ADD],_}const BLEND=0,OFFSET=1,CULLING=2,DEPTH_TEST=3,WINDING=4,DEPTH_MASK=5,_StateSystem=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=BLEND_MODES.NONE,this._blendEq=!1,this.map=[],this.map[BLEND]=this.setBlend,this.map[OFFSET]=this.setOffset,this.map[CULLING]=this.setCullFace,this.map[DEPTH_TEST]=this.setDepthTest,this.map[WINDING]=this.setFrontFace,this.map[DEPTH_MASK]=this.setDepthMask,this.checks=[],this.defaultState=new State$1,this.defaultState.blend=!0}contextChange(T){this.gl=T,this.blendModes=mapWebGLBlendModesToPixi(T),this.set(this.defaultState),this.reset()}set(T){if(T=T||this.defaultState,this.stateId!==T.data){let _=this.stateId^T.data,E=0;for(;_;)_&1&&this.map[E].call(this,!!(T.data&1<<E)),_=_>>1,E++;this.stateId=T.data}for(let _=0;_<this.checks.length;_++)this.checks[_](this,T)}forceState(T){T=T||this.defaultState;for(let _=0;_<this.map.length;_++)this.map[_].call(this,!!(T.data&1<<_));for(let _=0;_<this.checks.length;_++)this.checks[_](this,T);this.stateId=T.data}setBlend(T){this.updateCheck(_StateSystem.checkBlendMode,T),this.gl[T?"enable":"disable"](this.gl.BLEND)}setOffset(T){this.updateCheck(_StateSystem.checkPolygonOffset,T),this.gl[T?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(T){this.gl[T?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(T){this.gl.depthMask(T)}setCullFace(T){this.gl[T?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(T){this.gl.frontFace(this.gl[T?"CW":"CCW"])}setBlendMode(T){if(T===this.blendMode)return;this.blendMode=T;const _=this.blendModes[T],E=this.gl;_.length===2?E.blendFunc(_[0],_[1]):E.blendFuncSeparate(_[0],_[1],_[2],_[3]),_.length===6?(this._blendEq=!0,E.blendEquationSeparate(_[4],_[5])):this._blendEq&&(this._blendEq=!1,E.blendEquationSeparate(E.FUNC_ADD,E.FUNC_ADD))}setPolygonOffset(T,_){this.gl.polygonOffset(T,_)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(T,_){const E=this.checks.indexOf(T);_&&E===-1?this.checks.push(T):!_&&E!==-1&&this.checks.splice(E,1)}static checkBlendMode(T,_){T.setBlendMode(_.blendMode)}static checkPolygonOffset(T,_){T.setPolygonOffset(1,_.polygonOffset)}destroy(){this.gl=null}};let StateSystem=_StateSystem;StateSystem.extension={type:ExtensionType.RendererSystem,name:"state"};extensions$1.add(StateSystem);class TextureGCSystem{constructor(_){this.renderer=_,this.count=0,this.checkCount=0,this.maxIdle=settings.GC_MAX_IDLE,this.checkCountMax=settings.GC_MAX_CHECK_COUNT,this.mode=settings.GC_MODE}postrender(){!this.renderer.objectRenderer.renderingToScreen||(this.count++,this.mode!==GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const _=this.renderer.texture,E=_.managedTextures;let A=!1;for(let R=0;R<E.length;R++){const I=E[R];!I.framebuffer&&this.count-I.touched>this.maxIdle&&(_.destroyTexture(I,!0),E[R]=null,A=!0)}if(A){let R=0;for(let I=0;I<E.length;I++)E[I]!==null&&(E[R++]=E[I]);E.length=R}}unload(_){const E=this.renderer.texture,A=_._texture;A&&!A.framebuffer&&E.destroyTexture(A);for(let R=_.children.length-1;R>=0;R--)this.unload(_.children[R])}destroy(){this.renderer=null}}TextureGCSystem.extension={type:ExtensionType.RendererSystem,name:"textureGC"};extensions$1.add(TextureGCSystem);function mapTypeAndFormatToInternalFormat(T){let _;return"WebGL2RenderingContext"in globalThis&&T instanceof globalThis.WebGL2RenderingContext?_={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:T.RGBA8,[FORMATS.RGB]:T.RGB8,[FORMATS.RG]:T.RG8,[FORMATS.RED]:T.R8,[FORMATS.RGBA_INTEGER]:T.RGBA8UI,[FORMATS.RGB_INTEGER]:T.RGB8UI,[FORMATS.RG_INTEGER]:T.RG8UI,[FORMATS.RED_INTEGER]:T.R8UI,[FORMATS.ALPHA]:T.ALPHA,[FORMATS.LUMINANCE]:T.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:T.LUMINANCE_ALPHA},[TYPES.BYTE]:{[FORMATS.RGBA]:T.RGBA8_SNORM,[FORMATS.RGB]:T.RGB8_SNORM,[FORMATS.RG]:T.RG8_SNORM,[FORMATS.RED]:T.R8_SNORM,[FORMATS.RGBA_INTEGER]:T.RGBA8I,[FORMATS.RGB_INTEGER]:T.RGB8I,[FORMATS.RG_INTEGER]:T.RG8I,[FORMATS.RED_INTEGER]:T.R8I},[TYPES.UNSIGNED_SHORT]:{[FORMATS.RGBA_INTEGER]:T.RGBA16UI,[FORMATS.RGB_INTEGER]:T.RGB16UI,[FORMATS.RG_INTEGER]:T.RG16UI,[FORMATS.RED_INTEGER]:T.R16UI,[FORMATS.DEPTH_COMPONENT]:T.DEPTH_COMPONENT16},[TYPES.SHORT]:{[FORMATS.RGBA_INTEGER]:T.RGBA16I,[FORMATS.RGB_INTEGER]:T.RGB16I,[FORMATS.RG_INTEGER]:T.RG16I,[FORMATS.RED_INTEGER]:T.R16I},[TYPES.UNSIGNED_INT]:{[FORMATS.RGBA_INTEGER]:T.RGBA32UI,[FORMATS.RGB_INTEGER]:T.RGB32UI,[FORMATS.RG_INTEGER]:T.RG32UI,[FORMATS.RED_INTEGER]:T.R32UI,[FORMATS.DEPTH_COMPONENT]:T.DEPTH_COMPONENT24},[TYPES.INT]:{[FORMATS.RGBA_INTEGER]:T.RGBA32I,[FORMATS.RGB_INTEGER]:T.RGB32I,[FORMATS.RG_INTEGER]:T.RG32I,[FORMATS.RED_INTEGER]:T.R32I},[TYPES.FLOAT]:{[FORMATS.RGBA]:T.RGBA32F,[FORMATS.RGB]:T.RGB32F,[FORMATS.RG]:T.RG32F,[FORMATS.RED]:T.R32F,[FORMATS.DEPTH_COMPONENT]:T.DEPTH_COMPONENT32F},[TYPES.HALF_FLOAT]:{[FORMATS.RGBA]:T.RGBA16F,[FORMATS.RGB]:T.RGB16F,[FORMATS.RG]:T.RG16F,[FORMATS.RED]:T.R16F},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:T.RGB565},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:T.RGBA4},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:T.RGB5_A1},[TYPES.UNSIGNED_INT_2_10_10_10_REV]:{[FORMATS.RGBA]:T.RGB10_A2,[FORMATS.RGBA_INTEGER]:T.RGB10_A2UI},[TYPES.UNSIGNED_INT_10F_11F_11F_REV]:{[FORMATS.RGB]:T.R11F_G11F_B10F},[TYPES.UNSIGNED_INT_5_9_9_9_REV]:{[FORMATS.RGB]:T.RGB9_E5},[TYPES.UNSIGNED_INT_24_8]:{[FORMATS.DEPTH_STENCIL]:T.DEPTH24_STENCIL8},[TYPES.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[FORMATS.DEPTH_STENCIL]:T.DEPTH32F_STENCIL8}}:_={[TYPES.UNSIGNED_BYTE]:{[FORMATS.RGBA]:T.RGBA,[FORMATS.RGB]:T.RGB,[FORMATS.ALPHA]:T.ALPHA,[FORMATS.LUMINANCE]:T.LUMINANCE,[FORMATS.LUMINANCE_ALPHA]:T.LUMINANCE_ALPHA},[TYPES.UNSIGNED_SHORT_5_6_5]:{[FORMATS.RGB]:T.RGB},[TYPES.UNSIGNED_SHORT_4_4_4_4]:{[FORMATS.RGBA]:T.RGBA},[TYPES.UNSIGNED_SHORT_5_5_5_1]:{[FORMATS.RGBA]:T.RGBA}},_}class GLTexture{constructor(_){this.texture=_,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=TYPES.UNSIGNED_BYTE,this.internalFormat=FORMATS.RGBA,this.samplerType=0}}class TextureSystem{constructor(_){this.renderer=_,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new BaseTexture,this.hasIntegerTextures=!1}contextChange(){const _=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=mapTypeAndFormatToInternalFormat(_);const E=_.getParameter(_.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=E;for(let R=0;R<E;R++)this.boundTextures[R]=null;this.emptyTextures={};const A=new GLTexture(_.createTexture());_.bindTexture(_.TEXTURE_2D,A.texture),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,1,1,0,_.RGBA,_.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[_.TEXTURE_2D]=A,this.emptyTextures[_.TEXTURE_CUBE_MAP]=new GLTexture(_.createTexture()),_.bindTexture(_.TEXTURE_CUBE_MAP,this.emptyTextures[_.TEXTURE_CUBE_MAP].texture);for(let R=0;R<6;R++)_.texImage2D(_.TEXTURE_CUBE_MAP_POSITIVE_X+R,0,_.RGBA,1,1,0,_.RGBA,_.UNSIGNED_BYTE,null);_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MAG_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_CUBE_MAP,_.TEXTURE_MIN_FILTER,_.LINEAR);for(let R=0;R<this.boundTextures.length;R++)this.bind(null,R)}bind(_,E=0){const{gl:A}=this;if(_=_==null?void 0:_.castToBaseTexture(),(_==null?void 0:_.valid)&&!_.parentTextureArray){_.touched=this.renderer.textureGC.count;const R=_._glTextures[this.CONTEXT_UID]||this.initTexture(_);this.boundTextures[E]!==_&&(this.currentLocation!==E&&(this.currentLocation=E,A.activeTexture(A.TEXTURE0+E)),A.bindTexture(_.target,R.texture)),R.dirtyId!==_.dirtyId?(this.currentLocation!==E&&(this.currentLocation=E,A.activeTexture(A.TEXTURE0+E)),this.updateTexture(_)):R.dirtyStyleId!==_.dirtyStyleId&&this.updateTextureStyle(_),this.boundTextures[E]=_}else this.currentLocation!==E&&(this.currentLocation=E,A.activeTexture(A.TEXTURE0+E)),A.bindTexture(A.TEXTURE_2D,this.emptyTextures[A.TEXTURE_2D].texture),this.boundTextures[E]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let _=0;_<this.boundTextures.length;_++)this.boundTextures[_]=this.unknownTexture}unbind(_){const{gl:E,boundTextures:A}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let R=0;R<A.length;R++)A[R]===this.unknownTexture&&this.bind(null,R)}for(let R=0;R<A.length;R++)A[R]===_&&(this.currentLocation!==R&&(E.activeTexture(E.TEXTURE0+R),this.currentLocation=R),E.bindTexture(_.target,this.emptyTextures[_.target].texture),A[R]=null)}ensureSamplerType(_){const{boundTextures:E,hasIntegerTextures:A,CONTEXT_UID:R}=this;if(!!A)for(let I=_-1;I>=0;--I){const P=E[I];P&&P._glTextures[R].samplerType!==SAMPLER_TYPES.FLOAT&&this.renderer.texture.unbind(P)}}initTexture(_){const E=new GLTexture(this.gl.createTexture());return E.dirtyId=-1,_._glTextures[this.CONTEXT_UID]=E,this.managedTextures.push(_),_.on("dispose",this.destroyTexture,this),E}initTextureType(_,E){var A,R;E.internalFormat=(R=(A=this.internalFormats[_.type])==null?void 0:A[_.format])!=null?R:_.format,this.webGLVersion===2&&_.type===TYPES.HALF_FLOAT?E.type=this.gl.HALF_FLOAT:E.type=_.type}updateTexture(_){var R;const E=_._glTextures[this.CONTEXT_UID];if(!E)return;const A=this.renderer;if(this.initTextureType(_,E),(R=_.resource)!=null&&R.upload(A,_,E))E.samplerType!==SAMPLER_TYPES.FLOAT&&(this.hasIntegerTextures=!0);else{const I=_.realWidth,P=_.realHeight,C=A.gl;(E.width!==I||E.height!==P||E.dirtyId<0)&&(E.width=I,E.height=P,C.texImage2D(_.target,0,E.internalFormat,I,P,0,_.format,E.type,null))}_.dirtyStyleId!==E.dirtyStyleId&&this.updateTextureStyle(_),E.dirtyId=_.dirtyId}destroyTexture(_,E){const{gl:A}=this;if(_=_.castToBaseTexture(),_._glTextures[this.CONTEXT_UID]&&(this.unbind(_),A.deleteTexture(_._glTextures[this.CONTEXT_UID].texture),_.off("dispose",this.destroyTexture,this),delete _._glTextures[this.CONTEXT_UID],!E)){const R=this.managedTextures.indexOf(_);R!==-1&&removeItems(this.managedTextures,R,1)}}updateTextureStyle(_){var A;const E=_._glTextures[this.CONTEXT_UID];!E||((_.mipmap===MIPMAP_MODES.POW2||this.webGLVersion!==2)&&!_.isPowerOfTwo?E.mipmap=!1:E.mipmap=_.mipmap>=1,this.webGLVersion!==2&&!_.isPowerOfTwo?E.wrapMode=WRAP_MODES.CLAMP:E.wrapMode=_.wrapMode,(A=_.resource)!=null&&A.style(this.renderer,_,E)||this.setStyle(_,E),E.dirtyStyleId=_.dirtyStyleId)}setStyle(_,E){const A=this.gl;if(E.mipmap&&_.mipmap!==MIPMAP_MODES.ON_MANUAL&&A.generateMipmap(_.target),A.texParameteri(_.target,A.TEXTURE_WRAP_S,E.wrapMode),A.texParameteri(_.target,A.TEXTURE_WRAP_T,E.wrapMode),E.mipmap){A.texParameteri(_.target,A.TEXTURE_MIN_FILTER,_.scaleMode===SCALE_MODES.LINEAR?A.LINEAR_MIPMAP_LINEAR:A.NEAREST_MIPMAP_NEAREST);const R=this.renderer.context.extensions.anisotropicFiltering;if(R&&_.anisotropicLevel>0&&_.scaleMode===SCALE_MODES.LINEAR){const I=Math.min(_.anisotropicLevel,A.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT));A.texParameterf(_.target,R.TEXTURE_MAX_ANISOTROPY_EXT,I)}}else A.texParameteri(_.target,A.TEXTURE_MIN_FILTER,_.scaleMode===SCALE_MODES.LINEAR?A.LINEAR:A.NEAREST);A.texParameteri(_.target,A.TEXTURE_MAG_FILTER,_.scaleMode===SCALE_MODES.LINEAR?A.LINEAR:A.NEAREST)}destroy(){this.renderer=null}}TextureSystem.extension={type:ExtensionType.RendererSystem,name:"texture"};extensions$1.add(TextureSystem);const tempTransform=new Transform;class GenerateTextureSystem{constructor(_){this.renderer=_,this._tempMatrix=new Matrix}generateTexture(_,E){const{region:A,...R}=E||{},I=A||_.getLocalBounds(null,!0);I.width===0&&(I.width=1),I.height===0&&(I.height=1);const P=RenderTexture.create({width:I.width,height:I.height,...R});this._tempMatrix.tx=-I.x,this._tempMatrix.ty=-I.y;const C=_.transform;return _.transform=tempTransform,this.renderer.render(_,{renderTexture:P,transform:this._tempMatrix,skipUpdateTransform:!!_.parent,blit:!0}),_.transform=C,P}destroy(){}}GenerateTextureSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"textureGenerator"};extensions$1.add(GenerateTextureSystem);class BackgroundSystem{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(_){this.clearBeforeRender=_.clearBeforeRender,_.color&&(this.color=typeof _.color=="string"?string2hex(_.color):_.color),this.alpha=_.alpha}get color(){return this._backgroundColor}set color(_){this._backgroundColor=_,this._backgroundColorString=hex2string(_),hex2rgb(_,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(_){this._backgroundColorRgba[3]=_}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}BackgroundSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"background"};extensions$1.add(BackgroundSystem);class ViewSystem{constructor(_){this.renderer=_}init(_){this.screen=new Rectangle(0,0,_.width,_.height),this.element=_.view||settings.ADAPTER.createCanvas(),this.resolution=_.resolution||settings.RESOLUTION,this.autoDensity=!!_.autoDensity}resizeView(_,E){this.element.width=Math.round(_*this.resolution),this.element.height=Math.round(E*this.resolution);const A=this.element.width/this.resolution,R=this.element.height/this.resolution;this.screen.width=A,this.screen.height=R,this.autoDensity&&(this.element.style.width=`${A}px`,this.element.style.height=`${R}px`),this.renderer.emit("resize",A,R),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(_){var E;_&&((E=this.element.parentNode)==null||E.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}ViewSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_view"};extensions$1.add(ViewSystem);class PluginSystem{constructor(_){this.renderer=_,this.plugins={}}init(_){for(const E in _)this.plugins[E]=new _[E](this.renderer)}destroy(){for(const _ in this.plugins)this.plugins[_].destroy(),this.plugins[_]=null}}PluginSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"_plugin"};extensions$1.add(PluginSystem);class SystemManager extends EventEmitter$1{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(_){var R;this.addRunners(..._.runners);const E=((R=_.priority)!=null?R:[]).filter(I=>_.systems[I]),A=[...E,...Object.keys(_.systems).filter(I=>!E.includes(I))];for(const I of A)this.addSystem(_.systems[I],I)}addRunners(..._){_.forEach(E=>{this.runners[E]=new Runner(E)})}addSystem(_,E){const A=new _(this);if(this[E])throw new Error(`Whoops! The name "${E}" is already in use`);this[E]=A,this._systemsHash[E]=A;for(const R in this.runners)this.runners[R].add(A);return this}emitWithCustomOptions(_,E){const A=Object.keys(this._systemsHash);_.items.forEach(R=>{const I=A.find(P=>this._systemsHash[P]===R);R[_.name](E[I])})}destroy(){Object.values(this.runners).forEach(_=>{_.destroy()}),this._systemsHash={}}}class StartupSystem{constructor(_){this.renderer=_}run(_){const E=this.renderer;E.emitWithCustomOptions(E.runners.init,_),_.hello&&console.log(`PixiJS 7.0.4 - ${E.rendererLogId} - https://pixijs.com`),E.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}StartupSystem.extension={type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem],name:"startup"};extensions$1.add(StartupSystem);class TransformFeedbackSystem{constructor(_){this.renderer=_}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(_){const{gl:E,CONTEXT_UID:A}=this,R=_._glTransformFeedbacks[A]||this.createGLTransformFeedback(_);E.bindTransformFeedback(E.TRANSFORM_FEEDBACK,R)}unbind(){const{gl:_}=this;_.bindTransformFeedback(_.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(_,E){const{gl:A,renderer:R}=this;E&&R.shader.bind(E),A.beginTransformFeedback(_)}endTransformFeedback(){const{gl:_}=this;_.endTransformFeedback()}createGLTransformFeedback(_){const{gl:E,renderer:A,CONTEXT_UID:R}=this,I=E.createTransformFeedback();_._glTransformFeedbacks[R]=I,E.bindTransformFeedback(E.TRANSFORM_FEEDBACK,I);for(let P=0;P<_.buffers.length;P++){const C=_.buffers[P];!C||(A.buffer.update(C),C._glBuffers[R].refCount++,E.bindBufferBase(E.TRANSFORM_FEEDBACK_BUFFER,P,C._glBuffers[R].buffer||null))}return E.bindTransformFeedback(E.TRANSFORM_FEEDBACK,null),_.disposeRunner.add(this),I}disposeTransformFeedback(_,E){const A=_._glTransformFeedbacks[this.CONTEXT_UID],R=this.gl;_.disposeRunner.remove(this);const I=this.renderer.buffer;if(I)for(let P=0;P<_.buffers.length;P++){const C=_.buffers[P];if(!C)continue;const D=C._glBuffers[this.CONTEXT_UID];D&&(D.refCount--,D.refCount===0&&!E&&I.dispose(C,E))}!A||(E||R.deleteTransformFeedback(A),delete _._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}TransformFeedbackSystem.extension={type:ExtensionType.RendererSystem,name:"transformFeedback"};extensions$1.add(TransformFeedbackSystem);const renderers=[];extensions$1.handleByList(ExtensionType.Renderer,renderers);function autoDetectRenderer(T){for(const _ of renderers)if(_.test(T))return new _(T);throw new Error("Unable to auto-detect a suitable renderer.")}var $defaultFilterVertex=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const defaultFilterVertex=$defaultFilterVertex,_Renderer=class extends SystemManager{constructor(T){var A,R;super(),T=Object.assign({},settings.RENDER_OPTIONS,T),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new UniformGroup({projectionMatrix:new Matrix},!0);const _={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:_Renderer.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(_);const E={hello:T.hello,_plugin:_Renderer.__plugins,background:{alpha:T.backgroundAlpha,color:(A=T.background)!=null?A:T.backgroundColor,clearBeforeRender:T.clearBeforeRender},_view:{height:T.height,width:T.width,autoDensity:T.autoDensity,resolution:T.resolution,view:T.view},context:{antialias:T.antialias,context:T.context,powerPreference:T.powerPreference,premultipliedAlpha:(R=T.premultipliedAlpha)!=null?R:T.useContextAlpha&&T.useContextAlpha!=="notMultiplied",preserveDrawingBuffer:T.preserveDrawingBuffer}};this.startup.run(E)}static test(T){return T!=null&&T.forceCanvas?!1:isWebGLSupported()}render(T,_){this.objectRenderer.render(T,_)}resize(T,_){this._view.resizeView(T,_)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(T=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:T}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(T){this.background.color=T}get backgroundAlpha(){return this.background.color}set backgroundAlpha(T){this.background.alpha=T}get powerPreference(){return this.context.powerPreference}generateTexture(T,_){return this.textureGenerator.generateTexture(T,_)}};let Renderer=_Renderer;Renderer.extension={type:ExtensionType.Renderer,priority:1};Renderer.__plugins={};Renderer.__systems={};extensions$1.handleByMap(ExtensionType.RendererPlugin,Renderer.__plugins);extensions$1.handleByMap(ExtensionType.RendererSystem,Renderer.__systems);extensions$1.add(Renderer);class BatchDrawCall{constructor(){this.texArray=null,this.blend=0,this.type=DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null}}class BatchTextureArray{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let _=0;_<this.count;_++)this.elements[_]=null;this.count=0}}class ViewableBuffer{constructor(_){typeof _=="number"?this.rawBinaryData=new ArrayBuffer(_):_ instanceof Uint8Array?this.rawBinaryData=_.buffer:this.rawBinaryData=_,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(_){return this[`${_}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(_){switch(_){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${_} isn't a valid view type`)}}}class BatchShaderGenerator{constructor(_,E){if(this.vertexSrc=_,this.fragTemplate=E,this.programCache={},this.defaultGroupCache={},!E.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!E.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(_){if(!this.programCache[_]){const A=new Int32Array(_);for(let I=0;I<_;I++)A[I]=I;this.defaultGroupCache[_]=UniformGroup.from({uSamplers:A},!0);let R=this.fragTemplate;R=R.replace(/%count%/gi,`${_}`),R=R.replace(/%forloop%/gi,this.generateSampleSrc(_)),this.programCache[_]=new Program(this.vertexSrc,R)}const E={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:this.defaultGroupCache[_]};return new Shader(this.programCache[_],E)}generateSampleSrc(_){let E="";E+=`
`,E+=`
`;for(let A=0;A<_;A++)A>0&&(E+=`
else `),A<_-1&&(E+=`if(vTextureId < ${A}.5)`),E+=`
{`,E+=`
	color = texture2D(uSamplers[${A}], vTextureCoord);`,E+=`
}`;return E+=`
`,E+=`
`,E}}class BatchGeometry extends Geometry{constructor(_=!1){super(),this._buffer=new Buffer(null,_,!1),this._indexBuffer=new Buffer(null,_,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,TYPES.FLOAT).addAttribute("aColor",this._buffer,4,!0,TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,TYPES.FLOAT).addIndex(this._indexBuffer)}}var defaultVertex=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,defaultFragment=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`;const _BatchRenderer=class extends ObjectRenderer{constructor(T){super(T),this.setShaderGenerator(),this.geometryClass=BatchGeometry,this.vertexSize=6,this.state=State$1.for2d(),this.size=settings.SPRITE_BATCH_SIZE*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),T.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return defaultVertex}static get defaultFragmentTemplate(){return defaultFragment}setShaderGenerator({vertex:T=_BatchRenderer.defaultVertexSrc,fragment:_=_BatchRenderer.defaultFragmentTemplate}={}){this.shaderGenerator=new BatchShaderGenerator(T,_)}contextChange(){const T=this.renderer.gl;settings.PREFER_ENV===ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS),settings.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=checkMaxIfStatementsInShader(this.MAX_TEXTURES,T)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let _=0;_<this._packedGeometryPoolSize;_++)this._packedGeometries[_]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:T,_textureArrayPool:_}=_BatchRenderer,E=this.size/4,A=Math.floor(E/this.MAX_TEXTURES)+1;for(;T.length<E;)T.push(new BatchDrawCall);for(;_.length<A;)_.push(new BatchTextureArray);for(let R=0;R<this.MAX_TEXTURES;R++)this._tempBoundTextures[R]=null}onPrerender(){this._flushId=0}render(T){!T._texture.valid||(this._vertexCount+T.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=T.vertexData.length/2,this._indexCount+=T.indices.length,this._bufferedTextures[this._bufferSize]=T._texture.baseTexture,this._bufferedElements[this._bufferSize++]=T)}buildTexturesAndDrawCalls(){const{_bufferedTextures:T,MAX_TEXTURES:_}=this,E=_BatchRenderer._textureArrayPool,A=this.renderer.batch,R=this._tempBoundTextures,I=this.renderer.textureGC.count;let P=++BaseTexture._globalBatch,C=0,D=E[0],B=0;A.copyBoundTextures(R,_);for(let O=0;O<this._bufferSize;++O){const F=T[O];T[O]=null,F._batchEnabled!==P&&(D.count>=_&&(A.boundArray(D,R,P,_),this.buildDrawCalls(D,B,O),B=O,D=E[++C],++P),F._batchEnabled=P,F.touched=I,D.elements[D.count++]=F)}D.count>0&&(A.boundArray(D,R,P,_),this.buildDrawCalls(D,B,this._bufferSize),++C,++P);for(let O=0;O<R.length;O++)R[O]=null;BaseTexture._globalBatch=P}buildDrawCalls(T,_,E){const{_bufferedElements:A,_attributeBuffer:R,_indexBuffer:I,vertexSize:P}=this,C=_BatchRenderer._drawCallPool;let D=this._dcIndex,B=this._aIndex,O=this._iIndex,F=C[D];F.start=this._iIndex,F.texArray=T;for(let L=_;L<E;++L){const U=A[L],G=U._texture.baseTexture,X=premultiplyBlendMode[G.alphaMode?1:0][U.blendMode];A[L]=null,_<L&&F.blend!==X&&(F.size=O-F.start,_=L,F=C[++D],F.texArray=T,F.start=O),this.packInterleavedGeometry(U,R,I,B,O),B+=U.vertexData.length/2*P,O+=U.indices.length,F.blend=X}_<E&&(F.size=O-F.start,++D),this._dcIndex=D,this._aIndex=B,this._iIndex=O}bindAndClearTexArray(T){const _=this.renderer.texture;for(let E=0;E<T.count;E++)_.bind(T.elements[E],T.ids[E]),T.elements[E]=null;T.count=0}updateGeometry(){const{_packedGeometries:T,_attributeBuffer:_,_indexBuffer:E}=this;settings.CAN_UPLOAD_SAME_BUFFER?(T[this._flushId]._buffer.update(_.rawBinaryData),T[this._flushId]._indexBuffer.update(E),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,T[this._flushId]=new this.geometryClass),T[this._flushId]._buffer.update(_.rawBinaryData),T[this._flushId]._indexBuffer.update(E),this.renderer.geometry.bind(T[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const T=this._dcIndex,{gl:_,state:E}=this.renderer,A=_BatchRenderer._drawCallPool;let R=null;for(let I=0;I<T;I++){const{texArray:P,type:C,size:D,start:B,blend:O}=A[I];R!==P&&(R=P,this.bindAndClearTexArray(P)),this.state.blendMode=O,E.set(this.state),_.drawElements(C,D,_.UNSIGNED_SHORT,B*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),settings.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let T=0;T<this._packedGeometryPoolSize;T++)this._packedGeometries[T]&&this._packedGeometries[T].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(T){const _=nextPow2(Math.ceil(T/8)),E=log2(_),A=_*8;this._aBuffers.length<=E&&(this._iBuffers.length=E+1);let R=this._aBuffers[A];return R||(this._aBuffers[A]=R=new ViewableBuffer(A*this.vertexSize*4)),R}getIndexBuffer(T){const _=nextPow2(Math.ceil(T/12)),E=log2(_),A=_*12;this._iBuffers.length<=E&&(this._iBuffers.length=E+1);let R=this._iBuffers[E];return R||(this._iBuffers[E]=R=new Uint16Array(A)),R}packInterleavedGeometry(T,_,E,A,R){const{uint32View:I,float32View:P}=_,C=A/this.vertexSize,D=T.uvs,B=T.indices,O=T.vertexData,F=T._texture.baseTexture._batchLocation,L=Math.min(T.worldAlpha,1),U=L<1&&T._texture.baseTexture.alphaMode?premultiplyTint(T._tintRGB,L):T._tintRGB+(L*255<<24);for(let G=0;G<O.length;G+=2)P[A++]=O[G],P[A++]=O[G+1],P[A++]=D[G],P[A++]=D[G+1],I[A++]=U,P[A++]=F;for(let G=0;G<B.length;G++)E[R++]=C+B[G]}};let BatchRenderer=_BatchRenderer;BatchRenderer.extension={name:"batch",type:ExtensionType.RendererPlugin};BatchRenderer._drawCallPool=[];BatchRenderer._textureArrayPool=[];extensions$1.add(BatchRenderer);class GLBuffer{constructor(_){this.buffer=_||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class BufferSystem{constructor(_){this.renderer=_,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(_){const{gl:E,CONTEXT_UID:A}=this,R=_._glBuffers[A]||this.createGLBuffer(_);E.bindBuffer(_.type,R.buffer)}unbind(_){const{gl:E}=this;E.bindBuffer(_,null)}bindBufferBase(_,E){const{gl:A,CONTEXT_UID:R}=this;if(this.boundBufferBases[E]!==_){const I=_._glBuffers[R]||this.createGLBuffer(_);this.boundBufferBases[E]=_,A.bindBufferBase(A.UNIFORM_BUFFER,E,I.buffer)}}bindBufferRange(_,E,A){const{gl:R,CONTEXT_UID:I}=this;A=A||0;const P=_._glBuffers[I]||this.createGLBuffer(_);R.bindBufferRange(R.UNIFORM_BUFFER,E||0,P.buffer,A*256,256)}update(_){const{gl:E,CONTEXT_UID:A}=this,R=_._glBuffers[A]||this.createGLBuffer(_);if(_._updateID!==R.updateID)if(R.updateID=_._updateID,E.bindBuffer(_.type,R.buffer),R.byteLength>=_.data.byteLength)E.bufferSubData(_.type,0,_.data);else{const I=_.static?E.STATIC_DRAW:E.DYNAMIC_DRAW;R.byteLength=_.data.byteLength,E.bufferData(_.type,_.data,I)}}dispose(_,E){if(!this.managedBuffers[_.id])return;delete this.managedBuffers[_.id];const A=_._glBuffers[this.CONTEXT_UID],R=this.gl;_.disposeRunner.remove(this),A&&(E||R.deleteBuffer(A.buffer),delete _._glBuffers[this.CONTEXT_UID])}disposeAll(_){const E=Object.keys(this.managedBuffers);for(let A=0;A<E.length;A++)this.dispose(this.managedBuffers[E[A]],_)}createGLBuffer(_){const{CONTEXT_UID:E,gl:A}=this;return _._glBuffers[E]=new GLBuffer(A.createBuffer()),this.managedBuffers[_.id]=_,_.disposeRunner.add(this),_._glBuffers[E]}}BufferSystem.extension={type:ExtensionType.RendererSystem,name:"buffer"};extensions$1.add(BufferSystem);class MultisampleSystem{constructor(_){this.renderer=_}contextChange(_){let E;if(this.renderer.context.webGLVersion===1){const A=_.getParameter(_.FRAMEBUFFER_BINDING);_.bindFramebuffer(_.FRAMEBUFFER,null),E=_.getParameter(_.SAMPLES),_.bindFramebuffer(_.FRAMEBUFFER,A)}else{const A=_.getParameter(_.DRAW_FRAMEBUFFER_BINDING);_.bindFramebuffer(_.DRAW_FRAMEBUFFER,null),E=_.getParameter(_.SAMPLES),_.bindFramebuffer(_.DRAW_FRAMEBUFFER,A)}E>=MSAA_QUALITY.HIGH?this.multisample=MSAA_QUALITY.HIGH:E>=MSAA_QUALITY.MEDIUM?this.multisample=MSAA_QUALITY.MEDIUM:E>=MSAA_QUALITY.LOW?this.multisample=MSAA_QUALITY.LOW:this.multisample=MSAA_QUALITY.NONE}destroy(){}}MultisampleSystem.extension={type:ExtensionType.RendererSystem,name:"_multisample"};extensions$1.add(MultisampleSystem);class ObjectRendererSystem{constructor(_){this.renderer=_}render(_,E){const A=this.renderer;let R,I,P,C;if(E&&(R=E.renderTexture,I=E.clear,P=E.transform,C=E.skipUpdateTransform),this.renderingToScreen=!R,A.runners.prerender.emit(),A.emit("prerender"),A.projection.transform=P,!A.context.isLost){if(R||(this.lastObjectRendered=_),!C){const D=_.enableTempParent();_.updateTransform(),_.disableTempParent(D)}A.renderTexture.bind(R),A.batch.currentRenderer.start(),(I!=null?I:A.background.clearBeforeRender)&&A.renderTexture.clear(),_.render(A),A.batch.currentRenderer.flush(),R&&(E.blit&&A.framebuffer.blit(),R.baseTexture.update()),A.runners.postrender.emit(),A.projection.transform=null,A.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ObjectRendererSystem.extension={type:ExtensionType.RendererSystem,name:"objectRenderer"};extensions$1.add(ObjectRendererSystem);var fragment$2=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ColorMatrixFilter extends Filter{constructor(){const _={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(defaultFilterVertex,fragment$2,_),this.alpha=1}_loadMatrix(_,E=!1){let A=_;E&&(this._multiply(A,this.uniforms.m,_),A=this._colorMatrix(A)),this.uniforms.m=A}_multiply(_,E,A){return _[0]=E[0]*A[0]+E[1]*A[5]+E[2]*A[10]+E[3]*A[15],_[1]=E[0]*A[1]+E[1]*A[6]+E[2]*A[11]+E[3]*A[16],_[2]=E[0]*A[2]+E[1]*A[7]+E[2]*A[12]+E[3]*A[17],_[3]=E[0]*A[3]+E[1]*A[8]+E[2]*A[13]+E[3]*A[18],_[4]=E[0]*A[4]+E[1]*A[9]+E[2]*A[14]+E[3]*A[19]+E[4],_[5]=E[5]*A[0]+E[6]*A[5]+E[7]*A[10]+E[8]*A[15],_[6]=E[5]*A[1]+E[6]*A[6]+E[7]*A[11]+E[8]*A[16],_[7]=E[5]*A[2]+E[6]*A[7]+E[7]*A[12]+E[8]*A[17],_[8]=E[5]*A[3]+E[6]*A[8]+E[7]*A[13]+E[8]*A[18],_[9]=E[5]*A[4]+E[6]*A[9]+E[7]*A[14]+E[8]*A[19]+E[9],_[10]=E[10]*A[0]+E[11]*A[5]+E[12]*A[10]+E[13]*A[15],_[11]=E[10]*A[1]+E[11]*A[6]+E[12]*A[11]+E[13]*A[16],_[12]=E[10]*A[2]+E[11]*A[7]+E[12]*A[12]+E[13]*A[17],_[13]=E[10]*A[3]+E[11]*A[8]+E[12]*A[13]+E[13]*A[18],_[14]=E[10]*A[4]+E[11]*A[9]+E[12]*A[14]+E[13]*A[19]+E[14],_[15]=E[15]*A[0]+E[16]*A[5]+E[17]*A[10]+E[18]*A[15],_[16]=E[15]*A[1]+E[16]*A[6]+E[17]*A[11]+E[18]*A[16],_[17]=E[15]*A[2]+E[16]*A[7]+E[17]*A[12]+E[18]*A[17],_[18]=E[15]*A[3]+E[16]*A[8]+E[17]*A[13]+E[18]*A[18],_[19]=E[15]*A[4]+E[16]*A[9]+E[17]*A[14]+E[18]*A[19]+E[19],_}_colorMatrix(_){const E=new Float32Array(_);return E[4]/=255,E[9]/=255,E[14]/=255,E[19]/=255,E}brightness(_,E){const A=[_,0,0,0,0,0,_,0,0,0,0,0,_,0,0,0,0,0,1,0];this._loadMatrix(A,E)}tint(_,E){const A=_>>16&255,R=_>>8&255,I=_&255,P=[A/255,0,0,0,0,0,R/255,0,0,0,0,0,I/255,0,0,0,0,0,1,0];this._loadMatrix(P,E)}greyscale(_,E){const A=[_,_,_,0,0,_,_,_,0,0,_,_,_,0,0,0,0,0,1,0];this._loadMatrix(A,E)}blackAndWhite(_){const E=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(E,_)}hue(_,E){_=(_||0)/180*Math.PI;const A=Math.cos(_),R=Math.sin(_),I=Math.sqrt,P=1/3,C=I(P),D=A+(1-A)*P,B=P*(1-A)-C*R,O=P*(1-A)+C*R,F=P*(1-A)+C*R,L=A+P*(1-A),U=P*(1-A)-C*R,G=P*(1-A)-C*R,X=P*(1-A)+C*R,W=A+P*(1-A),V=[D,B,O,0,0,F,L,U,0,0,G,X,W,0,0,0,0,0,1,0];this._loadMatrix(V,E)}contrast(_,E){const A=(_||0)+1,R=-.5*(A-1),I=[A,0,0,0,R,0,A,0,0,R,0,0,A,0,R,0,0,0,1,0];this._loadMatrix(I,E)}saturate(_=0,E){const A=_*2/3+1,R=(A-1)*-.5,I=[A,R,R,0,0,R,A,R,0,0,R,R,A,0,0,0,0,0,1,0];this._loadMatrix(I,E)}desaturate(){this.saturate(-1)}negative(_){const E=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(E,_)}sepia(_){const E=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(E,_)}technicolor(_){const E=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(E,_)}polaroid(_){const E=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(E,_)}toBGR(_){const E=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(E,_)}kodachrome(_){const E=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(E,_)}browni(_){const E=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(E,_)}vintage(_){const E=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(E,_)}colorTone(_,E,A,R,I){_=_||.2,E=E||.15,A=A||16770432,R=R||3375104;const P=(A>>16&255)/255,C=(A>>8&255)/255,D=(A&255)/255,B=(R>>16&255)/255,O=(R>>8&255)/255,F=(R&255)/255,L=[.3,.59,.11,0,0,P,C,D,_,0,B,O,F,E,0,P-B,C-O,D-F,0,0];this._loadMatrix(L,I)}night(_,E){_=_||.1;const A=[_*-2,-_,0,0,0,-_,0,_,0,0,0,_,_*2,0,0,0,0,0,1,0];this._loadMatrix(A,E)}predator(_,E){const A=[11.224130630493164*_,-4.794486999511719*_,-2.8746118545532227*_,0*_,.40342438220977783*_,-3.6330697536468506*_,9.193157196044922*_,-2.951810836791992*_,0*_,-1.316135048866272*_,-3.2184197902679443*_,-4.2375030517578125*_,7.476448059082031*_,0*_,.8044459223747253*_,0,0,0,1,0];this._loadMatrix(A,E)}lsd(_){const E=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(E,_)}reset(){const _=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(_,!1)}get matrix(){return this.uniforms.m}set matrix(_){this.uniforms.m=_}get alpha(){return this.uniforms.uAlpha}set alpha(_){this.uniforms.uAlpha=_}}ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale;settings.SORTABLE_CHILDREN=!1;class Bounds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(_){return this.minX>this.maxX||this.minY>this.maxY?Rectangle.EMPTY:(_=_||new Rectangle(0,0,1,1),_.x=this.minX,_.y=this.minY,_.width=this.maxX-this.minX,_.height=this.maxY-this.minY,_)}addPoint(_){this.minX=Math.min(this.minX,_.x),this.maxX=Math.max(this.maxX,_.x),this.minY=Math.min(this.minY,_.y),this.maxY=Math.max(this.maxY,_.y)}addPointMatrix(_,E){const{a:A,b:R,c:I,d:P,tx:C,ty:D}=_,B=A*E.x+I*E.y+C,O=R*E.x+P*E.y+D;this.minX=Math.min(this.minX,B),this.maxX=Math.max(this.maxX,B),this.minY=Math.min(this.minY,O),this.maxY=Math.max(this.maxY,O)}addQuad(_){let E=this.minX,A=this.minY,R=this.maxX,I=this.maxY,P=_[0],C=_[1];E=P<E?P:E,A=C<A?C:A,R=P>R?P:R,I=C>I?C:I,P=_[2],C=_[3],E=P<E?P:E,A=C<A?C:A,R=P>R?P:R,I=C>I?C:I,P=_[4],C=_[5],E=P<E?P:E,A=C<A?C:A,R=P>R?P:R,I=C>I?C:I,P=_[6],C=_[7],E=P<E?P:E,A=C<A?C:A,R=P>R?P:R,I=C>I?C:I,this.minX=E,this.minY=A,this.maxX=R,this.maxY=I}addFrame(_,E,A,R,I){this.addFrameMatrix(_.worldTransform,E,A,R,I)}addFrameMatrix(_,E,A,R,I){const P=_.a,C=_.b,D=_.c,B=_.d,O=_.tx,F=_.ty;let L=this.minX,U=this.minY,G=this.maxX,X=this.maxY,W=P*E+D*A+O,V=C*E+B*A+F;L=W<L?W:L,U=V<U?V:U,G=W>G?W:G,X=V>X?V:X,W=P*R+D*A+O,V=C*R+B*A+F,L=W<L?W:L,U=V<U?V:U,G=W>G?W:G,X=V>X?V:X,W=P*E+D*I+O,V=C*E+B*I+F,L=W<L?W:L,U=V<U?V:U,G=W>G?W:G,X=V>X?V:X,W=P*R+D*I+O,V=C*R+B*I+F,L=W<L?W:L,U=V<U?V:U,G=W>G?W:G,X=V>X?V:X,this.minX=L,this.minY=U,this.maxX=G,this.maxY=X}addVertexData(_,E,A){let R=this.minX,I=this.minY,P=this.maxX,C=this.maxY;for(let D=E;D<A;D+=2){const B=_[D],O=_[D+1];R=B<R?B:R,I=O<I?O:I,P=B>P?B:P,C=O>C?O:C}this.minX=R,this.minY=I,this.maxX=P,this.maxY=C}addVertices(_,E,A,R){this.addVerticesMatrix(_.worldTransform,E,A,R)}addVerticesMatrix(_,E,A,R,I=0,P=I){const C=_.a,D=_.b,B=_.c,O=_.d,F=_.tx,L=_.ty;let U=this.minX,G=this.minY,X=this.maxX,W=this.maxY;for(let V=A;V<R;V+=2){const q=E[V],z=E[V+1],Y=C*q+B*z+F,K=O*z+D*q+L;U=Math.min(U,Y-I),X=Math.max(X,Y+I),G=Math.min(G,K-P),W=Math.max(W,K+P)}this.minX=U,this.minY=G,this.maxX=X,this.maxY=W}addBounds(_){const E=this.minX,A=this.minY,R=this.maxX,I=this.maxY;this.minX=_.minX<E?_.minX:E,this.minY=_.minY<A?_.minY:A,this.maxX=_.maxX>R?_.maxX:R,this.maxY=_.maxY>I?_.maxY:I}addBoundsMask(_,E){const A=_.minX>E.minX?_.minX:E.minX,R=_.minY>E.minY?_.minY:E.minY,I=_.maxX<E.maxX?_.maxX:E.maxX,P=_.maxY<E.maxY?_.maxY:E.maxY;if(A<=I&&R<=P){const C=this.minX,D=this.minY,B=this.maxX,O=this.maxY;this.minX=A<C?A:C,this.minY=R<D?R:D,this.maxX=I>B?I:B,this.maxY=P>O?P:O}}addBoundsMatrix(_,E){this.addFrameMatrix(E,_.minX,_.minY,_.maxX,_.maxY)}addBoundsArea(_,E){const A=_.minX>E.x?_.minX:E.x,R=_.minY>E.y?_.minY:E.y,I=_.maxX<E.x+E.width?_.maxX:E.x+E.width,P=_.maxY<E.y+E.height?_.maxY:E.y+E.height;if(A<=I&&R<=P){const C=this.minX,D=this.minY,B=this.maxX,O=this.maxY;this.minX=A<C?A:C,this.minY=R<D?R:D,this.maxX=I>B?I:B,this.maxY=P>O?P:O}}pad(_=0,E=_){this.isEmpty()||(this.minX-=_,this.maxX+=_,this.minY-=E,this.maxY+=E)}addFramePad(_,E,A,R,I,P){_-=I,E-=P,A+=I,R+=P,this.minX=this.minX<_?this.minX:_,this.maxX=this.maxX>A?this.maxX:A,this.minY=this.minY<E?this.minY:E,this.maxY=this.maxY>R?this.maxY:R}}class DisplayObject extends EventEmitter$1{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Transform,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Bounds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(_){const E=Object.keys(_);for(let A=0;A<E.length;++A){const R=E[A];Object.defineProperty(DisplayObject.prototype,R,Object.getOwnPropertyDescriptor(_,R))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(_,E){return _||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),E||(this._boundsRect||(this._boundsRect=new Rectangle),E=this._boundsRect),this._bounds.getRectangle(E)}getLocalBounds(_){_||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),_=this._localBoundsRect),this._localBounds||(this._localBounds=new Bounds);const E=this.transform,A=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const R=this._bounds,I=this._boundsID;this._bounds=this._localBounds;const P=this.getBounds(!1,_);return this.parent=A,this.transform=E,this._bounds=R,this._bounds.updateID+=this._boundsID-I,P}toGlobal(_,E,A=!1){return A||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(_,E)}toLocal(_,E,A,R){return E&&(_=E.toGlobal(_,A,R)),R||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(_,A)}setParent(_){if(!_||!_.addChild)throw new Error("setParent: Argument must be a Container");return _.addChild(this),_}removeFromParent(){var _;(_=this.parent)==null||_.removeChild(this)}setTransform(_=0,E=0,A=1,R=1,I=0,P=0,C=0,D=0,B=0){return this.position.x=_,this.position.y=E,this.scale.x=A||1,this.scale.y=R||1,this.rotation=I,this.skew.x=P,this.skew.y=C,this.pivot.x=D,this.pivot.y=B,this}destroy(_){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new TemporaryDisplayObject),this.tempDisplayObjectParent}enableTempParent(){const _=this.parent;return this.parent=this._tempDisplayObjectParent,_}disableTempParent(_){this.parent=_}get x(){return this.position.x}set x(_){this.transform.position.x=_}get y(){return this.position.y}set y(_){this.transform.position.y=_}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(_){this.transform.position.copyFrom(_)}get scale(){return this.transform.scale}set scale(_){this.transform.scale.copyFrom(_)}get pivot(){return this.transform.pivot}set pivot(_){this.transform.pivot.copyFrom(_)}get skew(){return this.transform.skew}set skew(_){this.transform.skew.copyFrom(_)}get rotation(){return this.transform.rotation}set rotation(_){this.transform.rotation=_}get angle(){return this.transform.rotation*RAD_TO_DEG}set angle(_){this.transform.rotation=_*DEG_TO_RAD}get zIndex(){return this._zIndex}set zIndex(_){this._zIndex=_,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let _=this;do{if(!_.visible)return!1;_=_.parent}while(_);return!0}get mask(){return this._mask}set mask(_){if(this._mask!==_){if(this._mask){const E=this._mask.isMaskData?this._mask.maskObject:this._mask;E&&(E._maskRefCount--,E._maskRefCount===0&&(E.renderable=!0,E.isMask=!1))}if(this._mask=_,this._mask){const E=this._mask.isMaskData?this._mask.maskObject:this._mask;E&&(E._maskRefCount===0&&(E.renderable=!1,E.isMask=!0),E._maskRefCount++)}}}}class TemporaryDisplayObject extends DisplayObject{constructor(){super(...arguments),this.sortDirty=null}}DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform;function sortChildren(T,_){return T.zIndex===_.zIndex?T._lastSortedIndex-_._lastSortedIndex:T.zIndex-_.zIndex}class Container extends DisplayObject{constructor(){super(),this.children=[],this.sortableChildren=settings.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(_){}addChild(..._){if(_.length>1)for(let E=0;E<_.length;E++)this.addChild(_[E]);else{const E=_[0];E.parent&&E.parent.removeChild(E),E.parent=this,this.sortDirty=!0,E.transform._parentID=-1,this.children.push(E),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",E,this,this.children.length-1),E.emit("added",this)}return _[0]}addChildAt(_,E){if(E<0||E>this.children.length)throw new Error(`${_}addChildAt: The index ${E} supplied is out of bounds ${this.children.length}`);return _.parent&&_.parent.removeChild(_),_.parent=this,this.sortDirty=!0,_.transform._parentID=-1,this.children.splice(E,0,_),this._boundsID++,this.onChildrenChange(E),_.emit("added",this),this.emit("childAdded",_,this,E),_}swapChildren(_,E){if(_===E)return;const A=this.getChildIndex(_),R=this.getChildIndex(E);this.children[A]=E,this.children[R]=_,this.onChildrenChange(A<R?A:R)}getChildIndex(_){const E=this.children.indexOf(_);if(E===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return E}setChildIndex(_,E){if(E<0||E>=this.children.length)throw new Error(`The index ${E} supplied is out of bounds ${this.children.length}`);const A=this.getChildIndex(_);removeItems(this.children,A,1),this.children.splice(E,0,_),this.onChildrenChange(E)}getChildAt(_){if(_<0||_>=this.children.length)throw new Error(`getChildAt: Index (${_}) does not exist.`);return this.children[_]}removeChild(..._){if(_.length>1)for(let E=0;E<_.length;E++)this.removeChild(_[E]);else{const E=_[0],A=this.children.indexOf(E);if(A===-1)return null;E.parent=null,E.transform._parentID=-1,removeItems(this.children,A,1),this._boundsID++,this.onChildrenChange(A),E.emit("removed",this),this.emit("childRemoved",E,this,A)}return _[0]}removeChildAt(_){const E=this.getChildAt(_);return E.parent=null,E.transform._parentID=-1,removeItems(this.children,_,1),this._boundsID++,this.onChildrenChange(_),E.emit("removed",this),this.emit("childRemoved",E,this,_),E}removeChildren(_=0,E=this.children.length){const A=_,R=E,I=R-A;let P;if(I>0&&I<=R){P=this.children.splice(A,I);for(let C=0;C<P.length;++C)P[C].parent=null,P[C].transform&&(P[C].transform._parentID=-1);this._boundsID++,this.onChildrenChange(_);for(let C=0;C<P.length;++C)P[C].emit("removed",this),this.emit("childRemoved",P[C],this,C);return P}else if(I===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let _=!1;for(let E=0,A=this.children.length;E<A;++E){const R=this.children[E];R._lastSortedIndex=E,!_&&R.zIndex!==0&&(_=!0)}_&&this.children.length>1&&this.children.sort(sortChildren),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let _=0,E=this.children.length;_<E;++_){const A=this.children[_];A.visible&&A.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let _=0;_<this.children.length;_++){const E=this.children[_];if(!(!E.visible||!E.renderable))if(E.calculateBounds(),E._mask){const A=E._mask.isMaskData?E._mask.maskObject:E._mask;A?(A.calculateBounds(),this._bounds.addBoundsMask(E._bounds,A._bounds)):this._bounds.addBounds(E._bounds)}else E.filterArea?this._bounds.addBoundsArea(E._bounds,E.filterArea):this._bounds.addBounds(E._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(_,E=!1){const A=super.getLocalBounds(_);if(!E)for(let R=0,I=this.children.length;R<I;++R){const P=this.children[R];P.visible&&P.updateTransform()}return A}_calculateBounds(){}_renderWithCulling(_){const E=_.renderTexture.sourceFrame;if(!(E.width>0&&E.height>0))return;let A,R;if(this.cullArea?(A=this.cullArea,R=this.worldTransform):this._render!==Container.prototype._render&&(A=this.getBounds(!0)),A&&E.intersects(A,R))this._render(_);else if(this.cullArea)return;for(let I=0,P=this.children.length;I<P;++I){const C=this.children[I],D=C.cullable;C.cullable=D||!this.cullArea,C.render(_),C.cullable=D}}render(_){var E;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||((E=this.filters)==null?void 0:E.length))this.renderAdvanced(_);else if(this.cullable)this._renderWithCulling(_);else{this._render(_);for(let A=0,R=this.children.length;A<R;++A)this.children[A].render(_)}}renderAdvanced(_){var I,P,C;const E=this.filters,A=this._mask;if(E){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let D=0;D<E.length;D++)E[D].enabled&&this._enabledFilters.push(E[D])}const R=E&&((I=this._enabledFilters)==null?void 0:I.length)||A&&(!A.isMaskData||A.enabled&&(A.autoDetect||A.type!==MASK_TYPES.NONE));if(R&&_.batch.flush(),E&&((P=this._enabledFilters)==null?void 0:P.length)&&_.filter.push(this,this._enabledFilters),A&&_.mask.push(this,this._mask),this.cullable)this._renderWithCulling(_);else{this._render(_);for(let D=0,B=this.children.length;D<B;++D)this.children[D].render(_)}R&&_.batch.flush(),A&&_.mask.pop(this),E&&((C=this._enabledFilters)==null?void 0:C.length)&&_.filter.pop()}_render(_){}destroy(_){super.destroy(),this.sortDirty=!1;const E=typeof _=="boolean"?_:_==null?void 0:_.children,A=this.removeChildren(0,this.children.length);if(E)for(let R=0;R<A.length;++R)A[R].destroy(_)}get width(){return this.scale.x*this.getLocalBounds().width}set width(_){const E=this.getLocalBounds().width;E!==0?this.scale.x=_/E:this.scale.x=1,this._width=_}get height(){return this.scale.y*this.getLocalBounds().height}set height(_){const E=this.getLocalBounds().height;E!==0?this.scale.y=_/E:this.scale.y=1,this._height=_}}Container.prototype.containerUpdateTransform=Container.prototype.updateTransform;const tempPoint$1=new Point,indices=new Uint16Array([0,1,2,0,2,3]);class Sprite extends Container{constructor(_){super(),this._anchor=new ObservablePoint(this._onAnchorUpdate,this,_?_.defaultAnchor.x:0,_?_.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=_||Texture.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=indices,this.pluginName="batch",this.isSprite=!0,this._roundPixels=settings.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=sign(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=sign(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const _=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===_._updateID)return;this._textureID!==_._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=_._updateID;const E=this.transform.worldTransform,A=E.a,R=E.b,I=E.c,P=E.d,C=E.tx,D=E.ty,B=this.vertexData,O=_.trim,F=_.orig,L=this._anchor;let U=0,G=0,X=0,W=0;if(O?(G=O.x-L._x*F.width,U=G+O.width,W=O.y-L._y*F.height,X=W+O.height):(G=-L._x*F.width,U=G+F.width,W=-L._y*F.height,X=W+F.height),B[0]=A*G+I*W+C,B[1]=P*W+R*G+D,B[2]=A*U+I*W+C,B[3]=P*W+R*U+D,B[4]=A*U+I*X+C,B[5]=P*X+R*U+D,B[6]=A*G+I*X+C,B[7]=P*X+R*G+D,this._roundPixels){const V=settings.RESOLUTION;for(let q=0;q<B.length;++q)B[q]=Math.round(B[q]*V)/V}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const _=this._texture,E=this.vertexTrimmedData,A=_.orig,R=this._anchor,I=this.transform.worldTransform,P=I.a,C=I.b,D=I.c,B=I.d,O=I.tx,F=I.ty,L=-R._x*A.width,U=L+A.width,G=-R._y*A.height,X=G+A.height;E[0]=P*L+D*G+O,E[1]=B*G+C*L+F,E[2]=P*U+D*G+O,E[3]=B*G+C*U+F,E[4]=P*U+D*X+O,E[5]=B*X+C*U+F,E[6]=P*L+D*X+O,E[7]=B*X+C*L+F}_render(_){this.calculateVertices(),_.batch.setObjectRenderer(_.plugins[this.pluginName]),_.plugins[this.pluginName].render(this)}_calculateBounds(){const _=this._texture.trim,E=this._texture.orig;!_||_.width===E.width&&_.height===E.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(_){return this.children.length===0?(this._localBounds||(this._localBounds=new Bounds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),_||(this._localBoundsRect||(this._localBoundsRect=new Rectangle),_=this._localBoundsRect),this._localBounds.getRectangle(_)):super.getLocalBounds.call(this,_)}containsPoint(_){this.worldTransform.applyInverse(_,tempPoint$1);const E=this._texture.orig.width,A=this._texture.orig.height,R=-E*this.anchor.x;let I=0;return tempPoint$1.x>=R&&tempPoint$1.x<R+E&&(I=-A*this.anchor.y,tempPoint$1.y>=I&&tempPoint$1.y<I+A)}destroy(_){if(super.destroy(_),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof _=="boolean"?_:_==null?void 0:_.texture){const A=typeof _=="boolean"?_:_==null?void 0:_.baseTexture;this._texture.destroy(!!A)}this._texture=null}static from(_,E){const A=_ instanceof Texture?_:Texture.from(_,E);return new Sprite(A)}set roundPixels(_){this._roundPixels!==_&&(this._transformID=-1),this._roundPixels=_}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(_){const E=sign(this.scale.x)||1;this.scale.x=E*_/this._texture.orig.width,this._width=_}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(_){const E=sign(this.scale.y)||1;this.scale.y=E*_/this._texture.orig.height,this._height=_}get anchor(){return this._anchor}set anchor(_){this._anchor.copyFrom(_)}get tint(){return this._tint}set tint(_){this._tint=_,this._tintRGB=(_>>16)+(_&65280)+((_&255)<<16)}get texture(){return this._texture}set texture(_){this._texture!==_&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=_||Texture.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,_&&(_.baseTexture.valid?this._onTextureUpdate():_.once("update",this._onTextureUpdate,this)))}}const _tempMatrix=new Matrix;DisplayObject.prototype._cacheAsBitmap=!1;DisplayObject.prototype._cacheData=null;DisplayObject.prototype._cacheAsBitmapResolution=null;DisplayObject.prototype._cacheAsBitmapMultisample=null;class CacheData{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(DisplayObject.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(T){T!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=T,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(T){T!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=T,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(T){if(this._cacheAsBitmap===T)return;this._cacheAsBitmap=T;let _;T?(this._cacheData||(this._cacheData=new CacheData),_=this._cacheData,_.originalRender=this.render,_.originalRenderCanvas=this.renderCanvas,_.originalUpdateTransform=this.updateTransform,_.originalCalculateBounds=this.calculateBounds,_.originalGetLocalBounds=this.getLocalBounds,_.originalDestroy=this.destroy,_.originalContainsPoint=this.containsPoint,_.originalMask=this._mask,_.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(_=this._cacheData,_.sprite&&this._destroyCachedDisplayObject(),this.render=_.originalRender,this.renderCanvas=_.originalRenderCanvas,this.calculateBounds=_.originalCalculateBounds,this.getLocalBounds=_.originalGetLocalBounds,this.destroy=_.originalDestroy,this.updateTransform=_.originalUpdateTransform,this.containsPoint=_.originalContainsPoint,this._mask=_.originalMask,this.filterArea=_.originalFilterArea)}}});DisplayObject.prototype._renderCached=function(_){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(_),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(_))};DisplayObject.prototype._initCachedDisplayObject=function(_){var L,U,G;if((L=this._cacheData)!=null&&L.sprite)return;const E=this.alpha;this.alpha=1,_.batch.flush();const A=this.getLocalBounds(null,!0).clone();if((U=this.filters)!=null&&U.length){const X=this.filters[0].padding;A.pad(X)}A.ceil(settings.RESOLUTION);const R=_.renderTexture.current,I=_.renderTexture.sourceFrame.clone(),P=_.renderTexture.destinationFrame.clone(),C=_.projection.transform,D=RenderTexture.create({width:A.width,height:A.height,resolution:this.cacheAsBitmapResolution||_.resolution,multisample:(G=this.cacheAsBitmapMultisample)!=null?G:_.multisample}),B=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=B,BaseTexture.addToCache(D.baseTexture,B),Texture.addToCache(D,B);const O=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-A.x,-A.y);this.render=this._cacheData.originalRender,_.render(this,{renderTexture:D,clear:!0,transform:O,skipUpdateTransform:!1}),_.framebuffer.blit(),_.projection.transform=C,_.renderTexture.bind(R,I,P),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=E;const F=new Sprite(D);F.transform.worldTransform=this.transform.worldTransform,F.anchor.x=-(A.x/A.width),F.anchor.y=-(A.y/A.height),F.alpha=E,F._bounds=this._bounds,this._cacheData.sprite=F,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=F.containsPoint.bind(F)};DisplayObject.prototype._renderCachedCanvas=function(_){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(_),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(_))};DisplayObject.prototype._initCachedDisplayObjectCanvas=function(_){var O;if((O=this._cacheData)!=null&&O.sprite)return;const E=this.getLocalBounds(null,!0),A=this.alpha;this.alpha=1;const R=_.canvasContext.activeContext,I=_._projTransform;E.ceil(settings.RESOLUTION);const P=RenderTexture.create({width:E.width,height:E.height}),C=`cacheAsBitmap_${uid()}`;this._cacheData.textureCacheId=C,BaseTexture.addToCache(P.baseTexture,C),Texture.addToCache(P,C);const D=_tempMatrix;this.transform.localTransform.copyTo(D),D.invert(),D.tx-=E.x,D.ty-=E.y,this.renderCanvas=this._cacheData.originalRenderCanvas,_.render(this,{renderTexture:P,clear:!0,transform:D,skipUpdateTransform:!1}),_.canvasContext.activeContext=R,_._projTransform=I,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=A;const B=new Sprite(P);B.transform.worldTransform=this.transform.worldTransform,B.anchor.x=-(E.x/E.width),B.anchor.y=-(E.y/E.height),B.alpha=A,B._bounds=this._bounds,this._cacheData.sprite=B,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=_._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=B.containsPoint.bind(B)};DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,BaseTexture.removeFromCache(this._cacheData.textureCacheId),Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};DisplayObject.prototype._cacheAsBitmapDestroy=function(_){this.cacheAsBitmap=!1,this.destroy(_)};DisplayObject.prototype.name=null;Container.prototype.getChildByName=function(_,E){for(let A=0,R=this.children.length;A<R;A++)if(this.children[A].name===_)return this.children[A];if(E)for(let A=0,R=this.children.length;A<R;A++){const I=this.children[A];if(!I.getChildByName)continue;const P=I.getChildByName(_,!0);if(P)return P}return null};DisplayObject.prototype.getGlobalPosition=function(_=new Point,E=!1){return this.parent?this.parent.toGlobal(this.position,_,E):(_.x=this.position.x,_.y=this.position.y),_};const accessibleTarget={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};class FederatedEvent{constructor(_){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=FederatedEvent.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Point,this.page=new Point,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=_}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(_,E,A){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(_,E,A,R,I){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class FederatedMouseEvent extends FederatedEvent{constructor(){super(...arguments),this.client=new Point,this.movement=new Point,this.offset=new Point,this.global=new Point,this.screen=new Point}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(_){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(_)}initMouseEvent(_,E,A,R,I,P,C,D,B,O,F,L,U,G,X){throw new Error("Method not implemented.")}}class FederatedPointerEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class FederatedWheelEvent extends FederatedMouseEvent{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const PROPAGATION_LIMIT=2048,tempHitLocation=new Point,tempLocalMapping=new Point;class EventBoundary{constructor(_){this.dispatch=new EventEmitter$1,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=_,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(_,E){this.mappingTable[_]||(this.mappingTable[_]=[]),this.mappingTable[_].push({fn:E,priority:0}),this.mappingTable[_].sort((A,R)=>A.priority-R.priority)}dispatchEvent(_,E){_.propagationStopped=!1,_.propagationImmediatelyStopped=!1,this.propagate(_,E),this.dispatch.emit(E||_.type,_)}mapEvent(_){if(!this.rootTarget)return;const E=this.mappingTable[_.type];if(E)for(let A=0,R=E.length;A<R;A++)E[A].fn(_);else console.warn(`[EventBoundary]: Event mapping not defined for ${_.type}`)}hitTest(_,E){const A=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,tempHitLocation.set(_,E),this.hitTestFn,this.hitPruneFn);return A&&A[0]}propagate(_,E){if(!_.target)return;const A=_.composedPath();_.eventPhase=_.CAPTURING_PHASE;for(let R=0,I=A.length-1;R<I;R++)if(_.currentTarget=A[R],this.notifyTarget(_,E),_.propagationStopped||_.propagationImmediatelyStopped)return;if(_.eventPhase=_.AT_TARGET,_.currentTarget=_.target,this.notifyTarget(_,E),!(_.propagationStopped||_.propagationImmediatelyStopped)){_.eventPhase=_.BUBBLING_PHASE;for(let R=A.length-2;R>=0;R--)if(_.currentTarget=A[R],this.notifyTarget(_,E),_.propagationStopped||_.propagationImmediatelyStopped)return}}all(_,E,A=this.rootTarget){_.eventPhase=_.BUBBLING_PHASE;const R=A.children;if(R)for(let I=0;I<R.length;I++)this.all(_,E,R[I]);_.currentTarget=A,this.notifyTarget(_,E)}propagationPath(_){const E=[_];for(let A=0;A<PROPAGATION_LIMIT&&_!==this.rootTarget;A++){if(!_.parent)throw new Error("Cannot find propagation path to disconnected target");E.push(_.parent),_=_.parent}return E.reverse(),E}hitTestRecursive(_,E,A,R,I){if(!_||!_.visible||I(_,A))return null;if(_.interactiveChildren&&_.children){const P=_.children;for(let C=P.length-1;C>=0;C--){const D=P[C],B=this.hitTestRecursive(D,E||D.interactive,A,R,I);if(B){if(B.length>0&&!B[B.length-1].parent)continue;return(B.length>0||_.interactive)&&B.push(_),B}}}return E&&R(_,A)?_.interactive?[_]:[]:null}hitPruneFn(_,E){var A;if(_.hitArea&&(_.worldTransform.applyInverse(E,tempLocalMapping),!_.hitArea.contains(tempLocalMapping.x,tempLocalMapping.y)))return!0;if(_._mask){const R=_._mask.isMaskData?_._mask.maskObject:_._mask;if(R&&!((A=R.containsPoint)!=null&&A.call(R,E)))return!0}return!1}hitTestFn(_,E){return _.hitArea?!0:_.containsPoint?_.containsPoint(E):!1}notifyTarget(_,E){E=E!=null?E:_.type;const A=_.eventPhase===_.CAPTURING_PHASE||_.eventPhase===_.AT_TARGET?`${E}capture`:E;this.notifyListeners(_,A),_.eventPhase===_.AT_TARGET&&this.notifyListeners(_,E)}mapPointerDown(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=this.createPointerEvent(_);if(this.dispatchEvent(E,"pointerdown"),E.pointerType==="touch")this.dispatchEvent(E,"touchstart");else if(E.pointerType==="mouse"||E.pointerType==="pen"){const R=E.button===2;this.dispatchEvent(E,R?"rightdown":"mousedown")}const A=this.trackingData(_.pointerId);A.pressTargetsByButton[_.button]=E.composedPath(),this.freeEvent(E)}mapPointerMove(_){var C;if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=this.createPointerEvent(_),A=E.pointerType==="mouse"||E.pointerType==="pen",R=this.trackingData(_.pointerId),I=this.findMountedTarget(R.overTargets);if(R.overTargets&&I!==E.target){const D=_.type==="mousemove"?"mouseout":"pointerout",B=this.createPointerEvent(_,D,I);if(this.dispatchEvent(B,"pointerout"),A&&this.dispatchEvent(B,"mouseout"),!E.composedPath().includes(I)){const O=this.createPointerEvent(_,"pointerleave",I);for(O.eventPhase=O.AT_TARGET;O.target&&!E.composedPath().includes(O.target);)O.currentTarget=O.target,this.notifyTarget(O),A&&this.notifyTarget(O,"mouseleave"),O.target=O.target.parent;this.freeEvent(O)}this.freeEvent(B)}if(I!==E.target){const D=_.type==="mousemove"?"mouseover":"pointerover",B=this.clonePointerEvent(E,D);this.dispatchEvent(B,"pointerover"),A&&this.dispatchEvent(B,"mouseover");let O=I==null?void 0:I.parent;for(;O&&O!==this.rootTarget.parent&&O!==E.target;)O=O.parent;if(!O||O===this.rootTarget.parent){const L=this.clonePointerEvent(E,"pointerenter");for(L.eventPhase=L.AT_TARGET;L.target&&L.target!==I&&L.target!==this.rootTarget.parent;)L.currentTarget=L.target,this.notifyTarget(L),A&&this.notifyTarget(L,"mouseenter"),L.target=L.target.parent;this.freeEvent(L)}this.freeEvent(B)}const P=this.moveOnAll?"all":"dispatchEvent";this[P](E,"pointermove"),E.pointerType==="touch"&&this[P](E,"touchmove"),A&&(this[P](E,"mousemove"),this.cursor=(C=E.target)==null?void 0:C.cursor),R.overTargets=E.composedPath(),this.freeEvent(E)}mapPointerOver(_){var P;if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=this.trackingData(_.pointerId),A=this.createPointerEvent(_),R=A.pointerType==="mouse"||A.pointerType==="pen";this.dispatchEvent(A,"pointerover"),R&&this.dispatchEvent(A,"mouseover"),A.pointerType==="mouse"&&(this.cursor=(P=A.target)==null?void 0:P.cursor);const I=this.clonePointerEvent(A,"pointerenter");for(I.eventPhase=I.AT_TARGET;I.target&&I.target!==this.rootTarget.parent;)I.currentTarget=I.target,this.notifyTarget(I),R&&this.notifyTarget(I,"mouseenter"),I.target=I.target.parent;E.overTargets=A.composedPath(),this.freeEvent(A),this.freeEvent(I)}mapPointerOut(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=this.trackingData(_.pointerId);if(E.overTargets){const A=_.pointerType==="mouse"||_.pointerType==="pen",R=this.findMountedTarget(E.overTargets),I=this.createPointerEvent(_,"pointerout",R);this.dispatchEvent(I),A&&this.dispatchEvent(I,"mouseout");const P=this.createPointerEvent(_,"pointerleave",R);for(P.eventPhase=P.AT_TARGET;P.target&&P.target!==this.rootTarget.parent;)P.currentTarget=P.target,this.notifyTarget(P),A&&this.notifyTarget(P,"mouseleave"),P.target=P.target.parent;E.overTargets=null,this.freeEvent(I),this.freeEvent(P)}this.cursor=null}mapPointerUp(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=performance.now(),A=this.createPointerEvent(_);if(this.dispatchEvent(A,"pointerup"),A.pointerType==="touch")this.dispatchEvent(A,"touchend");else if(A.pointerType==="mouse"||A.pointerType==="pen"){const C=A.button===2;this.dispatchEvent(A,C?"rightup":"mouseup")}const R=this.trackingData(_.pointerId),I=this.findMountedTarget(R.pressTargetsByButton[_.button]);let P=I;if(I&&!A.composedPath().includes(I)){let C=I;for(;C&&!A.composedPath().includes(C);){if(A.currentTarget=C,this.notifyTarget(A,"pointerupoutside"),A.pointerType==="touch")this.notifyTarget(A,"touchendoutside");else if(A.pointerType==="mouse"||A.pointerType==="pen"){const D=A.button===2;this.notifyTarget(A,D?"rightupoutside":"mouseupoutside")}C=C.parent}delete R.pressTargetsByButton[_.button],P=C}if(P){const C=this.clonePointerEvent(A,"click");C.target=P,C.path=null,R.clicksByButton[_.button]||(R.clicksByButton[_.button]={clickCount:0,target:C.target,timeStamp:E});const D=R.clicksByButton[_.button];D.target===C.target&&E-D.timeStamp<200?++D.clickCount:D.clickCount=1,D.target=C.target,D.timeStamp=E,C.detail=D.clickCount,C.pointerType==="mouse"?this.dispatchEvent(C,"click"):C.pointerType==="touch"&&this.dispatchEvent(C,"tap"),this.dispatchEvent(C,"pointertap"),this.freeEvent(C)}this.freeEvent(A)}mapPointerUpOutside(_){if(!(_ instanceof FederatedPointerEvent)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const E=this.trackingData(_.pointerId),A=this.findMountedTarget(E.pressTargetsByButton[_.button]),R=this.createPointerEvent(_);if(A){let I=A;for(;I;)R.currentTarget=I,this.notifyTarget(R,"pointerupoutside"),R.pointerType==="touch"?this.notifyTarget(R,"touchendoutside"):(R.pointerType==="mouse"||R.pointerType==="pen")&&this.notifyTarget(R,R.button===2?"rightupoutside":"mouseupoutside"),I=I.parent;delete E.pressTargetsByButton[_.button]}this.freeEvent(R)}mapWheel(_){if(!(_ instanceof FederatedWheelEvent)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const E=this.createWheelEvent(_);this.dispatchEvent(E),this.freeEvent(E)}findMountedTarget(_){if(!_)return null;let E=_[0];for(let A=1;A<_.length&&_[A].parent===E;A++)E=_[A];return E}createPointerEvent(_,E,A){const R=this.allocateEvent(FederatedPointerEvent);return this.copyPointerData(_,R),this.copyMouseData(_,R),this.copyData(_,R),R.nativeEvent=_.nativeEvent,R.originalEvent=_,R.target=A!=null?A:this.hitTest(R.global.x,R.global.y),typeof E=="string"&&(R.type=E),R}createWheelEvent(_){const E=this.allocateEvent(FederatedWheelEvent);return this.copyWheelData(_,E),this.copyMouseData(_,E),this.copyData(_,E),E.nativeEvent=_.nativeEvent,E.originalEvent=_,E.target=this.hitTest(E.global.x,E.global.y),E}clonePointerEvent(_,E){const A=this.allocateEvent(FederatedPointerEvent);return A.nativeEvent=_.nativeEvent,A.originalEvent=_.originalEvent,this.copyPointerData(_,A),this.copyMouseData(_,A),this.copyData(_,A),A.target=_.target,A.path=_.composedPath().slice(),A.type=E!=null?E:A.type,A}copyWheelData(_,E){E.deltaMode=_.deltaMode,E.deltaX=_.deltaX,E.deltaY=_.deltaY,E.deltaZ=_.deltaZ}copyPointerData(_,E){_ instanceof FederatedPointerEvent&&E instanceof FederatedPointerEvent&&(E.pointerId=_.pointerId,E.width=_.width,E.height=_.height,E.isPrimary=_.isPrimary,E.pointerType=_.pointerType,E.pressure=_.pressure,E.tangentialPressure=_.tangentialPressure,E.tiltX=_.tiltX,E.tiltY=_.tiltY,E.twist=_.twist)}copyMouseData(_,E){_ instanceof FederatedMouseEvent&&E instanceof FederatedMouseEvent&&(E.altKey=_.altKey,E.button=_.button,E.buttons=_.buttons,E.client.copyFrom(_.client),E.ctrlKey=_.ctrlKey,E.metaKey=_.metaKey,E.movement.copyFrom(_.movement),E.screen.copyFrom(_.screen),E.global.copyFrom(_.global))}copyData(_,E){E.isTrusted=_.isTrusted,E.srcElement=_.srcElement,E.timeStamp=performance.now(),E.type=_.type,E.detail=_.detail,E.view=_.view,E.which=_.which,E.layer.copyFrom(_.layer),E.page.copyFrom(_.page)}trackingData(_){return this.mappingState.trackingData[_]||(this.mappingState.trackingData[_]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[_]}allocateEvent(_){this.eventPool.has(_)||this.eventPool.set(_,[]);const E=this.eventPool.get(_).pop()||new _(this);return E.eventPhase=E.NONE,E.currentTarget=null,E.path=null,E.target=null,E}freeEvent(_){if(_.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const E=_.constructor;this.eventPool.has(E)||this.eventPool.set(E,[]),this.eventPool.get(E).push(_)}notifyListeners(_,E){const A=_.currentTarget._events[E];if(!!A)if("fn"in A)A.fn.call(A.context,_);else for(let R=0,I=A.length;R<I&&!_.propagationImmediatelyStopped;R++)A[R].fn.call(A[R].context,_)}}const MOUSE_POINTER_ID=1,TOUCH_TO_POINTER={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class EventSystem{constructor(_){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=_,this.rootBoundary=new EventBoundary(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new FederatedPointerEvent(null),this.rootWheelEvent=new FederatedWheelEvent(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:_,resolution:E}=this.renderer;this.setTargetElement(_),this.resolution=E}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(_){_=_||"default";let E=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(E=!1),this.currentCursor===_)return;this.currentCursor=_;const A=this.cursorStyles[_];if(A)switch(typeof A){case"string":E&&(this.domElement.style.cursor=A);break;case"function":A(_);break;case"object":E&&Object.assign(this.domElement.style,A);break}else E&&typeof _=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,_)&&(this.domElement.style.cursor=_)}onPointerDown(_){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&_.pointerType==="touch")return;const E=this.normalizeToPointerData(_);this.autoPreventDefault&&E[0].isNormalized&&(_.cancelable||!("cancelable"in _))&&_.preventDefault();for(let A=0,R=E.length;A<R;A++){const I=E[A],P=this.bootstrapEvent(this.rootPointerEvent,I);this.rootBoundary.mapEvent(P)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(_){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&_.pointerType==="touch")return;const E=this.normalizeToPointerData(_);for(let A=0,R=E.length;A<R;A++){const I=this.bootstrapEvent(this.rootPointerEvent,E[A]);this.rootBoundary.mapEvent(I)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(_){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&_.pointerType==="touch")return;let E=_.target;_.composedPath&&_.composedPath().length>0&&(E=_.composedPath()[0]);const A=E!==this.domElement?"outside":"",R=this.normalizeToPointerData(_);for(let I=0,P=R.length;I<P;I++){const C=this.bootstrapEvent(this.rootPointerEvent,R[I]);C.type+=A,this.rootBoundary.mapEvent(C)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(_){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&_.pointerType==="touch")return;const E=this.normalizeToPointerData(_);for(let A=0,R=E.length;A<R;A++){const I=this.bootstrapEvent(this.rootPointerEvent,E[A]);this.rootBoundary.mapEvent(I)}this.setCursor(this.rootBoundary.cursor)}onWheel(_){const E=this.normalizeWheelEvent(_);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(E)}setTargetElement(_){this.removeEvents(),this.domElement=_,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const _=this.domElement.style;_&&(globalThis.navigator.msPointerEnabled?(_.msContentZooming="none",_.msTouchAction="none"):this.supportsPointerEvents&&(_.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const _=this.domElement.style;globalThis.navigator.msPointerEnabled?(_.msContentZooming="",_.msTouchAction=""):this.supportsPointerEvents&&(_.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(_,E,A){let R;this.domElement.parentElement?R=this.domElement.getBoundingClientRect():R={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const I=1/this.resolution;_.x=(E-R.left)*(this.domElement.width/R.width)*I,_.y=(A-R.top)*(this.domElement.height/R.height)*I}normalizeToPointerData(_){const E=[];if(this.supportsTouchEvents&&_ instanceof TouchEvent)for(let A=0,R=_.changedTouches.length;A<R;A++){const I=_.changedTouches[A];typeof I.button>"u"&&(I.button=0),typeof I.buttons>"u"&&(I.buttons=1),typeof I.isPrimary>"u"&&(I.isPrimary=_.touches.length===1&&_.type==="touchstart"),typeof I.width>"u"&&(I.width=I.radiusX||1),typeof I.height>"u"&&(I.height=I.radiusY||1),typeof I.tiltX>"u"&&(I.tiltX=0),typeof I.tiltY>"u"&&(I.tiltY=0),typeof I.pointerType>"u"&&(I.pointerType="touch"),typeof I.pointerId>"u"&&(I.pointerId=I.identifier||0),typeof I.pressure>"u"&&(I.pressure=I.force||.5),typeof I.twist>"u"&&(I.twist=0),typeof I.tangentialPressure>"u"&&(I.tangentialPressure=0),typeof I.layerX>"u"&&(I.layerX=I.offsetX=I.clientX),typeof I.layerY>"u"&&(I.layerY=I.offsetY=I.clientY),I.isNormalized=!0,I.type=_.type,E.push(I)}else if(!globalThis.MouseEvent||_ instanceof MouseEvent&&(!this.supportsPointerEvents||!(_ instanceof globalThis.PointerEvent))){const A=_;typeof A.isPrimary>"u"&&(A.isPrimary=!0),typeof A.width>"u"&&(A.width=1),typeof A.height>"u"&&(A.height=1),typeof A.tiltX>"u"&&(A.tiltX=0),typeof A.tiltY>"u"&&(A.tiltY=0),typeof A.pointerType>"u"&&(A.pointerType="mouse"),typeof A.pointerId>"u"&&(A.pointerId=MOUSE_POINTER_ID),typeof A.pressure>"u"&&(A.pressure=.5),typeof A.twist>"u"&&(A.twist=0),typeof A.tangentialPressure>"u"&&(A.tangentialPressure=0),A.isNormalized=!0,E.push(A)}else E.push(_);return E}normalizeWheelEvent(_){const E=this.rootWheelEvent;return this.transferMouseData(E,_),E.deltaMode=_.deltaMode,E.deltaX=_.deltaX,E.deltaY=_.deltaY,E.deltaZ=_.deltaZ,this.mapPositionToPoint(E.screen,_.clientX,_.clientY),E.global.copyFrom(E.screen),E.offset.copyFrom(E.screen),E.nativeEvent=_,E.type=_.type,E}bootstrapEvent(_,E){return _.originalEvent=null,_.nativeEvent=E,_.pointerId=E.pointerId,_.width=E.width,_.height=E.height,_.isPrimary=E.isPrimary,_.pointerType=E.pointerType,_.pressure=E.pressure,_.tangentialPressure=E.tangentialPressure,_.tiltX=E.tiltX,_.tiltY=E.tiltY,_.twist=E.twist,this.transferMouseData(_,E),this.mapPositionToPoint(_.screen,E.clientX,E.clientY),_.global.copyFrom(_.screen),_.offset.copyFrom(_.screen),_.isTrusted=E.isTrusted,_.type==="pointerleave"&&(_.type="pointerout"),_.type.startsWith("mouse")&&(_.type=_.type.replace("mouse","pointer")),_.type.startsWith("touch")&&(_.type=TOUCH_TO_POINTER[_.type]||_.type),_}transferMouseData(_,E){_.isTrusted=E.isTrusted,_.srcElement=E.srcElement,_.timeStamp=performance.now(),_.type=E.type,_.altKey=E.altKey,_.button=E.button,_.buttons=E.buttons,_.client.x=E.clientX,_.client.y=E.clientY,_.ctrlKey=E.ctrlKey,_.metaKey=E.metaKey,_.movement.x=E.movementX,_.movement.y=E.movementY,_.page.x=E.pageX,_.page.y=E.pageY,_.relatedTarget=null,_.shiftKey=E.shiftKey}}EventSystem.extension={name:"events",type:[ExtensionType.RendererSystem,ExtensionType.CanvasRendererSystem]};extensions$1.add(EventSystem);const FederatedDisplayObject={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(T,_,E){const A=typeof E=="boolean"&&E||typeof E=="object"&&E.capture,R=typeof _=="function"?void 0:_;T=A?`${T}capture`:T,_=typeof _=="function"?_:_.handleEvent,this.on(T,_,R)},removeEventListener(T,_,E){const A=typeof E=="boolean"&&E||typeof E=="object"&&E.capture,R=typeof _=="function"?void 0:_;T=A?`${T}capture`:T,_=typeof _=="function"?_:_.handleEvent,this.off(T,_,R)},dispatchEvent(T){if(!(T instanceof FederatedEvent))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return T.defaultPrevented=!1,T.path=null,T.target=this,T.manager.dispatchEvent(T),!T.defaultPrevented}};DisplayObject.mixin(FederatedDisplayObject);DisplayObject.mixin(accessibleTarget);const KEY_CODE_TAB=9,DIV_TOUCH_SIZE=100,DIV_TOUCH_POS_X=0,DIV_TOUCH_POS_Y=0,DIV_TOUCH_ZINDEX=2,DIV_HOOK_SIZE=1,DIV_HOOK_POS_X=-1e3,DIV_HOOK_POS_Y=-1e3,DIV_HOOK_ZINDEX=2;class AccessibilityManager{constructor(_){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(isMobile.tablet||isMobile.phone)&&this.createTouchHook();const E=document.createElement("div");E.style.width=`${DIV_TOUCH_SIZE}px`,E.style.height=`${DIV_TOUCH_SIZE}px`,E.style.position="absolute",E.style.top=`${DIV_TOUCH_POS_X}px`,E.style.left=`${DIV_TOUCH_POS_Y}px`,E.style.zIndex=DIV_TOUCH_ZINDEX.toString(),this.div=E,this.renderer=_,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const _=document.createElement("button");_.style.width=`${DIV_HOOK_SIZE}px`,_.style.height=`${DIV_HOOK_SIZE}px`,_.style.position="absolute",_.style.top=`${DIV_HOOK_POS_X}px`,_.style.left=`${DIV_HOOK_POS_Y}px`,_.style.zIndex=DIV_HOOK_ZINDEX.toString(),_.style.backgroundColor="#FF0000",_.title="select to enable accessibility for this content",_.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(_),this._hookDiv=_}destroyTouchHook(){!this._hookDiv||(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var _;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(_=this.renderer.view.parentNode)==null||_.appendChild(this.div))}deactivate(){var _;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(_=this.div.parentNode)==null||_.removeChild(this.div))}updateAccessibleObjects(_){if(!_.visible||!_.accessibleChildren)return;_.accessible&&_.interactive&&(_._accessibleActive||this.addChild(_),_.renderId=this.renderId);const E=_.children;if(E)for(let A=0;A<E.length;A++)this.updateAccessibleObjects(E[A])}update(){const _=performance.now();if(isMobile.android.device&&_<this.androidUpdateCount||(this.androidUpdateCount=_+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:E,y:A,width:R,height:I}=this.renderer.view.getBoundingClientRect(),{width:P,height:C,resolution:D}=this.renderer,B=R/P*D,O=I/C*D;let F=this.div;F.style.left=`${E}px`,F.style.top=`${A}px`,F.style.width=`${P}px`,F.style.height=`${C}px`;for(let L=0;L<this.children.length;L++){const U=this.children[L];if(U.renderId!==this.renderId)U._accessibleActive=!1,removeItems(this.children,L,1),this.div.removeChild(U._accessibleDiv),this.pool.push(U._accessibleDiv),U._accessibleDiv=null,L--;else{F=U._accessibleDiv;let G=U.hitArea;const X=U.worldTransform;U.hitArea?(F.style.left=`${(X.tx+G.x*X.a)*B}px`,F.style.top=`${(X.ty+G.y*X.d)*O}px`,F.style.width=`${G.width*X.a*B}px`,F.style.height=`${G.height*X.d*O}px`):(G=U.getBounds(),this.capHitArea(G),F.style.left=`${G.x*B}px`,F.style.top=`${G.y*O}px`,F.style.width=`${G.width*B}px`,F.style.height=`${G.height*O}px`,F.title!==U.accessibleTitle&&U.accessibleTitle!==null&&(F.title=U.accessibleTitle),F.getAttribute("aria-label")!==U.accessibleHint&&U.accessibleHint!==null&&F.setAttribute("aria-label",U.accessibleHint)),(U.accessibleTitle!==F.title||U.tabIndex!==F.tabIndex)&&(F.title=U.accessibleTitle,F.tabIndex=U.tabIndex,this.debug&&this.updateDebugHTML(F))}}this.renderId++}updateDebugHTML(_){_.innerHTML=`type: ${_.type}</br> title : ${_.title}</br> tabIndex: ${_.tabIndex}`}capHitArea(_){_.x<0&&(_.width+=_.x,_.x=0),_.y<0&&(_.height+=_.y,_.y=0);const{width:E,height:A}=this.renderer;_.x+_.width>E&&(_.width=E-_.x),_.y+_.height>A&&(_.height=A-_.y)}addChild(_){let E=this.pool.pop();E||(E=document.createElement("button"),E.style.width=`${DIV_TOUCH_SIZE}px`,E.style.height=`${DIV_TOUCH_SIZE}px`,E.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",E.style.position="absolute",E.style.zIndex=DIV_TOUCH_ZINDEX.toString(),E.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?E.setAttribute("aria-live","off"):E.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?E.setAttribute("aria-relevant","additions"):E.setAttribute("aria-relevant","text"),E.addEventListener("click",this._onClick.bind(this)),E.addEventListener("focus",this._onFocus.bind(this)),E.addEventListener("focusout",this._onFocusOut.bind(this))),E.style.pointerEvents=_.accessiblePointerEvents,E.type=_.accessibleType,_.accessibleTitle&&_.accessibleTitle!==null?E.title=_.accessibleTitle:(!_.accessibleHint||_.accessibleHint===null)&&(E.title=`displayObject ${_.tabIndex}`),_.accessibleHint&&_.accessibleHint!==null&&E.setAttribute("aria-label",_.accessibleHint),this.debug&&this.updateDebugHTML(E),_._accessibleActive=!0,_._accessibleDiv=E,E.displayObject=_,this.children.push(_),this.div.appendChild(_._accessibleDiv),_._accessibleDiv.tabIndex=_.tabIndex}_dispatchEvent(_,E){const{displayObject:A}=_.target,R=this.renderer.events.rootBoundary,I=Object.assign(new FederatedEvent(R),{target:A});R.rootTarget=this.renderer.lastObjectRendered,E.forEach(P=>R.dispatchEvent(I,P))}_onClick(_){this._dispatchEvent(_,["click","pointertap","tap"])}_onFocus(_){_.target.getAttribute("aria-live")||_.target.setAttribute("aria-live","assertive"),this._dispatchEvent(_,["mouseover"])}_onFocusOut(_){_.target.getAttribute("aria-live")||_.target.setAttribute("aria-live","polite"),this._dispatchEvent(_,["mouseout"])}_onKeyDown(_){_.keyCode===KEY_CODE_TAB&&this.activate()}_onMouseMove(_){_.movementX===0&&_.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}AccessibilityManager.extension={name:"accessibility",type:[ExtensionType.RendererPlugin,ExtensionType.CanvasRendererPlugin]};extensions$1.add(AccessibilityManager);const _Application=class{constructor(T){this.stage=new Container,T=Object.assign({forceCanvas:!1},T),this.renderer=autoDetectRenderer(T),_Application._plugins.forEach(_=>{_.init.call(this,T)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(T,_){const E=_Application._plugins.slice(0);E.reverse(),E.forEach(A=>{A.destroy.call(this)}),this.stage.destroy(_),this.stage=null,this.renderer.destroy(T),this.renderer=null}};let Application=_Application;Application._plugins=[];extensions$1.handleByList(ExtensionType.Application,Application._plugins);class ResizePlugin{static init(_){Object.defineProperty(this,"resizeTo",{set(E){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=E,E&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{!this._resizeTo||(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let E,A;if(this._resizeTo===globalThis.window)E=globalThis.innerWidth,A=globalThis.innerHeight;else{const{clientWidth:R,clientHeight:I}=this._resizeTo;E=R,A=I}this.renderer.resize(E,A),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=_.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=ExtensionType.Application;extensions$1.add(ResizePlugin);class BackgroundLoader{constructor(_,E=!1){this._loader=_,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=E}add(_){_.forEach(E=>{this._assetList.push(E)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const _=[],E=Math.min(this._assetList.length,this._maxConcurrent);for(let A=0;A<E;A++)_.push(this._assetList.pop());await this._loader.load(_),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(_){this._isActive!==_&&(this._isActive=_,_&&!this._isLoading&&this._next())}}const convertToList=(T,_)=>(Array.isArray(T)||(T=[T]),_?T.map(E=>typeof E=="string"?_(E):E):T);function processX(T,_,E,A,R){const I=_[E];for(let P=0;P<I.length;P++){const C=I[P];E<_.length-1?processX(T.replace(A[E],C),_,E+1,A,R):R.push(T.replace(A[E],C))}}function createStringVariations(T){const _=/\{(.*?)\}/g,E=T.match(_),A=[];if(E){const R=[];E.forEach(I=>{const P=I.substring(1,I.length-1).split(",");R.push(P)}),processX(T,R,0,E,A)}else A.push(T);return A}const isSingleItem=T=>!Array.isArray(T);class CacheClass{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(_){return this._cache.has(_)}get(_){return this._cache.get(_)}set(_,E){const A=convertToList(_);let R;for(let C=0;C<this.parsers.length;C++){const D=this.parsers[C];if(D.test(E)){R=D.getCacheableAssets(A,E);break}}R||(R={},A.forEach(C=>{R[C]=E}));const I=Object.keys(R),P={cacheKeys:I,keys:A};if(A.forEach(C=>{this._cacheMap.set(C,P)}),I.forEach(C=>{this._cache.has(C)&&this._cache.get(C),this._cache.set(C,R[C])}),E instanceof Texture){const C=E;A.forEach(D=>{C.baseTexture!==Texture.EMPTY.baseTexture&&BaseTexture.addToCache(C.baseTexture,D),Texture.addToCache(C,D)})}}remove(_){if(this._cacheMap.get(_),!this._cacheMap.has(_))return;const E=this._cacheMap.get(_);E.cacheKeys.forEach(R=>{this._cache.delete(R)}),E.keys.forEach(R=>{this._cacheMap.delete(R)})}get parsers(){return this._parsers}}const Cache=new CacheClass;class Loader{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(_,E){const A={promise:null,parser:null};return A.promise=(async()=>{var I,P;let R=null;for(let C=0;C<this.parsers.length;C++){const D=this.parsers[C];if(D.load&&((I=D.test)==null?void 0:I.call(D,_,E,this))){R=await D.load(_,E,this),A.parser=D;break}}if(!A.parser)return null;for(let C=0;C<this.parsers.length;C++){const D=this.parsers[C];D.parse&&D.parse&&await((P=D.testParse)==null?void 0:P.call(D,R,E,this))&&(R=await D.parse(R,E,this)||R,A.parser=D)}return R})(),A}async load(_,E){let A=0;const R={},I=isSingleItem(_),P=convertToList(_,B=>({src:B})),C=P.length,D=P.map(async B=>{const O=path.toAbsolute(B.src);if(!R[B.src])try{this.promiseCache[O]||(this.promiseCache[O]=this._getLoadPromiseAndParser(O,B)),R[B.src]=await this.promiseCache[O].promise,E&&E(++A/C)}catch(F){throw delete this.promiseCache[O],delete R[B.src],new Error(`[Loader.load] Failed to load ${O}.
${F}`)}});return await Promise.all(D),I?R[P[0].src]:R}async unload(_){const A=convertToList(_,R=>({src:R})).map(async R=>{var C,D;const I=path.toAbsolute(R.src),P=this.promiseCache[I];if(P){const B=await P.promise;(D=(C=P.parser)==null?void 0:C.unload)==null||D.call(C,B,R,this),delete this.promiseCache[I]}});await Promise.all(A)}get parsers(){return this._parsers}}class Resolver{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(..._){_.forEach(E=>{this._preferredOrder.push(E),E.priority||(E.priority=Object.keys(E.params))}),this._resolverHash={}}set basePath(_){this._basePath=_}get basePath(){return this._basePath}set rootPath(_){this._rootPath=_}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(_){this._manifest,this._manifest=_,_.bundles.forEach(E=>{this.addBundle(E.name,E.assets)})}addBundle(_,E){const A=[];Array.isArray(E)?E.forEach(R=>{typeof R.name=="string"?A.push(R.name):A.push(...R.name),this.add(R.name,R.srcs)}):Object.keys(E).forEach(R=>{A.push(R),this.add(R,E[R])}),this._bundles[_]=A}add(_,E,A){const R=convertToList(_);R.forEach(P=>{this._assetMap[P]}),Array.isArray(E)||(typeof E=="string"?E=createStringVariations(E):E=[E]);const I=E.map(P=>{var D;let C=P;if(typeof P=="string"){let B=!1;for(let O=0;O<this._parsers.length;O++){const F=this._parsers[O];if(F.test(P)){C=F.parse(P),B=!0;break}}B||(C={src:P})}return C.format||(C.format=C.src.split(".").pop()),C.alias||(C.alias=R),(this._basePath||this._rootPath)&&(C.src=path.toAbsolute(C.src,this._basePath,this._rootPath)),C.data=(D=C.data)!=null?D:A,C});R.forEach(P=>{this._assetMap[P]=I})}resolveBundle(_){const E=isSingleItem(_);_=convertToList(_);const A={};return _.forEach(R=>{const I=this._bundles[R];I&&(A[R]=this.resolve(I))}),E?A[_[0]]:A}resolveUrl(_){const E=this.resolve(_);if(typeof _!="string"){const A={};for(const R in E)A[R]=E[R].src;return A}return E.src}resolve(_){const E=isSingleItem(_);_=convertToList(_);const A={};return _.forEach(R=>{var I;if(!this._resolverHash[R])if(this._assetMap[R]){let P=this._assetMap[R];const C=this._getPreferredOrder(P),D=P[0];C==null||C.priority.forEach(B=>{C.params[B].forEach(O=>{const F=P.filter(L=>L[B]?L[B]===O:!1);F.length&&(P=F)})}),this._resolverHash[R]=(I=P[0])!=null?I:D}else{let P=R;(this._basePath||this._rootPath)&&(P=path.toAbsolute(P,this._basePath,this._rootPath)),this._resolverHash[R]={src:P}}A[R]=this._resolverHash[R]}),E?A[_[0]]:A}_getPreferredOrder(_){for(let E=0;E<_.length;E++){const A=_[0],R=this._preferredOrder.find(I=>I.params.format.includes(A.format));if(R)return R}return this._preferredOrder[0]}}class AssetsClass{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Resolver,this.loader=new Loader,this.cache=Cache,this._backgroundLoader=new BackgroundLoader(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(_={}){var I,P,C,D;if(this._initialized)return;if(this._initialized=!0,_.basePath&&(this.resolver.basePath=_.basePath),_.manifest){let B=_.manifest;typeof B=="string"&&(B=await this.load(B)),this.resolver.addManifest(B)}const E=(P=(I=_.texturePreference)==null?void 0:I.resolution)!=null?P:1,A=typeof E=="number"?[E]:E;let R=[];if((C=_.texturePreference)!=null&&C.format){const B=(D=_.texturePreference)==null?void 0:D.format;R=typeof B=="string"?[B]:B;for(const O of this._detections)await O.test()||(R=await O.remove(R))}else for(const B of this._detections)await B.test()&&(R=await B.add(R));this.resolver.prefer({params:{format:R,resolution:A}})}add(_,E,A){this.resolver.add(_,E,A)}async load(_,E){this._initialized||await this.init();const A=isSingleItem(_),R=convertToList(_).map(C=>typeof C!="string"?(this.resolver.add(C.src,C),C.src):C),I=this.resolver.resolve(R),P=await this._mapLoadToResolve(I,E);return A?P[R[0]]:P}addBundle(_,E){this.resolver.addBundle(_,E)}async loadBundle(_,E){this._initialized||await this.init();let A=!1;typeof _=="string"&&(A=!0,_=[_]);const R=this.resolver.resolveBundle(_),I={},P=Object.keys(R);let C=0,D=0;const B=()=>{E==null||E(++C/D)},O=P.map(F=>{const L=R[F];return D+=Object.keys(L).length,this._mapLoadToResolve(L,B).then(U=>{I[F]=U})});return await Promise.all(O),A?I[_[0]]:I}async backgroundLoad(_){this._initialized||await this.init(),typeof _=="string"&&(_=[_]);const E=this.resolver.resolve(_);this._backgroundLoader.add(Object.values(E))}async backgroundLoadBundle(_){this._initialized||await this.init(),typeof _=="string"&&(_=[_]);const E=this.resolver.resolveBundle(_);Object.values(E).forEach(A=>{this._backgroundLoader.add(Object.values(A))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(_){if(typeof _=="string")return Cache.get(_);const E={};for(let A=0;A<_.length;A++)E[A]=Cache.get(_[A]);return E}async _mapLoadToResolve(_,E){const A=Object.values(_),R=Object.keys(_);this._backgroundLoader.active=!1;const I=await this.loader.load(A,E);this._backgroundLoader.active=!0;const P={};return A.forEach((C,D)=>{const B=I[C.src],O=[C.src];C.alias&&O.push(...C.alias),P[R[D]]=B,Cache.set(O,B)}),P}async unload(_){this._initialized||await this.init();const E=convertToList(_).map(R=>typeof R!="string"?R.src:R),A=this.resolver.resolve(E);await this._unloadFromResolved(A)}async unloadBundle(_){this._initialized||await this.init(),_=convertToList(_);const E=this.resolver.resolveBundle(_),A=Object.keys(E).map(R=>this._unloadFromResolved(E[R]));await Promise.all(A)}async _unloadFromResolved(_){const E=Object.values(_);E.forEach(A=>{Cache.remove(A.src)}),await this.loader.unload(E)}get detections(){return this._detections}}const Assets=new AssetsClass;extensions$1.handleByList(ExtensionType.LoadParser,Assets.loader.parsers).handleByList(ExtensionType.ResolveParser,Assets.resolver.parsers).handleByList(ExtensionType.CacheParser,Assets.cache.parsers).handleByList(ExtensionType.DetectionParser,Assets.detections);const assetKeyMap={loader:ExtensionType.LoadParser,resolver:ExtensionType.ResolveParser,cache:ExtensionType.CacheParser,detection:ExtensionType.DetectionParser};extensions$1.handle(ExtensionType.Asset,T=>{const _=T.ref;Object.entries(assetKeyMap).filter(([E])=>!!_[E]).forEach(([E,A])=>{var R;return extensions$1.add(Object.assign(_[E],{extension:(R=_[E].extension)!=null?R:A}))})},T=>{const _=T.ref;Object.keys(assetKeyMap).filter(E=>!!_[E]).forEach(E=>extensions$1.remove(_[E]))});const cacheTextureArray={extension:ExtensionType.CacheParser,test:T=>Array.isArray(T)&&T.every(_=>_ instanceof Texture),getCacheableAssets:(T,_)=>{const E={};return T.forEach(A=>{_.forEach((R,I)=>{E[A+(I===0?"":I+1)]=R})}),E}};extensions$1.add(cacheTextureArray);var LoaderParserPriority=(T=>(T[T.Low=0]="Low",T[T.Normal=1]="Normal",T[T.High=2]="High",T))(LoaderParserPriority||{});const loadJson={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(T){return path.extname(T).includes(".json")},async load(T){return await(await settings.ADAPTER.fetch(T)).json()}};extensions$1.add(loadJson);const loadTxt={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(T){return path.extname(T).includes(".txt")},async load(T){return await(await settings.ADAPTER.fetch(T)).text()}};extensions$1.add(loadTxt);const validWeights=["normal","bold","100","200","300","400","500","600","700","800","900"],validFonts=["woff","woff2","ttf","otf"];function getFontFamilyName(T){const _=path.extname(T);return path.basename(T,_).replace(/(-|_)/g," ").toLowerCase().split(" ").map(I=>I.charAt(0).toUpperCase()+I.slice(1)).join(" ")}const loadWebFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Low},test(T){const E=T.split("?")[0].split(".").pop();return validFonts.includes(E)},async load(T,_){var A,R,I,P,C,D;if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const E=settings.ADAPTER.getFontFaceSet();if(E){const B=[],O=(R=(A=_.data)==null?void 0:A.family)!=null?R:getFontFamilyName(T),F=(C=(P=(I=_.data)==null?void 0:I.weights)==null?void 0:P.filter(U=>validWeights.includes(U)))!=null?C:["normal"],L=(D=_.data)!=null?D:{};for(let U=0;U<F.length;U++){const G=F[U],X=new FontFace(O,`url(${T})`,{...L,weight:G});await X.load(),E.add(X),B.push(X)}return B.length===1?B[0]:B}return null},unload(T){(Array.isArray(T)?T:[T]).forEach(_=>settings.ADAPTER.getFontFaceSet().delete(_))}};extensions$1.add(loadWebFont);let UUID=0,MAX_WORKERS;const WHITE_PNG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",checkImageBitmapCode={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${WHITE_PNG}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},workerCode={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let workerURL;class WorkerManagerClass{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(_=>{const E=URL.createObjectURL(new Blob([checkImageBitmapCode.code],{type:"application/javascript"})),A=new Worker(E);A.addEventListener("message",R=>{A.terminate(),URL.revokeObjectURL(E),_(R.data)})}),this._isImageBitmapSupported)}loadImageBitmap(_){return this._run("loadImageBitmap",[_])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){MAX_WORKERS===void 0&&(MAX_WORKERS=navigator.hardwareConcurrency||4);let _=this.workerPool.pop();return!_&&this._createdWorkers<MAX_WORKERS&&(workerURL||(workerURL=URL.createObjectURL(new Blob([workerCode.code],{type:"application/javascript"}))),this._createdWorkers++,_=new Worker(workerURL),_.addEventListener("message",E=>{this.complete(E.data),this.returnWorker(E.target),this.next()})),_}returnWorker(_){this.workerPool.push(_)}complete(_){_.error!==void 0?this.resolveHash[_.uuid].reject(_.error):this.resolveHash[_.uuid].resolve(_.data),this.resolveHash[_.uuid]=null}async _run(_,E){await this._initWorkers();const A=new Promise((R,I)=>{this.queue.push({id:_,arguments:E,resolve:R,reject:I})});return this.next(),A}next(){if(!this.queue.length)return;const _=this.getWorker();if(!_)return;const E=this.queue.pop(),A=E.id;this.resolveHash[UUID]={resolve:E.resolve,reject:E.reject},_.postMessage({data:E.arguments,uuid:UUID++,id:A})}}const WorkerManager=new WorkerManagerClass;function checkExtension(T,_){const E=T.split("?")[0],A=path.extname(E).toLowerCase();return Array.isArray(_)?_.includes(A.toLowerCase()):A.toLowerCase()===_}function createTexture(T,_,E){const A=new Texture(T);return A.baseTexture.on("dispose",()=>{delete _.promiseCache[E]}),A}const validImages$1=[".jpg",".png",".jpeg",".avif",".webp"];async function loadImageBitmap(T){const _=await settings.ADAPTER.fetch(T);if(!_.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${T}: ${_.status} ${_.statusText}`);const E=await _.blob();return await createImageBitmap(E)}const loadTextures={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},config:{preferWorkers:!0},test(T){let _=!1;for(let E=0;E<validImages$1.length;E++)if(T.startsWith(`data:image/${validImages$1[E].slice(1)}`)){_=!0;break}return _||checkExtension(T,validImages$1)},async load(T,_,E){let A=null;globalThis.createImageBitmap?this.config.preferWorkers&&await WorkerManager.isImageBitmapSupported()?A=await WorkerManager.loadImageBitmap(T):A=await loadImageBitmap(T):A=await new Promise(I=>{A=new Image,A.crossOrigin="anonymous",A.src=T,A.complete?I(A):A.onload=()=>{I(A)}});const R=new BaseTexture(A,{resolution:getResolutionOfUrl(T),..._.data});return R.resource.src=T,createTexture(R,E,T)},unload(T){T.destroy(!0)}};extensions$1.add(loadTextures);ExtensionType.LoadParser,LoaderParserPriority.High,loadTextures.unload;const resolveTextureUrl={extension:ExtensionType.ResolveParser,test:loadTextures.test,parse:T=>{var _,E;return{resolution:parseFloat((E=(_=settings.RETINA_PREFIX.exec(T))==null?void 0:_[1])!=null?E:"1"),format:T.split(".").pop(),src:T}}};extensions$1.add(resolveTextureUrl);const detectAvif={extension:{type:ExtensionType.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const T="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",_=await settings.ADAPTER.fetch(T).then(E=>E.blob());return createImageBitmap(_).then(()=>!0,()=>!1)},add:async T=>[...T,"avif"],remove:async T=>T.filter(_=>_!=="avif")};extensions$1.add(detectAvif);const detectWebp={extension:{type:ExtensionType.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const T="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",_=await settings.ADAPTER.fetch(T).then(E=>E.blob());return createImageBitmap(_).then(()=>!0,()=>!1)},add:async T=>[...T,"webp"],remove:async T=>T.filter(_=>_!=="webp")};extensions$1.add(detectWebp);const imageFormats=["png","jpg","jpeg"],detectDefaults={extension:{type:ExtensionType.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async T=>[...T,...imageFormats],remove:async T=>T.filter(_=>!imageFormats.includes(_))};extensions$1.add(detectDefaults);var INTERNAL_FORMATS=(T=>(T[T.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",T[T.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",T[T.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",T[T.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",T[T.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",T[T.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",T[T.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",T[T.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",T[T.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",T[T.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",T[T.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",T[T.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",T[T.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",T[T.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",T[T.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",T[T.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",T[T.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",T[T.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",T[T.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",T[T.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",T[T.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",T[T.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",T[T.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",T[T.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",T[T.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",T[T.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",T[T.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",T))(INTERNAL_FORMATS||{});const INTERNAL_FORMAT_TO_BYTES_PER_PIXEL={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};class BlobResource extends BufferResource{constructor(_,E={width:1,height:1,autoLoad:!0}){let A,R;typeof _=="string"?(A=_,R=new Uint8Array):(A=null,R=_),super(R,E),this.origin=A,this.buffer=R?new ViewableBuffer(R):null,this.origin&&E.autoLoad!==!1&&this.load(),R!=null&&R.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(_){}async load(){const A=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(A),this.buffer=new ViewableBuffer(A),this.loaded=!0,this.onBlobLoaded(A),this.update(),this}}class CompressedTextureResource extends BlobResource{constructor(_,E){super(_,E),this.format=E.format,this.levels=E.levels||1,this._width=E.width,this._height=E.height,this._extension=CompressedTextureResource._formatToExtension(this.format),(E.levelBuffers||this.buffer)&&(this._levelBuffers=E.levelBuffers||CompressedTextureResource._createLevelBuffers(_ instanceof Uint8Array?_:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(_,E,A){const R=_.gl;if(!_.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let P=0,C=this.levels;P<C;P++){const{levelID:D,levelWidth:B,levelHeight:O,levelBuffer:F}=this._levelBuffers[P];R.compressedTexImage2D(R.TEXTURE_2D,D,this.format,B,O,0,F)}return!0}onBlobLoaded(){this._levelBuffers=CompressedTextureResource._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(_){if(_>=33776&&_<=33779)return"s3tc";if(_>=37488&&_<=37497)return"etc";if(_>=35840&&_<=35843)return"pvrtc";if(_>=36196)return"etc1";if(_>=35986&&_<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(_,E,A,R,I,P,C){const D=new Array(A);let B=_.byteOffset,O=P,F=C,L=O+R-1&~(R-1),U=F+I-1&~(I-1),G=L*U*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[E];for(let X=0;X<A;X++)D[X]={levelID:X,levelWidth:A>1?O:L,levelHeight:A>1?F:U,levelBuffer:new Uint8Array(_.buffer,B,G)},B+=G,O=O>>1||1,F=F>>1||1,L=O+R-1&~(R-1),U=F+I-1&~(I-1),G=L*U*INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[E];return D}}let storedGl,extensions;function getCompressedTextureExtensions(){extensions={s3tc:storedGl.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:storedGl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:storedGl.getExtension("WEBGL_compressed_texture_etc"),etc1:storedGl.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:storedGl.getExtension("WEBGL_compressed_texture_pvrtc")||storedGl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:storedGl.getExtension("WEBGL_compressed_texture_atc"),astc:storedGl.getExtension("WEBGL_compressed_texture_astc")}}const detectCompressedTextures={extension:{type:ExtensionType.DetectionParser,priority:2},test:async()=>{const _=settings.ADAPTER.createCanvas().getContext("webgl");return _?(storedGl=_,!0):!1},add:async T=>{extensions||getCompressedTextureExtensions();const _=[];for(const E in extensions)!extensions[E]||_.push(E);return[..._,...T]},remove:async T=>(extensions||getCompressedTextureExtensions(),T.filter(_=>!(_ in extensions)))};extensions$1.add(detectCompressedTextures);const DDS_MAGIC_SIZE=4,DDS_HEADER_SIZE=124,DDS_HEADER_PF_SIZE=32,DDS_HEADER_DX10_SIZE=20,DDS_MAGIC=542327876,DDS_FIELDS={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},DDS_PF_FIELDS={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},DDS_DX10_FIELDS={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},PF_FLAGS=1,DDPF_ALPHA=2,DDPF_FOURCC=4,DDPF_RGB=64,DDPF_YUV=512,DDPF_LUMINANCE=131072,FOURCC_DXT1=827611204,FOURCC_DXT3=861165636,FOURCC_DXT5=894720068,FOURCC_DX10=808540228,DDS_RESOURCE_MISC_TEXTURECUBE=4,FOURCC_TO_FORMAT={[FOURCC_DXT1]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[FOURCC_DXT3]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[FOURCC_DXT5]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT},DXGI_TO_FORMAT={[70]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:INTERNAL_FORMATS.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:INTERNAL_FORMATS.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function parseDDS(T){const _=new Uint32Array(T);if(_[0]!==DDS_MAGIC)throw new Error("Invalid DDS file magic word");const A=new Uint32Array(T,0,DDS_HEADER_SIZE/Uint32Array.BYTES_PER_ELEMENT),R=A[DDS_FIELDS.HEIGHT],I=A[DDS_FIELDS.WIDTH],P=A[DDS_FIELDS.MIPMAP_COUNT],C=new Uint32Array(T,DDS_FIELDS.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,DDS_HEADER_PF_SIZE/Uint32Array.BYTES_PER_ELEMENT),D=C[PF_FLAGS];if(D&DDPF_FOURCC){const B=C[DDS_PF_FIELDS.FOURCC];if(B!==FOURCC_DX10){const z=FOURCC_TO_FORMAT[B],Y=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,K=new Uint8Array(T,Y);return[new CompressedTextureResource(K,{format:z,width:I,height:R,levels:P})]}const O=DDS_MAGIC_SIZE+DDS_HEADER_SIZE,F=new Uint32Array(_.buffer,O,DDS_HEADER_DX10_SIZE/Uint32Array.BYTES_PER_ELEMENT),L=F[DDS_DX10_FIELDS.DXGI_FORMAT],U=F[DDS_DX10_FIELDS.RESOURCE_DIMENSION],G=F[DDS_DX10_FIELDS.MISC_FLAG],X=F[DDS_DX10_FIELDS.ARRAY_SIZE],W=DXGI_TO_FORMAT[L];if(W===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${L}`);if(G===DDS_RESOURCE_MISC_TEXTURECUBE)throw new Error("DDSParser does not support cubemap textures");if(U===6)throw new Error("DDSParser does not supported 3D texture data");const V=new Array,q=DDS_MAGIC_SIZE+DDS_HEADER_SIZE+DDS_HEADER_DX10_SIZE;if(X===1)V.push(new Uint8Array(T,q));else{const z=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[W];let Y=0,K=I,it=R;for(let Q=0;Q<P;Q++){const ot=Math.max(1,K+3&-4),at=Math.max(1,it+3&-4);Y+=ot*at*z,K=K>>>1,it=it>>>1}let et=q;for(let Q=0;Q<X;Q++)V.push(new Uint8Array(T,et,Y)),et+=Y}return V.map(z=>new CompressedTextureResource(z,{format:W,width:I,height:R,levels:P}))}throw D&DDPF_RGB?new Error("DDSParser does not support uncompressed texture data."):D&DDPF_YUV?new Error("DDSParser does not supported YUV uncompressed texture data."):D&DDPF_LUMINANCE?new Error("DDSParser does not support single-channel (lumninance) texture data!"):D&DDPF_ALPHA?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const FILE_IDENTIFIER=[171,75,84,88,32,49,49,187,13,10,26,10],ENDIANNESS=67305985,KTX_FIELDS={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},FILE_HEADER_SIZE=64,TYPES_TO_BYTES_PER_COMPONENT={[TYPES.UNSIGNED_BYTE]:1,[TYPES.UNSIGNED_SHORT]:2,[TYPES.INT]:4,[TYPES.UNSIGNED_INT]:4,[TYPES.FLOAT]:4,[TYPES.HALF_FLOAT]:8},FORMATS_TO_COMPONENTS={[FORMATS.RGBA]:4,[FORMATS.RGB]:3,[FORMATS.RG]:2,[FORMATS.RED]:1,[FORMATS.LUMINANCE]:1,[FORMATS.LUMINANCE_ALPHA]:2,[FORMATS.ALPHA]:1},TYPES_TO_BYTES_PER_PIXEL={[TYPES.UNSIGNED_SHORT_4_4_4_4]:2,[TYPES.UNSIGNED_SHORT_5_5_5_1]:2,[TYPES.UNSIGNED_SHORT_5_6_5]:2};function parseKTX(T,_,E=!1){const A=new DataView(_);if(!validate(T,A))return null;const R=A.getUint32(KTX_FIELDS.ENDIANNESS,!0)===ENDIANNESS,I=A.getUint32(KTX_FIELDS.GL_TYPE,R),P=A.getUint32(KTX_FIELDS.GL_FORMAT,R),C=A.getUint32(KTX_FIELDS.GL_INTERNAL_FORMAT,R),D=A.getUint32(KTX_FIELDS.PIXEL_WIDTH,R),B=A.getUint32(KTX_FIELDS.PIXEL_HEIGHT,R)||1,O=A.getUint32(KTX_FIELDS.PIXEL_DEPTH,R)||1,F=A.getUint32(KTX_FIELDS.NUMBER_OF_ARRAY_ELEMENTS,R)||1,L=A.getUint32(KTX_FIELDS.NUMBER_OF_FACES,R),U=A.getUint32(KTX_FIELDS.NUMBER_OF_MIPMAP_LEVELS,R),G=A.getUint32(KTX_FIELDS.BYTES_OF_KEY_VALUE_DATA,R);if(B===0||O!==1)throw new Error("Only 2D textures are supported");if(L!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(F!==1)throw new Error("WebGL does not support array textures");const X=4,W=4,V=D+3&-4,q=B+3&-4,z=new Array(F);let Y=D*B;I===0&&(Y=V*q);let K;if(I!==0?TYPES_TO_BYTES_PER_COMPONENT[I]?K=TYPES_TO_BYTES_PER_COMPONENT[I]*FORMATS_TO_COMPONENTS[P]:K=TYPES_TO_BYTES_PER_PIXEL[I]:K=INTERNAL_FORMAT_TO_BYTES_PER_PIXEL[C],K===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const it=E?parseKvData(A,G,R):null;let Q=Y*K,ot=D,at=B,rt=V,nt=q,tt=FILE_HEADER_SIZE+G;for(let Z=0;Z<U;Z++){const ht=A.getUint32(tt,R);let ut=tt+4;for(let st=0;st<F;st++){let ft=z[st];ft||(ft=z[st]=new Array(U)),ft[Z]={levelID:Z,levelWidth:U>1||I!==0?ot:rt,levelHeight:U>1||I!==0?at:nt,levelBuffer:new Uint8Array(_,ut,Q)},ut+=Q}tt+=ht+4,tt=tt%4!==0?tt+4-tt%4:tt,ot=ot>>1||1,at=at>>1||1,rt=ot+X-1&~(X-1),nt=at+W-1&~(W-1),Q=rt*nt*K}return I!==0?{uncompressed:z.map(Z=>{let ht=Z[0].levelBuffer,ut=!1;return I===TYPES.FLOAT?ht=new Float32Array(Z[0].levelBuffer.buffer,Z[0].levelBuffer.byteOffset,Z[0].levelBuffer.byteLength/4):I===TYPES.UNSIGNED_INT?(ut=!0,ht=new Uint32Array(Z[0].levelBuffer.buffer,Z[0].levelBuffer.byteOffset,Z[0].levelBuffer.byteLength/4)):I===TYPES.INT&&(ut=!0,ht=new Int32Array(Z[0].levelBuffer.buffer,Z[0].levelBuffer.byteOffset,Z[0].levelBuffer.byteLength/4)),{resource:new BufferResource(ht,{width:Z[0].levelWidth,height:Z[0].levelHeight}),type:I,format:ut?convertFormatToInteger(P):P}}),kvData:it}:{compressed:z.map(Z=>new CompressedTextureResource(null,{format:C,width:D,height:B,levels:U,levelBuffers:Z})),kvData:it}}function validate(T,_){for(let E=0;E<FILE_IDENTIFIER.length;E++)if(_.getUint8(E)!==FILE_IDENTIFIER[E])return!1;return!0}function convertFormatToInteger(T){switch(T){case FORMATS.RGBA:return FORMATS.RGBA_INTEGER;case FORMATS.RGB:return FORMATS.RGB_INTEGER;case FORMATS.RG:return FORMATS.RG_INTEGER;case FORMATS.RED:return FORMATS.RED_INTEGER;default:return T}}function parseKvData(T,_,E){const A=new Map;let R=0;for(;R<_;){const I=T.getUint32(FILE_HEADER_SIZE+R,E),P=FILE_HEADER_SIZE+R+4,C=3-(I+3)%4;if(I===0||I>_-R){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let D=0;for(;D<I&&T.getUint8(P+D)!==0;D++);if(D===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const B=new TextDecoder().decode(new Uint8Array(T.buffer,P,D)),O=new DataView(T.buffer,P+D+1,I-D-1);A.set(B,O),R+=4+I+C}return A}const loadDDS={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test(T){return checkExtension(T,".dds")},async load(T,_,E){const R=await(await settings.ADAPTER.fetch(T)).arrayBuffer(),P=parseDDS(R).map(C=>{const D=new BaseTexture(C,{mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(T),..._.data});return createTexture(D,E,T)});return P.length===1?P[0]:P},unload(T){Array.isArray(T)?T.forEach(_=>_.destroy(!0)):T.destroy(!0)}};extensions$1.add(loadDDS);const loadKTX={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.High},test(T){return checkExtension(T,".ktx")},async load(T,_,E){const R=await(await settings.ADAPTER.fetch(T)).arrayBuffer(),{compressed:I,uncompressed:P,kvData:C}=parseKTX(T,R),D=I!=null?I:P,B={mipmap:MIPMAP_MODES.OFF,alphaMode:ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,resolution:getResolutionOfUrl(T),..._.data},O=D.map(F=>{D===P&&Object.assign(B,{type:F.type,format:F.format});const L=new BaseTexture(F,B);return L.ktxKeyValueData=C,createTexture(L,E,T)});return O.length===1?O[0]:O},unload(T){Array.isArray(T)?T.forEach(_=>_.destroy(!0)):T.destroy(!0)}};extensions$1.add(loadKTX);const resolveCompressedTextureUrl={extension:ExtensionType.ResolveParser,test:T=>{const E=T.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(E)},parse:T=>{var A,R,I,P;if(T.split("?")[0].split(".").pop()==="ktx"){const C=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(C.some(D=>T.endsWith(D)))return{resolution:parseFloat((R=(A=settings.RETINA_PREFIX.exec(T))==null?void 0:A[1])!=null?R:"1"),format:C.find(D=>T.endsWith(D)),src:T}}return{resolution:parseFloat((P=(I=settings.RETINA_PREFIX.exec(T))==null?void 0:I[1])!=null?P:"1"),format:T.split(".").pop(),src:T}}};extensions$1.add(resolveCompressedTextureUrl);const TEMP_RECT=new Rectangle,BYTES_PER_PIXEL=4,_Extract=class{constructor(T){this.renderer=T}async image(T,_,E){const A=new Image;return A.src=await this.base64(T,_,E),A}async base64(T,_,E){const A=this.canvas(T);if(A.toDataURL!==void 0)return A.toDataURL(_,E);if(A.convertToBlob!==void 0){const R=await A.convertToBlob({type:_,quality:E});return await new Promise(I=>{const P=new FileReader;P.onload=()=>I(P.result),P.readAsDataURL(R)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(T,_){const E=this.renderer;let A,R=!1,I,P=!1;T&&(T instanceof RenderTexture?I=T:(I=this.renderer.generateTexture(T),P=!0)),I?(A=I.baseTexture.resolution,_=_!=null?_:I.frame,R=!1,E.renderTexture.bind(I)):(A=E.resolution,_||(_=TEMP_RECT,_.width=E.width,_.height=E.height),R=!0,E.renderTexture.bind(null));const C=Math.round(_.width*A),D=Math.round(_.height*A);let B=new CanvasRenderTarget(C,D,1);const O=new Uint8Array(BYTES_PER_PIXEL*C*D),F=E.gl;F.readPixels(Math.round(_.x*A),Math.round(_.y*A),C,D,F.RGBA,F.UNSIGNED_BYTE,O);const L=B.context.getImageData(0,0,C,D);if(_Extract.arrayPostDivide(O,L.data),B.context.putImageData(L,0,0),R){const U=new CanvasRenderTarget(B.width,B.height,1);U.context.scale(1,-1),U.context.drawImage(B.canvas,0,-D),B.destroy(),B=U}return P&&I.destroy(!0),B.canvas}pixels(T,_){const E=this.renderer;let A,R,I=!1;T&&(T instanceof RenderTexture?R=T:(R=this.renderer.generateTexture(T),I=!0)),R?(A=R.baseTexture.resolution,_=_!=null?_:R.frame,E.renderTexture.bind(R)):(A=E.resolution,_||(_=TEMP_RECT,_.width=E.width,_.height=E.height),E.renderTexture.bind(null));const P=Math.round(_.width*A),C=Math.round(_.height*A),D=new Uint8Array(BYTES_PER_PIXEL*P*C),B=E.gl;return B.readPixels(Math.round(_.x*A),Math.round(_.y*A),P,C,B.RGBA,B.UNSIGNED_BYTE,D),I&&R.destroy(!0),_Extract.arrayPostDivide(D,D),D}destroy(){this.renderer=null}static arrayPostDivide(T,_){for(let E=0;E<T.length;E+=4){const A=_[E+3]=T[E+3];A!==0?(_[E]=Math.round(Math.min(T[E]*255/A,255)),_[E+1]=Math.round(Math.min(T[E+1]*255/A,255)),_[E+2]=Math.round(Math.min(T[E+2]*255/A,255))):(_[E]=T[E],_[E+1]=T[E+1],_[E+2]=T[E+2])}}};let Extract=_Extract;Extract.extension={name:"extract",type:ExtensionType.RendererSystem};extensions$1.add(Extract);var LINE_JOIN=(T=>(T.MITER="miter",T.BEVEL="bevel",T.ROUND="round",T))(LINE_JOIN||{}),LINE_CAP=(T=>(T.BUTT="butt",T.ROUND="round",T.SQUARE="square",T))(LINE_CAP||{});const GRAPHICS_CURVES={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(T,_=20){if(!this.adaptive||!T||isNaN(T))return _;let E=Math.ceil(T/this.maxLength);return E<this.minSegments?E=this.minSegments:E>this.maxSegments&&(E=this.maxSegments),E}};class FillStyle{constructor(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const _=new FillStyle;return _.color=this.color,_.alpha=this.alpha,_.texture=this.texture,_.matrix=this.matrix,_.visible=this.visible,_}reset(){this.color=16777215,this.alpha=1,this.texture=Texture.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function fixOrientation(T,_=!1){const E=T.length;if(E<6)return;let A=0;for(let R=0,I=T[E-2],P=T[E-1];R<E;R+=2){const C=T[R],D=T[R+1];A+=(C-I)*(D+P),I=C,P=D}if(!_&&A>0||_&&A<=0){const R=E/2;for(let I=R+R%2;I<E;I+=2){const P=E-I-2,C=E-I-1,D=I,B=I+1;[T[P],T[D]]=[T[D],T[P]],[T[C],T[B]]=[T[B],T[C]]}}}const buildPoly={build(T){T.points=T.shape.points.slice()},triangulate(T,_){let E=T.points;const A=T.holes,R=_.points,I=_.indices;if(E.length>=6){fixOrientation(E,!1);const P=[];for(let B=0;B<A.length;B++){const O=A[B];fixOrientation(O.points,!0),P.push(E.length/2),E=E.concat(O.points)}const C=earcut$1.exports(E,P,2);if(!C)return;const D=R.length/2;for(let B=0;B<C.length;B+=3)I.push(C[B]+D),I.push(C[B+1]+D),I.push(C[B+2]+D);for(let B=0;B<E.length;B++)R.push(E[B])}}},buildCircle={build(T){const _=T.points;let E,A,R,I,P,C;if(T.type===SHAPES.CIRC){const G=T.shape;E=G.x,A=G.y,P=C=G.radius,R=I=0}else if(T.type===SHAPES.ELIP){const G=T.shape;E=G.x,A=G.y,P=G.width,C=G.height,R=I=0}else{const G=T.shape,X=G.width/2,W=G.height/2;E=G.x+X,A=G.y+W,P=C=Math.max(0,Math.min(G.radius,Math.min(X,W))),R=X-P,I=W-C}if(!(P>=0&&C>=0&&R>=0&&I>=0)){_.length=0;return}const D=Math.ceil(2.3*Math.sqrt(P+C)),B=D*8+(R?4:0)+(I?4:0);if(_.length=B,B===0)return;if(D===0){_.length=8,_[0]=_[6]=E+R,_[1]=_[3]=A+I,_[2]=_[4]=E-R,_[5]=_[7]=A-I;return}let O=0,F=D*4+(R?2:0)+2,L=F,U=B;{const G=R+P,X=I,W=E+G,V=E-G,q=A+X;if(_[O++]=W,_[O++]=q,_[--F]=q,_[--F]=V,I){const z=A-X;_[L++]=V,_[L++]=z,_[--U]=z,_[--U]=W}}for(let G=1;G<D;G++){const X=Math.PI/2*(G/D),W=R+Math.cos(X)*P,V=I+Math.sin(X)*C,q=E+W,z=E-W,Y=A+V,K=A-V;_[O++]=q,_[O++]=Y,_[--F]=Y,_[--F]=z,_[L++]=z,_[L++]=K,_[--U]=K,_[--U]=q}{const G=R,X=I+C,W=E+G,V=E-G,q=A+X,z=A-X;_[O++]=W,_[O++]=q,_[--U]=z,_[--U]=W,R&&(_[O++]=V,_[O++]=q,_[--U]=z,_[--U]=V)}},triangulate(T,_){const E=T.points,A=_.points,R=_.indices;if(E.length===0)return;let I=A.length/2;const P=I;let C,D;if(T.type!==SHAPES.RREC){const O=T.shape;C=O.x,D=O.y}else{const O=T.shape;C=O.x+O.width/2,D=O.y+O.height/2}const B=T.matrix;A.push(T.matrix?B.a*C+B.c*D+B.tx:C,T.matrix?B.b*C+B.d*D+B.ty:D),I++,A.push(E[0],E[1]);for(let O=2;O<E.length;O+=2)A.push(E[O],E[O+1]),R.push(I++,P,I);R.push(P+1,P,I)}},buildRectangle={build(T){const _=T.shape,E=_.x,A=_.y,R=_.width,I=_.height,P=T.points;P.length=0,R>=0&&I>=0&&P.push(E,A,E+R,A,E+R,A+I,E,A+I)},triangulate(T,_){const E=T.points,A=_.points;if(E.length===0)return;const R=A.length/2;A.push(E[0],E[1],E[2],E[3],E[6],E[7],E[4],E[5]),_.indices.push(R,R+1,R+2,R+1,R+2,R+3)}},buildRoundedRectangle={build(T){buildCircle.build(T)},triangulate(T,_){buildCircle.triangulate(T,_)}};function square(T,_,E,A,R,I,P,C){const D=T-E*R,B=_-A*R,O=T+E*I,F=_+A*I;let L,U;P?(L=A,U=-E):(L=-A,U=E);const G=D+L,X=B+U,W=O+L,V=F+U;return C.push(G,X),C.push(W,V),2}function round(T,_,E,A,R,I,P,C){const D=E-T,B=A-_;let O=Math.atan2(D,B),F=Math.atan2(R-T,I-_);C&&O<F?O+=Math.PI*2:!C&&O>F&&(F+=Math.PI*2);let L=O;const U=F-O,G=Math.abs(U),X=Math.sqrt(D*D+B*B),W=(15*G*Math.sqrt(X)/Math.PI>>0)+1,V=U/W;if(L+=V,C){P.push(T,_),P.push(E,A);for(let q=1,z=L;q<W;q++,z+=V)P.push(T,_),P.push(T+Math.sin(z)*X,_+Math.cos(z)*X);P.push(T,_),P.push(R,I)}else{P.push(E,A),P.push(T,_);for(let q=1,z=L;q<W;q++,z+=V)P.push(T+Math.sin(z)*X,_+Math.cos(z)*X),P.push(T,_);P.push(R,I),P.push(T,_)}return W*2}function buildNonNativeLine(T,_){const E=T.shape;let A=T.points||E.points.slice();const R=_.closePointEps;if(A.length===0)return;const I=T.lineStyle,P=new Point(A[0],A[1]),C=new Point(A[A.length-2],A[A.length-1]),D=E.type!==SHAPES.POLY||E.closeStroke,B=Math.abs(P.x-C.x)<R&&Math.abs(P.y-C.y)<R;if(D){A=A.slice(),B&&(A.pop(),A.pop(),C.set(A[A.length-2],A[A.length-1]));const st=(P.x+C.x)*.5,ft=(C.y+P.y)*.5;A.unshift(st,ft),A.push(st,ft)}const O=_.points,F=A.length/2;let L=A.length;const U=O.length/2,G=I.width/2,X=G*G,W=I.miterLimit*I.miterLimit;let V=A[0],q=A[1],z=A[2],Y=A[3],K=0,it=0,et=-(q-Y),Q=V-z,ot=0,at=0,rt=Math.sqrt(et*et+Q*Q);et/=rt,Q/=rt,et*=G,Q*=G;const nt=I.alignment,tt=(1-nt)*2,Z=nt*2;D||(I.cap===LINE_CAP.ROUND?L+=round(V-et*(tt-Z)*.5,q-Q*(tt-Z)*.5,V-et*tt,q-Q*tt,V+et*Z,q+Q*Z,O,!0)+2:I.cap===LINE_CAP.SQUARE&&(L+=square(V,q,et,Q,tt,Z,!0,O))),O.push(V-et*tt,q-Q*tt),O.push(V+et*Z,q+Q*Z);for(let st=1;st<F-1;++st){V=A[(st-1)*2],q=A[(st-1)*2+1],z=A[st*2],Y=A[st*2+1],K=A[(st+1)*2],it=A[(st+1)*2+1],et=-(q-Y),Q=V-z,rt=Math.sqrt(et*et+Q*Q),et/=rt,Q/=rt,et*=G,Q*=G,ot=-(Y-it),at=z-K,rt=Math.sqrt(ot*ot+at*at),ot/=rt,at/=rt,ot*=G,at*=G;const ft=z-V,yt=q-Y,J=z-K,lt=it-Y,dt=ft*J+yt*lt,mt=yt*J-lt*ft,pt=mt<0;if(Math.abs(mt)<.001*Math.abs(dt)){O.push(z-et*tt,Y-Q*tt),O.push(z+et*Z,Y+Q*Z),dt>=0&&(I.join===LINE_JOIN.ROUND?L+=round(z,Y,z-et*tt,Y-Q*tt,z-ot*tt,Y-at*tt,O,!1)+4:L+=2,O.push(z-ot*Z,Y-at*Z),O.push(z+ot*tt,Y+at*tt));continue}const gt=(-et+V)*(-Q+Y)-(-et+z)*(-Q+q),ct=(-ot+K)*(-at+Y)-(-ot+z)*(-at+it),_t=(ft*ct-J*gt)/mt,bt=(lt*gt-yt*ct)/mt,St=(_t-z)*(_t-z)+(bt-Y)*(bt-Y),Et=z+(_t-z)*tt,xt=Y+(bt-Y)*tt,vt=z-(_t-z)*Z,Tt=Y-(bt-Y)*Z,wt=Math.min(ft*ft+yt*yt,J*J+lt*lt),At=pt?tt:Z,Rt=wt+At*At*X;St<=Rt?I.join===LINE_JOIN.BEVEL||St/X>W?(pt?(O.push(Et,xt),O.push(z+et*Z,Y+Q*Z),O.push(Et,xt),O.push(z+ot*Z,Y+at*Z)):(O.push(z-et*tt,Y-Q*tt),O.push(vt,Tt),O.push(z-ot*tt,Y-at*tt),O.push(vt,Tt)),L+=2):I.join===LINE_JOIN.ROUND?pt?(O.push(Et,xt),O.push(z+et*Z,Y+Q*Z),L+=round(z,Y,z+et*Z,Y+Q*Z,z+ot*Z,Y+at*Z,O,!0)+4,O.push(Et,xt),O.push(z+ot*Z,Y+at*Z)):(O.push(z-et*tt,Y-Q*tt),O.push(vt,Tt),L+=round(z,Y,z-et*tt,Y-Q*tt,z-ot*tt,Y-at*tt,O,!1)+4,O.push(z-ot*tt,Y-at*tt),O.push(vt,Tt)):(O.push(Et,xt),O.push(vt,Tt)):(O.push(z-et*tt,Y-Q*tt),O.push(z+et*Z,Y+Q*Z),I.join===LINE_JOIN.ROUND?pt?L+=round(z,Y,z+et*Z,Y+Q*Z,z+ot*Z,Y+at*Z,O,!0)+2:L+=round(z,Y,z-et*tt,Y-Q*tt,z-ot*tt,Y-at*tt,O,!1)+2:I.join===LINE_JOIN.MITER&&St/X<=W&&(pt?(O.push(vt,Tt),O.push(vt,Tt)):(O.push(Et,xt),O.push(Et,xt)),L+=2),O.push(z-ot*tt,Y-at*tt),O.push(z+ot*Z,Y+at*Z),L+=2)}V=A[(F-2)*2],q=A[(F-2)*2+1],z=A[(F-1)*2],Y=A[(F-1)*2+1],et=-(q-Y),Q=V-z,rt=Math.sqrt(et*et+Q*Q),et/=rt,Q/=rt,et*=G,Q*=G,O.push(z-et*tt,Y-Q*tt),O.push(z+et*Z,Y+Q*Z),D||(I.cap===LINE_CAP.ROUND?L+=round(z-et*(tt-Z)*.5,Y-Q*(tt-Z)*.5,z-et*tt,Y-Q*tt,z+et*Z,Y+Q*Z,O,!1)+2:I.cap===LINE_CAP.SQUARE&&(L+=square(z,Y,et,Q,tt,Z,!1,O)));const ht=_.indices,ut=GRAPHICS_CURVES.epsilon*GRAPHICS_CURVES.epsilon;for(let st=U;st<L+U-2;++st)V=O[st*2],q=O[st*2+1],z=O[(st+1)*2],Y=O[(st+1)*2+1],K=O[(st+2)*2],it=O[(st+2)*2+1],!(Math.abs(V*(Y-it)+z*(it-q)+K*(q-Y))<ut)&&ht.push(st,st+1,st+2)}function buildNativeLine(T,_){let E=0;const A=T.shape,R=T.points||A.points,I=A.type!==SHAPES.POLY||A.closeStroke;if(R.length===0)return;const P=_.points,C=_.indices,D=R.length/2,B=P.length/2;let O=B;for(P.push(R[0],R[1]),E=1;E<D;E++)P.push(R[E*2],R[E*2+1]),C.push(O,O+1),O++;I&&C.push(O,B)}function buildLine(T,_){T.lineStyle.native?buildNativeLine(T,_):buildNonNativeLine(T,_)}class ArcUtils{static curveTo(_,E,A,R,I,P){const C=P[P.length-2],B=P[P.length-1]-E,O=C-_,F=R-E,L=A-_,U=Math.abs(B*L-O*F);if(U<1e-8||I===0)return(P[P.length-2]!==_||P[P.length-1]!==E)&&P.push(_,E),null;const G=B*B+O*O,X=F*F+L*L,W=B*F+O*L,V=I*Math.sqrt(G)/U,q=I*Math.sqrt(X)/U,z=V*W/G,Y=q*W/X,K=V*L+q*O,it=V*F+q*B,et=O*(q+z),Q=B*(q+z),ot=L*(V+Y),at=F*(V+Y),rt=Math.atan2(Q-it,et-K),nt=Math.atan2(at-it,ot-K);return{cx:K+_,cy:it+E,radius:I,startAngle:rt,endAngle:nt,anticlockwise:O*F>L*B}}static arc(_,E,A,R,I,P,C,D,B){const O=C-P,F=GRAPHICS_CURVES._segmentsCount(Math.abs(O)*I,Math.ceil(Math.abs(O)/PI_2)*40),L=O/(F*2),U=L*2,G=Math.cos(L),X=Math.sin(L),W=F-1,V=W%1/W;for(let q=0;q<=W;++q){const z=q+V*q,Y=L+P+U*z,K=Math.cos(Y),it=-Math.sin(Y);B.push((G*K+X*it)*I+A,(G*-it+X*K)*I+R)}}}class BezierUtils{static curveLength(_,E,A,R,I,P,C,D){let O=0,F=0,L=0,U=0,G=0,X=0,W=0,V=0,q=0,z=0,Y=0,K=_,it=E;for(let et=1;et<=10;++et)F=et/10,L=F*F,U=L*F,G=1-F,X=G*G,W=X*G,V=W*_+3*X*F*A+3*G*L*I+U*C,q=W*E+3*X*F*R+3*G*L*P+U*D,z=K-V,Y=it-q,K=V,it=q,O+=Math.sqrt(z*z+Y*Y);return O}static curveTo(_,E,A,R,I,P,C){const D=C[C.length-2],B=C[C.length-1];C.length-=2;const O=GRAPHICS_CURVES._segmentsCount(BezierUtils.curveLength(D,B,_,E,A,R,I,P));let F=0,L=0,U=0,G=0,X=0;C.push(D,B);for(let W=1,V=0;W<=O;++W)V=W/O,F=1-V,L=F*F,U=L*F,G=V*V,X=G*V,C.push(U*D+3*L*V*_+3*F*G*A+X*I,U*B+3*L*V*E+3*F*G*R+X*P)}}class QuadraticUtils{static curveLength(_,E,A,R,I,P){const C=_-2*A+I,D=E-2*R+P,B=2*A-2*_,O=2*R-2*E,F=4*(C*C+D*D),L=4*(C*B+D*O),U=B*B+O*O,G=2*Math.sqrt(F+L+U),X=Math.sqrt(F),W=2*F*X,V=2*Math.sqrt(U),q=L/X;return(W*G+X*L*(G-V)+(4*U*F-L*L)*Math.log((2*X+q+G)/(q+V)))/(4*W)}static curveTo(_,E,A,R,I){const P=I[I.length-2],C=I[I.length-1],D=GRAPHICS_CURVES._segmentsCount(QuadraticUtils.curveLength(P,C,_,E,A,R));let B=0,O=0;for(let F=1;F<=D;++F){const L=F/D;B=P+(_-P)*L,O=C+(E-C)*L,I.push(B+(_+(A-_)*L-B)*L,O+(E+(R-E)*L-O)*L)}}}class BatchPart{constructor(){this.reset()}begin(_,E,A){this.reset(),this.style=_,this.start=E,this.attribStart=A}end(_,E){this.attribSize=E-this.attribStart,this.size=_-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const FILL_COMMANDS={[SHAPES.POLY]:buildPoly,[SHAPES.CIRC]:buildCircle,[SHAPES.ELIP]:buildCircle,[SHAPES.RECT]:buildRectangle,[SHAPES.RREC]:buildRoundedRectangle},BATCH_POOL=[],DRAW_CALL_POOL=[];class GraphicsData{constructor(_,E=null,A=null,R=null){this.points=[],this.holes=[],this.shape=_,this.lineStyle=A,this.fillStyle=E,this.matrix=R,this.type=_.type}clone(){return new GraphicsData(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const tmpPoint=new Point,_GraphicsGeometry=class extends BatchGeometry{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Bounds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let T=0;T<this.drawCalls.length;T++)this.drawCalls[T].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[T]);this.drawCalls.length=0;for(let T=0;T<this.batches.length;T++){const _=this.batches[T];_.reset(),BATCH_POOL.push(_)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(T,_=null,E=null,A=null){const R=new GraphicsData(T,_,E,A);return this.graphicsData.push(R),this.dirty++,this}drawHole(T,_=null){if(!this.graphicsData.length)return null;const E=new GraphicsData(T,null,null,_),A=this.graphicsData[this.graphicsData.length-1];return E.lineStyle=A.lineStyle,A.holes.push(E),this.dirty++,this}destroy(){super.destroy();for(let T=0;T<this.graphicsData.length;++T)this.graphicsData[T].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(T){const _=this.graphicsData;for(let E=0;E<_.length;++E){const A=_[E];if(!!A.fillStyle.visible&&A.shape&&(A.matrix?A.matrix.applyInverse(T,tmpPoint):tmpPoint.copyFrom(T),A.shape.contains(tmpPoint.x,tmpPoint.y))){let R=!1;if(A.holes){for(let I=0;I<A.holes.length;I++)if(A.holes[I].shape.contains(tmpPoint.x,tmpPoint.y)){R=!0;break}}if(!R)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const T=this.uvs,_=this.graphicsData;let E=null,A=null;this.batches.length>0&&(E=this.batches[this.batches.length-1],A=E.style);for(let C=this.shapeIndex;C<_.length;C++){this.shapeIndex++;const D=_[C],B=D.fillStyle,O=D.lineStyle;FILL_COMMANDS[D.type].build(D),D.matrix&&this.transformPoints(D.points,D.matrix),(B.visible||O.visible)&&this.processHoles(D.holes);for(let L=0;L<2;L++){const U=L===0?B:O;if(!U.visible)continue;const G=U.texture.baseTexture,X=this.indices.length,W=this.points.length/2;G.wrapMode=WRAP_MODES.REPEAT,L===0?this.processFill(D):this.processLine(D);const V=this.points.length/2-W;V!==0&&(E&&!this._compareStyles(A,U)&&(E.end(X,W),E=null),E||(E=BATCH_POOL.pop()||new BatchPart,E.begin(U,X,W),this.batches.push(E),A=U),this.addUvs(this.points,T,U.texture,W,V,U.matrix))}}const R=this.indices.length,I=this.points.length/2;if(E&&E.end(R,I),this.batches.length===0){this.batchable=!0;return}const P=I>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&P===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=P?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(T,_){return!(!T||!_||T.texture.baseTexture!==_.texture.baseTexture||T.color+T.alpha!==_.color+_.alpha||!!T.native!=!!_.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let T=0,_=this.graphicsData.length;T<_;T++){const E=this.graphicsData[T],A=E.fillStyle,R=E.lineStyle;if(A&&!A.texture.baseTexture.valid||R&&!R.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const T=this.batches;for(let _=0,E=T.length;_<E;_++){const A=T[_];for(let R=0;R<A.size;R++){const I=A.start+R;this.indicesUint16[I]=this.indicesUint16[I]-A.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const T=this.batches;for(let _=0;_<T.length;_++)if(T[_].style.native)return!1;return this.points.length<_GraphicsGeometry.BATCHABLE_SIZE*2}buildDrawCalls(){let T=++BaseTexture._globalBatch;for(let O=0;O<this.drawCalls.length;O++)this.drawCalls[O].texArray.clear(),DRAW_CALL_POOL.push(this.drawCalls[O]);this.drawCalls.length=0;const _=this.colors,E=this.textureIds;let A=DRAW_CALL_POOL.pop();A||(A=new BatchDrawCall,A.texArray=new BatchTextureArray),A.texArray.count=0,A.start=0,A.size=0,A.type=DRAW_MODES.TRIANGLES;let R=0,I=null,P=0,C=!1,D=DRAW_MODES.TRIANGLES,B=0;this.drawCalls.push(A);for(let O=0;O<this.batches.length;O++){const F=this.batches[O],L=8,U=F.style,G=U.texture.baseTexture;C!==!!U.native&&(C=!!U.native,D=C?DRAW_MODES.LINES:DRAW_MODES.TRIANGLES,I=null,R=L,T++),I!==G&&(I=G,G._batchEnabled!==T&&(R===L&&(T++,R=0,A.size>0&&(A=DRAW_CALL_POOL.pop(),A||(A=new BatchDrawCall,A.texArray=new BatchTextureArray),this.drawCalls.push(A)),A.start=B,A.size=0,A.texArray.count=0,A.type=D),G.touched=1,G._batchEnabled=T,G._batchLocation=R,G.wrapMode=WRAP_MODES.REPEAT,A.texArray.elements[A.texArray.count++]=G,R++)),A.size+=F.size,B+=F.size,P=G._batchLocation,this.addColors(_,U.color,U.alpha,F.attribSize,F.attribStart),this.addTextureIds(E,P,F.attribSize,F.attribStart)}BaseTexture._globalBatch=T,this.packAttributes()}packAttributes(){const T=this.points,_=this.uvs,E=this.colors,A=this.textureIds,R=new ArrayBuffer(T.length*3*4),I=new Float32Array(R),P=new Uint32Array(R);let C=0;for(let D=0;D<T.length/2;D++)I[C++]=T[D*2],I[C++]=T[D*2+1],I[C++]=_[D*2],I[C++]=_[D*2+1],P[C++]=E[D],I[C++]=A[D];this._buffer.update(R),this._indexBuffer.update(this.indicesUint16)}processFill(T){T.holes.length?buildPoly.triangulate(T,this):FILL_COMMANDS[T.type].triangulate(T,this)}processLine(T){buildLine(T,this);for(let _=0;_<T.holes.length;_++)buildLine(T.holes[_],this)}processHoles(T){for(let _=0;_<T.length;_++){const E=T[_];FILL_COMMANDS[E.type].build(E),E.matrix&&this.transformPoints(E.points,E.matrix)}}calculateBounds(){const T=this._bounds;T.clear(),T.addVertexData(this.points,0,this.points.length),T.pad(this.boundsPadding,this.boundsPadding)}transformPoints(T,_){for(let E=0;E<T.length/2;E++){const A=T[E*2],R=T[E*2+1];T[E*2]=_.a*A+_.c*R+_.tx,T[E*2+1]=_.b*A+_.d*R+_.ty}}addColors(T,_,E,A,R=0){const I=(_>>16)+(_&65280)+((_&255)<<16),P=premultiplyTint(I,E);T.length=Math.max(T.length,R+A);for(let C=0;C<A;C++)T[R+C]=P}addTextureIds(T,_,E,A=0){T.length=Math.max(T.length,A+E);for(let R=0;R<E;R++)T[A+R]=_}addUvs(T,_,E,A,R,I=null){let P=0;const C=_.length,D=E.frame;for(;P<R;){let O=T[(A+P)*2],F=T[(A+P)*2+1];if(I){const L=I.a*O+I.c*F+I.tx;F=I.b*O+I.d*F+I.ty,O=L}P++,_.push(O/D.width,F/D.height)}const B=E.baseTexture;(D.width<B.width||D.height<B.height)&&this.adjustUvs(_,E,C,R)}adjustUvs(T,_,E,A){const R=_.baseTexture,I=1e-6,P=E+A*2,C=_.frame,D=C.width/R.width,B=C.height/R.height;let O=C.x/C.width,F=C.y/C.height,L=Math.floor(T[E]+I),U=Math.floor(T[E+1]+I);for(let G=E+2;G<P;G+=2)L=Math.min(L,Math.floor(T[G]+I)),U=Math.min(U,Math.floor(T[G+1]+I));O-=L,F-=U;for(let G=E;G<P;G+=2)T[G]=(T[G]+O)*D,T[G+1]=(T[G+1]+F)*B}};let GraphicsGeometry=_GraphicsGeometry;GraphicsGeometry.BATCHABLE_SIZE=100;class LineStyle extends FillStyle{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=LINE_CAP.BUTT,this.join=LINE_JOIN.MITER,this.miterLimit=10}clone(){const _=new LineStyle;return _.color=this.color,_.alpha=this.alpha,_.texture=this.texture,_.matrix=this.matrix,_.visible=this.visible,_.width=this.width,_.alignment=this.alignment,_.native=this.native,_.cap=this.cap,_.join=this.join,_.miterLimit=this.miterLimit,_}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const temp=new Float32Array(3),DEFAULT_SHADERS={},_Graphics=class extends Container{constructor(T=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new FillStyle,this._lineStyle=new LineStyle,this._matrix=null,this._holeMode=!1,this.state=State$1.for2d(),this._geometry=T||new GraphicsGeometry,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=BLEND_MODES.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new _Graphics(this._geometry)}set blendMode(T){this.state.blendMode=T}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(T){this._tint=T}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(T=null,_=0,E=1,A=.5,R=!1){return typeof T=="number"&&(T={width:T,color:_,alpha:E,alignment:A,native:R}),this.lineTextureStyle(T)}lineTextureStyle(T){T=Object.assign({width:0,texture:Texture.WHITE,color:T!=null&&T.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:LINE_CAP.BUTT,join:LINE_JOIN.MITER,miterLimit:10},T),this.currentPath&&this.startPoly();const _=T.width>0&&T.alpha>0;return _?(T.matrix&&(T.matrix=T.matrix.clone(),T.matrix.invert()),Object.assign(this._lineStyle,{visible:_},T)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const T=this.currentPath.points,_=this.currentPath.points.length;_>2&&(this.drawShape(this.currentPath),this.currentPath=new Polygon,this.currentPath.closeStroke=!1,this.currentPath.points.push(T[_-2],T[_-1]))}else this.currentPath=new Polygon,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(T,_){return this.startPoly(),this.currentPath.points[0]=T,this.currentPath.points[1]=_,this}lineTo(T,_){this.currentPath||this.moveTo(0,0);const E=this.currentPath.points,A=E[E.length-2],R=E[E.length-1];return(A!==T||R!==_)&&E.push(T,_),this}_initCurve(T=0,_=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[T,_]):this.moveTo(T,_)}quadraticCurveTo(T,_,E,A){this._initCurve();const R=this.currentPath.points;return R.length===0&&this.moveTo(0,0),QuadraticUtils.curveTo(T,_,E,A,R),this}bezierCurveTo(T,_,E,A,R,I){return this._initCurve(),BezierUtils.curveTo(T,_,E,A,R,I,this.currentPath.points),this}arcTo(T,_,E,A,R){this._initCurve(T,_);const I=this.currentPath.points,P=ArcUtils.curveTo(T,_,E,A,R,I);if(P){const{cx:C,cy:D,radius:B,startAngle:O,endAngle:F,anticlockwise:L}=P;this.arc(C,D,B,O,F,L)}return this}arc(T,_,E,A,R,I=!1){if(A===R)return this;if(!I&&R<=A?R+=PI_2:I&&A<=R&&(A+=PI_2),R-A===0)return this;const C=T+Math.cos(A)*E,D=_+Math.sin(A)*E,B=this._geometry.closePointEps;let O=this.currentPath?this.currentPath.points:null;if(O){const F=Math.abs(O[O.length-2]-C),L=Math.abs(O[O.length-1]-D);F<B&&L<B||O.push(C,D)}else this.moveTo(C,D),O=this.currentPath.points;return ArcUtils.arc(C,D,T,_,E,A,R,I,O),this}beginFill(T=0,_=1){return this.beginTextureFill({texture:Texture.WHITE,color:T,alpha:_})}beginTextureFill(T){T=Object.assign({texture:Texture.WHITE,color:16777215,alpha:1,matrix:null},T),this.currentPath&&this.startPoly();const _=T.alpha>0;return _?(T.matrix&&(T.matrix=T.matrix.clone(),T.matrix.invert()),Object.assign(this._fillStyle,{visible:_},T)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(T,_,E,A){return this.drawShape(new Rectangle(T,_,E,A))}drawRoundedRect(T,_,E,A,R){return this.drawShape(new RoundedRectangle(T,_,E,A,R))}drawCircle(T,_,E){return this.drawShape(new Circle(T,_,E))}drawEllipse(T,_,E,A){return this.drawShape(new Ellipse(T,_,E,A))}drawPolygon(...T){let _,E=!0;const A=T[0];A.points?(E=A.closeStroke,_=A.points):Array.isArray(T[0])?_=T[0]:_=T;const R=new Polygon(_);return R.closeStroke=E,this.drawShape(R),this}drawShape(T){return this._holeMode?this._geometry.drawHole(T,this._matrix):this._geometry.drawShape(T,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const T=this._geometry.graphicsData;return T.length===1&&T[0].shape.type===SHAPES.RECT&&!T[0].matrix&&!T[0].holes.length&&!(T[0].lineStyle.visible&&T[0].lineStyle.width)}_render(T){this.finishPoly();const _=this._geometry;_.updateBatches(),_.batchable?(this.batchDirty!==_.batchDirty&&this._populateBatches(),this._renderBatched(T)):(T.batch.flush(),this._renderDirect(T))}_populateBatches(){const T=this._geometry,_=this.blendMode,E=T.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=T.batchDirty,this.batches.length=E,this.vertexData=new Float32Array(T.points);for(let A=0;A<E;A++){const R=T.batches[A],I=R.style.color,P=new Float32Array(this.vertexData.buffer,R.attribStart*4*2,R.attribSize*2),C=new Float32Array(T.uvsFloat32.buffer,R.attribStart*4*2,R.attribSize*2),D=new Uint16Array(T.indicesUint16.buffer,R.start*2,R.size),B={vertexData:P,blendMode:_,indices:D,uvs:C,_batchRGB:hex2rgb(I),_tintRGB:I,_texture:R.style.texture,alpha:R.style.alpha,worldAlpha:1};this.batches[A]=B}}_renderBatched(T){if(!!this.batches.length){T.batch.setObjectRenderer(T.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let _=0,E=this.batches.length;_<E;_++){const A=this.batches[_];A.worldAlpha=this.worldAlpha*A.alpha,T.plugins[this.pluginName].render(A)}}}_renderDirect(T){const _=this._resolveDirectShader(T),E=this._geometry,A=this.tint,R=this.worldAlpha,I=_.uniforms,P=E.drawCalls;I.translationMatrix=this.transform.worldTransform,I.tint[0]=(A>>16&255)/255*R,I.tint[1]=(A>>8&255)/255*R,I.tint[2]=(A&255)/255*R,I.tint[3]=R,T.shader.bind(_),T.geometry.bind(E,_),T.state.set(this.state);for(let C=0,D=P.length;C<D;C++)this._renderDrawCallDirect(T,E.drawCalls[C])}_renderDrawCallDirect(T,_){const{texArray:E,type:A,size:R,start:I}=_,P=E.count;for(let C=0;C<P;C++)T.texture.bind(E.elements[C],C);T.geometry.draw(A,R,I)}_resolveDirectShader(T){let _=this.shader;const E=this.pluginName;if(!_){if(!DEFAULT_SHADERS[E]){const{MAX_TEXTURES:A}=T.plugins[E],R=new Int32Array(A);for(let C=0;C<A;C++)R[C]=C;const I={tint:new Float32Array([1,1,1,1]),translationMatrix:new Matrix,default:UniformGroup.from({uSamplers:R},!0)},P=T.plugins[E]._shader.program;DEFAULT_SHADERS[E]=new Shader(P,I)}_=DEFAULT_SHADERS[E]}return _}_calculateBounds(){this.finishPoly();const T=this._geometry;if(!T.graphicsData.length)return;const{minX:_,minY:E,maxX:A,maxY:R}=T.bounds;this._bounds.addFrame(this.transform,_,E,A,R)}containsPoint(T){return this.worldTransform.applyInverse(T,_Graphics._TEMP_POINT),this._geometry.containsPoint(_Graphics._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const T=hex2rgb(this.tint,temp);for(let _=0;_<this.batches.length;_++){const E=this.batches[_],A=E._batchRGB,R=T[0]*A[0]*255,I=T[1]*A[1]*255,P=T[2]*A[2]*255,C=(R<<16)+(I<<8)+(P|0);E._tintRGB=(C>>16)+(C&65280)+((C&255)<<16)}}}calculateVertices(){const T=this.transform._worldID;if(this._transformID===T)return;this._transformID=T;const _=this.transform.worldTransform,E=_.a,A=_.b,R=_.c,I=_.d,P=_.tx,C=_.ty,D=this._geometry.points,B=this.vertexData;let O=0;for(let F=0;F<D.length;F+=2){const L=D[F],U=D[F+1];B[O++]=E*L+R*U+P,B[O++]=I*U+A*L+C}}closePath(){const T=this.currentPath;return T&&(T.closeStroke=!0,this.finishPoly()),this}setMatrix(T){return this._matrix=T,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(T){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(T)}};let Graphics=_Graphics;Graphics._TEMP_POINT=new Point;class MeshBatchUvs{constructor(_,E){this.uvBuffer=_,this.uvMatrix=E,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(_){if(!_&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const E=this.uvBuffer.data;(!this.data||this.data.length!==E.length)&&(this.data=new Float32Array(E.length)),this.uvMatrix.multiplyUvs(E,this.data),this._updateID++}}const tempPoint=new Point,tempPolygon=new Polygon,_Mesh=class extends Container{constructor(T,_,E,A=DRAW_MODES.TRIANGLES){super(),this.geometry=T,this.shader=_,this.state=E||State$1.for2d(),this.drawMode=A,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=settings.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(T){this._geometry!==T&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=T,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(T){this.shader=T}get material(){return this.shader}set blendMode(T){this.state.blendMode=T}get blendMode(){return this.state.blendMode}set roundPixels(T){this._roundPixels!==T&&(this._transformID=-1),this._roundPixels=T}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(T){this.shader.tint=T}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(T){this.shader.texture=T}_render(T){const _=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===DRAW_MODES.TRIANGLES&&_.length<_Mesh.BATCHABLE_SIZE*2?this._renderToBatch(T):this._renderDefault(T)}_renderDefault(T){const _=this.shader;_.alpha=this.worldAlpha,_.update&&_.update(),T.batch.flush(),_.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),T.shader.bind(_),T.state.set(this.state),T.geometry.bind(this.geometry,_),T.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(T){const _=this.geometry,E=this.shader;E.uvMatrix&&(E.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=_.indexBuffer.data,this._tintRGB=E._tintRGB,this._texture=E.texture;const A=this.material.pluginName;T.batch.setObjectRenderer(T.plugins[A]),T.plugins[A].render(this)}calculateVertices(){const _=this.geometry.buffers[0],E=_.data,A=_._updateID;if(A===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==E.length&&(this.vertexData=new Float32Array(E.length));const R=this.transform.worldTransform,I=R.a,P=R.b,C=R.c,D=R.d,B=R.tx,O=R.ty,F=this.vertexData;for(let L=0;L<F.length/2;L++){const U=E[L*2],G=E[L*2+1];F[L*2]=I*U+C*G+B,F[L*2+1]=P*U+D*G+O}if(this._roundPixels){const L=settings.RESOLUTION;for(let U=0;U<F.length;++U)F[U]=Math.round(F[U]*L)/L}this.vertexDirty=A}calculateUvs(){const T=this.geometry.buffers[1],_=this.shader;_.uvMatrix.isSimple?this.uvs=T.data:(this.batchUvs||(this.batchUvs=new MeshBatchUvs(T,_.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(T){if(!this.getBounds().contains(T.x,T.y))return!1;this.worldTransform.applyInverse(T,tempPoint);const _=this.geometry.getBuffer("aVertexPosition").data,E=tempPolygon.points,A=this.geometry.getIndex().data,R=A.length,I=this.drawMode===4?3:1;for(let P=0;P+2<R;P+=I){const C=A[P]*2,D=A[P+1]*2,B=A[P+2]*2;if(E[0]=_[C],E[1]=_[C+1],E[2]=_[D],E[3]=_[D+1],E[4]=_[B],E[5]=_[B+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}return!1}destroy(T){super.destroy(T),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let Mesh=_Mesh;Mesh.BATCHABLE_SIZE=100;var fragment$1=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,vertex$1=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class MeshMaterial extends Shader{constructor(_,E){const A={uSampler:_,alpha:1,uTextureMatrix:Matrix.IDENTITY,uColor:new Float32Array([1,1,1,1])};E=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},E),E.uniforms&&Object.assign(A,E.uniforms),super(E.program||Program.from(vertex$1,fragment$1),A),this._colorDirty=!1,this.uvMatrix=new TextureMatrix(_),this.batchable=E.program===void 0,this.pluginName=E.pluginName,this.tint=E.tint,this.alpha=E.alpha}get texture(){return this.uniforms.uSampler}set texture(_){this.uniforms.uSampler!==_&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!_.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=_,this.uvMatrix.texture=_)}set alpha(_){_!==this._alpha&&(this._alpha=_,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(_){_!==this._tint&&(this._tint=_,this._tintRGB=(_>>16)+(_&65280)+((_&255)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const _=this.texture.baseTexture;premultiplyTintToRgba(this._tint,this._alpha,this.uniforms.uColor,_.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class MeshGeometry extends Geometry{constructor(_,E,A){super();const R=new Buffer(_),I=new Buffer(E,!0),P=new Buffer(A,!0,!0);this.addAttribute("aVertexPosition",R,2,!1,TYPES.FLOAT).addAttribute("aTextureCoord",I,2,!1,TYPES.FLOAT).addIndex(P),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class ParticleBuffer{constructor(_,E,A){this.geometry=new Geometry,this.indexBuffer=null,this.size=A,this.dynamicProperties=[],this.staticProperties=[];for(let R=0;R<_.length;++R){let I=_[R];I={attributeName:I.attributeName,size:I.size,uploadFunction:I.uploadFunction,type:I.type||TYPES.FLOAT,offset:I.offset},E[R]?this.dynamicProperties.push(I):this.staticProperties.push(I)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const _=this.geometry;let E=0;this.indexBuffer=new Buffer(createIndicesForQuads(this.size),!0,!0),_.addIndex(this.indexBuffer),this.dynamicStride=0;for(let P=0;P<this.dynamicProperties.length;++P){const C=this.dynamicProperties[P];C.offset=E,E+=C.size,this.dynamicStride+=C.size}const A=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(A),this.dynamicDataUint32=new Uint32Array(A),this.dynamicBuffer=new Buffer(this.dynamicData,!1,!1);let R=0;this.staticStride=0;for(let P=0;P<this.staticProperties.length;++P){const C=this.staticProperties[P];C.offset=R,R+=C.size,this.staticStride+=C.size}const I=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(I),this.staticDataUint32=new Uint32Array(I),this.staticBuffer=new Buffer(this.staticData,!0,!1);for(let P=0;P<this.dynamicProperties.length;++P){const C=this.dynamicProperties[P];_.addAttribute(C.attributeName,this.dynamicBuffer,0,C.type===TYPES.UNSIGNED_BYTE,C.type,this.dynamicStride*4,C.offset*4)}for(let P=0;P<this.staticProperties.length;++P){const C=this.staticProperties[P];_.addAttribute(C.attributeName,this.staticBuffer,0,C.type===TYPES.UNSIGNED_BYTE,C.type,this.staticStride*4,C.offset*4)}}uploadDynamic(_,E,A){for(let R=0;R<this.dynamicProperties.length;R++){const I=this.dynamicProperties[R];I.uploadFunction(_,E,A,I.type===TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,I.offset)}this.dynamicBuffer._updateID++}uploadStatic(_,E,A){for(let R=0;R<this.staticProperties.length;R++){const I=this.staticProperties[R];I.uploadFunction(_,E,A,I.type===TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,I.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var fragment=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vertex=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class ParticleRenderer extends ObjectRenderer{constructor(_){super(_),this.shader=null,this.properties=null,this.tempMatrix=new Matrix,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:TYPES.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Shader.from(vertex,fragment,{}),this.state=State$1.for2d()}render(_){const E=_.children,A=_._maxSize,R=_._batchSize,I=this.renderer;let P=E.length;if(P===0)return;P>A&&!_.autoResize&&(P=A);let C=_._buffers;C||(C=_._buffers=this.generateBuffers(_));const D=E[0]._texture.baseTexture,B=D.alphaMode>0;this.state.blendMode=correctBlendMode(_.blendMode,B),I.state.set(this.state);const O=I.gl,F=_.worldTransform.copyTo(this.tempMatrix);F.prepend(I.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=F.toArray(!0),this.shader.uniforms.uColor=premultiplyRgba(_.tintRgb,_.worldAlpha,this.shader.uniforms.uColor,B),this.shader.uniforms.uSampler=D,this.renderer.shader.bind(this.shader);let L=!1;for(let U=0,G=0;U<P;U+=R,G+=1){let X=P-U;X>R&&(X=R),G>=C.length&&C.push(this._generateOneMoreBuffer(_));const W=C[G];W.uploadDynamic(E,U,X);const V=_._bufferUpdateIDs[G]||0;L=L||W._updateID<V,L&&(W._updateID=_._updateID,W.uploadStatic(E,U,X)),I.geometry.bind(W.geometry),O.drawElements(O.TRIANGLES,X*6,O.UNSIGNED_SHORT,0)}}generateBuffers(_){const E=[],A=_._maxSize,R=_._batchSize,I=_._properties;for(let P=0;P<A;P+=R)E.push(new ParticleBuffer(this.properties,I,R));return E}_generateOneMoreBuffer(_){const E=_._batchSize,A=_._properties;return new ParticleBuffer(this.properties,A,E)}uploadVertices(_,E,A,R,I,P){let C=0,D=0,B=0,O=0;for(let F=0;F<A;++F){const L=_[E+F],U=L._texture,G=L.scale.x,X=L.scale.y,W=U.trim,V=U.orig;W?(D=W.x-L.anchor.x*V.width,C=D+W.width,O=W.y-L.anchor.y*V.height,B=O+W.height):(C=V.width*(1-L.anchor.x),D=V.width*-L.anchor.x,B=V.height*(1-L.anchor.y),O=V.height*-L.anchor.y),R[P]=D*G,R[P+1]=O*X,R[P+I]=C*G,R[P+I+1]=O*X,R[P+I*2]=C*G,R[P+I*2+1]=B*X,R[P+I*3]=D*G,R[P+I*3+1]=B*X,P+=I*4}}uploadPosition(_,E,A,R,I,P){for(let C=0;C<A;C++){const D=_[E+C].position;R[P]=D.x,R[P+1]=D.y,R[P+I]=D.x,R[P+I+1]=D.y,R[P+I*2]=D.x,R[P+I*2+1]=D.y,R[P+I*3]=D.x,R[P+I*3+1]=D.y,P+=I*4}}uploadRotation(_,E,A,R,I,P){for(let C=0;C<A;C++){const D=_[E+C].rotation;R[P]=D,R[P+I]=D,R[P+I*2]=D,R[P+I*3]=D,P+=I*4}}uploadUvs(_,E,A,R,I,P){for(let C=0;C<A;++C){const D=_[E+C]._texture._uvs;D?(R[P]=D.x0,R[P+1]=D.y0,R[P+I]=D.x1,R[P+I+1]=D.y1,R[P+I*2]=D.x2,R[P+I*2+1]=D.y2,R[P+I*3]=D.x3,R[P+I*3+1]=D.y3,P+=I*4):(R[P]=0,R[P+1]=0,R[P+I]=0,R[P+I+1]=0,R[P+I*2]=0,R[P+I*2+1]=0,R[P+I*3]=0,R[P+I*3+1]=0,P+=I*4)}}uploadTint(_,E,A,R,I,P){for(let C=0;C<A;++C){const D=_[E+C],B=D._texture.baseTexture.alphaMode>0,O=D.alpha,F=O<1&&B?premultiplyTint(D._tintRGB,O):D._tintRGB+(O*255<<24);R[P]=F,R[P+I]=F,R[P+I*2]=F,R[P+I*3]=F,P+=I*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}ParticleRenderer.extension={name:"particle",type:ExtensionType.RendererPlugin};extensions$1.add(ParticleRenderer);settings.UPLOADS_PER_FRAME=4;var TEXT_GRADIENT=(T=>(T[T.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",T[T.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",T))(TEXT_GRADIENT||{});const defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},genericFontFamilies=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class TextStyle{constructor(_){this.styleID=0,this.reset(),deepCopyProperties(this,_,_)}clone(){const _={};return deepCopyProperties(_,this,defaultStyle),new TextStyle(_)}reset(){deepCopyProperties(this,defaultStyle,defaultStyle)}get align(){return this._align}set align(_){this._align!==_&&(this._align=_,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(_){this._breakWords!==_&&(this._breakWords=_,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(_){this._dropShadow!==_&&(this._dropShadow=_,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(_){this._dropShadowAlpha!==_&&(this._dropShadowAlpha=_,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(_){this._dropShadowAngle!==_&&(this._dropShadowAngle=_,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(_){this._dropShadowBlur!==_&&(this._dropShadowBlur=_,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(_){const E=getColor(_);this._dropShadowColor!==E&&(this._dropShadowColor=E,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(_){this._dropShadowDistance!==_&&(this._dropShadowDistance=_,this.styleID++)}get fill(){return this._fill}set fill(_){const E=getColor(_);this._fill!==E&&(this._fill=E,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(_){this._fillGradientType!==_&&(this._fillGradientType=_,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(_){areArraysEqual(this._fillGradientStops,_)||(this._fillGradientStops=_,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(_){this.fontFamily!==_&&(this._fontFamily=_,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(_){this._fontSize!==_&&(this._fontSize=_,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(_){this._fontStyle!==_&&(this._fontStyle=_,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(_){this._fontVariant!==_&&(this._fontVariant=_,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(_){this._fontWeight!==_&&(this._fontWeight=_,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(_){this._letterSpacing!==_&&(this._letterSpacing=_,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(_){this._lineHeight!==_&&(this._lineHeight=_,this.styleID++)}get leading(){return this._leading}set leading(_){this._leading!==_&&(this._leading=_,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(_){this._lineJoin!==_&&(this._lineJoin=_,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(_){this._miterLimit!==_&&(this._miterLimit=_,this.styleID++)}get padding(){return this._padding}set padding(_){this._padding!==_&&(this._padding=_,this.styleID++)}get stroke(){return this._stroke}set stroke(_){const E=getColor(_);this._stroke!==E&&(this._stroke=E,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(_){this._strokeThickness!==_&&(this._strokeThickness=_,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(_){this._textBaseline!==_&&(this._textBaseline=_,this.styleID++)}get trim(){return this._trim}set trim(_){this._trim!==_&&(this._trim=_,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(_){this._whiteSpace!==_&&(this._whiteSpace=_,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(_){this._wordWrap!==_&&(this._wordWrap=_,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(_){this._wordWrapWidth!==_&&(this._wordWrapWidth=_,this.styleID++)}toFontString(){const _=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let E=this.fontFamily;Array.isArray(this.fontFamily)||(E=this.fontFamily.split(","));for(let A=E.length-1;A>=0;A--){let R=E[A].trim();!/([\"\'])[^\'\"]+\1/.test(R)&&!genericFontFamilies.includes(R)&&(R=`"${R}"`),E[A]=R}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${_} ${E.join(",")}`}}function getSingleColor(T){return typeof T=="number"?hex2string(T):(typeof T=="string"&&T.startsWith("0x")&&(T=T.replace("0x","#")),T)}function getColor(T){if(Array.isArray(T)){for(let _=0;_<T.length;++_)T[_]=getSingleColor(T[_]);return T}else return getSingleColor(T)}function areArraysEqual(T,_){if(!Array.isArray(T)||!Array.isArray(_)||T.length!==_.length)return!1;for(let E=0;E<T.length;++E)if(T[E]!==_[E])return!1;return!0}function deepCopyProperties(T,_,E){for(const A in E)Array.isArray(_[A])?T[A]=_[A].slice():T[A]=_[A]}const contextSettings={willReadFrequently:!0};class TextMetrics{constructor(_,E,A,R,I,P,C,D,B){this.text=_,this.style=E,this.width=A,this.height=R,this.lines=I,this.lineWidths=P,this.lineHeight=C,this.maxLineWidth=D,this.fontProperties=B}static measureText(_,E,A,R=TextMetrics._canvas){A=A==null?E.wordWrap:A;const I=E.toFontString(),P=TextMetrics.measureFont(I);P.fontSize===0&&(P.fontSize=E.fontSize,P.ascent=E.fontSize);const C=R.getContext("2d",contextSettings);C.font=I;const B=(A?TextMetrics.wordWrap(_,E,R):_).split(/(?:\r\n|\r|\n)/),O=new Array(B.length);let F=0;for(let X=0;X<B.length;X++){const W=C.measureText(B[X]).width+(B[X].length-1)*E.letterSpacing;O[X]=W,F=Math.max(F,W)}let L=F+E.strokeThickness;E.dropShadow&&(L+=E.dropShadowDistance);const U=E.lineHeight||P.fontSize+E.strokeThickness;let G=Math.max(U,P.fontSize+E.strokeThickness)+(B.length-1)*(U+E.leading);return E.dropShadow&&(G+=E.dropShadowDistance),new TextMetrics(_,E,L,G,B,O,U+E.leading,F,P)}static wordWrap(_,E,A=TextMetrics._canvas){const R=A.getContext("2d",contextSettings);let I=0,P="",C="";const D=Object.create(null),{letterSpacing:B,whiteSpace:O}=E,F=TextMetrics.collapseSpaces(O),L=TextMetrics.collapseNewlines(O);let U=!F;const G=E.wordWrapWidth+B,X=TextMetrics.tokenize(_);for(let W=0;W<X.length;W++){let V=X[W];if(TextMetrics.isNewline(V)){if(!L){C+=TextMetrics.addLine(P),U=!F,P="",I=0;continue}V=" "}if(F){const z=TextMetrics.isBreakingSpace(V),Y=TextMetrics.isBreakingSpace(P[P.length-1]);if(z&&Y)continue}const q=TextMetrics.getFromCache(V,B,D,R);if(q>G)if(P!==""&&(C+=TextMetrics.addLine(P),P="",I=0),TextMetrics.canBreakWords(V,E.breakWords)){const z=TextMetrics.wordWrapSplit(V);for(let Y=0;Y<z.length;Y++){let K=z[Y],it=1;for(;z[Y+it];){const Q=z[Y+it],ot=K[K.length-1];if(TextMetrics.canBreakChars(ot,Q,V,Y,E.breakWords))break}Y+=K.length-1;const et=TextMetrics.getFromCache(K,B,D,R);et+I>G&&(C+=TextMetrics.addLine(P),U=!1,P="",I=0),P+=K,I+=et}}else{P.length>0&&(C+=TextMetrics.addLine(P),P="",I=0);const z=W===X.length-1;C+=TextMetrics.addLine(V,!z),U=!1,P="",I=0}else q+I>G&&(U=!1,C+=TextMetrics.addLine(P),P="",I=0),(P.length>0||!TextMetrics.isBreakingSpace(V)||U)&&(P+=V,I+=q)}return C+=TextMetrics.addLine(P,!1),C}static addLine(_,E=!0){return _=TextMetrics.trimRight(_),_=E?`${_}
`:_,_}static getFromCache(_,E,A,R){let I=A[_];if(typeof I!="number"){const P=_.length*E;I=R.measureText(_).width+P,A[_]=I}return I}static collapseSpaces(_){return _==="normal"||_==="pre-line"}static collapseNewlines(_){return _==="normal"}static trimRight(_){if(typeof _!="string")return"";for(let E=_.length-1;E>=0;E--){const A=_[E];if(!TextMetrics.isBreakingSpace(A))break;_=_.slice(0,-1)}return _}static isNewline(_){return typeof _!="string"?!1:TextMetrics._newlines.includes(_.charCodeAt(0))}static isBreakingSpace(_,E){return typeof _!="string"?!1:TextMetrics._breakingSpaces.includes(_.charCodeAt(0))}static tokenize(_){const E=[];let A="";if(typeof _!="string")return E;for(let R=0;R<_.length;R++){const I=_[R],P=_[R+1];if(TextMetrics.isBreakingSpace(I,P)||TextMetrics.isNewline(I)){A!==""&&(E.push(A),A=""),E.push(I);continue}A+=I}return A!==""&&E.push(A),E}static canBreakWords(_,E){return E}static canBreakChars(_,E,A,R,I){return!0}static wordWrapSplit(_){return _.split("")}static measureFont(_){if(TextMetrics._fonts[_])return TextMetrics._fonts[_];const E={ascent:0,descent:0,fontSize:0},A=TextMetrics._canvas,R=TextMetrics._context;R.font=_;const I=TextMetrics.METRICS_STRING+TextMetrics.BASELINE_SYMBOL,P=Math.ceil(R.measureText(I).width);let C=Math.ceil(R.measureText(TextMetrics.BASELINE_SYMBOL).width);const D=Math.ceil(TextMetrics.HEIGHT_MULTIPLIER*C);C=C*TextMetrics.BASELINE_MULTIPLIER|0,A.width=P,A.height=D,R.fillStyle="#f00",R.fillRect(0,0,P,D),R.font=_,R.textBaseline="alphabetic",R.fillStyle="#000",R.fillText(I,0,C);const B=R.getImageData(0,0,P,D).data,O=B.length,F=P*4;let L=0,U=0,G=!1;for(L=0;L<C;++L){for(let X=0;X<F;X+=4)if(B[U+X]!==255){G=!0;break}if(!G)U+=F;else break}for(E.ascent=C-L,U=O-F,G=!1,L=D;L>C;--L){for(let X=0;X<F;X+=4)if(B[U+X]!==255){G=!0;break}if(!G)U-=F;else break}return E.descent=L-C,E.fontSize=E.ascent+E.descent,TextMetrics._fonts[_]=E,E}static clearMetrics(_=""){_?delete TextMetrics._fonts[_]:TextMetrics._fonts={}}static get _canvas(){if(!TextMetrics.__canvas){let _;try{const E=new OffscreenCanvas(0,0),A=E.getContext("2d",contextSettings);if(A!=null&&A.measureText)return TextMetrics.__canvas=E,E;_=settings.ADAPTER.createCanvas()}catch{_=settings.ADAPTER.createCanvas()}_.width=_.height=10,TextMetrics.__canvas=_}return TextMetrics.__canvas}static get _context(){return TextMetrics.__context||(TextMetrics.__context=TextMetrics._canvas.getContext("2d",contextSettings)),TextMetrics.__context}}TextMetrics._fonts={};TextMetrics.METRICS_STRING="|\xC9q\xC5";TextMetrics.BASELINE_SYMBOL="M";TextMetrics.BASELINE_MULTIPLIER=1.4;TextMetrics.HEIGHT_MULTIPLIER=2;TextMetrics._newlines=[10,13];TextMetrics._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},_Text=class extends Sprite{constructor(T,_,E){let A=!1;E||(E=settings.ADAPTER.createCanvas(),A=!0),E.width=3,E.height=3;const R=Texture.from(E);R.orig=new Rectangle,R.trim=new Rectangle,super(R),this._ownCanvas=A,this.canvas=E,this.context=E.getContext("2d",{willReadFrequently:!0}),this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=T,this.style=_,this.localStyleID=-1}updateText(T){const _=this._style;if(this.localStyleID!==_.styleID&&(this.dirty=!0,this.localStyleID=_.styleID),!this.dirty&&T)return;this._font=this._style.toFontString();const E=this.context,A=TextMetrics.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),R=A.width,I=A.height,P=A.lines,C=A.lineHeight,D=A.lineWidths,B=A.maxLineWidth,O=A.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,R)+_.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,I)+_.padding*2)*this._resolution),E.scale(this._resolution,this._resolution),E.clearRect(0,0,this.canvas.width,this.canvas.height),E.font=this._font,E.lineWidth=_.strokeThickness,E.textBaseline=_.textBaseline,E.lineJoin=_.lineJoin,E.miterLimit=_.miterLimit;let F,L;const U=_.dropShadow?2:1;for(let G=0;G<U;++G){const X=_.dropShadow&&G===0,W=X?Math.ceil(Math.max(1,I)+_.padding*2):0,V=W*this._resolution;if(X){E.fillStyle="black",E.strokeStyle="black";const z=_.dropShadowColor,Y=hex2rgb(typeof z=="number"?z:string2hex(z)),K=_.dropShadowBlur*this._resolution,it=_.dropShadowDistance*this._resolution;E.shadowColor=`rgba(${Y[0]*255},${Y[1]*255},${Y[2]*255},${_.dropShadowAlpha})`,E.shadowBlur=K,E.shadowOffsetX=Math.cos(_.dropShadowAngle)*it,E.shadowOffsetY=Math.sin(_.dropShadowAngle)*it+V}else E.fillStyle=this._generateFillStyle(_,P,A),E.strokeStyle=_.stroke,E.shadowColor="black",E.shadowBlur=0,E.shadowOffsetX=0,E.shadowOffsetY=0;let q=(C-O.fontSize)/2;C-O.fontSize<0&&(q=0);for(let z=0;z<P.length;z++)F=_.strokeThickness/2,L=_.strokeThickness/2+z*C+O.ascent+q,_.align==="right"?F+=B-D[z]:_.align==="center"&&(F+=(B-D[z])/2),_.stroke&&_.strokeThickness&&this.drawLetterSpacing(P[z],F+_.padding,L+_.padding-W,!0),_.fill&&this.drawLetterSpacing(P[z],F+_.padding,L+_.padding-W)}this.updateTexture()}drawLetterSpacing(T,_,E,A=!1){const I=this._style.letterSpacing,P=_Text.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(I===0||P){P&&(this.context.letterSpacing=I,this.context.textLetterSpacing=I),A?this.context.strokeText(T,_,E):this.context.fillText(T,_,E);return}let C=_;const D=Array.from?Array.from(T):T.split("");let B=this.context.measureText(T).width,O=0;for(let F=0;F<D.length;++F){const L=D[F];A?this.context.strokeText(L,C,E):this.context.fillText(L,C,E);let U="";for(let G=F+1;G<D.length;++G)U+=D[G];O=this.context.measureText(U).width,C+=B-O+I,B=O}}updateTexture(){const T=this.canvas;if(this._style.trim){const I=trimCanvas(T);I.data&&(T.width=I.width,T.height=I.height,this.context.putImageData(I.data,0,0))}const _=this._texture,E=this._style,A=E.trim?0:E.padding,R=_.baseTexture;_.trim.width=_._frame.width=T.width/this._resolution,_.trim.height=_._frame.height=T.height/this._resolution,_.trim.x=-A,_.trim.y=-A,_.orig.width=_._frame.width-A*2,_.orig.height=_._frame.height-A*2,this._onTextureUpdate(),R.setRealSize(T.width,T.height,this._resolution),_.updateUvs(),this.dirty=!1}_render(T){this._autoResolution&&this._resolution!==T.resolution&&(this._resolution=T.resolution,this.dirty=!0),this.updateText(!0),super._render(T)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(T,_){return this.updateText(!0),this._textureID===-1&&(T=!1),super.getBounds(T,_)}getLocalBounds(T){return this.updateText(!0),super.getLocalBounds.call(this,T)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(T,_,E){const A=T.fill;if(Array.isArray(A)){if(A.length===1)return A[0]}else return A;let R;const I=T.dropShadow?T.dropShadowDistance:0,P=T.padding||0,C=this.canvas.width/this._resolution-I-P*2,D=this.canvas.height/this._resolution-I-P*2,B=A.slice(),O=T.fillGradientStops.slice();if(!O.length){const F=B.length+1;for(let L=1;L<F;++L)O.push(L/F)}if(B.unshift(A[0]),O.unshift(0),B.push(A[A.length-1]),O.push(1),T.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){R=this.context.createLinearGradient(C/2,P,C/2,D+P);const F=E.fontProperties.fontSize+T.strokeThickness;for(let L=0;L<_.length;L++){const U=E.lineHeight*(L-1)+F,G=E.lineHeight*L;let X=G;L>0&&U>G&&(X=(G+U)/2);const W=G+F,V=E.lineHeight*(L+1);let q=W;L+1<_.length&&V<W&&(q=(W+V)/2);const z=(q-X)/D;for(let Y=0;Y<B.length;Y++){let K=0;typeof O[Y]=="number"?K=O[Y]:K=Y/B.length;let it=Math.min(1,Math.max(0,X/D+K*z));it=Number(it.toFixed(5)),R.addColorStop(it,B[Y])}}}else{R=this.context.createLinearGradient(P,D/2,C+P,D/2);const F=B.length+1;let L=1;for(let U=0;U<B.length;U++){let G;typeof O[U]=="number"?G=O[U]:G=L/F,R.addColorStop(G,B[U]),L++}}return R}destroy(T){typeof T=="boolean"&&(T={children:T}),T=Object.assign({},defaultDestroyOptions,T),super.destroy(T),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(T){this.updateText(!0);const _=sign(this.scale.x)||1;this.scale.x=_*T/this._texture.orig.width,this._width=T}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(T){this.updateText(!0);const _=sign(this.scale.y)||1;this.scale.y=_*T/this._texture.orig.height,this._height=T}get style(){return this._style}set style(T){T=T||{},T instanceof TextStyle?this._style=T:this._style=new TextStyle(T),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(T){T=String(T==null?"":T),this._text!==T&&(this._text=T,this.dirty=!0)}get resolution(){return this._resolution}set resolution(T){this._autoResolution=!1,this._resolution!==T&&(this._resolution=T,this.dirty=!0)}};let Text=_Text;Text.experimentalLetterSpacing=!1;class CountLimiter{constructor(_){this.maxItemsPerFrame=_,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function findMultipleBaseTextures(T,_){var A;let E=!1;if((A=T==null?void 0:T._textures)!=null&&A.length){for(let R=0;R<T._textures.length;R++)if(T._textures[R]instanceof Texture){const I=T._textures[R].baseTexture;_.includes(I)||(_.push(I),E=!0)}}return E}function findBaseTexture(T,_){if(T.baseTexture instanceof BaseTexture){const E=T.baseTexture;return _.includes(E)||_.push(E),!0}return!1}function findTexture(T,_){if(T._texture&&T._texture instanceof Texture){const E=T._texture.baseTexture;return _.includes(E)||_.push(E),!0}return!1}function drawText(T,_){return _ instanceof Text?(_.updateText(!0),!0):!1}function calculateTextStyle(T,_){if(_ instanceof TextStyle){const E=_.toFontString();return TextMetrics.measureFont(E),!0}return!1}function findText(T,_){if(T instanceof Text){_.includes(T.style)||_.push(T.style),_.includes(T)||_.push(T);const E=T._texture.baseTexture;return _.includes(E)||_.push(E),!0}return!1}function findTextStyle(T,_){return T instanceof TextStyle?(_.includes(T)||_.push(T),!0):!1}class BasePrepare{constructor(_){this.limiter=new CountLimiter(settings.UPLOADS_PER_FRAME),this.renderer=_,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{!this.queue||this.prepareItems()},this.registerFindHook(findText),this.registerFindHook(findTextStyle),this.registerFindHook(findMultipleBaseTextures),this.registerFindHook(findBaseTexture),this.registerFindHook(findTexture),this.registerUploadHook(drawText),this.registerUploadHook(calculateTextStyle)}upload(_){return new Promise(E=>{_&&this.add(_),this.queue.length?(this.completes.push(E),this.ticking||(this.ticking=!0,Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY))):E()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const _=this.queue[0];let E=!1;if(_&&!_._destroyed){for(let A=0,R=this.uploadHooks.length;A<R;A++)if(this.uploadHooks[A](this.uploadHookHelper,_)){this.queue.shift(),E=!0;break}}E||this.queue.shift()}if(this.queue.length)Ticker.system.addOnce(this.tick,this,UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;const _=this.completes.slice(0);this.completes.length=0;for(let E=0,A=_.length;E<A;E++)_[E]()}}registerFindHook(_){return _&&this.addHooks.push(_),this}registerUploadHook(_){return _&&this.uploadHooks.push(_),this}add(_){for(let E=0,A=this.addHooks.length;E<A&&!this.addHooks[E](_,this.queue);E++);if(_ instanceof Container)for(let E=_.children.length-1;E>=0;E--)this.add(_.children[E]);return this}destroy(){this.ticking&&Ticker.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function uploadBaseTextures(T,_){return _ instanceof BaseTexture?(_._glTextures[T.CONTEXT_UID]||T.texture.bind(_),!0):!1}function uploadGraphics(T,_){if(!(_ instanceof Graphics))return!1;const{geometry:E}=_;_.finishPoly(),E.updateBatches();const{batches:A}=E;for(let R=0;R<A.length;R++){const{texture:I}=A[R].style;I&&uploadBaseTextures(T,I.baseTexture)}return E.batchable||T.geometry.bind(E,_._resolveDirectShader(T)),!0}function findGraphics(T,_){return T instanceof Graphics?(_.push(T),!0):!1}class Prepare extends BasePrepare{constructor(_){super(_),this.uploadHookHelper=this.renderer,this.registerFindHook(findGraphics),this.registerUploadHook(uploadBaseTextures),this.registerUploadHook(uploadGraphics)}}Prepare.extension={name:"prepare",type:ExtensionType.RendererSystem};extensions$1.add(Prepare);const _Spritesheet=class{constructor(T,_,E=null){this.linkedSheets=[],this._texture=T instanceof Texture?T:null,this.baseTexture=T instanceof BaseTexture?T:this._texture.baseTexture,this.textures={},this.animations={},this.data=_;const A=this.baseTexture.resource;this.resolution=this._updateResolution(E||(A?A.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(T=null){const{scale:_}=this.data.meta;let E=getResolutionOfUrl(T,null);return E===null&&(E=parseFloat(_!=null?_:"1")),E!==1&&this.baseTexture.setResolution(E),E}parse(){return new Promise(T=>{this._callback=T,this._batchIndex=0,this._frameKeys.length<=_Spritesheet.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(T){let _=T;const E=_Spritesheet.BATCH_SIZE;for(;_-T<E&&_<this._frameKeys.length;){const A=this._frameKeys[_],R=this._frames[A],I=R.frame;if(I){let P=null,C=null;const D=R.trimmed!==!1&&R.sourceSize?R.sourceSize:R.frame,B=new Rectangle(0,0,Math.floor(D.w)/this.resolution,Math.floor(D.h)/this.resolution);R.rotated?P=new Rectangle(Math.floor(I.x)/this.resolution,Math.floor(I.y)/this.resolution,Math.floor(I.h)/this.resolution,Math.floor(I.w)/this.resolution):P=new Rectangle(Math.floor(I.x)/this.resolution,Math.floor(I.y)/this.resolution,Math.floor(I.w)/this.resolution,Math.floor(I.h)/this.resolution),R.trimmed!==!1&&R.spriteSourceSize&&(C=new Rectangle(Math.floor(R.spriteSourceSize.x)/this.resolution,Math.floor(R.spriteSourceSize.y)/this.resolution,Math.floor(I.w)/this.resolution,Math.floor(I.h)/this.resolution)),this.textures[A]=new Texture(this.baseTexture,P,B,C,R.rotated?2:0,R.anchor),Texture.addToCache(this.textures[A],A)}_++}}_processAnimations(){const T=this.data.animations||{};for(const _ in T){this.animations[_]=[];for(let E=0;E<T[_].length;E++){const A=T[_][E];this.animations[_].push(this.textures[A])}}}_parseComplete(){const T=this._callback;this._callback=null,this._batchIndex=0,T.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*_Spritesheet.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*_Spritesheet.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(T=!1){var _;for(const E in this.textures)this.textures[E].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,T&&((_=this._texture)==null||_.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Spritesheet=_Spritesheet;Spritesheet.BATCH_SIZE=1e3;const validImages=["jpg","png","jpeg","avif","webp"];function getCacheableAssets(T,_,E){const A={};if(T.forEach(R=>{A[R]=_}),Object.keys(_.textures).forEach(R=>{A[R]=_.textures[R]}),!E){const R=path.dirname(T[0]);_.linkedSheets.forEach((I,P)=>{const C=getCacheableAssets([`${R}/${_.data.meta.related_multi_packs[P]}`],I,!0);Object.assign(A,C)})}return A}const spritesheetAsset={extension:ExtensionType.Asset,cache:{test:T=>T instanceof Spritesheet,getCacheableAssets:(T,_)=>getCacheableAssets(T,_,!1)},resolver:{test:T=>{const E=T.split("?")[0].split("."),A=E.pop(),R=E.pop();return A==="json"&&validImages.includes(R)},parse:T=>{var E,A;const _=T.split(".");return{resolution:parseFloat((A=(E=settings.RETINA_PREFIX.exec(T))==null?void 0:E[1])!=null?A:"1"),format:_[_.length-2],src:T}}},loader:{extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},async testParse(T,_){return path.extname(_.src).includes(".json")&&!!T.frames},async parse(T,_,E){var B,O;let A=path.dirname(_.src);A&&A.lastIndexOf("/")!==A.length-1&&(A+="/");const R=A+T.meta.image,P=(await E.load([R]))[R],C=new Spritesheet(P.baseTexture,T,_.src);await C.parse();const D=(B=T==null?void 0:T.meta)==null?void 0:B.related_multi_packs;if(Array.isArray(D)){const F=[];for(const U of D){if(typeof U!="string")continue;const G=A+U;(O=_.data)!=null&&O.ignoreMultiPack||F.push(E.load({src:G,data:{ignoreMultiPack:!0}}))}const L=await Promise.all(F);C.linkedSheets=L,L.forEach(U=>{U.linkedSheets=[C].concat(C.linkedSheets.filter(G=>G!==U))})}return C},unload(T){T.destroy(!0)}}};extensions$1.add(spritesheetAsset);new Point;var fragmentSimpleSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,gl1VertexSrc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl1FragmentSrc=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,gl2VertexSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,gl2FragmentSrc=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`;const tempMat=new Matrix;class TilingSpriteRenderer extends ObjectRenderer{constructor(_){super(_),_.runners.contextChange.add(this),this.quad=new QuadUv,this.state=State$1.for2d()}contextChange(){const _=this.renderer,E={globals:_.globalUniforms};this.simpleShader=Shader.from(gl1VertexSrc,fragmentSimpleSrc,E),this.shader=_.context.webGLVersion>1?Shader.from(gl2VertexSrc,gl2FragmentSrc,E):Shader.from(gl1VertexSrc,gl1FragmentSrc,E)}render(_){const E=this.renderer,A=this.quad;let R=A.vertices;R[0]=R[6]=_._width*-_.anchor.x,R[1]=R[3]=_._height*-_.anchor.y,R[2]=R[4]=_._width*(1-_.anchor.x),R[5]=R[7]=_._height*(1-_.anchor.y);const I=_.uvRespectAnchor?_.anchor.x:0,P=_.uvRespectAnchor?_.anchor.y:0;R=A.uvs,R[0]=R[6]=-I,R[1]=R[3]=-P,R[2]=R[4]=1-I,R[5]=R[7]=1-P,A.invalidate();const C=_._texture,D=C.baseTexture,B=D.alphaMode>0,O=_.tileTransform.localTransform,F=_.uvMatrix;let L=D.isPowerOfTwo&&C.frame.width===D.width&&C.frame.height===D.height;L&&(D._glTextures[E.CONTEXT_UID]?L=D.wrapMode!==WRAP_MODES.CLAMP:D.wrapMode===WRAP_MODES.CLAMP&&(D.wrapMode=WRAP_MODES.REPEAT));const U=L?this.simpleShader:this.shader,G=C.width,X=C.height,W=_._width,V=_._height;tempMat.set(O.a*G/W,O.b*G/V,O.c*X/W,O.d*X/V,O.tx/W,O.ty/V),tempMat.invert(),L?tempMat.prepend(F.mapCoord):(U.uniforms.uMapCoord=F.mapCoord.toArray(!0),U.uniforms.uClampFrame=F.uClampFrame,U.uniforms.uClampOffset=F.uClampOffset),U.uniforms.uTransform=tempMat.toArray(!0),U.uniforms.uColor=premultiplyTintToRgba(_.tint,_.worldAlpha,U.uniforms.uColor,B),U.uniforms.translationMatrix=_.transform.worldTransform.toArray(!0),U.uniforms.uSampler=C,E.shader.bind(U),E.geometry.bind(A),this.state.blendMode=correctBlendMode(_.blendMode,B),E.state.set(this.state),E.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}TilingSpriteRenderer.extension={name:"tilingSprite",type:ExtensionType.RendererPlugin};extensions$1.add(TilingSpriteRenderer);class BitmapFontData{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class TextFormat{static test(_){return typeof _=="string"&&_.startsWith("info face=")}static parse(_){const E=_.match(/^[a-z]+\s+.+$/gm),A={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const I in E){const P=E[I].match(/^[a-z]+/gm)[0],C=E[I].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),D={};for(const B in C){const O=C[B].split("="),F=O[0],L=O[1].replace(/"/gm,""),U=parseFloat(L),G=isNaN(U)?L:U;D[F]=G}A[P].push(D)}const R=new BitmapFontData;return A.info.forEach(I=>R.info.push({face:I.face,size:parseInt(I.size,10)})),A.common.forEach(I=>R.common.push({lineHeight:parseInt(I.lineHeight,10)})),A.page.forEach(I=>R.page.push({id:parseInt(I.id,10),file:I.file})),A.char.forEach(I=>R.char.push({id:parseInt(I.id,10),page:parseInt(I.page,10),x:parseInt(I.x,10),y:parseInt(I.y,10),width:parseInt(I.width,10),height:parseInt(I.height,10),xoffset:parseInt(I.xoffset,10),yoffset:parseInt(I.yoffset,10),xadvance:parseInt(I.xadvance,10)})),A.kerning.forEach(I=>R.kerning.push({first:parseInt(I.first,10),second:parseInt(I.second,10),amount:parseInt(I.amount,10)})),A.distanceField.forEach(I=>R.distanceField.push({distanceRange:parseInt(I.distanceRange,10),fieldType:I.fieldType})),R}}class XMLFormat{static test(_){return _ instanceof XMLDocument&&_.getElementsByTagName("page").length&&_.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(_){const E=new BitmapFontData,A=_.getElementsByTagName("info"),R=_.getElementsByTagName("common"),I=_.getElementsByTagName("page"),P=_.getElementsByTagName("char"),C=_.getElementsByTagName("kerning"),D=_.getElementsByTagName("distanceField");for(let B=0;B<A.length;B++)E.info.push({face:A[B].getAttribute("face"),size:parseInt(A[B].getAttribute("size"),10)});for(let B=0;B<R.length;B++)E.common.push({lineHeight:parseInt(R[B].getAttribute("lineHeight"),10)});for(let B=0;B<I.length;B++)E.page.push({id:parseInt(I[B].getAttribute("id"),10)||0,file:I[B].getAttribute("file")});for(let B=0;B<P.length;B++){const O=P[B];E.char.push({id:parseInt(O.getAttribute("id"),10),page:parseInt(O.getAttribute("page"),10)||0,x:parseInt(O.getAttribute("x"),10),y:parseInt(O.getAttribute("y"),10),width:parseInt(O.getAttribute("width"),10),height:parseInt(O.getAttribute("height"),10),xoffset:parseInt(O.getAttribute("xoffset"),10),yoffset:parseInt(O.getAttribute("yoffset"),10),xadvance:parseInt(O.getAttribute("xadvance"),10)})}for(let B=0;B<C.length;B++)E.kerning.push({first:parseInt(C[B].getAttribute("first"),10),second:parseInt(C[B].getAttribute("second"),10),amount:parseInt(C[B].getAttribute("amount"),10)});for(let B=0;B<D.length;B++)E.distanceField.push({fieldType:D[B].getAttribute("fieldType"),distanceRange:parseInt(D[B].getAttribute("distanceRange"),10)});return E}}class XMLStringFormat{static test(_){if(typeof _=="string"&&_.includes("<font>")){const E=new globalThis.DOMParser().parseFromString(_,"text/xml");return XMLFormat.test(E)}return!1}static parse(_){const E=new globalThis.DOMParser().parseFromString(_,"text/xml");return XMLFormat.parse(E)}}const formats=[TextFormat,XMLFormat,XMLStringFormat];function autoDetectFormat(T){for(let _=0;_<formats.length;_++)if(formats[_].test(T))return formats[_];return null}function generateFillStyle(T,_,E,A,R,I){const P=E.fill;if(Array.isArray(P)){if(P.length===1)return P[0]}else return P;let C;const D=E.dropShadow?E.dropShadowDistance:0,B=E.padding||0,O=T.width/A-D-B*2,F=T.height/A-D-B*2,L=P.slice(),U=E.fillGradientStops.slice();if(!U.length){const G=L.length+1;for(let X=1;X<G;++X)U.push(X/G)}if(L.unshift(P[0]),U.unshift(0),L.push(P[P.length-1]),U.push(1),E.fillGradientType===TEXT_GRADIENT.LINEAR_VERTICAL){C=_.createLinearGradient(O/2,B,O/2,F+B);let G=0;const W=(I.fontProperties.fontSize+E.strokeThickness)/F;for(let V=0;V<R.length;V++){const q=I.lineHeight*V;for(let z=0;z<L.length;z++){let Y=0;typeof U[z]=="number"?Y=U[z]:Y=z/L.length;const K=q/F+Y*W;let it=Math.max(G,K);it=Math.min(it,1),C.addColorStop(it,L[z]),G=it}}}else{C=_.createLinearGradient(B,F/2,O+B,F/2);const G=L.length+1;let X=1;for(let W=0;W<L.length;W++){let V;typeof U[W]=="number"?V=U[W]:V=X/G,C.addColorStop(V,L[W]),X++}}return C}function drawGlyph(T,_,E,A,R,I,P){const C=E.text,D=E.fontProperties;_.translate(A,R),_.scale(I,I);const B=P.strokeThickness/2,O=-(P.strokeThickness/2);if(_.font=P.toFontString(),_.lineWidth=P.strokeThickness,_.textBaseline=P.textBaseline,_.lineJoin=P.lineJoin,_.miterLimit=P.miterLimit,_.fillStyle=generateFillStyle(T,_,P,I,[C],E),_.strokeStyle=P.stroke,P.dropShadow){const F=P.dropShadowColor,L=hex2rgb(typeof F=="number"?F:string2hex(F)),U=P.dropShadowBlur*I,G=P.dropShadowDistance*I;_.shadowColor=`rgba(${L[0]*255},${L[1]*255},${L[2]*255},${P.dropShadowAlpha})`,_.shadowBlur=U,_.shadowOffsetX=Math.cos(P.dropShadowAngle)*G,_.shadowOffsetY=Math.sin(P.dropShadowAngle)*G}else _.shadowColor="black",_.shadowBlur=0,_.shadowOffsetX=0,_.shadowOffsetY=0;P.stroke&&P.strokeThickness&&_.strokeText(C,B,O+E.lineHeight-D.descent),P.fill&&_.fillText(C,B,O+E.lineHeight-D.descent),_.setTransform(1,0,0,1,0,0),_.fillStyle="rgba(0, 0, 0, 0)"}function splitTextToCharacters(T){return Array.from?Array.from(T):T.split("")}function resolveCharacters(T){typeof T=="string"&&(T=[T]);const _=[];for(let E=0,A=T.length;E<A;E++){const R=T[E];if(Array.isArray(R)){if(R.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${R.length}.`);const I=R[0].charCodeAt(0),P=R[1].charCodeAt(0);if(P<I)throw new Error("[BitmapFont]: Invalid character range.");for(let C=I,D=P;C<=D;C++)_.push(String.fromCharCode(C))}else _.push(...splitTextToCharacters(R))}if(_.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return _}function extractCharCode(T){return T.codePointAt?T.codePointAt(0):T.charCodeAt(0)}const _BitmapFont=class{constructor(T,_,E){var B,O;const[A]=T.info,[R]=T.common,[I]=T.page,[P]=T.distanceField,C=getResolutionOfUrl(I.file),D={};this._ownsTextures=E,this.font=A.face,this.size=A.size,this.lineHeight=R.lineHeight/C,this.chars={},this.pageTextures=D;for(let F=0;F<T.page.length;F++){const{id:L,file:U}=T.page[F];D[L]=_ instanceof Array?_[F]:_[U],(P==null?void 0:P.fieldType)&&P.fieldType!=="none"&&(D[L].baseTexture.alphaMode=ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,D[L].baseTexture.mipmap=MIPMAP_MODES.OFF)}for(let F=0;F<T.char.length;F++){const{id:L,page:U}=T.char[F];let{x:G,y:X,width:W,height:V,xoffset:q,yoffset:z,xadvance:Y}=T.char[F];G/=C,X/=C,W/=C,V/=C,q/=C,z/=C,Y/=C;const K=new Rectangle(G+D[U].frame.x/C,X+D[U].frame.y/C,W,V);this.chars[L]={xOffset:q,yOffset:z,xAdvance:Y,kerning:{},texture:new Texture(D[U].baseTexture,K),page:U}}for(let F=0;F<T.kerning.length;F++){let{first:L,second:U,amount:G}=T.kerning[F];L/=C,U/=C,G/=C,this.chars[U]&&(this.chars[U].kerning[L]=G)}this.distanceFieldRange=P==null?void 0:P.distanceRange,this.distanceFieldType=(O=(B=P==null?void 0:P.fieldType)==null?void 0:B.toLowerCase())!=null?O:"none"}destroy(){for(const T in this.chars)this.chars[T].texture.destroy(),this.chars[T].texture=null;for(const T in this.pageTextures)this._ownsTextures&&this.pageTextures[T].destroy(!0),this.pageTextures[T]=null;this.chars=null,this.pageTextures=null}static install(T,_,E){let A;if(T instanceof BitmapFontData)A=T;else{const I=autoDetectFormat(T);if(!I)throw new Error("Unrecognized data format for font.");A=I.parse(T)}_ instanceof Texture&&(_=[_]);const R=new _BitmapFont(A,_,E);return _BitmapFont.available[R.font]=R,R}static uninstall(T){const _=_BitmapFont.available[T];if(!_)throw new Error(`No font found named '${T}'`);_.destroy(),delete _BitmapFont.available[T]}static from(T,_,E){if(!T)throw new Error("[BitmapFont] Property `name` is required.");const{chars:A,padding:R,resolution:I,textureWidth:P,textureHeight:C,...D}=Object.assign({},_BitmapFont.defaultOptions,E),B=resolveCharacters(A),O=_ instanceof TextStyle?_:new TextStyle(_),F=P,L=new BitmapFontData;L.info[0]={face:O.fontFamily,size:O.fontSize},L.common[0]={lineHeight:O.fontSize};let U=0,G=0,X,W,V,q=0;const z=[];for(let K=0;K<B.length;K++){X||(X=settings.ADAPTER.createCanvas(),X.width=P,X.height=C,W=X.getContext("2d"),V=new BaseTexture(X,{resolution:I,...D}),z.push(new Texture(V)),L.page.push({id:z.length-1,file:""}));const it=B[K],et=TextMetrics.measureText(it,O,!1,X),Q=et.width,ot=Math.ceil(et.height),at=Math.ceil((O.fontStyle==="italic"?2:1)*Q);if(G>=C-ot*I){if(G===0)throw new Error(`[BitmapFont] textureHeight ${C}px is too small (fontFamily: '${O.fontFamily}', fontSize: ${O.fontSize}px, char: '${it}')`);--K,X=null,W=null,V=null,G=0,U=0,q=0;continue}if(q=Math.max(ot+et.fontProperties.descent,q),at*I+U>=F){if(U===0)throw new Error(`[BitmapFont] textureWidth ${P}px is too small (fontFamily: '${O.fontFamily}', fontSize: ${O.fontSize}px, char: '${it}')`);--K,G+=q*I,G=Math.ceil(G),U=0,q=0;continue}drawGlyph(X,W,et,U,G,I,O);const rt=extractCharCode(et.text);L.char.push({id:rt,page:z.length-1,x:U/I,y:G/I,width:at,height:ot,xoffset:0,yoffset:0,xadvance:Math.ceil(Q-(O.dropShadow?O.dropShadowDistance:0)-(O.stroke?O.strokeThickness:0))}),U+=(at+2*R)*I,U=Math.ceil(U)}for(let K=0,it=B.length;K<it;K++){const et=B[K];for(let Q=0;Q<it;Q++){const ot=B[Q],at=W.measureText(et).width,rt=W.measureText(ot).width,tt=W.measureText(et+ot).width-(at+rt);tt&&L.kerning.push({first:extractCharCode(et),second:extractCharCode(ot),amount:tt})}}const Y=new _BitmapFont(L,z,!0);return _BitmapFont.available[T]!==void 0&&_BitmapFont.uninstall(T),_BitmapFont.available[T]=Y,Y}};let BitmapFont=_BitmapFont;BitmapFont.ALPHA=[["a","z"],["A","Z"]," "];BitmapFont.NUMERIC=[["0","9"]];BitmapFont.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];BitmapFont.ASCII=[[" ","~"]];BitmapFont.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:_BitmapFont.ALPHANUMERIC};BitmapFont.available={};var msdfFrag=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r
\r
}\r
`,msdfVert=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const pageMeshDataDefaultPageMeshData=[],pageMeshDataMSDFPageMeshData=[],charRenderDataPool=[],_BitmapText=class extends Container{constructor(T,_={}){super(),this._tint=16777215;const{align:E,tint:A,maxWidth:R,letterSpacing:I,fontName:P,fontSize:C}=Object.assign({},_BitmapText.styleDefaults,_);if(!BitmapFont.available[P])throw new Error(`Missing BitmapFont "${P}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=E,this._tint=A,this._font=void 0,this._fontName=P,this._fontSize=C,this.text=T,this._maxWidth=R,this._maxLineHeight=0,this._letterSpacing=I,this._anchor=new ObservablePoint(()=>{this.dirty=!0},this,0,0),this._roundPixels=settings.ROUND_PIXELS,this.dirty=!0,this._resolution=settings.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var at;const T=BitmapFont.available[this._fontName],_=this.fontSize,E=_/T.size,A=new Point,R=[],I=[],P=[],C=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",D=splitTextToCharacters(C),B=this._maxWidth*T.size/_,O=T.distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;let F=null,L=0,U=0,G=0,X=-1,W=0,V=0,q=0,z=0;for(let rt=0;rt<D.length;rt++){const nt=D[rt],tt=extractCharCode(nt);if(/(?:\s)/.test(nt)&&(X=rt,W=L,z++),nt==="\r"||nt===`
`){I.push(L),P.push(-1),U=Math.max(U,L),++G,++V,A.x=0,A.y+=T.lineHeight,F=null,z=0;continue}const Z=T.chars[tt];if(!Z)continue;F&&Z.kerning[F]&&(A.x+=Z.kerning[F]);const ht=charRenderDataPool.pop()||{texture:Texture.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Point};ht.texture=Z.texture,ht.line=G,ht.charCode=tt,ht.position.x=A.x+Z.xOffset+this._letterSpacing/2,ht.position.y=A.y+Z.yOffset,ht.prevSpaces=z,R.push(ht),L=ht.position.x+Math.max(Z.xAdvance-Z.xOffset,Z.texture.orig.width),A.x+=Z.xAdvance+this._letterSpacing,q=Math.max(q,Z.yOffset+Z.texture.height),F=tt,X!==-1&&B>0&&A.x>B&&(++V,removeItems(R,1+X-V,1+rt-X),rt=X,X=-1,I.push(W),P.push(R.length>0?R[R.length-1].prevSpaces:0),U=Math.max(U,W),G++,A.x=0,A.y+=T.lineHeight,F=null,z=0)}const Y=D[D.length-1];Y!=="\r"&&Y!==`
`&&(/(?:\s)/.test(Y)&&(L=W),I.push(L),U=Math.max(U,L),P.push(-1));const K=[];for(let rt=0;rt<=G;rt++){let nt=0;this._align==="right"?nt=U-I[rt]:this._align==="center"?nt=(U-I[rt])/2:this._align==="justify"&&(nt=P[rt]<0?0:(U-I[rt])/P[rt]),K.push(nt)}const it=R.length,et={},Q=[],ot=this._activePagesMeshData;O.push(...ot);for(let rt=0;rt<it;rt++){const nt=R[rt].texture,tt=nt.baseTexture.uid;if(!et[tt]){let Z=O.pop();if(!Z){const ut=new MeshGeometry;let st,ft;T.distanceFieldType==="none"?(st=new MeshMaterial(Texture.EMPTY),ft=BLEND_MODES.NORMAL):(st=new MeshMaterial(Texture.EMPTY,{program:Program.from(msdfVert,msdfFrag),uniforms:{uFWidth:0}}),ft=BLEND_MODES.NORMAL_NPM);const yt=new Mesh(ut,st);yt.blendMode=ft,Z={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:yt,vertices:null,uvs:null,indices:null}}Z.index=0,Z.indexCount=0,Z.vertexCount=0,Z.uvsCount=0,Z.total=0;const{_textureCache:ht}=this;ht[tt]=ht[tt]||new Texture(nt.baseTexture),Z.mesh.texture=ht[tt],Z.mesh.tint=this._tint,Q.push(Z),et[tt]=Z}et[tt].total++}for(let rt=0;rt<ot.length;rt++)Q.includes(ot[rt])||this.removeChild(ot[rt].mesh);for(let rt=0;rt<Q.length;rt++)Q[rt].mesh.parent!==this&&this.addChild(Q[rt].mesh);this._activePagesMeshData=Q;for(const rt in et){const nt=et[rt],tt=nt.total;if(!(((at=nt.indices)==null?void 0:at.length)>6*tt)||nt.vertices.length<Mesh.BATCHABLE_SIZE*2)nt.vertices=new Float32Array(4*2*tt),nt.uvs=new Float32Array(4*2*tt),nt.indices=new Uint16Array(6*tt);else{const Z=nt.total,ht=nt.vertices;for(let ut=Z*4*2;ut<ht.length;ut++)ht[ut]=0}nt.mesh.size=6*tt}for(let rt=0;rt<it;rt++){const nt=R[rt];let tt=nt.position.x+K[nt.line]*(this._align==="justify"?nt.prevSpaces:1);this._roundPixels&&(tt=Math.round(tt));const Z=tt*E,ht=nt.position.y*E,ut=nt.texture,st=et[ut.baseTexture.uid],ft=ut.frame,yt=ut._uvs,J=st.index++;st.indices[J*6+0]=0+J*4,st.indices[J*6+1]=1+J*4,st.indices[J*6+2]=2+J*4,st.indices[J*6+3]=0+J*4,st.indices[J*6+4]=2+J*4,st.indices[J*6+5]=3+J*4,st.vertices[J*8+0]=Z,st.vertices[J*8+1]=ht,st.vertices[J*8+2]=Z+ft.width*E,st.vertices[J*8+3]=ht,st.vertices[J*8+4]=Z+ft.width*E,st.vertices[J*8+5]=ht+ft.height*E,st.vertices[J*8+6]=Z,st.vertices[J*8+7]=ht+ft.height*E,st.uvs[J*8+0]=yt.x0,st.uvs[J*8+1]=yt.y0,st.uvs[J*8+2]=yt.x1,st.uvs[J*8+3]=yt.y1,st.uvs[J*8+4]=yt.x2,st.uvs[J*8+5]=yt.y2,st.uvs[J*8+6]=yt.x3,st.uvs[J*8+7]=yt.y3}this._textWidth=U*E,this._textHeight=(A.y+T.lineHeight)*E;for(const rt in et){const nt=et[rt];if(this.anchor.x!==0||this.anchor.y!==0){let ut=0;const st=this._textWidth*this.anchor.x,ft=this._textHeight*this.anchor.y;for(let yt=0;yt<nt.total;yt++)nt.vertices[ut++]-=st,nt.vertices[ut++]-=ft,nt.vertices[ut++]-=st,nt.vertices[ut++]-=ft,nt.vertices[ut++]-=st,nt.vertices[ut++]-=ft,nt.vertices[ut++]-=st,nt.vertices[ut++]-=ft}this._maxLineHeight=q*E;const tt=nt.mesh.geometry.getBuffer("aVertexPosition"),Z=nt.mesh.geometry.getBuffer("aTextureCoord"),ht=nt.mesh.geometry.getIndex();tt.data=nt.vertices,Z.data=nt.uvs,ht.data=nt.indices,tt.update(),Z.update(),ht.update()}for(let rt=0;rt<R.length;rt++)charRenderDataPool.push(R[rt]);this._font=T,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(T){this._autoResolution&&this._resolution!==T.resolution&&(this._resolution=T.resolution,this.dirty=!0);const{distanceFieldRange:_,distanceFieldType:E,size:A}=BitmapFont.available[this._fontName];if(E!=="none"){const{a:R,b:I,c:P,d:C}=this.worldTransform,D=Math.sqrt(R*R+I*I),B=Math.sqrt(P*P+C*C),O=(Math.abs(D)+Math.abs(B))/2,F=this.fontSize/A,L=T._view.resolution;for(const U of this._activePagesMeshData)U.mesh.shader.uniforms.uFWidth=O*_*F*L}super._render(T)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const T=BitmapFont.available[this._fontName];if(!T)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==T&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(T){if(this._tint!==T){this._tint=T;for(let _=0;_<this._activePagesMeshData.length;_++)this._activePagesMeshData[_].mesh.tint=T}}get align(){return this._align}set align(T){this._align!==T&&(this._align=T,this.dirty=!0)}get fontName(){return this._fontName}set fontName(T){if(!BitmapFont.available[T])throw new Error(`Missing BitmapFont "${T}"`);this._fontName!==T&&(this._fontName=T,this.dirty=!0)}get fontSize(){var T;return(T=this._fontSize)!=null?T:BitmapFont.available[this._fontName].size}set fontSize(T){this._fontSize!==T&&(this._fontSize=T,this.dirty=!0)}get anchor(){return this._anchor}set anchor(T){typeof T=="number"?this._anchor.set(T):this._anchor.copyFrom(T)}get text(){return this._text}set text(T){T=String(T==null?"":T),this._text!==T&&(this._text=T,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(T){this._maxWidth!==T&&(this._maxWidth=T,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(T){this._letterSpacing!==T&&(this._letterSpacing=T,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(T){T!==this._roundPixels&&(this._roundPixels=T,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(T){this._autoResolution=!1,this._resolution!==T&&(this._resolution=T,this.dirty=!0)}destroy(T){const{_textureCache:_}=this,A=BitmapFont.available[this._fontName].distanceFieldType==="none"?pageMeshDataDefaultPageMeshData:pageMeshDataMSDFPageMeshData;A.push(...this._activePagesMeshData);for(const R of this._activePagesMeshData)this.removeChild(R.mesh);this._activePagesMeshData=[],A.filter(R=>_[R.mesh.texture.baseTexture.uid]).forEach(R=>{R.mesh.texture=Texture.EMPTY});for(const R in _)_[R].destroy(),delete _[R];this._font=null,this._textureCache=null,super.destroy(T)}};let BitmapText=_BitmapText;BitmapText.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const validExtensions=[".xml",".fnt"],loadBitmapFont={extension:{type:ExtensionType.LoadParser,priority:LoaderParserPriority.Normal},test(T){return validExtensions.includes(path.extname(T))},async testParse(T){return TextFormat.test(T)||XMLStringFormat.test(T)},async parse(T,_,E){const A=TextFormat.test(T)?TextFormat.parse(T):XMLStringFormat.parse(T),{src:R}=_,{page:I}=A,P=[];for(let B=0;B<I.length;++B){const O=I[B].file,F=path.join(path.dirname(R),O);P.push(F)}const C=await E.load(P),D=P.map(B=>C[B]);return BitmapFont.install(A,D,!0)},async load(T,_){return(await settings.ADAPTER.fetch(T)).text()},unload(T){T.destroy()}};extensions$1.add(loadBitmapFont);const subscriber_queue=[];function writable(T,_=noop$1){let E;const A=new Set;function R(C){if(safe_not_equal(T,C)&&(T=C,E)){const D=!subscriber_queue.length;for(const B of A)B[1](),subscriber_queue.push(B,T);if(D){for(let B=0;B<subscriber_queue.length;B+=2)subscriber_queue[B][0](subscriber_queue[B+1]);subscriber_queue.length=0}}}function I(C){R(C(T))}function P(C,D=noop$1){const B=[C,D];return A.add(B),A.size===1&&(E=_(R)||noop$1),C(T),()=>{A.delete(B),A.size===0&&(E(),E=null)}}return{set:R,update:I,subscribe:P}}var minimal$1={exports:{}},indexMinimal={},minimal={},aspromise=asPromise;function asPromise(T,_){for(var E=new Array(arguments.length-1),A=0,R=2,I=!0;R<arguments.length;)E[A++]=arguments[R++];return new Promise(function(C,D){E[A]=function(O){if(I)if(I=!1,O)D(O);else{for(var F=new Array(arguments.length-1),L=0;L<F.length;)F[L++]=arguments[L];C.apply(null,F)}};try{T.apply(_||null,E)}catch(B){I&&(I=!1,D(B))}})}var base64$1={};(function(T){var _=T;_.length=function(C){var D=C.length;if(!D)return 0;for(var B=0;--D%4>1&&C.charAt(D)==="=";)++B;return Math.ceil(C.length*3)/4-B};for(var E=new Array(64),A=new Array(123),R=0;R<64;)A[E[R]=R<26?R+65:R<52?R+71:R<62?R-4:R-59|43]=R++;_.encode=function(C,D,B){for(var O=null,F=[],L=0,U=0,G;D<B;){var X=C[D++];switch(U){case 0:F[L++]=E[X>>2],G=(X&3)<<4,U=1;break;case 1:F[L++]=E[G|X>>4],G=(X&15)<<2,U=2;break;case 2:F[L++]=E[G|X>>6],F[L++]=E[X&63],U=0;break}L>8191&&((O||(O=[])).push(String.fromCharCode.apply(String,F)),L=0)}return U&&(F[L++]=E[G],F[L++]=61,U===1&&(F[L++]=61)),O?(L&&O.push(String.fromCharCode.apply(String,F.slice(0,L))),O.join("")):String.fromCharCode.apply(String,F.slice(0,L))};var I="invalid encoding";_.decode=function(C,D,B){for(var O=B,F=0,L,U=0;U<C.length;){var G=C.charCodeAt(U++);if(G===61&&F>1)break;if((G=A[G])===void 0)throw Error(I);switch(F){case 0:L=G,F=1;break;case 1:D[B++]=L<<2|(G&48)>>4,L=G,F=2;break;case 2:D[B++]=(L&15)<<4|(G&60)>>2,L=G,F=3;break;case 3:D[B++]=(L&3)<<6|G,F=0;break}}if(F===1)throw Error(I);return B-O},_.test=function(C){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(C)}})(base64$1);var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(_,E,A){return(this._listeners[_]||(this._listeners[_]=[])).push({fn:E,ctx:A||this}),this};EventEmitter.prototype.off=function(_,E){if(_===void 0)this._listeners={};else if(E===void 0)this._listeners[_]=[];else for(var A=this._listeners[_],R=0;R<A.length;)A[R].fn===E?A.splice(R,1):++R;return this};EventEmitter.prototype.emit=function(_){var E=this._listeners[_];if(E){for(var A=[],R=1;R<arguments.length;)A.push(arguments[R++]);for(R=0;R<E.length;)E[R].fn.apply(E[R++].ctx,A)}return this};var float=factory(factory);function factory(T){return typeof Float32Array<"u"?function(){var _=new Float32Array([-0]),E=new Uint8Array(_.buffer),A=E[3]===128;function R(D,B,O){_[0]=D,B[O]=E[0],B[O+1]=E[1],B[O+2]=E[2],B[O+3]=E[3]}function I(D,B,O){_[0]=D,B[O]=E[3],B[O+1]=E[2],B[O+2]=E[1],B[O+3]=E[0]}T.writeFloatLE=A?R:I,T.writeFloatBE=A?I:R;function P(D,B){return E[0]=D[B],E[1]=D[B+1],E[2]=D[B+2],E[3]=D[B+3],_[0]}function C(D,B){return E[3]=D[B],E[2]=D[B+1],E[1]=D[B+2],E[0]=D[B+3],_[0]}T.readFloatLE=A?P:C,T.readFloatBE=A?C:P}():function(){function _(A,R,I,P){var C=R<0?1:0;if(C&&(R=-R),R===0)A(1/R>0?0:2147483648,I,P);else if(isNaN(R))A(2143289344,I,P);else if(R>34028234663852886e22)A((C<<31|2139095040)>>>0,I,P);else if(R<11754943508222875e-54)A((C<<31|Math.round(R/1401298464324817e-60))>>>0,I,P);else{var D=Math.floor(Math.log(R)/Math.LN2),B=Math.round(R*Math.pow(2,-D)*8388608)&8388607;A((C<<31|D+127<<23|B)>>>0,I,P)}}T.writeFloatLE=_.bind(null,writeUintLE),T.writeFloatBE=_.bind(null,writeUintBE);function E(A,R,I){var P=A(R,I),C=(P>>31)*2+1,D=P>>>23&255,B=P&8388607;return D===255?B?NaN:C*(1/0):D===0?C*1401298464324817e-60*B:C*Math.pow(2,D-150)*(B+8388608)}T.readFloatLE=E.bind(null,readUintLE),T.readFloatBE=E.bind(null,readUintBE)}(),typeof Float64Array<"u"?function(){var _=new Float64Array([-0]),E=new Uint8Array(_.buffer),A=E[7]===128;function R(D,B,O){_[0]=D,B[O]=E[0],B[O+1]=E[1],B[O+2]=E[2],B[O+3]=E[3],B[O+4]=E[4],B[O+5]=E[5],B[O+6]=E[6],B[O+7]=E[7]}function I(D,B,O){_[0]=D,B[O]=E[7],B[O+1]=E[6],B[O+2]=E[5],B[O+3]=E[4],B[O+4]=E[3],B[O+5]=E[2],B[O+6]=E[1],B[O+7]=E[0]}T.writeDoubleLE=A?R:I,T.writeDoubleBE=A?I:R;function P(D,B){return E[0]=D[B],E[1]=D[B+1],E[2]=D[B+2],E[3]=D[B+3],E[4]=D[B+4],E[5]=D[B+5],E[6]=D[B+6],E[7]=D[B+7],_[0]}function C(D,B){return E[7]=D[B],E[6]=D[B+1],E[5]=D[B+2],E[4]=D[B+3],E[3]=D[B+4],E[2]=D[B+5],E[1]=D[B+6],E[0]=D[B+7],_[0]}T.readDoubleLE=A?P:C,T.readDoubleBE=A?C:P}():function(){function _(A,R,I,P,C,D){var B=P<0?1:0;if(B&&(P=-P),P===0)A(0,C,D+R),A(1/P>0?0:2147483648,C,D+I);else if(isNaN(P))A(0,C,D+R),A(2146959360,C,D+I);else if(P>17976931348623157e292)A(0,C,D+R),A((B<<31|2146435072)>>>0,C,D+I);else{var O;if(P<22250738585072014e-324)O=P/5e-324,A(O>>>0,C,D+R),A((B<<31|O/4294967296)>>>0,C,D+I);else{var F=Math.floor(Math.log(P)/Math.LN2);F===1024&&(F=1023),O=P*Math.pow(2,-F),A(O*4503599627370496>>>0,C,D+R),A((B<<31|F+1023<<20|O*1048576&1048575)>>>0,C,D+I)}}}T.writeDoubleLE=_.bind(null,writeUintLE,0,4),T.writeDoubleBE=_.bind(null,writeUintBE,4,0);function E(A,R,I,P,C){var D=A(P,C+R),B=A(P,C+I),O=(B>>31)*2+1,F=B>>>20&2047,L=4294967296*(B&1048575)+D;return F===2047?L?NaN:O*(1/0):F===0?O*5e-324*L:O*Math.pow(2,F-1075)*(L+4503599627370496)}T.readDoubleLE=E.bind(null,readUintLE,0,4),T.readDoubleBE=E.bind(null,readUintBE,4,0)}(),T}function writeUintLE(T,_,E){_[E]=T&255,_[E+1]=T>>>8&255,_[E+2]=T>>>16&255,_[E+3]=T>>>24}function writeUintBE(T,_,E){_[E]=T>>>24,_[E+1]=T>>>16&255,_[E+2]=T>>>8&255,_[E+3]=T&255}function readUintLE(T,_){return(T[_]|T[_+1]<<8|T[_+2]<<16|T[_+3]<<24)>>>0}function readUintBE(T,_){return(T[_]<<24|T[_+1]<<16|T[_+2]<<8|T[_+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(T){}return null}var utf8$2={};(function(T){var _=T;_.length=function(A){for(var R=0,I=0,P=0;P<A.length;++P)I=A.charCodeAt(P),I<128?R+=1:I<2048?R+=2:(I&64512)===55296&&(A.charCodeAt(P+1)&64512)===56320?(++P,R+=4):R+=3;return R},_.read=function(A,R,I){var P=I-R;if(P<1)return"";for(var C=null,D=[],B=0,O;R<I;)O=A[R++],O<128?D[B++]=O:O>191&&O<224?D[B++]=(O&31)<<6|A[R++]&63:O>239&&O<365?(O=((O&7)<<18|(A[R++]&63)<<12|(A[R++]&63)<<6|A[R++]&63)-65536,D[B++]=55296+(O>>10),D[B++]=56320+(O&1023)):D[B++]=(O&15)<<12|(A[R++]&63)<<6|A[R++]&63,B>8191&&((C||(C=[])).push(String.fromCharCode.apply(String,D)),B=0);return C?(B&&C.push(String.fromCharCode.apply(String,D.slice(0,B))),C.join("")):String.fromCharCode.apply(String,D.slice(0,B))},_.write=function(A,R,I){for(var P=I,C,D,B=0;B<A.length;++B)C=A.charCodeAt(B),C<128?R[I++]=C:C<2048?(R[I++]=C>>6|192,R[I++]=C&63|128):(C&64512)===55296&&((D=A.charCodeAt(B+1))&64512)===56320?(C=65536+((C&1023)<<10)+(D&1023),++B,R[I++]=C>>18|240,R[I++]=C>>12&63|128,R[I++]=C>>6&63|128,R[I++]=C&63|128):(R[I++]=C>>12|224,R[I++]=C>>6&63|128,R[I++]=C&63|128);return I-P}})(utf8$2);var pool_1=pool;function pool(T,_,E){var A=E||8192,R=A>>>1,I=null,P=A;return function(D){if(D<1||D>R)return T(D);P+D>A&&(I=T(A),P=0);var B=_.call(I,P,P+=D);return P&7&&(P=(P|7)+1),B}}var longbits,hasRequiredLongbits;function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=_;var T=requireMinimal();function _(I,P){this.lo=I>>>0,this.hi=P>>>0}var E=_.zero=new _(0,0);E.toNumber=function(){return 0},E.zzEncode=E.zzDecode=function(){return this},E.length=function(){return 1};var A=_.zeroHash="\0\0\0\0\0\0\0\0";_.fromNumber=function(P){if(P===0)return E;var C=P<0;C&&(P=-P);var D=P>>>0,B=(P-D)/4294967296>>>0;return C&&(B=~B>>>0,D=~D>>>0,++D>4294967295&&(D=0,++B>4294967295&&(B=0))),new _(D,B)},_.from=function(P){if(typeof P=="number")return _.fromNumber(P);if(T.isString(P))if(T.Long)P=T.Long.fromString(P);else return _.fromNumber(parseInt(P,10));return P.low||P.high?new _(P.low>>>0,P.high>>>0):E},_.prototype.toNumber=function(P){if(!P&&this.hi>>>31){var C=~this.lo+1>>>0,D=~this.hi>>>0;return C||(D=D+1>>>0),-(C+D*4294967296)}return this.lo+this.hi*4294967296},_.prototype.toLong=function(P){return T.Long?new T.Long(this.lo|0,this.hi|0,Boolean(P)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(P)}};var R=String.prototype.charCodeAt;return _.fromHash=function(P){return P===A?E:new _((R.call(P,0)|R.call(P,1)<<8|R.call(P,2)<<16|R.call(P,3)<<24)>>>0,(R.call(P,4)|R.call(P,5)<<8|R.call(P,6)<<16|R.call(P,7)<<24)>>>0)},_.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},_.prototype.zzEncode=function(){var P=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^P)>>>0,this.lo=(this.lo<<1^P)>>>0,this},_.prototype.zzDecode=function(){var P=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^P)>>>0,this.hi=(this.hi>>>1^P)>>>0,this},_.prototype.length=function(){var P=this.lo,C=(this.lo>>>28|this.hi<<4)>>>0,D=this.hi>>>24;return D===0?C===0?P<16384?P<128?1:2:P<2097152?3:4:C<16384?C<128?5:6:C<2097152?7:8:D<128?9:10},longbits}var hasRequiredMinimal;function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(T){var _=T;_.asPromise=aspromise,_.base64=base64$1,_.EventEmitter=eventemitter,_.float=float,_.inquire=inquire_1,_.utf8=utf8$2,_.pool=pool_1,_.LongBits=requireLongbits(),_.isNode=Boolean(typeof commonjsGlobal<"u"&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),_.global=_.isNode&&commonjsGlobal||typeof window<"u"&&window||typeof self<"u"&&self||commonjsGlobal,_.emptyArray=Object.freeze?Object.freeze([]):[],_.emptyObject=Object.freeze?Object.freeze({}):{},_.isInteger=Number.isInteger||function(I){return typeof I=="number"&&isFinite(I)&&Math.floor(I)===I},_.isString=function(I){return typeof I=="string"||I instanceof String},_.isObject=function(I){return I&&typeof I=="object"},_.isset=_.isSet=function(I,P){var C=I[P];return C!=null&&I.hasOwnProperty(P)?typeof C!="object"||(Array.isArray(C)?C.length:Object.keys(C).length)>0:!1},_.Buffer=function(){try{var R=_.inquire("buffer").Buffer;return R.prototype.utf8Write?R:null}catch{return null}}(),_._Buffer_from=null,_._Buffer_allocUnsafe=null,_.newBuffer=function(I){return typeof I=="number"?_.Buffer?_._Buffer_allocUnsafe(I):new _.Array(I):_.Buffer?_._Buffer_from(I):typeof Uint8Array>"u"?I:new Uint8Array(I)},_.Array=typeof Uint8Array<"u"?Uint8Array:Array,_.Long=_.global.dcodeIO&&_.global.dcodeIO.Long||_.global.Long||_.inquire("long"),_.key2Re=/^true|false|0|1$/,_.key32Re=/^-?(?:0|[1-9][0-9]*)$/,_.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,_.longToHash=function(I){return I?_.LongBits.from(I).toHash():_.LongBits.zeroHash},_.longFromHash=function(I,P){var C=_.LongBits.fromHash(I);return _.Long?_.Long.fromBits(C.lo,C.hi,P):C.toNumber(Boolean(P))};function E(R,I,P){for(var C=Object.keys(I),D=0;D<C.length;++D)(R[C[D]]===void 0||!P)&&(R[C[D]]=I[C[D]]);return R}_.merge=E,_.lcFirst=function(I){return I.charAt(0).toLowerCase()+I.substring(1)};function A(R){function I(P,C){if(!(this instanceof I))return new I(P,C);Object.defineProperty(this,"message",{get:function(){return P}}),Error.captureStackTrace?Error.captureStackTrace(this,I):Object.defineProperty(this,"stack",{value:new Error().stack||""}),C&&E(this,C)}return I.prototype=Object.create(Error.prototype,{constructor:{value:I,writable:!0,enumerable:!1,configurable:!0},name:{get(){return R},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),I}_.newError=A,_.ProtocolError=A("ProtocolError"),_.oneOfGetter=function(I){for(var P={},C=0;C<I.length;++C)P[I[C]]=1;return function(){for(var D=Object.keys(this),B=D.length-1;B>-1;--B)if(P[D[B]]===1&&this[D[B]]!==void 0&&this[D[B]]!==null)return D[B]}},_.oneOfSetter=function(I){return function(P){for(var C=0;C<I.length;++C)I[C]!==P&&delete this[I[C]]}},_.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},_._configure=function(){var R=_.Buffer;if(!R){_._Buffer_from=_._Buffer_allocUnsafe=null;return}_._Buffer_from=R.from!==Uint8Array.from&&R.from||function(P,C){return new R(P,C)},_._Buffer_allocUnsafe=R.allocUnsafe||function(P){return new R(P)}}}(minimal)),minimal}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(T,_,E){this.fn=T,this.len=_,this.next=void 0,this.val=E}function noop(){}function State(T){this.head=T.head,this.tail=T.tail,this.len=T.len,this.next=T.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function T(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};Writer$1.create=create$1();Writer$1.alloc=function T(_){return new util$4.Array(_)};util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray));Writer$1.prototype._push=function T(_,E,A){return this.tail=this.tail.next=new Op(_,E,A),this.len+=E,this};function writeByte(T,_,E){_[E]=T&255}function writeVarint32(T,_,E){for(;T>127;)_[E++]=T&127|128,T>>>=7;_[E]=T}function VarintOp(T,_){this.len=T,this.next=void 0,this.val=_}VarintOp.prototype=Object.create(Op.prototype);VarintOp.prototype.fn=writeVarint32;Writer$1.prototype.uint32=function T(_){return this.len+=(this.tail=this.tail.next=new VarintOp((_=_>>>0)<128?1:_<16384?2:_<2097152?3:_<268435456?4:5,_)).len,this};Writer$1.prototype.int32=function T(_){return _<0?this._push(writeVarint64,10,LongBits$1.fromNumber(_)):this.uint32(_)};Writer$1.prototype.sint32=function T(_){return this.uint32((_<<1^_>>31)>>>0)};function writeVarint64(T,_,E){for(;T.hi;)_[E++]=T.lo&127|128,T.lo=(T.lo>>>7|T.hi<<25)>>>0,T.hi>>>=7;for(;T.lo>127;)_[E++]=T.lo&127|128,T.lo=T.lo>>>7;_[E++]=T.lo}Writer$1.prototype.uint64=function T(_){var E=LongBits$1.from(_);return this._push(writeVarint64,E.length(),E)};Writer$1.prototype.int64=Writer$1.prototype.uint64;Writer$1.prototype.sint64=function T(_){var E=LongBits$1.from(_).zzEncode();return this._push(writeVarint64,E.length(),E)};Writer$1.prototype.bool=function T(_){return this._push(writeByte,1,_?1:0)};function writeFixed32(T,_,E){_[E]=T&255,_[E+1]=T>>>8&255,_[E+2]=T>>>16&255,_[E+3]=T>>>24}Writer$1.prototype.fixed32=function T(_){return this._push(writeFixed32,4,_>>>0)};Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32;Writer$1.prototype.fixed64=function T(_){var E=LongBits$1.from(_);return this._push(writeFixed32,4,E.lo)._push(writeFixed32,4,E.hi)};Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64;Writer$1.prototype.float=function T(_){return this._push(util$4.float.writeFloatLE,4,_)};Writer$1.prototype.double=function T(_){return this._push(util$4.float.writeDoubleLE,8,_)};var writeBytes=util$4.Array.prototype.set?function T(_,E,A){E.set(_,A)}:function T(_,E,A){for(var R=0;R<_.length;++R)E[A+R]=_[R]};Writer$1.prototype.bytes=function T(_){var E=_.length>>>0;if(!E)return this._push(writeByte,1,0);if(util$4.isString(_)){var A=Writer$1.alloc(E=base64.length(_));base64.decode(_,A,0),_=A}return this.uint32(E)._push(writeBytes,E,_)};Writer$1.prototype.string=function T(_){var E=utf8$1.length(_);return E?this.uint32(E)._push(utf8$1.write,E,_):this._push(writeByte,1,0)};Writer$1.prototype.fork=function T(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this};Writer$1.prototype.reset=function T(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this};Writer$1.prototype.ldelim=function T(){var _=this.head,E=this.tail,A=this.len;return this.reset().uint32(A),A&&(this.tail.next=_.next,this.tail=E,this.len+=A),this};Writer$1.prototype.finish=function T(){for(var _=this.head.next,E=this.constructor.alloc(this.len),A=0;_;)_.fn(_.val,E,A),A+=_.len,_=_.next;return E};Writer$1._configure=function(T){BufferWriter$1=T,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&util$3.Buffer.prototype.set.name==="set"?function(_,E,A){E.set(_,A)}:function(_,E,A){if(_.copy)_.copy(E,A,0,_.length);else for(var R=0;R<_.length;)E[A++]=_[R++]}};BufferWriter.prototype.bytes=function T(_){util$3.isString(_)&&(_=util$3._Buffer_from(_,"base64"));var E=_.length>>>0;return this.uint32(E),E&&this._push(BufferWriter.writeBytesBuffer,E,_),this};function writeStringBuffer(T,_,E){T.length<40?util$3.utf8.write(T,_,E):_.utf8Write?_.utf8Write(T,E):_.write(T,E)}BufferWriter.prototype.string=function T(_){var E=util$3.Buffer.byteLength(_);return this.uint32(E),E&&this._push(writeStringBuffer,E,_),this};BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(T,_){return RangeError("index out of range: "+T.pos+" + "+(_||1)+" > "+T.len)}function Reader$1(T){this.buf=T,this.pos=0,this.len=T.length}var create_array=typeof Uint8Array<"u"?function T(_){if(_ instanceof Uint8Array||Array.isArray(_))return new Reader$1(_);throw Error("illegal buffer")}:function T(_){if(Array.isArray(_))return new Reader$1(_);throw Error("illegal buffer")},create=function T(){return util$2.Buffer?function(E){return(Reader$1.create=function(R){return util$2.Buffer.isBuffer(R)?new BufferReader$1(R):create_array(R)})(E)}:create_array};Reader$1.create=create();Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice;Reader$1.prototype.uint32=function T(){var _=4294967295;return function(){if(_=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(_=(_|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(_=(_|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return _;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return _}}();Reader$1.prototype.int32=function T(){return this.uint32()|0};Reader$1.prototype.sint32=function T(){var _=this.uint32();return _>>>1^-(_&1)|0};function readLongVarint(){var T=new LongBits(0,0),_=0;if(this.len-this.pos>4){for(;_<4;++_)if(T.lo=(T.lo|(this.buf[this.pos]&127)<<_*7)>>>0,this.buf[this.pos++]<128)return T;if(T.lo=(T.lo|(this.buf[this.pos]&127)<<28)>>>0,T.hi=(T.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return T;_=0}else{for(;_<3;++_){if(this.pos>=this.len)throw indexOutOfRange(this);if(T.lo=(T.lo|(this.buf[this.pos]&127)<<_*7)>>>0,this.buf[this.pos++]<128)return T}return T.lo=(T.lo|(this.buf[this.pos++]&127)<<_*7)>>>0,T}if(this.len-this.pos>4){for(;_<5;++_)if(T.hi=(T.hi|(this.buf[this.pos]&127)<<_*7+3)>>>0,this.buf[this.pos++]<128)return T}else for(;_<5;++_){if(this.pos>=this.len)throw indexOutOfRange(this);if(T.hi=(T.hi|(this.buf[this.pos]&127)<<_*7+3)>>>0,this.buf[this.pos++]<128)return T}throw Error("invalid varint encoding")}Reader$1.prototype.bool=function T(){return this.uint32()!==0};function readFixed32_end(T,_){return(T[_-4]|T[_-3]<<8|T[_-2]<<16|T[_-1]<<24)>>>0}Reader$1.prototype.fixed32=function T(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)};Reader$1.prototype.sfixed32=function T(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)|0};function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.prototype.float=function T(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var _=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,_};Reader$1.prototype.double=function T(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var _=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,_};Reader$1.prototype.bytes=function T(){var _=this.uint32(),E=this.pos,A=this.pos+_;if(A>this.len)throw indexOutOfRange(this,_);return this.pos+=_,Array.isArray(this.buf)?this.buf.slice(E,A):E===A?new this.buf.constructor(0):this._slice.call(this.buf,E,A)};Reader$1.prototype.string=function T(){var _=this.bytes();return utf8.read(_,0,_.length)};Reader$1.prototype.skip=function T(_){if(typeof _=="number"){if(this.pos+_>this.len)throw indexOutOfRange(this,_);this.pos+=_}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this};Reader$1.prototype.skipType=function(T){switch(T){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(T=this.uint32()&7)!==4;)this.skipType(T);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+T+" at offset "+this.pos)}return this};Reader$1._configure=function(T){BufferReader$1=T,Reader$1.create=create(),BufferReader$1._configure();var _=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[_](!1)},uint64:function(){return readLongVarint.call(this)[_](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[_](!1)},fixed64:function(){return readFixed64.call(this)[_](!0)},sfixed64:function(){return readFixed64.call(this)[_](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(T){Reader.call(this,T)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)};BufferReader.prototype.string=function T(){var _=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+_,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+_,this.len))};BufferReader._configure();var rpc={},service=Service,util=requireMinimal();(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service;function Service(T,_,E){if(typeof T!="function")throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=T,this.requestDelimited=Boolean(_),this.responseDelimited=Boolean(E)}Service.prototype.rpcCall=function T(_,E,A,R,I){if(!R)throw TypeError("request must be specified");var P=this;if(!I)return util.asPromise(T,P,_,E,A,R);if(!P.rpcImpl){setTimeout(function(){I(Error("already ended"))},0);return}try{return P.rpcImpl(_,E[P.requestDelimited?"encodeDelimited":"encode"](R).finish(),function(D,B){if(D)return P.emit("error",D,_),I(D);if(B===null){P.end(!0);return}if(!(B instanceof A))try{B=A[P.responseDelimited?"decodeDelimited":"decode"](B)}catch(O){return P.emit("error",O,_),I(O)}return P.emit("data",B,_),I(null,B)})}catch(C){P.emit("error",C,_),setTimeout(function(){I(C)},0);return}};Service.prototype.end=function T(_){return this.rpcImpl&&(_||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};(function(T){var _=T;_.Service=service})(rpc);var roots={};(function(T){var _=T;_.build="minimal",_.Writer=writer,_.BufferWriter=writer_buffer,_.Reader=reader,_.BufferReader=reader_buffer,_.util=requireMinimal(),_.rpc=rpc,_.roots=roots,_.configure=E;function E(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)}E()})(indexMinimal);(function(T){T.exports=indexMinimal})(minimal$1);var ClientMsgType;(function(T){T[T.join_lobby=0]="join_lobby",T[T.lobby_msg=1]="lobby_msg",T[T.create_lobby_game=2]="create_lobby_game",T[T.join_lobby_game=3]="join_lobby_game",T[T.leave_lobby_game=4]="leave_lobby_game",T[T.player_move=5]="player_move",T[T.leave_game=6]="leave_game",T[T.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ClientMsgType||(ClientMsgType={}));var ServerMsgType;(function(T){T[T.lobby_state=0]="lobby_state",T[T.player_msg=1]="player_msg",T[T.player_join_lobby=2]="player_join_lobby",T[T.player_leave_lobby=3]="player_leave_lobby",T[T.lobby_game_updated=4]="lobby_game_updated",T[T.player_join=5]="player_join",T[T.game_start=6]="game_start",T[T.game_end=7]="game_end",T[T.tick=8]="tick",T[T.player_left=9]="player_left",T[T.UNRECOGNIZED=-1]="UNRECOGNIZED"})(ServerMsgType||(ServerMsgType={}));var GameStatus;(function(T){T[T.WAITING=0]="WAITING",T[T.RUNNING=1]="RUNNING",T[T.PLAYER_WON=2]="PLAYER_WON",T[T.AI_WON=3]="AI_WON",T[T.TIE=4]="TIE",T[T.UNRECOGNIZED=-1]="UNRECOGNIZED"})(GameStatus||(GameStatus={}));function gameStatusFromJSON(T){switch(T){case 0:case"WAITING":return GameStatus.WAITING;case 1:case"RUNNING":return GameStatus.RUNNING;case 2:case"PLAYER_WON":return GameStatus.PLAYER_WON;case 3:case"AI_WON":return GameStatus.AI_WON;case 4:case"TIE":return GameStatus.TIE;case-1:case"UNRECOGNIZED":default:return GameStatus.UNRECOGNIZED}}function gameStatusToJSON(T){switch(T){case GameStatus.WAITING:return"WAITING";case GameStatus.RUNNING:return"RUNNING";case GameStatus.PLAYER_WON:return"PLAYER_WON";case GameStatus.AI_WON:return"AI_WON";case GameStatus.TIE:return"TIE";case GameStatus.UNRECOGNIZED:default:return"UNRECOGNIZED"}}function createBasePlayer(){return{id:0,clientId:0,playerNumber:0,name:"",color:0,cursor:void 0,dead:!1}}const Player={encode(T,_=minimal$1.exports.Writer.create()){return T.id!==0&&_.uint32(8).uint32(T.id),T.clientId!==0&&_.uint32(16).uint32(T.clientId),T.playerNumber!==0&&_.uint32(24).uint32(T.playerNumber),T.name!==""&&_.uint32(34).string(T.name),T.color!==0&&_.uint32(40).uint32(T.color),T.cursor!==void 0&&Cursor.encode(T.cursor,_.uint32(50).fork()).ldelim(),T.dead===!0&&_.uint32(56).bool(T.dead),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBasePlayer();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.id=E.uint32();break;case 2:R.clientId=E.uint32();break;case 3:R.playerNumber=E.uint32();break;case 4:R.name=E.string();break;case 5:R.color=E.uint32();break;case 6:R.cursor=Cursor.decode(E,E.uint32());break;case 7:R.dead=E.bool();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{id:isSet(T.id)?Number(T.id):0,clientId:isSet(T.clientId)?Number(T.clientId):0,playerNumber:isSet(T.playerNumber)?Number(T.playerNumber):0,name:isSet(T.name)?String(T.name):"",color:isSet(T.color)?Number(T.color):0,cursor:isSet(T.cursor)?Cursor.fromJSON(T.cursor):void 0,dead:isSet(T.dead)?Boolean(T.dead):!1}},toJSON(T){const _={};return T.id!==void 0&&(_.id=Math.round(T.id)),T.clientId!==void 0&&(_.clientId=Math.round(T.clientId)),T.playerNumber!==void 0&&(_.playerNumber=Math.round(T.playerNumber)),T.name!==void 0&&(_.name=T.name),T.color!==void 0&&(_.color=Math.round(T.color)),T.cursor!==void 0&&(_.cursor=T.cursor?Cursor.toJSON(T.cursor):void 0),T.dead!==void 0&&(_.dead=T.dead),_},fromPartial(T){var _,E,A,R,I,P;const C=createBasePlayer();return C.id=(_=T.id)!==null&&_!==void 0?_:0,C.clientId=(E=T.clientId)!==null&&E!==void 0?E:0,C.playerNumber=(A=T.playerNumber)!==null&&A!==void 0?A:0,C.name=(R=T.name)!==null&&R!==void 0?R:"",C.color=(I=T.color)!==null&&I!==void 0?I:0,C.cursor=T.cursor!==void 0&&T.cursor!==null?Cursor.fromPartial(T.cursor):void 0,C.dead=(P=T.dead)!==null&&P!==void 0?P:!1,C}};function createBaseCursor(){return{player:0,x:0,y:0}}const Cursor={encode(T,_=minimal$1.exports.Writer.create()){return T.player!==0&&_.uint32(8).uint32(T.player),T.x!==0&&_.uint32(16).uint32(T.x),T.y!==0&&_.uint32(24).uint32(T.y),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseCursor();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.player=E.uint32();break;case 2:R.x=E.uint32();break;case 3:R.y=E.uint32();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{player:isSet(T.player)?Number(T.player):0,x:isSet(T.x)?Number(T.x):0,y:isSet(T.y)?Number(T.y):0}},toJSON(T){const _={};return T.player!==void 0&&(_.player=Math.round(T.player)),T.x!==void 0&&(_.x=Math.round(T.x)),T.y!==void 0&&(_.y=Math.round(T.y)),_},fromPartial(T){var _,E,A;const R=createBaseCursor();return R.player=(_=T.player)!==null&&_!==void 0?_:0,R.x=(E=T.x)!==null&&E!==void 0?E:0,R.y=(A=T.y)!==null&&A!==void 0?A:0,R}};function createBaseBallOwner(){return{player:0,percentage:0}}const BallOwner={encode(T,_=minimal$1.exports.Writer.create()){return T.player!==0&&_.uint32(8).uint32(T.player),T.percentage!==0&&_.uint32(21).float(T.percentage),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseBallOwner();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.player=E.uint32();break;case 2:R.percentage=E.float();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{player:isSet(T.player)?Number(T.player):0,percentage:isSet(T.percentage)?Number(T.percentage):0}},toJSON(T){const _={};return T.player!==void 0&&(_.player=Math.round(T.player)),T.percentage!==void 0&&(_.percentage=T.percentage),_},fromPartial(T){var _,E;const A=createBaseBallOwner();return A.player=(_=T.player)!==null&&_!==void 0?_:0,A.percentage=(E=T.percentage)!==null&&E!==void 0?E:0,A}};function createBaseBall(){return{player:0,color:0,x:0,y:0,radius:0,owners:[]}}const Ball={encode(T,_=minimal$1.exports.Writer.create()){T.player!==0&&_.uint32(8).uint32(T.player),T.color!==0&&_.uint32(16).uint32(T.color),T.x!==0&&_.uint32(29).float(T.x),T.y!==0&&_.uint32(37).float(T.y),T.radius!==0&&_.uint32(45).float(T.radius);for(const E of T.owners)BallOwner.encode(E,_.uint32(50).fork()).ldelim();return _},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseBall();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.player=E.uint32();break;case 2:R.color=E.uint32();break;case 3:R.x=E.float();break;case 4:R.y=E.float();break;case 5:R.radius=E.float();break;case 6:R.owners.push(BallOwner.decode(E,E.uint32()));break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{player:isSet(T.player)?Number(T.player):0,color:isSet(T.color)?Number(T.color):0,x:isSet(T.x)?Number(T.x):0,y:isSet(T.y)?Number(T.y):0,radius:isSet(T.radius)?Number(T.radius):0,owners:Array.isArray(T==null?void 0:T.owners)?T.owners.map(_=>BallOwner.fromJSON(_)):[]}},toJSON(T){const _={};return T.player!==void 0&&(_.player=Math.round(T.player)),T.color!==void 0&&(_.color=Math.round(T.color)),T.x!==void 0&&(_.x=T.x),T.y!==void 0&&(_.y=T.y),T.radius!==void 0&&(_.radius=T.radius),T.owners?_.owners=T.owners.map(E=>E?BallOwner.toJSON(E):void 0):_.owners=[],_},fromPartial(T){var _,E,A,R,I,P;const C=createBaseBall();return C.player=(_=T.player)!==null&&_!==void 0?_:0,C.color=(E=T.color)!==null&&E!==void 0?E:0,C.x=(A=T.x)!==null&&A!==void 0?A:0,C.y=(R=T.y)!==null&&R!==void 0?R:0,C.radius=(I=T.radius)!==null&&I!==void 0?I:0,C.owners=((P=T.owners)===null||P===void 0?void 0:P.map(D=>BallOwner.fromPartial(D)))||[],C}};function createBaseRect(){return{x:0,y:0,width:0,height:0,rotation:0}}const Rect={encode(T,_=minimal$1.exports.Writer.create()){return T.x!==0&&_.uint32(21).float(T.x),T.y!==0&&_.uint32(29).float(T.y),T.width!==0&&_.uint32(37).float(T.width),T.height!==0&&_.uint32(45).float(T.height),T.rotation!==0&&_.uint32(53).float(T.rotation),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseRect();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 2:R.x=E.float();break;case 3:R.y=E.float();break;case 4:R.width=E.float();break;case 5:R.height=E.float();break;case 6:R.rotation=E.float();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{x:isSet(T.x)?Number(T.x):0,y:isSet(T.y)?Number(T.y):0,width:isSet(T.width)?Number(T.width):0,height:isSet(T.height)?Number(T.height):0,rotation:isSet(T.rotation)?Number(T.rotation):0}},toJSON(T){const _={};return T.x!==void 0&&(_.x=T.x),T.y!==void 0&&(_.y=T.y),T.width!==void 0&&(_.width=T.width),T.height!==void 0&&(_.height=T.height),T.rotation!==void 0&&(_.rotation=T.rotation),_},fromPartial(T){var _,E,A,R,I;const P=createBaseRect();return P.x=(_=T.x)!==null&&_!==void 0?_:0,P.y=(E=T.y)!==null&&E!==void 0?E:0,P.width=(A=T.width)!==null&&A!==void 0?A:0,P.height=(R=T.height)!==null&&R!==void 0?R:0,P.rotation=(I=T.rotation)!==null&&I!==void 0?I:0,P}};function createBaseLobbyGame(){return{gameId:"",players:0,maxPlayers:0}}const LobbyGame={encode(T,_=minimal$1.exports.Writer.create()){return T.gameId!==""&&_.uint32(10).string(T.gameId),T.players!==0&&_.uint32(16).uint32(T.players),T.maxPlayers!==0&&_.uint32(24).uint32(T.maxPlayers),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseLobbyGame();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.players=E.uint32();break;case 3:R.maxPlayers=E.uint32();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):"",players:isSet(T.players)?Number(T.players):0,maxPlayers:isSet(T.maxPlayers)?Number(T.maxPlayers):0}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.players!==void 0&&(_.players=Math.round(T.players)),T.maxPlayers!==void 0&&(_.maxPlayers=Math.round(T.maxPlayers)),_},fromPartial(T){var _,E,A;const R=createBaseLobbyGame();return R.gameId=(_=T.gameId)!==null&&_!==void 0?_:"",R.players=(E=T.players)!==null&&E!==void 0?E:0,R.maxPlayers=(A=T.maxPlayers)!==null&&A!==void 0?A:0,R}};function createBaseLobbyPlayer(){return{playerId:0,name:""}}const LobbyPlayer={encode(T,_=minimal$1.exports.Writer.create()){return T.playerId!==0&&_.uint32(16).uint32(T.playerId),T.name!==""&&_.uint32(26).string(T.name),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseLobbyPlayer();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 2:R.playerId=E.uint32();break;case 3:R.name=E.string();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{playerId:isSet(T.playerId)?Number(T.playerId):0,name:isSet(T.name)?String(T.name):""}},toJSON(T){const _={};return T.playerId!==void 0&&(_.playerId=Math.round(T.playerId)),T.name!==void 0&&(_.name=T.name),_},fromPartial(T){var _,E;const A=createBaseLobbyPlayer();return A.playerId=(_=T.playerId)!==null&&_!==void 0?_:0,A.name=(E=T.name)!==null&&E!==void 0?E:"",A}};function createBaseLobbyState(){return{games:[],players:[]}}const LobbyState={encode(T,_=minimal$1.exports.Writer.create()){for(const E of T.games)LobbyGame.encode(E,_.uint32(10).fork()).ldelim();for(const E of T.players)LobbyPlayer.encode(E,_.uint32(18).fork()).ldelim();return _},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseLobbyState();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.games.push(LobbyGame.decode(E,E.uint32()));break;case 2:R.players.push(LobbyPlayer.decode(E,E.uint32()));break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{games:Array.isArray(T==null?void 0:T.games)?T.games.map(_=>LobbyGame.fromJSON(_)):[],players:Array.isArray(T==null?void 0:T.players)?T.players.map(_=>LobbyPlayer.fromJSON(_)):[]}},toJSON(T){const _={};return T.games?_.games=T.games.map(E=>E?LobbyGame.toJSON(E):void 0):_.games=[],T.players?_.players=T.players.map(E=>E?LobbyPlayer.toJSON(E):void 0):_.players=[],_},fromPartial(T){var _,E;const A=createBaseLobbyState();return A.games=((_=T.games)===null||_===void 0?void 0:_.map(R=>LobbyGame.fromPartial(R)))||[],A.players=((E=T.players)===null||E===void 0?void 0:E.map(R=>LobbyPlayer.fromPartial(R)))||[],A}};function createBaseGameStart(){return{gameId:"",players:[],balls:[],rects:[]}}const GameStart={encode(T,_=minimal$1.exports.Writer.create()){T.gameId!==""&&_.uint32(10).string(T.gameId);for(const E of T.players)Player.encode(E,_.uint32(18).fork()).ldelim();for(const E of T.balls)Ball.encode(E,_.uint32(26).fork()).ldelim();for(const E of T.rects)Rect.encode(E,_.uint32(34).fork()).ldelim();return _},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseGameStart();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.players.push(Player.decode(E,E.uint32()));break;case 3:R.balls.push(Ball.decode(E,E.uint32()));break;case 4:R.rects.push(Rect.decode(E,E.uint32()));break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):"",players:Array.isArray(T==null?void 0:T.players)?T.players.map(_=>Player.fromJSON(_)):[],balls:Array.isArray(T==null?void 0:T.balls)?T.balls.map(_=>Ball.fromJSON(_)):[],rects:Array.isArray(T==null?void 0:T.rects)?T.rects.map(_=>Rect.fromJSON(_)):[]}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.players?_.players=T.players.map(E=>E?Player.toJSON(E):void 0):_.players=[],T.balls?_.balls=T.balls.map(E=>E?Ball.toJSON(E):void 0):_.balls=[],T.rects?_.rects=T.rects.map(E=>E?Rect.toJSON(E):void 0):_.rects=[],_},fromPartial(T){var _,E,A,R;const I=createBaseGameStart();return I.gameId=(_=T.gameId)!==null&&_!==void 0?_:"",I.players=((E=T.players)===null||E===void 0?void 0:E.map(P=>Player.fromPartial(P)))||[],I.balls=((A=T.balls)===null||A===void 0?void 0:A.map(P=>Ball.fromPartial(P)))||[],I.rects=((R=T.rects)===null||R===void 0?void 0:R.map(P=>Rect.fromPartial(P)))||[],I}};function createBaseGameEnd(){return{gameId:"",result:0,winner:void 0}}const GameEnd={encode(T,_=minimal$1.exports.Writer.create()){return T.gameId!==""&&_.uint32(10).string(T.gameId),T.result!==0&&_.uint32(16).int32(T.result),T.winner!==void 0&&Player.encode(T.winner,_.uint32(26).fork()).ldelim(),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseGameEnd();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.result=E.int32();break;case 3:R.winner=Player.decode(E,E.uint32());break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):"",result:isSet(T.result)?gameStatusFromJSON(T.result):0,winner:isSet(T.winner)?Player.fromJSON(T.winner):void 0}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.result!==void 0&&(_.result=gameStatusToJSON(T.result)),T.winner!==void 0&&(_.winner=T.winner?Player.toJSON(T.winner):void 0),_},fromPartial(T){var _,E;const A=createBaseGameEnd();return A.gameId=(_=T.gameId)!==null&&_!==void 0?_:"",A.result=(E=T.result)!==null&&E!==void 0?E:0,A.winner=T.winner!==void 0&&T.winner!==null?Player.fromPartial(T.winner):void 0,A}};function createBaseTick(){return{gameId:"",cursors:[],balls:[]}}const Tick={encode(T,_=minimal$1.exports.Writer.create()){T.gameId!==""&&_.uint32(10).string(T.gameId);for(const E of T.cursors)Cursor.encode(E,_.uint32(18).fork()).ldelim();for(const E of T.balls)Ball.encode(E,_.uint32(26).fork()).ldelim();return _},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseTick();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.cursors.push(Cursor.decode(E,E.uint32()));break;case 3:R.balls.push(Ball.decode(E,E.uint32()));break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):"",cursors:Array.isArray(T==null?void 0:T.cursors)?T.cursors.map(_=>Cursor.fromJSON(_)):[],balls:Array.isArray(T==null?void 0:T.balls)?T.balls.map(_=>Ball.fromJSON(_)):[]}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.cursors?_.cursors=T.cursors.map(E=>E?Cursor.toJSON(E):void 0):_.cursors=[],T.balls?_.balls=T.balls.map(E=>E?Ball.toJSON(E):void 0):_.balls=[],_},fromPartial(T){var _,E,A;const R=createBaseTick();return R.gameId=(_=T.gameId)!==null&&_!==void 0?_:"",R.cursors=((E=T.cursors)===null||E===void 0?void 0:E.map(I=>Cursor.fromPartial(I)))||[],R.balls=((A=T.balls)===null||A===void 0?void 0:A.map(I=>Ball.fromPartial(I)))||[],R}};function createBaseGameOptions(){return{serverTickRate:0,liquidPerPlayer:0,cursorSpeed:0,players:0}}const GameOptions={encode(T,_=minimal$1.exports.Writer.create()){return T.serverTickRate!==0&&_.uint32(8).uint32(T.serverTickRate),T.liquidPerPlayer!==0&&_.uint32(16).uint32(T.liquidPerPlayer),T.cursorSpeed!==0&&_.uint32(24).uint32(T.cursorSpeed),T.players!==0&&_.uint32(32).uint32(T.players),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBaseGameOptions();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.serverTickRate=E.uint32();break;case 2:R.liquidPerPlayer=E.uint32();break;case 3:R.cursorSpeed=E.uint32();break;case 4:R.players=E.uint32();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{serverTickRate:isSet(T.serverTickRate)?Number(T.serverTickRate):0,liquidPerPlayer:isSet(T.liquidPerPlayer)?Number(T.liquidPerPlayer):0,cursorSpeed:isSet(T.cursorSpeed)?Number(T.cursorSpeed):0,players:isSet(T.players)?Number(T.players):0}},toJSON(T){const _={};return T.serverTickRate!==void 0&&(_.serverTickRate=Math.round(T.serverTickRate)),T.liquidPerPlayer!==void 0&&(_.liquidPerPlayer=Math.round(T.liquidPerPlayer)),T.cursorSpeed!==void 0&&(_.cursorSpeed=Math.round(T.cursorSpeed)),T.players!==void 0&&(_.players=Math.round(T.players)),_},fromPartial(T){var _,E,A,R;const I=createBaseGameOptions();return I.serverTickRate=(_=T.serverTickRate)!==null&&_!==void 0?_:0,I.liquidPerPlayer=(E=T.liquidPerPlayer)!==null&&E!==void 0?E:0,I.cursorSpeed=(A=T.cursorSpeed)!==null&&A!==void 0?A:0,I.players=(R=T.players)!==null&&R!==void 0?R:0,I}};function createBasePlayerJoinLobby(){return{playerId:0,name:""}}const PlayerJoinLobby={encode(T,_=minimal$1.exports.Writer.create()){return T.playerId!==0&&_.uint32(8).uint32(T.playerId),T.name!==""&&_.uint32(18).string(T.name),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBasePlayerJoinLobby();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.playerId=E.uint32();break;case 2:R.name=E.string();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{playerId:isSet(T.playerId)?Number(T.playerId):0,name:isSet(T.name)?String(T.name):""}},toJSON(T){const _={};return T.playerId!==void 0&&(_.playerId=Math.round(T.playerId)),T.name!==void 0&&(_.name=T.name),_},fromPartial(T){var _,E;const A=createBasePlayerJoinLobby();return A.playerId=(_=T.playerId)!==null&&_!==void 0?_:0,A.name=(E=T.name)!==null&&E!==void 0?E:"",A}};function createBasePlayerCreateGame(){return{playerId:0,name:"",color:"",options:void 0}}const PlayerCreateGame={encode(T,_=minimal$1.exports.Writer.create()){return T.playerId!==0&&_.uint32(8).uint32(T.playerId),T.name!==""&&_.uint32(18).string(T.name),T.color!==""&&_.uint32(26).string(T.color),T.options!==void 0&&GameOptions.encode(T.options,_.uint32(34).fork()).ldelim(),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBasePlayerCreateGame();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.playerId=E.uint32();break;case 2:R.name=E.string();break;case 3:R.color=E.string();break;case 4:R.options=GameOptions.decode(E,E.uint32());break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{playerId:isSet(T.playerId)?Number(T.playerId):0,name:isSet(T.name)?String(T.name):"",color:isSet(T.color)?String(T.color):"",options:isSet(T.options)?GameOptions.fromJSON(T.options):void 0}},toJSON(T){const _={};return T.playerId!==void 0&&(_.playerId=Math.round(T.playerId)),T.name!==void 0&&(_.name=T.name),T.color!==void 0&&(_.color=T.color),T.options!==void 0&&(_.options=T.options?GameOptions.toJSON(T.options):void 0),_},fromPartial(T){var _,E,A;const R=createBasePlayerCreateGame();return R.playerId=(_=T.playerId)!==null&&_!==void 0?_:0,R.name=(E=T.name)!==null&&E!==void 0?E:"",R.color=(A=T.color)!==null&&A!==void 0?A:"",R.options=T.options!==void 0&&T.options!==null?GameOptions.fromPartial(T.options):void 0,R}};function createBasePlayerJoinGame(){return{gameId:void 0,playerId:0,name:"",color:"",options:void 0}}const PlayerJoinGame={encode(T,_=minimal$1.exports.Writer.create()){return T.gameId!==void 0&&_.uint32(10).string(T.gameId),T.playerId!==0&&_.uint32(16).uint32(T.playerId),T.name!==""&&_.uint32(26).string(T.name),T.color!==""&&_.uint32(34).string(T.color),T.options!==void 0&&GameOptions.encode(T.options,_.uint32(42).fork()).ldelim(),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBasePlayerJoinGame();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.playerId=E.uint32();break;case 3:R.name=E.string();break;case 4:R.color=E.string();break;case 5:R.options=GameOptions.decode(E,E.uint32());break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):void 0,playerId:isSet(T.playerId)?Number(T.playerId):0,name:isSet(T.name)?String(T.name):"",color:isSet(T.color)?String(T.color):"",options:isSet(T.options)?GameOptions.fromJSON(T.options):void 0}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.playerId!==void 0&&(_.playerId=Math.round(T.playerId)),T.name!==void 0&&(_.name=T.name),T.color!==void 0&&(_.color=T.color),T.options!==void 0&&(_.options=T.options?GameOptions.toJSON(T.options):void 0),_},fromPartial(T){var _,E,A,R;const I=createBasePlayerJoinGame();return I.gameId=(_=T.gameId)!==null&&_!==void 0?_:void 0,I.playerId=(E=T.playerId)!==null&&E!==void 0?E:0,I.name=(A=T.name)!==null&&A!==void 0?A:"",I.color=(R=T.color)!==null&&R!==void 0?R:"",I.options=T.options!==void 0&&T.options!==null?GameOptions.fromPartial(T.options):void 0,I}};function createBasePlayerMove(){return{gameId:"",playerNumber:0,mouseX:0,mouseY:0}}const PlayerMove={encode(T,_=minimal$1.exports.Writer.create()){return T.gameId!==""&&_.uint32(10).string(T.gameId),T.playerNumber!==0&&_.uint32(16).uint32(T.playerNumber),T.mouseX!==0&&_.uint32(24).uint32(T.mouseX),T.mouseY!==0&&_.uint32(32).uint32(T.mouseY),_},decode(T,_){const E=T instanceof minimal$1.exports.Reader?T:new minimal$1.exports.Reader(T);let A=_===void 0?E.len:E.pos+_;const R=createBasePlayerMove();for(;E.pos<A;){const I=E.uint32();switch(I>>>3){case 1:R.gameId=E.string();break;case 2:R.playerNumber=E.uint32();break;case 3:R.mouseX=E.uint32();break;case 4:R.mouseY=E.uint32();break;default:E.skipType(I&7);break}}return R},fromJSON(T){return{gameId:isSet(T.gameId)?String(T.gameId):"",playerNumber:isSet(T.playerNumber)?Number(T.playerNumber):0,mouseX:isSet(T.mouseX)?Number(T.mouseX):0,mouseY:isSet(T.mouseY)?Number(T.mouseY):0}},toJSON(T){const _={};return T.gameId!==void 0&&(_.gameId=T.gameId),T.playerNumber!==void 0&&(_.playerNumber=Math.round(T.playerNumber)),T.mouseX!==void 0&&(_.mouseX=Math.round(T.mouseX)),T.mouseY!==void 0&&(_.mouseY=Math.round(T.mouseY)),_},fromPartial(T){var _,E,A,R;const I=createBasePlayerMove();return I.gameId=(_=T.gameId)!==null&&_!==void 0?_:"",I.playerNumber=(E=T.playerNumber)!==null&&E!==void 0?E:0,I.mouseX=(A=T.mouseX)!==null&&A!==void 0?A:0,I.mouseY=(R=T.mouseY)!==null&&R!==void 0?R:0,I}};function isSet(T){return T!=null}const getEnv=T=>{if(!T)throw new Error("Undefined environment variable!");return T},WS_URL=getEnv("wss://liquid-war.fly.dev");var browser={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var T=1e3,_=T*60,E=_*60,A=E*24,R=A*7,I=A*365.25;ms=function(O,F){F=F||{};var L=typeof O;if(L==="string"&&O.length>0)return P(O);if(L==="number"&&isFinite(O))return F.long?D(O):C(O);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(O))};function P(O){if(O=String(O),!(O.length>100)){var F=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(O);if(!!F){var L=parseFloat(F[1]),U=(F[2]||"ms").toLowerCase();switch(U){case"years":case"year":case"yrs":case"yr":case"y":return L*I;case"weeks":case"week":case"w":return L*R;case"days":case"day":case"d":return L*A;case"hours":case"hour":case"hrs":case"hr":case"h":return L*E;case"minutes":case"minute":case"mins":case"min":case"m":return L*_;case"seconds":case"second":case"secs":case"sec":case"s":return L*T;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return L;default:return}}}}function C(O){var F=Math.abs(O);return F>=A?Math.round(O/A)+"d":F>=E?Math.round(O/E)+"h":F>=_?Math.round(O/_)+"m":F>=T?Math.round(O/T)+"s":O+"ms"}function D(O){var F=Math.abs(O);return F>=A?B(O,F,A,"day"):F>=E?B(O,F,E,"hour"):F>=_?B(O,F,_,"minute"):F>=T?B(O,F,T,"second"):O+" ms"}function B(O,F,L,U){var G=F>=L*1.5;return Math.round(O/L)+" "+U+(G?"s":"")}return ms}function setup(T){E.debug=E,E.default=E,E.coerce=D,E.disable=I,E.enable=R,E.enabled=P,E.humanize=requireMs(),E.destroy=B,Object.keys(T).forEach(O=>{E[O]=T[O]}),E.names=[],E.skips=[],E.formatters={};function _(O){let F=0;for(let L=0;L<O.length;L++)F=(F<<5)-F+O.charCodeAt(L),F|=0;return E.colors[Math.abs(F)%E.colors.length]}E.selectColor=_;function E(O){let F,L=null,U,G;function X(...W){if(!X.enabled)return;const V=X,q=Number(new Date),z=q-(F||q);V.diff=z,V.prev=F,V.curr=q,F=q,W[0]=E.coerce(W[0]),typeof W[0]!="string"&&W.unshift("%O");let Y=0;W[0]=W[0].replace(/%([a-zA-Z%])/g,(it,et)=>{if(it==="%%")return"%";Y++;const Q=E.formatters[et];if(typeof Q=="function"){const ot=W[Y];it=Q.call(V,ot),W.splice(Y,1),Y--}return it}),E.formatArgs.call(V,W),(V.log||E.log).apply(V,W)}return X.namespace=O,X.useColors=E.useColors(),X.color=E.selectColor(O),X.extend=A,X.destroy=E.destroy,Object.defineProperty(X,"enabled",{enumerable:!0,configurable:!1,get:()=>L!==null?L:(U!==E.namespaces&&(U=E.namespaces,G=E.enabled(O)),G),set:W=>{L=W}}),typeof E.init=="function"&&E.init(X),X}function A(O,F){const L=E(this.namespace+(typeof F>"u"?":":F)+O);return L.log=this.log,L}function R(O){E.save(O),E.namespaces=O,E.names=[],E.skips=[];let F;const L=(typeof O=="string"?O:"").split(/[\s,]+/),U=L.length;for(F=0;F<U;F++)!L[F]||(O=L[F].replace(/\*/g,".*?"),O[0]==="-"?E.skips.push(new RegExp("^"+O.slice(1)+"$")):E.names.push(new RegExp("^"+O+"$")))}function I(){const O=[...E.names.map(C),...E.skips.map(C).map(F=>"-"+F)].join(",");return E.enable(""),O}function P(O){if(O[O.length-1]==="*")return!0;let F,L;for(F=0,L=E.skips.length;F<L;F++)if(E.skips[F].test(O))return!1;for(F=0,L=E.names.length;F<L;F++)if(E.names[F].test(O))return!0;return!1}function C(O){return O.toString().substring(2,O.toString().length-2).replace(/\.\*\?$/,"*")}function D(O){return O instanceof Error?O.stack||O.message:O}function B(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return E.enable(E.load()),E}var common=setup;(function(T,_){_.formatArgs=A,_.save=R,_.load=I,_.useColors=E,_.storage=P(),_.destroy=(()=>{let D=!1;return()=>{D||(D=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),_.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function E(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function A(D){if(D[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+D[0]+(this.useColors?"%c ":" ")+"+"+T.exports.humanize(this.diff),!this.useColors)return;const B="color: "+this.color;D.splice(1,0,B,"color: inherit");let O=0,F=0;D[0].replace(/%[a-zA-Z%]/g,L=>{L!=="%%"&&(O++,L==="%c"&&(F=O))}),D.splice(F,0,B)}_.log=console.debug||console.log||(()=>{});function R(D){try{D?_.storage.setItem("debug",D):_.storage.removeItem("debug")}catch{}}function I(){let D;try{D=_.storage.getItem("debug")}catch{}return!D&&typeof process<"u"&&"env"in process&&(D=process.env.DEBUG),D}function P(){try{return localStorage}catch{}}T.exports=common(_);const{formatters:C}=T.exports;C.j=function(D){try{return JSON.stringify(D)}catch(B){return"[UnexpectedJSONParseError]: "+B.message}}})(browser,browser.exports);const debug=browser.exports,logger=debug("game"),log={print(T,_,E,A){const R=T==="info"?E:`%c ${T.toUpperCase()} -> ${E}`;A&&T==="info"?logger(R,A):A?logger(R,`color: ${_}`,A):T==="info"?logger(R):logger(R,`color: ${_}`)},debug(T,_){return this.print("debug","#c563ff",T,_)},info(T,_){return this.print("info","",T,_)},warn(T,_){return this.print("warn","#f3f32c",T,_)},error(T,_){return this.print("error","#ff4242",T,_)}},enableDebug=T=>{T?debug.enable("game"):debug.disable()};let socket=null;const socketActions={connect(T){socket=new WebSocket(WS_URL),socket.binaryType="arraybuffer",socket.onopen=()=>{console.log("Connected"),T({e:"connected"})},socket.onerror=_=>{console.debug("Socket error",_),T({e:"error",err:_})},socket.onclose=()=>{console.log("Disconnected"),socket=null,T({e:"disconnected"})},socket.onmessage=_=>{const{data:E}=_,A=new Uint8Array(E),R=A.slice(1),I=A[0];switch(I){case ServerMsgType.lobby_state:T({e:ServerMsgType.lobby_state,data:LobbyState.decode(R)});break;case ServerMsgType.player_msg:case ServerMsgType.player_join_lobby:case ServerMsgType.player_leave_lobby:case ServerMsgType.lobby_game_updated:case ServerMsgType.player_join:log.debug(`Read type ${I}`);break;case ServerMsgType.game_start:{T({e:ServerMsgType.game_start,data:GameStart.decode(R)});break}case ServerMsgType.game_end:{T({e:ServerMsgType.game_end,data:GameEnd.decode(R)});break}case ServerMsgType.tick:{T({e:ServerMsgType.tick,data:Tick.decode(R)});break}default:log.error(`Unknown message type: ${I}`)}}},emit(T,_){const E=new Uint8Array(_.length+1);E.set([T],0),E.set(_,1),socket==null||socket.send(E)},emitJoinLobby(T){const _=PlayerJoinLobby.encode(T).finish(),E=new Uint8Array(_.length+1);E.set([ClientMsgType.join_lobby],0),E.set(_,1),socket==null||socket.send(E)},emitJoinGame(T){const _=PlayerJoinGame.encode(T).finish(),E=new Uint8Array(_.length+1);E.set([ClientMsgType.join_lobby_game],0),E.set(_,1),socket==null||socket.send(E)},emitMove(T){const _=PlayerMove.encode(T).finish(),E=new Uint8Array(_.length+1);E.set([ClientMsgType.player_move],0),E.set(_,1),socket==null||socket.send(E)}},lobbyGames=writable([]),lobbyPlayers=writable([]),playerName=writable("unknown"),gameState=writable("connecting"),gameEnd=writable(void 0),gameId=writable(""),players=writable([]),balls$1=writable([]),playerId=Math.ceil(Math.random()*1e5),localPlayer=writable(void 0),retryConnectTimeout=writable();function handleMessages(T){var _;switch(log.debug("Event:",T),T.e){case"connected":socketActions.emitJoinLobby({playerId,name:get_store_value(playerName)}),gameState.set("lobby");break;case"disconnected":gameState.set("connecting"),retryConnectTimeout.set(setTimeout(()=>{socketActions.connect(handleMessages)},1e3));break;case ServerMsgType.lobby_state:lobbyGames.set(T.data.games),lobbyPlayers.set(T.data.players);break;case ServerMsgType.game_start:gameId.set(T.data.gameId),players.set(T.data.players),balls$1.set(T.data.balls),localPlayer.set(T.data.players.find(R=>R.id===playerId)),gfxActions.initGame(T.data.players,T.data.balls,T.data.rects),gameState.set("game-running");break;case ServerMsgType.game_end:gameEnd.set(T.data),gfxActions.destroy(),gameState.set("game-ended");break;case ServerMsgType.tick:const E=T.data;players.update(R=>(E.cursors.forEach((I,P)=>{R[P].cursor=I}),R));const A=get_store_value(mouse);socketActions.emitMove({gameId:E.gameId,playerNumber:((_=get_store_value(localPlayer))==null?void 0:_.playerNumber)||0,mouseX:A.x,mouseY:A.y}),gfxActions.updateBalls(E.balls,get_store_value(players));break}}const gameActions={setPlayerName(T){playerName.set(T)},runGame(){gameState.set("connecting"),socketActions.connect(handleMessages)},joinLobby(){gameState.set("lobby"),socketActions.emit(ClientMsgType.join_lobby,PlayerJoinLobby.encode({playerId,name:get_store_value(playerName)}).finish())},createGame(T){const _={playerId,name:get_store_value(playerName),color:"poop",options:T};socketActions.emit(ClientMsgType.create_lobby_game,PlayerCreateGame.encode(_).finish()),gameState.set("waiting-game-start")},joinGame(T,_){const E={gameId:T.gameId,playerId,name:get_store_value(playerName),color:"poop",options:_};socketActions.emit(ClientMsgType.join_lobby_game,PlayerJoinGame.encode(E).finish()),gameState.set("waiting-game-start")}};k([mixPlugin]);const width=1920,height=1072,globalCursors=writable([]),balls=writable([]),mouse=writable({x:0,y:0});let app;const gfxActions={initGame(T,_,E){app=new Application({width,height,backgroundAlpha:0,useContextAlpha:!1});let A=performance.now();app.ticker.add(()=>{var D;const R=(D=get_store_value(localPlayer))==null?void 0:D.playerNumber;if(get_store_value(gameState)!=="game-running")return;if(R===void 0){console.error("undefined playerNumber!");return}const I=performance.now()-A;A=performance.now();const P=.01*I,C=Math.min(1,.01*I);balls.update(B=>B.map(O=>(O.x+=(O.targetX-O.x)*P,O.y+=(O.targetY-O.y)*P,O.pixiBall.x=O.x,O.pixiBall.y=O.y,O))),globalCursors.update(B=>B.map(O=>(O.player==R?(O.x=get_store_value(mouse).x,O.y=get_store_value(mouse).y):(O.x+=(O.targetX-O.x)*C,O.y+=(O.targetY-O.y)*C),O)))}),globalCursors.set(T.map(R=>({...R.cursor,color:R.color,targetX:R.cursor.x,targetY:R.cursor.y}))),balls.set(_.map(R=>{const I=new Graphics;return I.lineStyle(0),I.beginFill(16777215,1),I.drawCircle(0,0,R.radius),I.endFill(),app.stage.addChild(I),{...R,targetX:R.x,targetY:R.y,pixiBall:I}})),E.forEach(R=>{const I=new Graphics;I.width=R.width,I.height=R.height,I.lineStyle(0),I.beginFill(16777215,1),I.drawRect(0,0,R.width,R.height),I.endFill(),I.pivot.set(-.5,-.5),I.position.set(R.x,R.y),I.rotation=R.rotation,app.stage.addChild(I)})},destroy(){get_store_value(balls).forEach(T=>{T.pixiBall.destroy()}),app.destroy(),globalCursors.set([]),balls.set([])},updateMouse(T,_){if(T<0||T>=width||_<0||_>=height){console.error("Invalid mouse position",T,_);return}mouse.set({x:T,y:_})},updateBalls(T,_){balls.update(E=>E.map((A,R)=>{const I=T[R];let P=w(argbToHex(I.color));I.owners.forEach(D=>{var O;const B=(O=_.find(F=>F.playerNumber===D.player))==null?void 0:O.color;B&&(P=P.mix(argbToHex(B),D.percentage))});const C=hexToArgb(P.toHex());return A.pixiBall.tint=C,{...A,targetX:T[R].x,targetY:T[R].y,color:C}}))}},argbToHex=T=>"#"+T.toString(16).slice(2),hexToArgb=T=>parseInt(T.slice(1),16),Canvas_svelte_svelte_type_style_lang="";function create_fragment$2(T){let _,E,A=`${width} / ${height}`;return{c(){_=element("div"),E=element("div"),attr(E,"class","canvas-wrapper svelte-am5vch"),set_style(E,"aspect-ratio",A),attr(_,"class","game svelte-am5vch")},m(R,I){insert(R,_,I),append(_,E),T[1](E)},p:noop$1,i:noop$1,o:noop$1,d(R){R&&detach(_),T[1](null)}}}function instance$2(T,_,E){let A;onMount(()=>{A.appendChild(app.view)});function R(I){binding_callbacks[I?"unshift":"push"](()=>{A=I,E(0,A)})}return[A,R]}class Canvas extends SvelteComponent{constructor(_){super(),init$1(this,_,instance$2,create_fragment$2,safe_not_equal,{})}}const Lobby_svelte_svelte_type_style_lang="";function get_each_context(T,_,E){const A=T.slice();return A[14]=_[E],A[16]=E,A}function create_else_block(T){let _,E=T[4],A=[];for(let R=0;R<E.length;R+=1)A[R]=create_each_block(get_each_context(T,E,R));return{c(){_=element("ul");for(let R=0;R<A.length;R+=1)A[R].c();attr(_,"class","svelte-1beqg5q")},m(R,I){insert(R,_,I);for(let P=0;P<A.length;P+=1)A[P].m(_,null)},p(R,I){if(I&272){E=R[4];let P;for(P=0;P<E.length;P+=1){const C=get_each_context(R,E,P);A[P]?A[P].p(C,I):(A[P]=create_each_block(C),A[P].c(),A[P].m(_,null))}for(;P<A.length;P+=1)A[P].d(1);A.length=E.length}},d(R){R&&detach(_),destroy_each(A,R)}}}function create_if_block$1(T){let _;return{c(){_=element("h3"),_.textContent="No games",set_style(_,"margin-top","2rem")},m(E,A){insert(E,_,A)},p:noop$1,d(E){E&&detach(_)}}}function create_each_block(T){let _,E,A,R,I=T[14].players+"",P,C,D=T[14].maxPlayers+"",B,O,F,L;function U(){return T[9](T[16])}return{c(){_=element("li"),E=element("div"),A=element("button"),R=text("Players: "),P=text(I),C=text("/"),B=text(D),O=space(),attr(A,"class","svelte-1beqg5q")},m(G,X){insert(G,_,X),append(_,E),append(E,A),append(A,R),append(A,P),append(A,C),append(A,B),append(_,O),F||(L=listen(A,"click",U),F=!0)},p(G,X){T=G,X&16&&I!==(I=T[14].players+"")&&set_data(P,I),X&16&&D!==(D=T[14].maxPlayers+"")&&set_data(B,D)},d(G){G&&detach(_),F=!1,L()}}}function create_fragment$1(T){let _,E,A,R,I,P,C,D,B,O,F,L,U,G,X,W,V,q,z,Y,K,it,et,Q,ot,at,rt,nt,tt,Z,ht,ut,st,ft,yt,J,lt,dt;function mt(ct,_t){return ct[4].length===0?create_if_block$1:create_else_block}let pt=mt(T),gt=pt(T);return{c(){_=element("div"),E=element("h1"),E.textContent="Liquid War",A=space(),R=element("div"),I=element("div"),gt.c(),P=space(),C=element("form"),D=element("div"),B=element("label"),B.textContent="Name",O=space(),F=element("input"),L=space(),U=element("button"),U.textContent="Play",G=space(),X=element("details"),W=element("summary"),W.textContent="Custom game options",V=space(),q=element("div"),z=element("label"),z.textContent="Server tick rate",Y=space(),K=element("input"),it=space(),et=element("div"),Q=element("label"),Q.textContent="Liquid per player",ot=space(),at=element("input"),rt=space(),nt=element("div"),tt=element("label"),tt.textContent="Cursor speed",Z=space(),ht=element("input"),ut=space(),st=element("div"),ft=element("label"),ft.textContent="Players",yt=space(),J=element("input"),attr(E,"class","svelte-1beqg5q"),attr(I,"class","games svelte-1beqg5q"),attr(B,"for","name"),attr(B,"class","svelte-1beqg5q"),attr(F,"id","name"),F.value=T[5],attr(F,"class","svelte-1beqg5q"),attr(D,"class","field svelte-1beqg5q"),set_style(U,"background","var(--confirm-color)"),attr(U,"class","svelte-1beqg5q"),attr(W,"class","svelte-1beqg5q"),attr(z,"for","serverTickRate"),attr(z,"class","svelte-1beqg5q"),attr(K,"id","serverTickRate"),attr(K,"class","svelte-1beqg5q"),attr(q,"class","field svelte-1beqg5q"),attr(Q,"for","liquid"),attr(Q,"class","svelte-1beqg5q"),attr(at,"id","liquid"),attr(at,"class","svelte-1beqg5q"),attr(et,"class","field svelte-1beqg5q"),attr(tt,"for","cursor"),attr(tt,"class","svelte-1beqg5q"),attr(ht,"id","cursor"),attr(ht,"class","svelte-1beqg5q"),attr(nt,"class","field svelte-1beqg5q"),attr(ft,"for","players"),attr(ft,"class","svelte-1beqg5q"),attr(J,"id","players"),attr(J,"class","svelte-1beqg5q"),attr(st,"class","field svelte-1beqg5q"),X.open=!0,attr(X,"class","svelte-1beqg5q"),attr(C,"class","svelte-1beqg5q"),attr(R,"class","body svelte-1beqg5q"),attr(_,"class","container svelte-1beqg5q")},m(ct,_t){insert(ct,_,_t),append(_,E),append(_,A),append(_,R),append(R,I),gt.m(I,null),append(R,P),append(R,C),append(C,D),append(D,B),append(D,O),append(D,F),append(C,L),append(C,U),append(C,G),append(C,X),append(X,W),append(X,V),append(X,q),append(q,z),append(q,Y),append(q,K),set_input_value(K,T[0]),append(X,it),append(X,et),append(et,Q),append(et,ot),append(et,at),set_input_value(at,T[1]),append(X,rt),append(X,nt),append(nt,tt),append(nt,Z),append(nt,ht),set_input_value(ht,T[2]),append(X,ut),append(X,st),append(st,ft),append(st,yt),append(st,J),set_input_value(J,T[3]),lt||(dt=[listen(F,"input",T[6]),listen(K,"input",T[10]),listen(at,"input",T[11]),listen(ht,"input",T[12]),listen(J,"input",T[13]),listen(C,"submit",prevent_default(T[7]))],lt=!0)},p(ct,[_t]){pt===(pt=mt(ct))&&gt?gt.p(ct,_t):(gt.d(1),gt=pt(ct),gt&&(gt.c(),gt.m(I,null))),_t&32&&F.value!==ct[5]&&(F.value=ct[5]),_t&1&&K.value!==ct[0]&&set_input_value(K,ct[0]),_t&2&&at.value!==ct[1]&&set_input_value(at,ct[1]),_t&4&&ht.value!==ct[2]&&set_input_value(ht,ct[2]),_t&8&&J.value!==ct[3]&&set_input_value(J,ct[3])},i:noop$1,o:noop$1,d(ct){ct&&detach(_),gt.d(),lt=!1,run_all(dt)}}}function instance$1(T,_,E){let A,R;component_subscribe(T,lobbyGames,V=>E(4,A=V)),component_subscribe(T,playerName,V=>E(5,R=V));let I,P,C,D=2;onMount(()=>{function V(q){q.data.type&&q.data.type==="play"&&(E(3,D=q.data.players),document.querySelector("button").click())}return window.addEventListener("message",V),()=>{window.removeEventListener("message",V)}});function B(V){gameActions.setPlayerName(V.currentTarget.value)}function O(){gameActions.createGame({serverTickRate:I||0,liquidPerPlayer:P||0,cursorSpeed:C||0,players:D})}function F(V){const q=A[V];gameActions.joinGame(q,{serverTickRate:I||0,liquidPerPlayer:P||0,cursorSpeed:C||0,players:D})}const L=V=>F(V);function U(){I=this.value,E(0,I)}function G(){P=this.value,E(1,P)}function X(){C=this.value,E(2,C)}function W(){D=this.value,E(3,D)}return[I,P,C,D,A,R,B,O,F,L,U,G,X,W]}class Lobby extends SvelteComponent{constructor(_){super(),init$1(this,_,instance$1,create_fragment$1,safe_not_equal,{})}}function initializeAI(){balls.subscribe(T=>{const _=get_store_value(localPlayer);if(_){const E=T.find(A=>A.player!==_.playerNumber);gfxActions.updateMouse(E.x,E.y)}})}const App_svelte_svelte_type_style_lang="";function create_if_block_4(T){let _;return{c(){_=element("div"),_.innerHTML=`<h1 class="svelte-1p7dfao">Liquid War</h1> 
      <p>Connecting...</p>`,attr(_,"class","loading-menu svelte-1p7dfao")},m(E,A){insert(E,_,A)},p:noop$1,i:noop$1,o:noop$1,d(E){E&&detach(_)}}}function create_if_block_3(T){let _,E;return _=new Canvas({}),{c(){create_component(_.$$.fragment)},m(A,R){mount_component(_,A,R),E=!0},p:noop$1,i(A){E||(transition_in(_.$$.fragment,A),E=!0)},o(A){transition_out(_.$$.fragment,A),E=!1},d(A){destroy_component(_,A)}}}function create_if_block_2(T){let _,E,A,R,I,P,C,D,B;return{c(){_=element("div"),E=element("marquee"),E.textContent="Game ended",A=space(),R=element("p"),I=text(T[0]),P=space(),C=element("button"),C.textContent="Play again",attr(E,"class","title svelte-1p7dfao"),attr(E,"width","50%"),attr(R,"class","game-winner svelte-1p7dfao"),attr(C,"class","svelte-1p7dfao"),attr(_,"class","end-menu svelte-1p7dfao")},m(O,F){insert(O,_,F),append(_,E),append(_,A),append(_,R),append(R,I),append(_,P),append(_,C),D||(B=listen(C,"click",T[2]),D=!0)},p(O,F){F&1&&set_data(I,O[0])},i:noop$1,o:noop$1,d(O){O&&detach(_),D=!1,B()}}}function create_if_block_1(T){let _,E;return _=new Lobby({}),{c(){create_component(_.$$.fragment)},m(A,R){mount_component(_,A,R),E=!0},p:noop$1,i(A){E||(transition_in(_.$$.fragment,A),E=!0)},o(A){transition_out(_.$$.fragment,A),E=!1},d(A){destroy_component(_,A)}}}function create_if_block(T){let _;return{c(){_=element("div"),_.innerHTML="<h2>Waiting for players\u2026</h2>",attr(_,"class","loading-menu svelte-1p7dfao")},m(E,A){insert(E,_,A)},p:noop$1,i:noop$1,o:noop$1,d(E){E&&detach(_)}}}function create_fragment(T){let _,E,A,R;const I=[create_if_block,create_if_block_1,create_if_block_2,create_if_block_3,create_if_block_4],P=[];function C(D,B){return D[1]==="waiting-game-start"?0:D[1]==="lobby"?1:D[1]==="game-ended"?2:D[1]==="game-running"?3:D[1]==="connecting"?4:-1}return~(E=C(T))&&(A=P[E]=I[E](T)),{c(){_=element("main"),A&&A.c(),attr(_,"class","svelte-1p7dfao")},m(D,B){insert(D,_,B),~E&&P[E].m(_,null),R=!0},p(D,[B]){let O=E;E=C(D),E===O?~E&&P[E].p(D,B):(A&&(group_outros(),transition_out(P[O],1,1,()=>{P[O]=null}),check_outros()),~E?(A=P[E],A?A.p(D,B):(A=P[E]=I[E](D),A.c()),transition_in(A,1),A.m(_,null)):A=null)},i(D){R||(transition_in(A),R=!0)},o(D){transition_out(A),R=!1},d(D){D&&detach(_),~E&&P[E].d()}}}function instance(T,_,E){let A,R;component_subscribe(T,gameEnd,C=>E(3,A=C)),component_subscribe(T,gameState,C=>E(1,R=C));let I="";onMount(()=>{const C=new URLSearchParams(window.location.search);C.has("autoplay")&&window.addEventListener("load",()=>{document.querySelector("button").click()}),C.has("ai")&&initializeAI(),window.addEventListener("pointermove",function(D){let B=document.querySelector("canvas");if(!B)return;let O=B.getBoundingClientRect();if(D.clientX>=O.left&&D.clientX<O.right&&D.clientY>=O.top&&D.clientY<O.bottom){let F=B.width/O.width,L=B.height/O.height;gfxActions.updateMouse((D.clientX-O.left)*F,(D.clientY-O.top)*L)}},!1),gameActions.runGame()});function P(){gameActions.joinLobby()}return T.$$.update=()=>{var C,D;if(T.$$.dirty&8){const B=A;B&&(B.result===GameStatus.PLAYER_WON&&((C=B.winner)==null?void 0:C.id)===playerId?E(0,I="You won \u{1F3C6} :DD"):B.result===GameStatus.PLAYER_WON&&((D=B.winner)==null?void 0:D.id)!==playerId?E(0,I="You lost \u{1F635}"):B.result===GameStatus.TIE?E(0,I="Tie \u{1F926}\u200D\u2642\uFE0F"):B.result===GameStatus.AI_WON?E(0,I="Computer won \u{1F916}"):E(0,I=`Something weird happened: ${GameStatus}`))}},[I,R,P,A]}class App extends SvelteComponent{constructor(_){super(),init$1(this,_,instance,create_fragment,safe_not_equal,{})}}const index="";enableDebug(!1);const el=document.querySelector("#app");el&&new App({target:el});
